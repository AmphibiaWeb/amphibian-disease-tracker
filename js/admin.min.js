var _7zHandler,bootstrapTransect,bootstrapUploader,csvHandler,dataFileParams,excelHandler,helperDir,imageHandler,loadCreateNewProject,loadEditor,loadProjectBrowser,newGeoDataHandler,populateAdminActions,removeDataFile,singleDataFileHelper,startAdminActionHelper,user,verifyLoginCredentials,zipHandler;window.adminParams={},adminParams.domain="amphibiandisease",adminParams.apiTarget="admin_api.php",adminParams.adminPageUrl="https://"+adminParams.domain+".org/admin-page.html",adminParams.loginDir="admin/",adminParams.loginApiTarget=adminParams.loginDir+"async_login_handler.php",dataFileParams={},dataFileParams.hasDataFile=!1,dataFileParams.fileName=null,dataFileParams.filePath=null,helperDir="helpers/",user=$.cookie(adminParams.domain+"_link"),window.loadAdminUi=function(){var a;try{verifyLoginCredentials(function(a){var b;return b="<h3>\n  Welcome, "+$.cookie(adminParams.domain+"_name")+'\n  <span id="pib-wrapper-settings" class="pib-wrapper" data-toggle="tooltip" title="User Settings" data-placement="bottom">\n    <paper-icon-button icon=\'icons:settings-applications\' class=\'click\' data-href=\''+a.login_url+"'></paper-icon-button>\n  </span>\n\n</h3>\n<section id='admin-actions-block' class=\"row center-block text-center\">\n  <div class='bs-callout bs-callout-info'>\n    <p>Please be patient while the administrative interface loads.</p>\n  </div>\n</section>",$("main #main-body").before(b),populateAdminActions(),bindClicks(),!1})}catch(b){a=b,$("main #main-body").html("<div class='bs-callout bs-callout-danger'><h4>Application Error</h4><p>There was an error in the application. Please refresh and try again. If this persists, please contact administration.</p></div>")}return!1},populateAdminActions=function(){var a;return a='<paper-button id="new-project" class="admin-action col-md-3 col-sm-4 col-xs-12" raised>\n  <iron-icon icon="icons:add"></iron-icon>\n    Create New Project\n</paper-button>\n<paper-button id="edit-project" class="admin-action col-md-3 col-sm-4 col-xs-12" raised>\n  <iron-icon icon="icons:create"></iron-icon>\n    Edit Existing Project\n</paper-button>\n<paper-button id="view-project" class="admin-action col-md-3 col-sm-4 col-xs-12" raised>\n  <iron-icon icon="icons:visibility"></iron-icon>\n    View All Projects\n</paper-button>',$("#admin-actions-block").html(a),$("#show-actions").remove(),$("main #main-body").empty(),$("#new-project").click(function(){return loadCreateNewProject()}),$("#edit-project").click(function(){return loadEditor()}),$("#view-project").click(function(){return loadProjectBrowser()})},verifyLoginCredentials=function(a){var b,c,d,e;return c=$.cookie(adminParams.domain+"_auth"),e=$.cookie(adminParams.domain+"_secret"),d=$.cookie(adminParams.domain+"_link"),b="hash="+c+"&secret="+e+"&dblink="+d,$.post(adminParams.loginApiTarget,b,"json").done(function(b){return b.status===!0?a(b):goTo(b.login_url)}).fail(function(a,b){return $("main #main-body").html("<div class='bs-callout-danger bs-callout'><h4>Couldn't verify login</h4><p>There's currently a server problem. Try back again soon.</p></div>"),console.log(a,b),!1}),!1},startAdminActionHelper=function(){var a;return $("#admin-actions-block").empty(),a='<span id="pib-wrapper-dashboard" class="pib-wrapper" data-toggle="tooltip" title="Administration Home" data-placement="bottom">\n  <paper-icon-button icon="icons:dashboard" class="admin-action" id="show-actions">\n  </paper-icon-button>\n</span>',$("#pib-wrapper-settings").after(a),$("#show-actions").click(function(){return $(this).tooltip("hide"),$(".tooltip").tooltip("hide"),populateAdminActions()})},loadEditor=function(){return startAdminActionHelper(),adData.cartoRef="38544c04-5e56-11e5-8515-0e4fddd5de28",geo.init(),foo(),!1},loadCreateNewProject=function(){var a;return startAdminActionHelper(),a='<h2 class="new-title">Project Title</h2>\n<paper-input label="Project Title" id="project-title" class="project-field col-md-6 col-xs-12" required autovalidate="true"></paper-input>\n<h2 class="new-title">Project Parameters</h2>\n<section class="project-inputs clearfix">\n  <paper-input label="Primary Disease Studied" id="project-disease" class="project-field col-md-6 col-xs-12" required autovalidate="true"></paper-input>\n  <paper-input label="Project Reference" id="reference-id" class="project-field col-md-6 col-xs-12"></paper-input>\n  <h2 class="new-title">Lab Parameters</h2>\n  <paper-input label="Project PI" id="project-pi" class="project-field col-md-6 col-xs-12"  required autovalidate="true"></paper-input>\n  <paper-input label="Project Contact" id="project-author" class="project-field col-md-6 col-xs-12"  required autovalidate="true"></paper-input>\n  <gold-email-input label="Contact Email" id="author-email" class="project-field col-md-6 col-xs-12"  required autovalidate="true"></gold-email-input>\n  <paper-input label="Project Lab" id="project-lab" class="project-field col-md-6 col-xs-12"  required autovalidate="true"></paper-input>\n  <h2 class="new-title">Project Notes</h2>\n  <iron-autogrow-textarea id="project-notes" class="project-field col-md-6 col-xs-12" rows="3"></iron-autogrow-textarea>\n  <h2 class="new-title">Data Parameters</h2>\n  <paper-input label="Samples Counted" placeholder="Please upload a data file to see sample count" class="project-field col-md-6 col-xs-12" id="samplecount" readonly type="number"></paper-input>\n  <h2 class="new-title">Data Permissions</h2>\n  <div class="col-xs-12">\n    <span class="toggle-off-label iron-label">Private Dataset</span>\n    <paper-toggle-button id="transect-input-toggle">Public Dataset</paper-toggle-button>\n  </div>      \n    <p><strong>Smart selector here for registered users</strong>, only show when "private" toggle set</p>\n  <h2 class="new-title">Project Area of Interest</h2>\n  <p>This represents the approximate collection region for your samples. If you don\'t enter anything, we\'ll guess from your dataset.</p>\n  <div class="col-xs-12">\n    <span class="toggle-off-label iron-label">Locality Name</span>\n    <paper-toggle-button id="transect-input-toggle">Coordinate List</paper-toggle-button>\n  </div>\n  <p id="transect-instructions" class="col-xs-12"></p>\n  <div id="transect-input" class="col-md-6 col-xs-12">\n  </div>\n  <div id="carto-rendered-map" class="col-md-6">\n    <div id="carto-map-container" class="carto-map map">\n    </div>\n  </div>\n</section>\n<p>Etc</p>\n<h2 class="new-title">Uploading your project data</h2>\n<p>Drag and drop as many files as you need below. </p>\n<p>\n  To save your project, we need at least one file with structured data containing coordinates.\n  Please note that the data <strong>must</strong> have a header row,\n  and the data <strong>must</strong> have the columns <code>decimalLatitude</code>, <code>decimalLongitude</code>, <code>alt</code>, and <code>coordinateUncertaintyInMeters</code>.\n</p>',$("main #main-body").append(a),bootstrapUploader(),bootstrapTransect(),foo(),!1},loadProjectBrowser=function(){var a;return startAdminActionHelper(),a="<div class='bs-callout bs-callout-warn center-block col-md-5'>\n  <p>Function worked, there's just nothing to show yet.</p>\n  <p>Imagine the beautiful and functional browser of all projects you have access to of your dreams, here.</p>\n</div>",$("#main-body").html(a),adData.cartoRef="38544c04-5e56-11e5-8515-0e4fddd5de28",geo.init(),foo(),!1},bootstrapTransect=function(){var a,b,c;return c=function(a){return foo(),!1},a=function(){var a;return window.geocodeLookupCallback=function(){var a,b,c;return startLoad(),b=p$("#locality-input").value,a=new google.maps.Geocoder,c={address:b},a.geocode(c,function(a,b){var c,d,e,f,g,h,i,j;return b===google.maps.GeocoderStatus.OK?(console.info("Google said:",a),$("#locality-lookup-result").exists()||$("#carto-rendered-map").prepend('<div class="alert alert-info alert-dismissable" role="alert" id="locality-lookup-result">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Location Found</strong>: <span class="lookup-name"></span>\n</div>'),$("#locality-lookup-result .lookup-name").text(a[0].formatted_address),j=a[0].geometry.location,h=j.lat(),i=j.lng(),f=a[0].geometry.viewport,c=f.O,d=f.j,e={nw:[c.O,d.O],ne:[c.j,d.O],sw:[c.O,d.j],se:[c.j,d.j]},console.info("Got bounds: ",[h,i],e),g=function(){var a;return a={cartodb_logo:!1,https:!0,mobile_layout:!0,gmaps_base_type:"hybrid",center_lat:h,center_lon:i,zoom:7},$("#carto-map-container").empty(),createMap(null,"carto-map-container",a,function(a,b){return foo()})},loadJS("js/cartodb.js",g,!1),stopLoad()):stopLoadError("Couldn't find location: "+b)})},null==("undefined"!=typeof google&&null!==google?google.maps:void 0)?loadJS("https://maps.googleapis.com/maps/api/js?key="+gMapsApiKey+"&callback=geocodeLookupCallback"):geocodeLookupCallback(),a=[],c(a),!1},(b=function(){var b,d;return p$("#transect-input-toggle").checked?(b="Please input a list of coordinates, in the form <code>lat, lng</code>, with one set on each line. <strong>Please press <kbd>enter</kbd> to insert a new line after your last coordinate</strong>.",d='<iron-autogrow-textarea id="coord-input" class="" required rows="3"></iron-autogrow-textarea>'):(b="Please enter a name of a locality",d='<paper-input id="locality-input" label="Locality" class="pull-left" required autovalidate></paper-input> <paper-icon-button class="pull-left" id="do-search-locality" icon="icons:search"></paper-icon-button>'),$("#transect-instructions").html(b),$("#transect-input").html(d),p$("#transect-input-toggle").checked?$(p$("#coord-input").textarea).keyup(function(a){return function(a){var b,d,e,f,g,h,i,j,k,l;if(h=a.keyCode?a.keyCode:a.which,13===h&&(l=$(p$("#coord-input").textarea).val(),j=l.split("\n").length,j>3)){for(e=[],f=l.split("\n"),g=0,i=f.length;i>g;g++)b=f[g],b.search(!1)&&(d=b.split(","),k=[toFloat(d[0]),toFloat(d[1])],e.push(k));return e.length>=3?(console.info("Coords:",e),c(e)):console.warn("There is one or more invalid coordinates preventing the UI from being shown.")}}}(this)):($("#locality-input").keyup(function(b){var c;return c=b.keyCode?b.keyCode:b.which,13===c?a():void 0}),$("#do-search-locality").click(function(){return a()})),!1})(),$("#transect-input-toggle").on("iron-change",function(){return b()}),!1},bootstrapUploader=function(a){var b,c;return null==a&&(a="file-uploader"),c="#"+a,$(c).exists()||(b='<form id="'+a+'-form" class="col-md-4 clearfix">\n  <p class="visible-xs-block">Tap the button to upload a file</p>\n  <fieldset class="hidden-xs">\n    <legend>Upload Files</legend>\n    <div id="'+a+'" class="media-uploader outline media-upload-target">\n    </div>\n  </fieldset>\n</form>',$("main #main-body").append(b),$(c).submit(function(a){return a.preventDefault(),a.stopPropagation(),!1})),verifyLoginCredentials(function(){return null==window.dropperParams&&(window.dropperParams={}),window.dropperParams.uploadPath="uploaded/"+user+"/",loadJS("helpers/js-dragdrop/client-upload.min.js",function(){return console.info("Loaded drag drop helper"),window.dropperParams.postUploadHandler=function(a,b){var c,d,e,f,g,h;if(window.dropperParams.dropzone.removeAllFiles(),"object"!=typeof b)return console.error("Dropzone returned an error - "+b),toastStatusMessage("There was a problem with the server handling your image. Please try again."),!1;if(b.status!==!0)return null==b.human_error&&(b.human_error="There was a problem uploading your image."),toastStatusMessage(""+b.human_error),console.error("Error uploading!",b),!1;try{switch(console.info("Server returned the following result:",b),console.info("The script returned the following file information:",a),g="helpers/js-dragdrop/uploaded/"+user+"/",b.full_path=b.wrote_file,b.thumb_path=b.wrote_thumb,f=b.mime_provided.split("/")[0],e=b.mime_provided.split("/")[1],d=a.size<5242880||"image"!==f?""+g+b.full_path:""+g+b.thumb_path,h=function(){switch(f){case"image":return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <img src="'+d+'" alt=\'Uploaded Image\' class="img-circle thumb-img img-responsive"/>\n    <p class="text-muted">\n      '+a.name+" -> "+b.full_path+'\n  (<a href="'+d+'" class="newwindow" download="'+a.name+'">\n    Original Image\n  </a>)\n    </p>\n</div>';case"audio":return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <audio src="'+d+'" controls preload="auto">\n    <span class="glyphicon glyphicon-music"></span>\n    <p>\n      Your browser doesn\'t support the HTML5 <code>audio</code> element.\n      Please download the file below.\n    </p>\n  </audio>\n  <p class="text-muted">\n    '+a.name+" -> "+b.full_path+'\n    (<a href="'+d+'" class="newwindow" download="'+a.name+'">\n      Original Media\n    </a>)\n  </p>\n</div>';case"video":return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <video src="'+d+'" controls preload="auto">\n    <img src="'+g+b.thumb_path+'" alt="Video Thumbnail" class="img-responsive" />\n    <p>\n      Your browser doesn\'t support the HTML5 <code>video</code> element.\n      Please download the file below.\n    </p>\n  </video>\n  <p class="text-muted">\n    '+a.name+" -> "+b.full_path+'\n    (<a href="'+d+'" class="newwindow" download="'+a.name+'">\n      Original Media\n    </a>)\n  </p>\n</div>';default:return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <span class="glyphicon glyphicon-file"></span>\n  <p class="text-muted">'+a.name+" -> "+b.full_path+"</p>\n</div>"}}(),$(window.dropperParams.dropTargetSelector).before(h),f){case"application":switch(console.info("Checking "+e+" in application"),e){case"vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"vnd.ms-excel":return excelHandler(d);case"zip":case"x-zip-compressed":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===a.type||"xlsx"===d.split(".").pop()?excelHandler(d):zipHandler(d);case"x-7z-compressed":return _7zHandler(d)}break;case"text":return csvHandler();case"image":return imageHandler()}}catch(i){return c=i,toastStatusMessage("Your file uploaded successfully, but there was a problem in the post-processing.")}}}),!1})},singleDataFileHelper=function(a,b){var c;return"function"!=typeof b?(console.error("Second argument must be a function"),!1):dataFileParams.hasDataFile===!0?($("#single-data-file-modal").exists()&&$("#single-data-file-modal").remove(),c='<paper-dialog modal id="single-data-file-modal">\n  <h2>You can only have one primary data file</h2>\n  <div>\n    Continuing will remove your previous one\n  </div>\n  <div class="buttons">\n    <paper-button id="cancel-parse">Cancel Upload</paper-button>\n    <paper-button id="overwrite">Replace Previous</paper-button>\n  </div>\n</paper-dialog>',$("body").append(c),$("#cancel-parse").click(function(){return removeDataFile(a,!1),p$("#single-data-file-modal").close(),!1}),$("#overwrite").click(function(){return removeDataFile(),p$("#single-data-file-modal").close(),b()}),safariDialogHelper("#single-data-file-modal")):b()},excelHandler=function(a,b){var c,d,e;return null==b&&(b=!0),startLoad(),toastStatusMessage("Processing ..."),e=helperDir+"excelHelper.php",d=a,a.search(-1!==helperDir)&&(d=a.slice(helperDir.length)),console.info("Pinging for "+d),c="action=parse&path="+d,$.get(e,c,"json").done(function(b){return console.info("Got result",b),singleDataFileHelper(a,function(){var c,e,f,g;return dataFileParams.hasDataFile=!0,dataFileParams.fileName=a,dataFileParams.filePath=d,g=Object.size(b.data),e="",g>0&&(f=randomInt(1,g)-1,e="\n\nHere's a random row: "+JSON.stringify(b.data[f])),c="<pre>\nFrom upload, fetched "+g+" rows."+e+"\n</pre>",$("#main-body").append(c),newGeoDataHandler(b.data),stopLoad()})}).fail(function(a,b){return console.error("Couldn't POST"),console.warn(a,b),stopLoadError()}),!1},csvHandler=function(a){return dataFileParams.hasDataFile=!0,dataFileParams.fileName=a,dataFileParams.filePath=correctedPath,geoDataHandler(),!1},imageHandler=function(a){return foo(),!1},zipHandler=function(a){return foo(),!1},_7zHandler=function(a){return foo(),!1},removeDataFile=function(a,b){var c,d;return null==a&&(a=dataFileParams.fileName),null==b&&(b=!0),a=a.split("/").pop(),b&&(dataFileParams.hasDataFile=!1),$(".uploaded-media[data-system-file='"+a+"']").remove(),d=helperDir+"/js-dragdrop/uploaded/"+user+"/"+a,c="action=removefile&path="+encode64(a)+"&user="+user,!1},newGeoDataHandler=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;null==a&&(a={});try{try{p=a[0]}catch(v){return toastStatusMessage("Your data file was malformed, and could not be parsed. Please try again."),removeDataFile(),!1}if(null==p.decimalLatitude||null==p.decimalLongitude||null==p.coordinateUncertaintyInMeters||null==p.alt)return toastStatusMessage("Data are missing required geo columns. Please reformat and try again."),console.info("Missing: ",null!=p.decimalLatitude,null!=p.decimalLongitude,null!=p.coordinateUncertaintyInMeters,null!=p.alt),removeDataFile(),!1;if(!(isNumber(p.decimalLatitude)&&isNumber(p.decimalLongitude)&&isNumber(p.coordinateUncertaintyInMeters)&&isNumber(p.alt)))return toastStatusMessage("Data has invalid entries for geo columns. Please be sure they're all numeric and try again."),removeDataFile(),!1;o=Object.size(a),p$("#samplecount").value=o,isNull(p$("#project-disease"))&&(p$("#project-disease").value=p.diseaseTested),k={};for(j in a){n=a[j],s={};for(c in n){switch(u=n[c],c){case"dateIdentified":try{u>0&&1e6>u?(f=25569,g=24107,q=86400,r=(u-f)*q*1e3):r=Date.parse(u)}catch(v){r=Date.now()}d=new Date(r),e=d.getUTCDate(),10>e&&(e="0"+e),i=d.getUTCMonth()+1,10>i&&(i="0"+i),b=d.getUTCFullYear()+"-"+i+"-"+e;break;case"fatal":b=u.toBool();break;case"decimalLatitude":case"decimalLongitude":case"alt":case"coordinateUncertaintyInMeters":b=toFloat(u);break;case"diseaseDetected":b=isBool(u)?u.toBool():"NO_CONFIDENCE";break;default:try{b=u.trim()}catch(v){b=u}}s[c]=b}k[j]=s}try{l=JsonHuman.format(k),$("#main-body").append(l)}catch(v){h=v,console.warn("Couldn't pretty set!"),console.warn(h.stack),console.info(k)}m="t"+md5(p$("#project-title").value+$.cookie(uri.domain+"_link")),t={transectRing:void 0,data:k},geo.requestCartoUpload(t,m,"create")}catch(v){h=v,console.error(h.message),toastStatusMessage("There was a problem parsing your data")}return!1},$(function(){return $("#next").exists()&&$("#next").unbind().click(function(){return openTab(adminParams.adminPageUrl)}),loadJS("bower_components/bootstrap/dist/js/bootstrap.min.js",function(){return $("body").tooltip({selector:"[data-toggle='tooltip']"})})});
//# sourceMappingURL=maps/c.map