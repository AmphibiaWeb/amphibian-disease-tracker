var _7zHandler,addPointsToMap,bootstrapTransect,bootstrapUploader,csvHandler,dataAttrs,dataFileParams,excelHandler,finalizeData,getCanonicalDataCoords,getInfoTooltip,getTableCoordinates,helperDir,imageHandler,loadCreateNewProject,loadEditor,loadProjectBrowser,mapAddPoints,mapOverlayPolygon,newGeoDataHandler,pointStringToLatLng,pointStringToPoint,populateAdminActions,removeDataFile,resetForm,singleDataFileHelper,startAdminActionHelper,user,verifyLoginCredentials,zipHandler;window.adminParams={},adminParams.domain="amphibiandisease",adminParams.apiTarget="admin_api.php",adminParams.adminPageUrl="https://"+adminParams.domain+".org/admin-page.html",adminParams.loginDir="admin/",adminParams.loginApiTarget=adminParams.loginDir+"async_login_handler.php",dataFileParams={},dataFileParams.hasDataFile=!1,dataFileParams.fileName=null,dataFileParams.filePath=null,dataAttrs={},helperDir="helpers/",user=$.cookie(adminParams.domain+"_link"),window.loadAdminUi=function(){var a;try{verifyLoginCredentials(function(a){var b;return b="<h3>\n  Welcome, "+$.cookie(adminParams.domain+"_name")+'\n  <span id="pib-wrapper-settings" class="pib-wrapper" data-toggle="tooltip" title="User Settings" data-placement="bottom">\n    <paper-icon-button icon=\'icons:settings-applications\' class=\'click\' data-href=\''+a.login_url+"'></paper-icon-button>\n  </span>\n\n</h3>\n<section id='admin-actions-block' class=\"row center-block text-center\">\n  <div class='bs-callout bs-callout-info'>\n    <p>Please be patient while the administrative interface loads.</p>\n  </div>\n</section>",$("main #main-body").before(b),populateAdminActions(),bindClicks(),!1})}catch(b){a=b,$("main #main-body").html("<div class='bs-callout bs-callout-danger'><h4>Application Error</h4><p>There was an error in the application. Please refresh and try again. If this persists, please contact administration.</p></div>")}return!1},populateAdminActions=function(){var a;return a='<paper-button id="new-project" class="admin-action col-md-3 col-sm-4 col-xs-12" raised>\n  <iron-icon icon="icons:add"></iron-icon>\n    Create New Project\n</paper-button>\n<paper-button id="edit-project" class="admin-action col-md-3 col-sm-4 col-xs-12" raised>\n  <iron-icon icon="icons:create"></iron-icon>\n    Edit Existing Project\n</paper-button>\n<paper-button id="view-project" class="admin-action col-md-3 col-sm-4 col-xs-12" raised>\n  <iron-icon icon="icons:visibility"></iron-icon>\n    View All My Projects\n</paper-button>',$("#admin-actions-block").html(a),$("#show-actions").remove(),$("main #main-body").empty(),$("#new-project").click(function(){return loadCreateNewProject()}),$("#edit-project").click(function(){return loadEditor()}),$("#view-project").click(function(){return loadProjectBrowser()})},verifyLoginCredentials=function(a){var b,c,d,e;return c=$.cookie(adminParams.domain+"_auth"),e=$.cookie(adminParams.domain+"_secret"),d=$.cookie(adminParams.domain+"_link"),b="hash="+c+"&secret="+e+"&dblink="+d,$.post(adminParams.loginApiTarget,b,"json").done(function(b){return b.status===!0?a(b):goTo(b.login_url)}).fail(function(a,b){return $("main #main-body").html("<div class='bs-callout-danger bs-callout'><h4>Couldn't verify login</h4><p>There's currently a server problem. Try back again soon.</p></div>"),console.log(a,b),!1}),!1},startAdminActionHelper=function(){var a;return $("#admin-actions-block").empty(),a='<span id="pib-wrapper-dashboard" class="pib-wrapper" data-toggle="tooltip" title="Administration Home" data-placement="bottom">\n  <paper-icon-button icon="icons:dashboard" class="admin-action" id="show-actions">\n  </paper-icon-button>\n</span>',$("#pib-wrapper-settings").after(a),$("#show-actions").click(function(){return $(this).tooltip("hide"),$(".tooltip").tooltip("hide"),populateAdminActions()})},loadEditor=function(){return startAdminActionHelper(),adData.cartoRef="38544c04-5e56-11e5-8515-0e4fddd5de28",geo.init(),foo(),!1},getInfoTooltip=function(a){var b;return null==a&&(a="No Message Provided"),b='<div class="col-xs-1 adjacent-info">\n  <span class="glyphicon glyphicon-info-sign" data-toggle="tooltip" title="'+a+'"></span>\n</div>'},loadCreateNewProject=function(){var a;return startAdminActionHelper(),a='<h2 class="new-title col-xs-12">Project Title</h2>\n<paper-input label="Project Title" id="project-title" class="project-field col-md-6 col-xs-12" required auto-validate></paper-input>\n<h2 class="new-title col-xs-12">Project Parameters</h2>\n<section class="project-inputs clearfix col-xs-12">\n  <div class="row">\n    <paper-input label="Primary Disease Studied" id="project-disease" class="project-field col-md-6 col-xs-11" required auto-validate></paper-input>'+getInfoTooltip("Test")+'\n    <paper-input label="Project Reference" id="reference-id" class="project-field col-md-6 col-xs-11"></paper-input>\n    '+getInfoTooltip("E.g.  a DOI or other reference")+'\n    <h2 class="new-title col-xs-12">Lab Parameters</h2>\n    <paper-input label="Project PI" id="project-pi" class="project-field col-md-6 col-xs-12"  required auto-validate></paper-input>\n    <paper-input label="Project Contact" id="project-author" class="project-field col-md-6 col-xs-12"  required auto-validate></paper-input>\n    <gold-email-input label="Contact Email" id="author-email" class="project-field col-md-6 col-xs-12"  required auto-validate></gold-email-input>\n    <paper-input label="Project Lab" id="project-lab" class="project-field col-md-6 col-xs-12"  required auto-validate></paper-input>\n    <h2 class="new-title col-xs-12">Project Notes</h2>\n    <iron-autogrow-textarea id="project-notes" class="project-field col-md-6 col-xs-12" rows="3"></iron-autogrow-textarea>\n    <h2 class="new-title col-xs-12">Data Permissions</h2>\n    <div class="col-xs-12">\n      <span class="toggle-off-label iron-label">Private Dataset</span>\n      <paper-toggle-button id="data-encumbrance-toggle">Public Dataset</paper-toggle-button>\n      <p><strong>Smart selector here for registered users</strong>, only show when "private" toggle set</p>\n    </div>\n    <h2 class="new-title col-xs-12">Project Area of Interest</h2>\n    <div class="col-xs-12">\n      <p>This represents the approximate collection region for your samples. If you don\'t enter anything, we\'ll guess from your dataset.</p>\n      <span class="toggle-off-label iron-label">Locality Name</span>\n      <paper-toggle-button id="transect-input-toggle">Coordinate List</paper-toggle-button>\n    </div>\n    <p id="transect-instructions" class="col-xs-12"></p>\n    <div id="transect-input" class="col-md-6 col-xs-12">\n    </div>\n    <div id="carto-rendered-map" class="col-md-6">\n      <div id="carto-map-container" class="carto-map map">\n      </div>\n    </div>\n    <div class="col-xs-12">\n      <br/>\n      <paper-checkbox checked id="has-data">My project already has data</paper-checkbox>\n      <br/>\n    </div>\n  </div>\n</section>\n<section id="uploader-container-section" class="data-section col-xs-12">\n  <h2 class="new-title">Uploading your project data</h2>\n  <p>Drag and drop as many files as you need below. </p>\n  <p>\n    To save your project, we need at least one file with structured data containing coordinates.\n    Please note that the data <strong>must</strong> have a header row,\n    and the data <strong>must</strong> have the columns <code>decimalLatitude</code>, <code>decimalLongitude</code>, <code>alt</code>, and <code>coordinateUncertaintyInMeters</code>.\n  </p>\n</section>\n<section class="project-inputs clearfix data-section col-xs-12">\n  <div class="row">\n    <h2 class="new-title">Project Data Summary</h2>\n    <h3 class="new-title">Calculated Data Parameters</h3>\n    <paper-input label="Samples Counted" placeholder="Please upload a data file to see sample count" class="project-field col-md-6 col-xs-12" id="samplecount" readonly type="number"></paper-input>\n    <p>Etc</p>\n  </div>\n</section>\n<section id="submission-section col-xs-12">\n  <div class="pull-right">\n    <button id="upload-data" class="btn btn-success click" data-function="finalizeData">Save Data &amp; Create Project</button>\n    <button id="reset-data" class="btn btn-danger click" data-function="resetForm">Reset Form</button>\n  </div>\n</section>',$("main #main-body").append(a),bootstrapUploader(),bootstrapTransect(),$("#has-data").on("iron-change",function(){return $(this).get(0).checked?$(".data-section").removeAttr("hidden"):$(".data-section").attr("hidden","hidden")}),bindClicks(),foo(),!1},finalizeData=function(){return foo()},resetForm=function(){return foo()},getTableCoordinates=function(a){return null==a&&(a="tdf0f1bc730325de59d48a5c80df45931_6d6d454828c05e8ceea03c99cc5f547e52fcb5fb"),!1},addPointsToMap=function(a){var b;return null==a&&(a="tdf0f1bc730325de59d48a5c80df45931_6d6d454828c05e8ceea03c99cc5f547e52fcb5fb"),null==geo.cartoMap?(console.warn("Can't add points to a map without an instanced map!"),!1):(b={sql:"SELECT * FROM "+a},geo.mapLayer.getSubLayer(0).set(b),!1)},pointStringToLatLng=function(a){var b,c,d;return a.search(!1)?(d=a.slice(6,-1),b=d.split(" "),c={lat:b[0],lng:b[1]}):(console.warn("Invalid point string"),!1)},pointStringToPoint=function(a){var b,c,d;return a.search(!1)?(d=a.slice(6,-1),c=d.split(" "),b=new Point(c[0],c[1])):(console.warn("Invalid point string"),!1)},loadProjectBrowser=function(){var a;return startAdminActionHelper(),a="<div class='bs-callout bs-callout-warn center-block col-md-5'>\n  <p>Function worked, there's just nothing to show yet.</p>\n  <p>Imagine the beautiful and functional browser of all projects you have access to of your dreams, here.</p>\n</div>",$("#main-body").html(a),adData.cartoRef="38544c04-5e56-11e5-8515-0e4fddd5de28",geo.init(),foo(),!1},bootstrapTransect=function(){var a,b;return window.geocodeLookupCallback=function(){var a,b,c;return startLoad(),b=p$("#locality-input").value,a=new google.maps.Geocoder,c={address:b},a.geocode(c,function(a,b){var c,d,e,f,g,h,i,j;return b===google.maps.GeocoderStatus.OK?(console.info("Google said:",a),$("#locality-lookup-result").exists()||$("#carto-rendered-map").prepend('<div class="alert alert-info alert-dismissable" role="alert" id="locality-lookup-result">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Location Found</strong>: <span class="lookup-name"></span>\n</div>'),$("#locality-lookup-result .lookup-name").text(a[0].formatted_address),j=a[0].geometry.location,h=j.lat(),i=j.lng(),f=a[0].geometry.viewport,c=f.O,d=f.j,e={nw:[c.j,d.O],ne:[c.j,d.j],se:[c.O,d.O],sw:[c.O,d.j]},console.info("Got bounds: ",[h,i],e),geo.boundingBox=e,g=function(){return geo.renderMapHelper(e,h,i)},loadJS("https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js",g,!1)):stopLoadError("Couldn't find location: "+b)})},geo.renderMapHelper=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(null==a&&(a=geo.boundingBox),startLoad(),null==("undefined"!=typeof google&&null!==google?google.maps:void 0))return window.recallMapHelper=function(){return geo.renderMapHelper(a,b,c)},loadJS("https://maps.googleapis.com/maps/api/js?key="+gMapsApiKey+"&callback=recallMapHelper"),!1;try{geo.boundingBox=a,i=-180,s=180;for(k in a)g=a[k],g[1]<s&&(s=g[1]),g[1]>i&&(i=g[1]);if(d=256,f=i-s,0>f&&(f+=360),m=$(geo.mapSelector).width(),e=360/f,l=e/d,u=toInt(Math.log(m*l)/Math.LN2),o=u,--u,t=u,1>u&&(u=7),console.info("Calculated zoom "+u+", from original "+o+" and loosened "+t+" from",a,m,l),"number"!=typeof b){j=0,p=0;for(k in a)g=a[k],++j,p+=g[0],console.info(g,j,p);b=toFloat(p)/toFloat(j)}if("number"!=typeof c){j=0,q=0;for(k in a)g=a[k],++j,q+=g[1];c=toFloat(q)/toFloat(j)}return b=toFloat(b),c=toFloat(c),n={cartodb_logo:!1,https:!0,mobile_layout:!0,gmaps_base_type:"hybrid",center_lat:b,center_lon:c,zoom:u},geo.mapParams=n,$("#carto-map-container").empty(),"undefined"!=typeof geo&&null!==geo&&null==geo.dataTable&&(geo.dataTable="tdf0f1bc730325de59d48a5c80df45931_6d6d454828c05e8ceea03c99cc5f547e52fcb5fb"),r={layers:[{options:{sql:"SELECT * FROM "+geo.dataTable}}]},createMap(null,"carto-map-container",n,function(b,c){var d;try{mapOverlayPolygon(a),stopLoad()}catch(e){d=e,console.error("There was an error drawing your bounding box - "+d.emssage),stopLoadError("There was an error drawing your bounding box - "+d.emssage)}return!1})}catch(v){return h=v,console.error("There was an error rendering the map - "+h.message),stopLoadError("There was an error rendering the map - "+h.message)}},a=function(){return null==("undefined"!=typeof google&&null!==google?google.maps:void 0)?loadJS("https://maps.googleapis.com/maps/api/js?key="+gMapsApiKey+"&callback=geocodeLookupCallback"):geocodeLookupCallback(),!1},(b=function(){var b,c;return p$("#transect-input-toggle").checked?(b="Please input a list of coordinates, in the form <code>lat, lng</code>, with one set on each line. <strong>Please press <kbd>enter</kbd> to insert a new line after your last coordinate</strong>.",c='<iron-autogrow-textarea id="coord-input" class="" required rows="3"></iron-autogrow-textarea>'):(b="Please enter a name of a locality",c='<paper-input id="locality-input" label="Locality" class="pull-left" required autovalidate></paper-input> <paper-icon-button class="pull-left" id="do-search-locality" icon="icons:search"></paper-icon-button>'),$("#transect-instructions").html(b),$("#transect-input").html(c),p$("#transect-input-toggle").checked?$(p$("#coord-input").textarea).keyup(function(a){return function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(k=a.keyCode?a.keyCode:a.which,13===k&&(q=$(p$("#coord-input").textarea).val(),o=q.split("\n").length,o>3)){for(f=[],g=q.split("\n"),console.info("Raw coordinate info:",g),j=0,m=g.length;m>j;j++)d=g[j],d.search(",")>0&&!isNull(d)&&(e=d.split(","),2===e.length&&(p=[toFloat(e[0]),toFloat(e[1])],f.push(p)));if(f.length>=3){for(console.info("Coords:",f),i=0,b={},l=0,n=f.length;n>l;l++)c=f[l],++i,b[i]=c;return h=function(){return geo.renderMapHelper(b)},geo.boundingBox=b,loadJS("https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js",h,!1)}return console.warn("There is one or more invalid coordinates preventing the UI from being shown.")}}}(this)):($("#locality-input").keyup(function(b){var c;return c=b.keyCode?b.keyCode:b.which,13===c?a():void 0}),$("#do-search-locality").click(function(){return a()})),!1})(),$("#transect-input-toggle").on("iron-change",function(){return b()}),!1},mapOverlayPolygon=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(null==b&&(b=null),null==c&&(c={}),null==d&&(d=geo.googleMap),i={},"object"!=typeof a)return console.warn("mapOverlayPolygon() got an invalid data type to overlay!"),!1;if("object"!=typeof c&&(c={}),null==c.fillColor&&(c.fillColor="#ff7800"),i.fillColor=c.fillColor,i.fillOpacity=.35,"object"!=typeof b&&(b=null),console.info("Should overlay polygon from bounds here"),$("#carto-map-container").exists()&&null!=geo.cartoMap){n=[],g=[],h=[],o=-90,q=90,f=-180,s=180;for(m in a)p=a[m],n.push(p),r={},r.lat=p[0],r.lng=p[1],h.push(new Point(r.lat,r.lng));g=sortPoints(h),e=[],e.push(n),i.paths=g,l={type:"Polygon",coordinates:e},k={type:"Feature",properties:b,geometry:l},console.info("Rendering GeoJSON MultiPolygon",l),geo.geoJsonBoundingBox=k,geo.overlayOptions=c,console.info("Rendering Google Maps polygon",i),geo.canonicalBoundingBox=i,j=new google.maps.Polygon(i),j.setMap(d)}else console.warn("There's no map yet! Can't overlay polygon");return!1},mapAddPoints=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;for(null==c&&(c=geo.googleMap),i=0,l=a.length;l>i;i++)if(r=a[i],!(r instanceof geo.Point))return console.warn("Invalid datatype in array -- array must be constructed of Point objects"),!1;for(q={},g=[],e=0,k=0,m=a.length;m>k;k++)r=a[k],u=null!=b?null!=(t=b[e])?t.title:void 0:"",s=r.getObj(),d=new google.maps.LatLng(s.lat,s.lng),o={position:d,map:c,title:u},n=new google.maps.Marker(o),q[e]={marker:n},isNull(u)?console.info("Key "+e+" has no title in pointInfoArray",b[e]):(h={content:b[e].html},f=new google.maps.InfoWindow(h),q[e].infoWindow=f,g.push(f)),++e;if(!isNull(g)){dataAttrs.coordInfoWindows=g;for(j in q)p=q[j],n=p.marker,n.unbind("click"),n.self=n,n.iw=p.infoWindow,n.iwk=j,n.addListener("click",function(){var a;try{return this.iw.open(c,this),console.info("Opening infoWindow #"+this.iwk)}catch(b){return a=b,console.error("Invalid infowindow @ "+this.iwk+"!",g,p,this.iw)}});geo.markers=q}return q},getCanonicalDataCoords=function(a,b){var c,d,e;return null==a&&(a="tdf0f1bc730325de59d48a5c80df45931_6d6d454828c05e8ceea03c99cc5f547e52fcb5fb"),null==b&&(b=mapAddPoints),"function"!=typeof b?(console.error("This function needs a callback function as the second argument"),!1):(e="SELECT ST_AsText(the_geom), genus, specificEpithet, infraspecificEpithet, dateIdentified, sampleMethod, diseaseDetected, diseaseTested, catalogNumber FROM "+a,c=encodeURIComponent(encode64(e)),d="action=fetch&sql_query="+c,$.post("api.php",d,"json").done(function(a){var c,d,e,f,g,h,i,j,k;c=a.parsed_responses[0],d=[],g=[],i=c.rows;for(f in i)j=i[f],k=j.st_astext,isNull(j.infraspecificepithet)&&(j.infraspecificepithet=""),h=pointStringToPoint(k),e={title:j.catalognumber+": "+j.genus+" "+j.specificepithet+" "+j.infraspecificepithet,html:'<p>\n  <span class="sciname italic">'+j.genus+" "+j.specificepithet+" "+j.infraspecificepithet+"</span> collected on "+j.dateidentified+"\n</p>\n<p>\n  <strong>Status:</strong>\n  Sampled by "+j.samplemethod+", disease status "+j.diseasedetected+" for "+j.diseasetested+"\n</p>"},d.push(h),g.push(e);return dataAttrs.coords=d,dataAttrs.markerInfo=g,b(d,g)}).error(function(a,c){return null!=(null!=dataAttrs?dataAttrs.coords:void 0)?b(dataAttrs.coords,dataAttrs.markerInfo):console.error("No valid coordinates accessible!")}),!1)},bootstrapUploader=function(a){var b,c;return null==a&&(a="file-uploader"),c="#"+a,$(c).exists()||(b='<form id="'+a+'-form" class="col-md-4 clearfix">\n  <p class="visible-xs-block">Tap the button to upload a file</p>\n  <fieldset class="hidden-xs">\n    <legend>Upload Files</legend>\n    <div id="'+a+'" class="media-uploader outline media-upload-target">\n    </div>\n  </fieldset>\n</form>',$("main #uploader-container-section").append(b),$(c).submit(function(a){return a.preventDefault(),a.stopPropagation(),!1})),verifyLoginCredentials(function(){return null==window.dropperParams&&(window.dropperParams={}),window.dropperParams.uploadPath="uploaded/"+user+"/",loadJS("helpers/js-dragdrop/client-upload.min.js",function(){return console.info("Loaded drag drop helper"),window.dropperParams.postUploadHandler=function(a,b){var c,d,e,f,g,h;if(window.dropperParams.dropzone.removeAllFiles(),"object"!=typeof b)return console.error("Dropzone returned an error - "+b),toastStatusMessage("There was a problem with the server handling your image. Please try again."),!1;if(b.status!==!0)return null==b.human_error&&(b.human_error="There was a problem uploading your image."),toastStatusMessage(""+b.human_error),console.error("Error uploading!",b),!1;try{switch(console.info("Server returned the following result:",b),console.info("The script returned the following file information:",a),g="helpers/js-dragdrop/uploaded/"+user+"/",b.full_path=b.wrote_file,b.thumb_path=b.wrote_thumb,f=b.mime_provided.split("/")[0],e=b.mime_provided.split("/")[1],d=a.size<5242880||"image"!==f?""+g+b.full_path:""+g+b.thumb_path,h=function(){switch(f){case"image":return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <img src="'+d+'" alt=\'Uploaded Image\' class="img-circle thumb-img img-responsive"/>\n    <p class="text-muted">\n      '+a.name+" -> "+b.full_path+'\n  (<a href="'+d+'" class="newwindow" download="'+a.name+'">\n    Original Image\n  </a>)\n    </p>\n</div>';case"audio":return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <audio src="'+d+'" controls preload="auto">\n    <span class="glyphicon glyphicon-music"></span>\n    <p>\n      Your browser doesn\'t support the HTML5 <code>audio</code> element.\n      Please download the file below.\n    </p>\n  </audio>\n  <p class="text-muted">\n    '+a.name+" -> "+b.full_path+'\n    (<a href="'+d+'" class="newwindow" download="'+a.name+'">\n      Original Media\n    </a>)\n  </p>\n</div>';case"video":return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <video src="'+d+'" controls preload="auto">\n    <img src="'+g+b.thumb_path+'" alt="Video Thumbnail" class="img-responsive" />\n    <p>\n      Your browser doesn\'t support the HTML5 <code>video</code> element.\n      Please download the file below.\n    </p>\n  </video>\n  <p class="text-muted">\n    '+a.name+" -> "+b.full_path+'\n    (<a href="'+d+'" class="newwindow" download="'+a.name+'">\n      Original Media\n    </a>)\n  </p>\n</div>';default:return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <span class="glyphicon glyphicon-file"></span>\n  <p class="text-muted">'+a.name+" -> "+b.full_path+"</p>\n</div>"}}(),$(window.dropperParams.dropTargetSelector).before(h),f){case"application":switch(console.info("Checking "+e+" in application"),e){case"vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"vnd.ms-excel":return excelHandler(d);case"zip":case"x-zip-compressed":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===a.type||"xlsx"===d.split(".").pop()?excelHandler(d):zipHandler(d);case"x-7z-compressed":return _7zHandler(d)}break;case"text":return csvHandler();case"image":return imageHandler()}}catch(i){return c=i,toastStatusMessage("Your file uploaded successfully, but there was a problem in the post-processing.")}}}),!1})},singleDataFileHelper=function(a,b){var c;return"function"!=typeof b?(console.error("Second argument must be a function"),!1):dataFileParams.hasDataFile===!0?($("#single-data-file-modal").exists()&&$("#single-data-file-modal").remove(),c='<paper-dialog modal id="single-data-file-modal">\n  <h2>You can only have one primary data file</h2>\n  <div>\n    Continuing will remove your previous one\n  </div>\n  <div class="buttons">\n    <paper-button id="cancel-parse">Cancel Upload</paper-button>\n    <paper-button id="overwrite">Replace Previous</paper-button>\n  </div>\n</paper-dialog>',$("body").append(c),$("#cancel-parse").click(function(){return removeDataFile(a,!1),p$("#single-data-file-modal").close(),!1}),$("#overwrite").click(function(){return removeDataFile(),p$("#single-data-file-modal").close(),b()}),safariDialogHelper("#single-data-file-modal")):b()},excelHandler=function(a,b){var c,d,e;return null==b&&(b=!0),startLoad(),toastStatusMessage("Processing ..."),e=helperDir+"excelHelper.php",d=a,a.search(-1!==helperDir)&&(d=a.slice(helperDir.length)),console.info("Pinging for "+d),c="action=parse&path="+d,$.get(e,c,"json").done(function(b){return console.info("Got result",b),singleDataFileHelper(a,function(){var c,e,f,g;return dataFileParams.hasDataFile=!0,dataFileParams.fileName=a,dataFileParams.filePath=d,g=Object.size(b.data),e="",g>0&&(f=randomInt(1,g)-1,e="\n\nHere's a random row: "+JSON.stringify(b.data[f])),c="<pre>\nFrom upload, fetched "+g+" rows."+e+"\n</pre>",$("#main-body").append(c),newGeoDataHandler(b.data),stopLoad()})}).fail(function(a,b){return console.error("Couldn't POST"),console.warn(a,b),stopLoadError()}),!1},csvHandler=function(a){return dataFileParams.hasDataFile=!0,dataFileParams.fileName=a,dataFileParams.filePath=correctedPath,geoDataHandler(),!1},imageHandler=function(a){return foo(),!1},zipHandler=function(a){return foo(),!1},_7zHandler=function(a){return foo(),!1},removeDataFile=function(a,b){var c,d;return null==a&&(a=dataFileParams.fileName),null==b&&(b=!0),a=a.split("/").pop(),b&&(dataFileParams.hasDataFile=!1),$(".uploaded-media[data-system-file='"+a+"']").remove(),d=helperDir+"/js-dragdrop/uploaded/"+user+"/"+a,c="action=removefile&path="+encode64(a)+"&user="+user,!1},newGeoDataHandler=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;null==a&&(a={});try{try{r=a[0]}catch(x){return toastStatusMessage("Your data file was malformed, and could not be parsed. Please try again."),removeDataFile(),!1}if(null==r.decimalLatitude||null==r.decimalLongitude||null==r.coordinateUncertaintyInMeters||null==r.alt)return toastStatusMessage("Data are missing required geo columns. Please reformat and try again."),console.info("Missing: ",null!=r.decimalLatitude,null!=r.decimalLongitude,null!=r.coordinateUncertaintyInMeters,null!=r.alt),removeDataFile(),!1;if(!(isNumber(r.decimalLatitude)&&isNumber(r.decimalLongitude)&&isNumber(r.coordinateUncertaintyInMeters)&&isNumber(r.alt)))return toastStatusMessage("Data has invalid entries for geo columns. Please be sure they're all numeric and try again."),removeDataFile(),!1;q=Object.size(a),p$("#samplecount").value=q,isNull(p$("#project-disease"))&&(p$("#project-disease").value=r.diseaseTested),m={},dataAttrs.coords=[],dataAttrs.coordsFull=[];for(l in a){p=a[l],u={};for(c in p){switch(w=p[c],c){case"dateIdentified":try{w>0&&1e6>w?(h=25569,i=24107,s=86400,t=(w-h)*s*1e3):t=Date.parse(w)}catch(x){t=Date.now()}f=new Date(t),g=f.getUTCDate(),10>g&&(g="0"+g),k=f.getUTCMonth()+1,10>k&&(k="0"+k),b=f.getUTCFullYear()+"-"+k+"-"+g;break;case"fatal":b=w.toBool();break;case"decimalLatitude":case"decimalLongitude":case"alt":case"coordinateUncertaintyInMeters":b=toFloat(w);break;case"diseaseDetected":b=isBool(w)?w.toBool():"NO_CONFIDENCE";break;default:try{b=w.trim()}catch(x){b=w}}u[c]=b}d={lat:u.decimalLatitude,lng:u.decimalLongitude,alt:u.alt,uncertainty:u.coordinateUncertaintyMeters},e=new Point(d.lat,d.lng),dataAttrs.coords.push(e),dataAttrs.coordsFull.push(d),m[l]=u}dataAttrs.dataObj=m;try{n=JsonHuman.format(m),$("#main-body").append(n)}catch(x){j=x,console.warn("Couldn't pretty set!"),console.warn(j.stack),console.info(m)}o="t"+md5(p$("#project-title").value+$.cookie(uri.domain+"_link")),v={transectRing:void 0,data:m},geo.requestCartoUpload(v,o,"create"),mapOverlayPolygon(v.transectRing)}catch(x){j=x,console.error(j.message),toastStatusMessage("There was a problem parsing your data")}return!1},$(function(){return $("#next").exists()&&$("#next").unbind().click(function(){return openTab(adminParams.adminPageUrl)}),loadJS("bower_components/bootstrap/dist/js/bootstrap.min.js",function(){return $("body").tooltip({selector:"[data-toggle='tooltip']"})})});
//# sourceMappingURL=maps/c.map