function shuffle(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}var activityIndicatorOff,activityIndicatorOn,adData,animateLoad,bindClicks,bindDismissalRemoval,bsAlert,byteCount,cartoAccount,cartoMap,cartoVis,createMap,d$,decode64,deepJQuery,defaultMapMouseOverBehaviour,delay,doCORSget,e,encode64,foo,formatScientificNames,gMapsApiKey,getLocation,getMaxZ,getPosterFromSrc,goTo,isBlank,isBool,isEmpty,isHovered,isJson,isNull,isNumber,jsonTo64,lightboxImages,loadJS,mapNewWindows,openLink,openTab,overlayOff,overlayOn,p$,prepURI,randomInt,roundNumber,roundNumberSigfig,safariDialogHelper,startLoad,stopLoad,stopLoadError,toFloat,toInt,toObject,toastStatusMessage,uri,slice=[].slice,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};try{uri=new Object,uri.o=$.url(),uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+uri.o.attr("directory"),uri.query=uri.o.attr("fragment")}catch(_error){e=_error,console.warn("PURL not installed!")}window.locationData=new Object,locationData.params={enableHighAccuracy:!0},locationData.last=void 0,window.debounce_timer=null,null==window.adminParams&&(window.adminParams=new Object),isBool=function(a,b){if(null==b&&(b=!1),b)return"boolean"==typeof a;try{return"boolean"==typeof a?a===!0||a===!1:"string"==typeof a?"true"===a.toLowerCase()||"false"===a.toLowerCase():"number"==typeof a?1===a||0===a:!1}catch(c){return e=c,!1}},isEmpty=function(a){return!a||0===a.length},isBlank=function(a){return!a||/^\s*$/.test(a)},isNull=function(a){try{if((isEmpty(a)||isBlank(a)||null==a)&&a!==!1&&0!==a)return!0}catch(b){return e=b,!1}return!1},isJson=function(a){if("object"==typeof a)return!0;try{return JSON.parse(a),!0}catch(b){return e=b,!1}return!1},isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},toFloat=function(a){return!isNumber(a)||isNull(a)?0:parseFloat(a)},toInt=function(a){return!isNumber(a)||isNull(a)?0:parseInt(a)},String.prototype.toBool=function(){return"true"===this.toString().toLowerCase()},Boolean.prototype.toBool=function(){return"true"===this.toString()},Number.prototype.toBool=function(){return"1"===this.toString()},String.prototype.addSlashes=function(){return this.replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Object.size=function(a){var b,c;if("object"!=typeof a)try{return a.length}catch(d){e=d,console.error("Passed argument isn't an object and doesn't have a .length parameter"),console.warn(e.message)}c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},delay=function(a,b){return setTimeout(b,a)},roundNumber=function(a,b){var c;return null==b&&(b=0),c=Math.pow(10,b),Math.round(a*c)/c},roundNumberSigfig=function(a,b){var c,d,e,f,g;return null==b&&(b=0),e=roundNumber(a,b).toString(),c=e.split("."),1===c.length?e+"."+Array(b+1).join("0"):(g=c.pop(),f=c[0]+".",g.length===b?e:(d=b-g.length,g+=Array(d+1).join("0"),""+f+g))},jsonTo64=function(a){var b;return"array"==typeof a&&(a=toObject(arr)),b=JSON.stringify(a),encodeURIComponent(encode64(b))},encode64=function(a){try{return Base64.encode(a)}catch(b){return e=b,console.warn("Bad encode string provided"),a}},decode64=function(a){try{return Base64.decode(a)}catch(b){return e=b,console.warn("Bad decode string provided"),a}},jQuery.fn.polymerSelected=function(a,b){var c,d,f;if(null==a&&(a=void 0),null==b&&(b="attrForSelected"),c=$(this).attr(b),null==a){f=void 0;try{f=$(this).get(0).selected,isNumber(f)&&!isNull(c)&&(d=$(this).find("paper-item")[toInt(f)],f=$(d).attr(c))}catch(g){return e=g,!1}return("null"===f||null==f)&&(f=void 0),f}if(isBool(a)){if($(this).parent().children().removeAttribute("aria-selected"),$(this).parent().children().removeAttribute("active"),$(this).parent().children().removeClass("iron-selected"),$(this).prop("selected",a),$(this).prop("active",a),$(this).prop("aria-selected",a),a===!0)return $(this).addClass("iron-selected")}else try{return $(this).get(0).select(a)}catch(g){return e=g,!1}},jQuery.fn.polymerChecked=function(a){var b;return null==a&&(a=void 0),null!=a?jQuery(this).prop("checked",a):(b=jQuery(this)[0].checked,("null"===b||null==b)&&(b=void 0),b)},isHovered=function(a){return $(a+":hover").length>0},jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery.fn.isVisible=function(){return jQuery(this).is(":visible")&&"hidden"!==jQuery(this).css("visibility")},jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3},byteCount=function(a){return function(a){return encodeURI(a).split(/%..|./).length-1}}(this),toObject=function(a){var b,c,d;d=new Object;for(c in a)b=a[c],void 0!==b&&(d[c]=b);return d},loadJS=function(a,b,c){var d,f,g;if(null==b&&(b=new Object),null==c&&(c=!0),$("script[src='"+a+"']").exists()){if("function"==typeof b)try{b()}catch(h){e=h,console.error("Script is already loaded, but there was an error executing the callback function - "+e.message)}return!0}return g=document.createElement("script"),g.setAttribute("src",a),g.setAttribute("async","async"),g.setAttribute("type","text/javascript"),g.src=a,g.async=!0,f=function(){var c;c=g.readyState;try{if(!b.done&&(!c||/loaded|complete/.test(c))&&(b.done=!0,"function"==typeof b))try{return b()}catch(d){return e=d,console.error("Postload callback error for "+a+" - "+e.message),console.warn(e.stack)}}catch(d){return e=d,console.error("Onload error - "+e.message)}},d=function(){console.warn("There may have been a problem loading "+a);try{if(!b.done&&(b.done=!0,"function"==typeof b&&c))try{return b()}catch(d){return e=d,console.error("Post error callback error - "+e.message)}}catch(d){return e=d,console.error("There was an error in the error handler! "+e.message)}},g.setAttribute("onload",f),g.setAttribute("onreadystate",f),g.setAttribute("onerror",d),g.onload=g.onreadystate=f,g.onerror=d,document.getElementsByTagName("head")[0].appendChild(g),!0},String.prototype.toTitleCase=function(){var a,b,c,d,e,f,g,h,i,j,k;for(h=this.replace(/([^\W_]+[^\s-]*) */g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),g=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"],a=0,c=g.length;c>a;a++)e=g[a],f=new RegExp("\\s"+e+"\\s","g"),h=h.replace(f,function(a){return a.toLowerCase()});for(k=["Id","Tv"],b=0,d=k.length;d>b;b++)i=k[b],j=new RegExp("\\b"+i+"\\b","g"),h=h.replace(j,i.toUpperCase());return h},Function.prototype.debounce=function(){var a,b,c,d,f,g;if(f=arguments[0],c=arguments[1],g=arguments[2],a=4<=arguments.length?slice.call(arguments,3):[],null==f&&(f=300),null==c&&(c=!1),null==g&&(g=debounce_timer),d=this,b=function(){return c||d.apply(d,a),console.log("Debounce applied")},null!=g)try{clearTimeout(g)}catch(h){e=h}else c&&(d.apply(obj,a),console.log("Executed immediately"));return setTimeout(b,f)},randomInt=function(a,b){var c,d,e;return null==a&&(a=0),null==b&&(b=1),e=Math.random(),null==a&&(c=[0,a],a=c[0],b=c[1]),a>b&&(d=[b,a],a=d[0],b=d[1]),Math.floor(e*(b-a+1)+a)},animateLoad=function(a){var b;null==a&&(a="loader"),isNumber(a)&&(a="loader"),"#"===a.slice(0,1)?(b=a,a=a.slice(1)):b="#"+a;try{return $(b).exists()?$(b).attr("active",!0):$("body").append('<paper-spinner id="'+a+'" active></paper-spinner'),!1}catch(c){return e=c,console.log("Could not animate loader",e.message)}},startLoad=animateLoad,stopLoad=function(a,b){var c;null==a&&(a="loader"),null==b&&(b=1e3),"#"===a.slice(0,1)?(c=a,a=a.slice(1)):c="#"+a;try{if($(c).exists())return $(c).addClass("good"),delay(b,function(){return $(c).removeClass("good"),$(c).removeAttr("active")})}catch(d){return e=d,console.log("Could not stop load animation",e.message)}},stopLoadError=function(a,b,c){var d;null==b&&(b="loader"),null==c&&(c=5e3),"#"===b.slice(0,1)?(d=b,b=b.slice(1)):d="#"+b;try{if($(d).exists())return $(d).addClass("bad"),null!=a&&toastStatusMessage(a,"",c),delay(c,function(){return $(d).removeClass("bad"),$(d).removeAttr("active")})}catch(f){return e=f,console.log("Could not stop load error animation",e.message)}},toastStatusMessage=function(a,b,c,d){var e,f;return null==b&&(b=""),null==c&&(c=3e3),null==d&&(d="#status-message"),null==(null!=(f=window.metaTracker)?f.isToasting:void 0)&&null==window.metaTracker&&(window.metaTracker=new Object,window.metaTracker.isToasting=!1),window.metaTracker.isToasting?(delay(250,function(){return toastStatusMessage(a,b,c,d)}),!1):(window.metaTracker.isToasting=!0,isNumber(c)||(c=3e3),d.slice(0,1)===!1&&(d="#"+d),$(d).exists()||(e='<paper-toast id="'+d.slice(1)+'" duration="'+c+'"></paper-toast>',$(e).appendTo("body")),$(d).attr("text",a).text(a).addClass(b),$(d).get(0).show(),delay(c+500,function(){return $(d).empty(),$(d).removeClass(b),$(d).attr("text",""),window.metaTracker.isToasting=!1}))},openLink=function(a){return null==a?!1:(window.open(a),!1)},openTab=function(a){return openLink(a)},goTo=function(a){return null==a?!1:(window.location.href=a,!1)},mapNewWindows=function(a){return null==a&&(a=!0),$(".newwindow").each(function(){var b,c;return b=$(this).attr("href"),null==b&&(b=$(this).attr("data-href")),c=function(a){return null==a?!1:(window.open(a),!1)},$(this).click(function(d){return a&&(d.preventDefault(),d.stopPropagation()),c(b)}),$(this).keypress(function(){return c(b)})})},deepJQuery=function(a){try{if(!$("html /deep/ "+a).exists())throw"Bad /deep/ selector";return $("html /deep/ "+a)}catch(b){e=b;try{if(!$("html >>> "+a).exists())throw"Bad >>> selector";return $("html >>> "+a)}catch(b){return e=b,$(a)}}},d$=function(a){return deepJQuery(a)},bindClicks=function(a){return null==a&&(a=".click"),$(a).each(function(){var a,b;try{if(b=$(this).attr("data-href"),!isNull(b)){$(this).unbind();try{b===uri.o.attr("path")&&"paper-tab"===$(this).prop("tagName").toLowerCase()&&$(this).parent().prop("selected",$(this).index())}catch(c){e=c,console.warn("tagname lower case error")}return $(this).click(function(){var a,c,d;try{return(null!=(a=$(this).attr("newTab"))?a.toBool():void 0)||(null!=(c=$(this).attr("newtab"))?c.toBool():void 0)||(null!=(d=$(this).attr("data-newtab"))?d.toBool():void 0)?openTab(b):goTo(b)}catch(e){return goTo(b)}}),b}if(a=$(this).attr("data-function"),null!=a)return $(this).unbind(),$(this).click(function(){try{return console.log("Executing bound function "+a+"()"),window[a]()}catch(b){return e=b,console.error("'"+a+"()' is a bad function - "+e.message)}})}catch(c){return e=c,console.error("There was a problem binding to #"+$(this).attr("id")+" - "+e.message)}}),!1},getPosterFromSrc=function(a){var b,c;try{return c=a.split("."),b=c.pop(),c.push("png"),c.join(".")}catch(d){return e=d,""}},doCORSget=function(a,b,c,d){var f,g,h,i;null==c&&(c=void 0),null==d&&(d=void 0),f=function(){if("function"==typeof d)return d();throw new Error("There was an error performing the CORS request")},h={url:a,data:b,type:"get",crossDomain:!0};try{$.ajax(h).done(function(a){return"function"==typeof c?(c(),!1):console.log(response)}).fail(function(a,b){return console.warn("Couldn't perform jQuery AJAX CORS. Attempting manually.")})}catch(j){e=j,console.warn("There was an error using jQuery to perform the CORS request. Attemping manually.")}if(a=a+"?"+b,g=function(a,b){var c;return null==a&&(a="get"),c=new XMLHttpRequest,"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c},i=g("get",a),!i)throw new Error("CORS not supported");return i.onload=function(){var a;return a=i.responseText,"function"==typeof c&&c(a),console.log(a),!1},i.onerror=function(){return console.warn("Couldn't do manual XMLHttp CORS request"),f()},i.send(),!1},lightboxImages=function(a,b){var c,d;return null==a&&(a=".lightboximage"),null==b&&(b=!1),d={onStart:function(){return overlayOn()},onEnd:function(){return overlayOff(),activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif|bmp|webp",quitOnDocClick:!0,quitOnImgClick:!0},c=b?d$(a):$(a),loadJS("bower_components/imagelightbox/dist/imagelightbox.min.js",function(){return c.click(function(a){try{return a.preventDefault(),a.stopPropagation(),$(this).imageLightbox(d).startImageLightbox(),console.warn("Event propagation was stopped when clicking on this.")}catch(b){return a=b,console.error("Unable to lightbox this image!")}}).each(function(){var b,c;console.log("Using selectors '"+a+"' / '"+this+"' for lightboximages");try{if("img"===$(this).prop("tagName").toLowerCase()&&"a"!==$(this).parent().prop("tagName").toLowerCase())return c=$(this).removeClass("lightboximage").prop("outerHTML"),b=function(){switch(!1){case!!isNull($(this).attr("data-layzr-retina")):return $(this).attr("data-layzr-retina");case!!isNull($(this).attr("data-layzr")):return $(this).attr("data-layzr");case!!isNull($(this).attr("data-lightbox-image")):return $(this).attr("data-lightbox-image");default:return $(this).attr("src")}}.call(this),$(this).replaceWith("<a href='"+b+"' class='lightboximage'>"+c+"</a>"),$("a[href='"+b+"']").imageLightbox(d)}catch(f){return e=f,console.log("Couldn't parse through the elements")}}),console.info("Lightboxed the following:",c)})},activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")},activityIndicatorOff=function(){return $("#imagelightbox-loading").remove(),$("#imagelightbox-overlay").click(function(){return $("#imagelightbox").click()})},overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")},overlayOff=function(){return $("#imagelightbox-overlay").remove()},formatScientificNames=function(a){return null==a&&(a=".sciname"),$(".sciname").each(function(){var a;return a="italic"===$(this).css("font-style")?"normal":"italic",$(this).css("font-style",a)})},prepURI=function(a){return a=encodeURIComponent(a),a.replace(/%20/g,"+")},window.locationData=new Object,locationData.params={enableHighAccuracy:!0},locationData.last=void 0,getLocation=function(a){var b,c;return null==a&&(a=void 0),c=function(a,b){return window.locationData.lat=a.coords.latitude,window.locationData.lng=a.coords.longitude,window.locationData.acc=a.coords.accuracy,window.locationData.last=Date.now(),null!=b&&b(window.locationData),!1},b=function(a,b){var c;return c=function(){switch(a.code){case 0:return"There was an error while retrieving your location: "+a.message;case 1:return"The user prevented this page from retrieving a location";case 2:return"The browser was unable to determine your location: "+a.message;case 3:return"The browser timed out retrieving your location."}}(),console.error(c),null!=b&&b(!1),!1},navigator.geolocation?navigator.geolocation.getCurrentPosition(c,b,window.locationData.params):(console.warn("This browser doesn't support geolocation!"),null!=a?a(!1):void 0)},getMaxZ=function(){var a;return a=function(){return $.map($("body *"),function(a,b){return"static"!==$(a).css("position")?parseInt($(a).css("z-index")||1):void 0})},Math.max.apply(null,a())},foo=function(){return toastStatusMessage("Sorry, this feature is not yet finished"),stopLoad(),!1},safariDialogHelper=function(a,b,c){var d,f;if(null==a&&(a="#download-chooser"),null==b&&(b=0),"function"!=typeof c&&(c=function(){return bindDismissalRemoval()}),!(10>b))return stopLoadError("Unable to show dialog. Please try again.");try{return d$(a).get(0).open(),"function"==typeof c&&c(),stopLoad()}catch(g){return e=g,f=b+1,d=250,delay(d,function(){return console.warn("Trying again to display dialog after "+f*d+"ms"),safariDialogHelper(a,f,c)})}},bindDismissalRemoval=function(){return $("[dialog-dismiss]").unbind().click(function(){return $(this).parents("paper-dialog").remove()})},p$=function(a){try{return $$(a)[0]}catch(b){return $(a).get(0)}},bsAlert=function(a,b,c,d){var e,f;return null==b&&(b="warning"),null==c&&(c="body"),null==d&&(d="#bs-alert"),$(d).exists()||(e='<div class="alert alert-'+b+' alert-dismissable" role="alert" id="'+d.slice(1)+'">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <div class="alert-message"></div>\n</div>',f=$("main").exists()?"main":$("article").exists()?"article":c,$(f).prepend(e)),$(d+" .alert-message").html(a)},$(function(){bindClicks(),formatScientificNames(),lightboxImages();try{$("body").tooltip({selector:"[data-toggle='tooltip']"})}catch(a){e=a,console.warn("Tooltips were attempted to be set up, but do not exist")}try{return checkAdmin(),("undefined"!=typeof adminParams&&null!==adminParams?adminParams.loadAdminUi:void 0)===!0?loadJS("js/admin.min.js",function(){return console.info("Loaded admin file"),loadAdminUi()}):console.info("No admin setup requested")}catch(a){}}),uri.domain=uri.o.attr("host").split(".").reverse().pop(),cartoAccount="tigerhawkvok",gMapsApiKey="AIzaSyAZvQMkfFkbqNStlgzNjw1VOWBASd74gq4",cartoMap=null,cartoVis=null,adData=new Object,window.geo=new Object,geo.init=function(a){var b;try{window.locationData.lat=37.871527,window.locationData.lng=-122.262113,getLocation()}catch(c){}return b='<link rel="stylesheet" href="/css/cartodb.css" />',$("head").append(b),null==a&&(a=function(){return createMap(adData.cartoRef),!1}),window.gMapsCallback=function(){return loadJS("js/cartodb.js",a,!1)},loadJS("https://maps.googleapis.com/maps/api/js?key="+gMapsApiKey+"&callback=gMapsCallback")},defaultMapMouseOverBehaviour=function(a,b,c,d,e){return console.log(a,b,c,d,e)},createMap=function(a,b,c,d){var e,f;return null==a&&(a="38544c04-5e56-11e5-8515-0e4fddd5de28"),null==b&&(b="map"),null==a&&console.info("Can't create map without a data visualization identifier"),e="https://"+cartoAccount+".cartodb.com/api/v2/viz/"+a+"/viz.json",null==c&&(c={cartodb_logo:!1,https:!0,mobile_layout:!0,gmaps_base_type:"hybrid",center_lat:window.locationData.lat,center_lon:window.locationData.lng,zoom:7}),$("#"+b).exists()||(f='<div id="'+b+'" class="carto-map wide-map">\n  <!-- Dynamically inserted from unavailable target -->\n</div>',$("main #main-body").append(f)),"function"!=typeof d&&(d=function(a,b){return cartodb.createLayer(b,e).addTo(b).done(function(a){return a.setInteraction(!0),a.on("featureOver",defaultMapMouseOverBehaviour)})}),cartodb.createVis(b,e,c).done(function(b,c){return console.info("Fetched data from CartoDB account "+cartoAccount+", from data set "+a),cartoVis=b,cartoMap=b.getNativeMap(),d(cartoVis,cartoMap)}).error(function(a){return toastStatusMessage("Couldn't load maps!"),console.error("Couldn't get map - "+a)})},geo.requestCartoUpload=function(a,b,c){var d,f,g,h,i,j;try{g=a.data}catch(k){}return"object"!=typeof g?(console.info("This function requires the base data to be a JSON object."),toastStatusMessage("Your data is malformed. Please double check your data and try again."),!1):(d=["edit","insert","delete","create"],indexOf.call(d,c)<0?(console.error(c+" is not an allowed operation on a data set!"),console.info("Allowed operations are ",d),toastStatusMessage("Sorry, '"+c+"' isn't an allowed operation."),!1):isNull(b)?(console.error("Must use a defined table name!"),toastStatusMessage("You must name your data table"),!1):(i=$.cookie(uri.domain+"_link"),h=$.cookie(uri.domain+"_auth"),j=$.cookie(uri.domain+"_secret"),null==i||null==h||null==j?(console.error("You're not logged in. Got one or more invalid tokens for secrets.",i,h,j),toastStatusMessage("Sorry, you're not logged in. Please log in and try again."),!1):(b=b+"_"+i,f="hash="+h+"&secret="+j+"&dblink="+i,$.post("admin_api.php",f,"json").done(function(d){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W;if(d.status){Q=new Array,E=new Array,J=new Array;for(K in g){P=g[K],H=new Array;for(n in P)switch(U=P[n],n){case"decimalLongitude":H[1]=U,J.push(U);break;case"decimalLatitude":H[0]=U,E.push(U)}Q.push(H)}k=null!=(L=E.max())?L:0,l=null!=(M=E.min())?M:0,j=null!=(N=J.max())?N:0,m=null!=(O=J.min())?O:0,u=[[k,m],[k,j],[l,j],[l,m]];try{for(T=JSON.parse(a.transectRing),B=0,F=T.length;F>B;B++){if(r=T[B],2!==r.length)throw{message:"Bad coordinate length for '"+r+"'"};for(C=0,G=r.length;G>C;C++)if(q=r[C],!isNumber(q))throw{message:"Bad coordinate number '"+q+"'"}}}catch(X){e=X,console.warn("Error parsing the user transect ring - "+e.message),T=void 0}switch(S=null!=T?T:u,w={type:"GeometryCollection",geometries:[{type:"MultiPoint",coordinates:Q},{type:"Polygon",coordinates:S}]},s="ST_AsBinary("+JSON.stringify(w)+", 4326)",o={id:"int",collectionID:"varchar",catalogNumber:"varchar",fieldNumber:"varchar",diseaseTested:"varchar",diseaseStrain:"varchar",sampleMethod:"varchar",sampleDisposition:"varchar",diseaseDetected:"varchar",fatal:"boolean",cladeSampled:"varchar",genus:"varchar",specificEpithet:"varchar",infraspecificEpithet:"varchar",lifeStage:"varchar",dateIdentified:"date",decimalLatitude:"decimal",decimalLongitude:"decimal",alt:"decimal",coordinateUncertaintyInMeters:"decimal",Collector:"varchar",the_geom:"varchar"},c){case"edit":return R="UPDATE "+b+" ",foo(),!1;case"insert":case"create":R="","create"===c&&(R="CREATE TABLE "+b+" "),W="",t={the_geom:s},W=new Array,p=new Array,p.push("id int");for(z in g){P=g[z],z=toInt(z),console.log("Iter #"+z,0===z,0==z),V=new Array,D=0,I=0,h=0,v=0,x={type:"Point",coordinates:new Array},A=z+1,V.push(A);for(n in P){U=P[n],0===z&&p.push(n+" "+o[n]);try{U=U.replace("'","&#95;")}catch(X){}switch(n){case"decimalLongitude":x.coordinates[1]=U;break;case"decimalLatitude":x.coordinates[0]=U}"string"==typeof U?V.push("'"+U+"'"):isNull(U)?V.push("null"):V.push(U)}0===z&&(console.log("We're appending to col names list"),p.push("the_geom geometry"),"create"===c&&(R=R+" ("+p.join(",")+"); ")),y="ST_SetSRID(ST_Point("+x.coordinates[0]+","+x.coordinates[1]+"),4326)",V.push(y),W.push("("+V.join(",")+")")}R=R+"INSERT INTO "+b+" VALUES "+W.join(", ")+";";break;case"delete":return R="DELETE FROM "+b+" WHERE ",foo(),!1}return i=encodeURIComponent(encode64(R)),f="action=upload&sql_query="+i,console.info("STOPPING INCOMPLETE EXECUTION"),console.info("Would query with args",f),console.info("Have query:"),console.info(R),$("#main-body").append("<pre>Would send Carto:\n\n "+R+"</pre>"),console.info("GeoJSON:",w),console.info("GeoJSON String:",s),console.warn("Want to post:",uri.urlString+"api.php?"+f),$.post("api.php",f).done(function(a){var c,d,e,f,g,h,i;if(console.log("Got back",a),a.status!==!0)return console.error("Got an error from the server!"),console.warn(a),toastStatusMessage("There was a problem uploading your data. Please try again."),!1;d=a.post_response,c=!1;for(g in d)i=d[g],isNull(null!=i?i.error:void 0)||(c=i.error[0]);if(c!==!1)return stopLoadError("CartoDB returned an error: "+c),!1;console.info("Carto was succesfful! Got results",d);try{h=JsonHuman.format(d),$("#main-body").append("<div class='alert alert-success'><strong>Success! Carto said</strong>"+$(h).html()+"</div>")}catch(j){}return bsAlert("Upload to CartoDB of table <code>"+b+"</code> was successful","success"),foo(),e="",f="https://"+cartoAccount+".cartodb.com/api/v2/viz/"+e+"/viz.json",isNull(cartoMap)?geo.init(function(){return createMap(f),!1}):cartodb.createLayer(cartoMap,f).addTo(cartoMap).done(function(a){return a.setInteraction(!0),a.on("featureOver",defaultMapMouseOverBehaviour)})})}return console.error("Unable to authenticate session. Please log in."),toastStatusMessage("Sorry, your session has expired. Please log in and try again.")}).error(function(a,b){return console.error("Couldn't communicate with server!",a,b),console.warn(uri.urlString+"admin_api.php?"+f),toastStatusMessage("There was a problem communicating with the server. Please try again in a bit.")}),!1)))},$(function(){});var _7zHandler,bootstrapTransect,bootstrapUploader,csvHandler,dataFileParams,excelHandler,helperDir,imageHandler,loadCreateNewProject,loadEditor,loadProjectBrowser,newGeoDataHandler,populateAdminActions,removeDataFile,singleDataFileHelper,startAdminActionHelper,user,verifyLoginCredentials,zipHandler;window.adminParams=new Object,adminParams.domain="amphibiandisease",adminParams.apiTarget="admin_api.php",adminParams.adminPageUrl="https://"+adminParams.domain+".org/admin-page.html",adminParams.loginDir="admin/",adminParams.loginApiTarget=adminParams.loginDir+"async_login_handler.php",dataFileParams=new Object,dataFileParams.hasDataFile=!1,dataFileParams.fileName=null,dataFileParams.filePath=null,helperDir="helpers/",user=$.cookie(adminParams.domain+"_link"),window.loadAdminUi=function(){var a;try{verifyLoginCredentials(function(a){var b;return b="<h3>\n  Welcome, "+$.cookie(adminParams.domain+"_name")+'\n  <span id="pib-wrapper-settings" class="pib-wrapper" data-toggle="tooltip" title="User Settings" data-placement="bottom">\n    <paper-icon-button icon=\'icons:settings-applications\' class=\'click\' data-href=\''+a.login_url+"'></paper-icon-button>\n  </span>\n\n</h3>\n<section id='admin-actions-block' class=\"row center-block text-center\">\n  <div class='bs-callout bs-callout-info'>\n    <p>Please be patient while the administrative interface loads.</p>\n  </div>\n</section>",$("main #main-body").before(b),populateAdminActions(),bindClicks(),!1})}catch(b){a=b,$("main #main-body").html("<div class='bs-callout bs-callout-danger'><h4>Application Error</h4><p>There was an error in the application. Please refresh and try again. If this persists, please contact administration.</p></div>")}return!1},populateAdminActions=function(){var a;return a='<paper-button id="new-project" class="admin-action col-md-3 col-sm-4 col-xs-12" raised>\n  <iron-icon icon="icons:add"></iron-icon>\n    Create New Project\n</paper-button>\n<paper-button id="edit-project" class="admin-action col-md-3 col-sm-4 col-xs-12" raised>\n  <iron-icon icon="icons:create"></iron-icon>\n    Edit Existing Project\n</paper-button>\n<paper-button id="view-project" class="admin-action col-md-3 col-sm-4 col-xs-12" raised>\n  <iron-icon icon="icons:visibility"></iron-icon>\n    View All Projects\n</paper-button>',$("#admin-actions-block").html(a),$("#show-actions").remove(),$("main #main-body").empty(),$("#new-project").click(function(){return loadCreateNewProject()}),$("#edit-project").click(function(){return loadEditor()}),$("#view-project").click(function(){return loadProjectBrowser()})},verifyLoginCredentials=function(a){var b,c,d,e;return c=$.cookie(adminParams.domain+"_auth"),e=$.cookie(adminParams.domain+"_secret"),d=$.cookie(adminParams.domain+"_link"),b="hash="+c+"&secret="+e+"&dblink="+d,$.post(adminParams.loginApiTarget,b,"json").done(function(b){return b.status===!0?a(b):goTo(b.login_url)}).fail(function(a,b){return $("main #main-body").html("<div class='bs-callout-danger bs-callout'><h4>Couldn't verify login</h4><p>There's currently a server problem. Try back again soon.</p></div>"),console.log(a,b),!1}),!1},startAdminActionHelper=function(){var a;return $("#admin-actions-block").empty(),a='<span id="pib-wrapper-dashboard" class="pib-wrapper" data-toggle="tooltip" title="Administration Home" data-placement="bottom">\n  <paper-icon-button icon="icons:dashboard" class="admin-action" id="show-actions">\n  </paper-icon-button>\n</span>',$("#pib-wrapper-settings").after(a),$("#show-actions").click(function(){return $(this).tooltip("hide"),$(".tooltip").tooltip("hide"),populateAdminActions()})},loadEditor=function(){return startAdminActionHelper(),adData.cartoRef="38544c04-5e56-11e5-8515-0e4fddd5de28",geo.init(),foo(),!1},loadCreateNewProject=function(){var a;return startAdminActionHelper(),a='<h2 class="new-title">Project Title</h2>\n<paper-input label="Project Title" id="project-title" class="project-field col-md-6 col-xs-12" required autovalidate="true"></paper-input>\n<h2 class="new-title">Project Parameters</h2>\n<section class="project-inputs clearfix">\n  <paper-input label="Primary Disease Studied" id="project-disease" class="project-field col-md-6 col-xs-12" required autovalidate="true"></paper-input>\n  <paper-input label="Project Reference" id="reference-id" class="project-field col-md-6 col-xs-12"></paper-input>\n  <h2 class="new-title">Lab Parameters</h2>\n  <paper-input label="Project PI" id="project-pi" class="project-field col-md-6 col-xs-12"  required autovalidate="true"></paper-input>\n  <paper-input label="Project Contact" id="project-author" class="project-field col-md-6 col-xs-12"  required autovalidate="true"></paper-input>\n  <gold-email-input label="Contact Email" id="author-email" class="project-field col-md-6 col-xs-12"  required autovalidate="true"></gold-email-input>\n  <paper-input label="Project Lab" id="project-lab" class="project-field col-md-6 col-xs-12"  required autovalidate="true"></paper-input>\n  <h2 class="new-title">Project Notes</h2>\n  <iron-autogrow-textarea id="project-notes" class="project-field col-md-6 col-xs-12" rows="3"></iron-autogrow-textarea>\n  <h2 class="new-title">Data Parameters</h2>\n  <paper-input label="Samples Counted" placeholder="Please upload a data file to see sample count" class="project-field col-md-6 col-xs-12" id="samplecount" readonly type="number"></paper-input>\n  <h2 class="new-title">Transects</h2>\n  <div class="col-xs-12">\n    <span class="toggle-off-label iron-label">Locality Name</span>\n    <paper-toggle-button id="transect-input-toggle" checked>Coordinate List</paper-toggle-button>\n  </div>\n  <p id="transect-instructions" class="col-xs-12"></p>\n  <div id="transect-input" class="col-md-6 col-xs-12">\n  </div>\n  <div id="carto-rendered-map" class="col-md-6">\n    <div id="carto-map-container" class="carto-map map">\n    </div>\n  </div>\n</section>\n<p>Etc</p>\n<h2 class="new-title">Uploading your project data</h2>\n<p>Drag and drop as many files as you need below. </p>\n<p>\n  To save your project, we need at least one file with structured data containing coordinates.\n  Please note that the data <strong>must</strong> have a header row,\n  and the data <strong>must</strong> have the columns <code>decimalLatitude</code>, <code>decimalLongitude</code>, <code>alt</code>, and <code>coordinateUncertaintyInMeters</code>.\n</p>',$("main #main-body").append(a),bootstrapUploader(),bootstrapTransect(),foo(),!1},loadProjectBrowser=function(){var a;return startAdminActionHelper(),a="<div class='bs-callout bs-callout-warn center-block col-md-5'>\n  <p>Function worked, there's just nothing to show yet.</p>\n  <p>Imagine the beautiful and functional browser of all projects you have access to of your dreams, here.</p>\n</div>",$("#main-body").html(a),adData.cartoRef="38544c04-5e56-11e5-8515-0e4fddd5de28",geo.init(),foo(),!1},bootstrapTransect=function(){var a,b,c;return c=function(a){return foo(),!1},a=function(){var a;return window.geocodeLookupCallback=function(){var a,b,c;return startLoad(),b=p$("#locality-input").value,a=new google.maps.Geocoder,c={address:b},a.geocode(c,function(a,b){var c,d,e,f,g,h,i,j;return b===google.maps.GeocoderStatus.OK?(console.info("Google said:",a),$("#locality-lookup-result").exists()||$("#carto-rendered-map").prepend('<div class="alert alert-info alert-dismissable" role="alert" id="locality-lookup-result">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Location Found</strong>: <span class="lookup-name"></span>\n</div>'),$("#locality-lookup-result .lookup-name").text(a[0].formatted_address),j=a[0].geometry.location,h=j.lat(),i=j.lng(),f=a[0].geometry.viewport,c=f.O,d=f.j,e={nw:[c.O,d.O],ne:[c.j,d.O],sw:[c.O,d.j],se:[c.j,d.j]},console.info("Got bounds: ",[h,i],e),g=function(){var a;return a={cartodb_logo:!1,https:!0,mobile_layout:!0,gmaps_base_type:"hybrid",center_lat:h,center_lon:i,zoom:7},createMap(null,"carto-map-container",a,function(a,b){return foo()})},loadJS("js/cartodb.js",g,!1),stopLoad()):stopLoadError("Couldn't find location: "+b)})},null==("undefined"!=typeof google&&null!==google?google.maps:void 0)?loadJS("https://maps.googleapis.com/maps/api/js?key="+gMapsApiKey+"&callback=geocodeLookupCallback"):geocodeLookupCallback(),
a=new Array,c(a),!1},(b=function(){var b,d;return p$("#transect-input-toggle").checked?(b="Please input a list of coordinates, in the form <code>lat, lng</code>, with one set on each line. <strong>Please press <kbd>enter</kbd> to insert a new line after your last coordinate</strong>.",d='<iron-autogrow-textarea id="coord-input" class="" required rows="3"></iron-autogrow-textarea>'):(b="Please enter a name of a locality",d='<paper-input id="locality-input" label="Locality" class="pull-left" required autovalidate></paper-input> <paper-icon-button class="pull-left" id="do-search-locality" icon="icons:search"></paper-icon-button>'),$("#transect-instructions").html(b),$("#transect-input").html(d),p$("#transect-input-toggle").checked?$(p$("#coord-input").textarea).keyup(function(a){return function(a){var b,d,e,f,g,h,i,j,k,l;if(h=a.keyCode?a.keyCode:a.which,13===h&&(l=$(p$("#coord-input").textarea).val(),j=l.split("\n").length,j>3)){for(e=new Array,f=l.split("\n"),g=0,i=f.length;i>g;g++)b=f[g],b.search(!1)&&(d=b.split(","),k=[toFloat(d[0]),toFloat(d[1])],e.push(k));return e.length>=3?(console.info("Coords:",e),c(e)):console.warn("There is one or more invalid coordinates preventing the UI from being shown.")}}}(this)):($("#locality-input").keyup(function(b){var c;return c=b.keyCode?b.keyCode:b.which,13===c?a():void 0}),$("#do-search-locality").click(function(){return a()})),!1})(),$("#transect-input-toggle").on("iron-change",function(){return b()}),!1},bootstrapUploader=function(a){var b,c;return null==a&&(a="file-uploader"),c="#"+a,$(c).exists()||(b='<form id="'+a+'-form" class="col-md-4 clearfix">\n  <p class="visible-xs-block">Tap the button to upload a file</p>\n  <fieldset class="hidden-xs">\n    <legend>Upload Files</legend>\n    <div id="'+a+'" class="media-uploader outline media-upload-target">\n    </div>\n  </fieldset>\n</form>',$("main #main-body").append(b),$(c).submit(function(a){return a.preventDefault(),a.stopPropagation(),!1})),verifyLoginCredentials(function(){return null==window.dropperParams&&(window.dropperParams=new Object),window.dropperParams.uploadPath="uploaded/"+user+"/",loadJS("helpers/js-dragdrop/client-upload.min.js",function(){return console.info("Loaded drag drop helper"),window.dropperParams.postUploadHandler=function(a,b){var c,d,e,f,g,h;if(window.dropperParams.dropzone.removeAllFiles(),"object"!=typeof b)return console.error("Dropzone returned an error - "+b),toastStatusMessage("There was a problem with the server handling your image. Please try again."),!1;if(b.status!==!0)return null==b.human_error&&(b.human_error="There was a problem uploading your image."),toastStatusMessage(""+b.human_error),console.error("Error uploading!",b),!1;try{switch(console.info("Server returned the following result:",b),console.info("The script returned the following file information:",a),g="helpers/js-dragdrop/uploaded/"+user+"/",b.full_path=b.wrote_file,b.thumb_path=b.wrote_thumb,f=b.mime_provided.split("/")[0],e=b.mime_provided.split("/")[1],d=a.size<5242880||"image"!==f?""+g+b.full_path:""+g+b.thumb_path,h=function(){switch(f){case"image":return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <img src="'+d+'" alt=\'Uploaded Image\' class="img-circle thumb-img img-responsive"/>\n    <p class="text-muted">\n      '+a.name+" -> "+b.full_path+'\n  (<a href="'+d+'" class="newwindow" download="'+a.name+'">\n    Original Image\n  </a>)\n    </p>\n</div>';case"audio":return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <audio src="'+d+'" controls preload="auto">\n    <span class="glyphicon glyphicon-music"></span>\n    <p>\n      Your browser doesn\'t support the HTML5 <code>audio</code> element.\n      Please download the file below.\n    </p>\n  </audio>\n  <p class="text-muted">\n    '+a.name+" -> "+b.full_path+'\n    (<a href="'+d+'" class="newwindow" download="'+a.name+'">\n      Original Media\n    </a>)\n  </p>\n</div>';case"video":return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <video src="'+d+'" controls preload="auto">\n    <img src="'+g+b.thumb_path+'" alt="Video Thumbnail" class="img-responsive" />\n    <p>\n      Your browser doesn\'t support the HTML5 <code>video</code> element.\n      Please download the file below.\n    </p>\n  </video>\n  <p class="text-muted">\n    '+a.name+" -> "+b.full_path+'\n    (<a href="'+d+'" class="newwindow" download="'+a.name+'">\n      Original Media\n    </a>)\n  </p>\n</div>';default:return'<div class="uploaded-media center-block" data-system-file="'+b.full_path+'">\n  <span class="glyphicon glyphicon-file"></span>\n  <p class="text-muted">'+a.name+" -> "+b.full_path+"</p>\n</div>"}}(),$(window.dropperParams.dropTargetSelector).before(h),f){case"application":switch(console.info("Checking "+e+" in application"),e){case"vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"vnd.ms-excel":return excelHandler(d);case"zip":case"x-zip-compressed":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===a.type||"xlsx"===d.split(".").pop()?excelHandler(d):zipHandler(d);case"x-7z-compressed":return _7zHandler(d)}break;case"text":return csvHandler();case"image":return imageHandler()}}catch(i){return c=i,toastStatusMessage("Your file uploaded successfully, but there was a problem in the post-processing.")}}}),!1})},singleDataFileHelper=function(a,b){var c;return"function"!=typeof b?(console.error("Second argument must be a function"),!1):dataFileParams.hasDataFile===!0?($("#single-data-file-modal").exists()&&$("#single-data-file-modal").remove(),c='<paper-dialog modal id="single-data-file-modal">\n  <h2>You can only have one primary data file</h2>\n  <div>\n    Continuing will remove your previous one\n  </div>\n  <div class="buttons">\n    <paper-button id="cancel-parse">Cancel Upload</paper-button>\n    <paper-button id="overwrite">Replace Previous</paper-button>\n  </div>\n</paper-dialog>',$("body").append(c),$("#cancel-parse").click(function(){return removeDataFile(a,!1),p$("#single-data-file-modal").close(),!1}),$("#overwrite").click(function(){return removeDataFile(),p$("#single-data-file-modal").close(),b()}),safariDialogHelper("#single-data-file-modal")):b()},excelHandler=function(a,b){var c,d,e;return null==b&&(b=!0),startLoad(),toastStatusMessage("Processing ..."),e=helperDir+"excelHelper.php",d=a,a.search(-1!==helperDir)&&(d=a.slice(helperDir.length)),console.info("Pinging for "+d),c="action=parse&path="+d,$.get(e,c,"json").done(function(b){return console.info("Got result",b),singleDataFileHelper(a,function(){var c,e,f,g;return dataFileParams.hasDataFile=!0,dataFileParams.fileName=a,dataFileParams.filePath=d,g=Object.size(b.data),e="",g>0&&(f=randomInt(1,g)-1,e="\n\nHere's a random row: "+JSON.stringify(b.data[f])),c="<pre>\nFrom upload, fetched "+g+" rows."+e+"\n</pre>",$("#main-body").append(c),newGeoDataHandler(b.data),stopLoad()})}).fail(function(a,b){return console.error("Couldn't POST"),console.warn(a,b),stopLoadError()}),!1},csvHandler=function(a){return dataFileParams.hasDataFile=!0,dataFileParams.fileName=a,dataFileParams.filePath=correctedPath,geoDataHandler(),!1},imageHandler=function(a){return foo(),!1},zipHandler=function(a){return foo(),!1},_7zHandler=function(a){return foo(),!1},removeDataFile=function(a,b){var c,d;return null==a&&(a=dataFileParams.fileName),null==b&&(b=!0),a=a.split("/").pop(),b&&(dataFileParams.hasDataFile=!1),$(".uploaded-media[data-system-file='"+a+"']").remove(),d=helperDir+"/js-dragdrop/uploaded/"+user+"/"+a,c="action=removefile&path="+encode64(a)+"&user="+user,!1},newGeoDataHandler=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;null==a&&(a=new Object);try{try{p=a[0]}catch(v){return toastStatusMessage("Your data file was malformed, and could not be parsed. Please try again."),removeDataFile(),!1}if(null==p.decimalLatitude||null==p.decimalLongitude||null==p.coordinateUncertaintyInMeters||null==p.alt)return toastStatusMessage("Data are missing required geo columns. Please reformat and try again."),console.info("Missing: ",null!=p.decimalLatitude,null!=p.decimalLongitude,null!=p.coordinateUncertaintyInMeters,null!=p.alt),removeDataFile(),!1;if(!(isNumber(p.decimalLatitude)&&isNumber(p.decimalLongitude)&&isNumber(p.coordinateUncertaintyInMeters)&&isNumber(p.alt)))return toastStatusMessage("Data has invalid entries for geo columns. Please be sure they're all numeric and try again."),removeDataFile(),!1;o=Object.size(a),p$("#samplecount").value=o,isNull(p$("#project-disease"))&&(p$("#project-disease").value=p.diseaseTested),k=new Object;for(j in a){n=a[j],s=new Object;for(c in n){switch(u=n[c],c){case"dateIdentified":try{u>0&&1e6>u?(f=25569,g=24107,q=86400,r=(u-f)*q*1e3):r=Date.parse(u)}catch(v){r=Date.now()}d=new Date(r),e=d.getUTCDate(),10>e&&(e="0"+e),i=d.getUTCMonth()+1,10>i&&(i="0"+i),b=d.getUTCFullYear()+"-"+i+"-"+e;break;case"fatal":b=u.toBool();break;case"decimalLatitude":case"decimalLongitude":case"alt":case"coordinateUncertaintyInMeters":b=toFloat(u);break;case"diseaseDetected":b=isBool(u)?u.toBool():"NO_CONFIDENCE";break;default:try{b=u.trim()}catch(v){b=u}}s[c]=b}k[j]=s}try{l=JsonHuman.format(k),$("#main-body").append(l)}catch(v){h=v,console.warn("Couldn't pretty set!"),console.warn(h.stack),console.info(k)}m="t"+md5(p$("#project-title").value+$.cookie(uri.domain+"_link")),t={transectRing:void 0,data:k},geo.requestCartoUpload(t,m,"create")}catch(v){h=v,console.error(h.message),toastStatusMessage("There was a problem parsing your data")}return!1},$(function(){return $("#next").exists()&&$("#next").unbind().click(function(){return openTab(adminParams.adminPageUrl)}),loadJS("bower_components/bootstrap/dist/js/bootstrap.min.js",function(){return $("body").tooltip({selector:"[data-toggle='tooltip']"})})});
//# sourceMappingURL=maps/combined.map