var checkCoordinateSanity,doDeepSearch,doSearch,getSearchObject,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};checkCoordinateSanity=function(){var a,b;return b=!0,a={n:$("#north-coordinate").val(),w:$("#west-coordinate").val(),s:$("#south-coordinate").val(),e:$("#east-coordinate").val()},a.n>a.s||(b=!1,$(".lat-input").parent().addClass("has-error")),a.e>a.w||(b=!1,$(".lng-input").parent().addClass("has-error")),b?($(".coord-input").parent().removeClass("has-error"),$(".do-search").removeAttr("disabled"),!0):($(".do-search").attr("disabled","disabled"),!1)},getSearchObject=function(){var a,b,c,d;return a={n:$("#north-coordinate").val(),w:$("#west-coordinate").val(),s:$("#south-coordinate").val(),e:$("#east-coordinate").val()},d={sampled_species:{data:$("#taxa-input").val()},bounding_box_n:{data:a.n,search_type:"<="},bounding_box_e:{data:a.e,search_type:"<="},bounding_box_w:{data:a.w,search_type:">="},bounding_box_s:{data:a.s,search_type:">="}},b=$(p$("#disease-status").selectedItem).attr("data-search"),"*"!==b&&(d.disease_positive={data:0,search_type:b.toBool()?">":"="}),c=$(p$("#morbidity-status").selectedItem).attr("data-search"),"*"!==c&&(d.disease_morbidity={data:0,search_type:c.toBool()?">":"="}),d},doSearch=function(a,b){var c,d;return null==a&&(a=getSearchObject()),null==b&&(b=!1),startLoad(),d=jsonTo64(a),c="perform=advanced_project_search&q="+d,$.post(uri.urlString+"admin-api.php",c,"json").done(function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(console.info("Adv. search result",c),c.status!==!0)return console.error(c.error),stopLoadError("There was a problem fetching the results"),!1;if(q=Object.toArray(c.result),0===q.length)return console.warn("No results"),stopLoadError("No results"),!1;try{d=[[a.bounding_box_n.data,a.bounding_box_w.data],[a.bounding_box_n.data,a.bounding_box_e.data],[a.bounding_box_s.data,a.bounding_box_e.data],[a.bounding_box_s.data,a.bounding_box_w.data]],n=getMapCenter(d),p$("#global-data-map").latitude=n.lat,p$("#global-data-map").longitude=n.lng,x=getMapZoom(d,"#global-data-map")}catch(f){e=f,console.warn("Failed to rezoom/recenter map - "+e.message),console.warn(e.stack)}if(b)return doDeepSearch(q),!1;for(v=0,o=0,w=[],k=[],h=0,l=q.length;l>h;h++){for(p=q[h],v+=p.disease_samples,o+=p.disease_positive,r=p.sampled_species.split(","),i=0,m=r.length;m>i;i++)s=r[i],s=s.trim(),indexOf.call(w,s)<0&&w.push(s);u=p.carto_id.table,isNull(u)||(j={sql:"SELECT * FROM "+u},k.push(j))}t=w.length,console.info("Projects containing your search returned "+v+" ("+o+" positive) among "+t+" species"),$("#post-map-subtitle").text("Viewing projects containing "+v+" samples ("+o+" positive) among "+t+" species");try{createRawCartoMap(k)}catch(g){e=g,console.error("Couldn't create map! "+e.message),console.warn(e.stack)}return stopLoad(),!1}).fail(function(a,b){return console.error(a,b),stopLoadError("Server error, couldn't perform search")}),!1},doDeepSearch=function(a){return toastStatusMessage("Deep search not yet implemented"),stopLoad(),!1},$(function(){return $(".coord-input").keyup(function(){return checkCoordinateSanity()}),$(".do-search").click(function(){var a,b;return(b=checkCoordinateSanity())?(a=$(this).attr("data-deep").toBool(),doSearch(getSearchObject(),a),!1):(toastStatusMessage("Please check your coordinates"),!1)})});
//# sourceMappingURL=maps/c.map