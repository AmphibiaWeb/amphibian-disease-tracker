var checkCoordinateSanity,doDeepSearch,doSearch,getSearchObject,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};checkCoordinateSanity=function(){var a,b;return b=!0,a={n:toFloat($("#north-coordinate").val()),w:toFloat($("#west-coordinate").val()),s:toFloat($("#south-coordinate").val()),e:toFloat($("#east-coordinate").val())},console.log("User Bounds",a),a.n>a.s||(b=!1,$(".lat-input").parent().addClass("has-error")),a.e>a.w||(b=!1,$(".lng-input").parent().addClass("has-error")),b?($(".coord-input").parent().removeClass("has-error"),$(".do-search").removeAttr("disabled"),!0):($(".do-search").attr("disabled","disabled"),!1)},getSearchObject=function(){var a,b,c,d;return a={n:$("#north-coordinate").val(),w:$("#west-coordinate").val(),s:$("#south-coordinate").val(),e:$("#east-coordinate").val()},d={sampled_species:{data:$("#taxa-input").val()},bounding_box_n:{data:a.n,search_type:"<="},bounding_box_e:{data:a.e,search_type:"<="},bounding_box_w:{data:a.w,search_type:">="},bounding_box_s:{data:a.s,search_type:">="}},b=$(p$("#disease-status").selectedItem).attr("data-search"),"*"!==b&&(d.disease_positive={data:0,search_type:b.toBool()?">":"="}),c=$(p$("#morbidity-status").selectedItem).attr("data-search"),"*"!==c&&(d.disease_morbidity={data:0,search_type:c.toBool()?">":"="}),d},doSearch=function(a,b){var c,d;return null==a&&(a=getSearchObject()),null==b&&(b=!1),startLoad(),d=jsonTo64(a),c="perform=advanced_project_search&q="+d,$.post(uri.urlString+"admin-api.php",c,"json").done(function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;if(console.info("Adv. search result",a),a.status!==!0)return console.error(a.error),stopLoadError("There was a problem fetching the results"),!1;if(x=Object.toArray(a.result),0===x.length)return console.warn("No results"),stopLoadError("No results"),!1;for(C=0,u=0,D=[],q=[],c={n:-90,s:90,e:-180,w:180},l=0,m=0,r=x.length;r>m;m++){for(v=x[m],v.bounding_box_n>c.n&&(c.n=v.bounding_box_n),v.bounding_box_e>c.e&&(c.e=v.bounding_box_e),v.bounding_box_s<c.s&&(c.s=v.bounding_box_s),v.bounding_box_w<c.w&&(c.w=v.bounding_box_w),C+=v.disease_samples,u+=v.disease_positive,y=v.sampled_species.split(","),n=0,s=y.length;s>n;n++)z=y[n],z=z.trim(),indexOf.call(D,z)<0&&D.push(z);if(null==(null!=(w=v.carto_id)?w.table:void 0))try{f=JSON.parse(v.carto_id),e={};for(o in f){E=f[o],g=o.replace("&#95;","_");try{h=E.replace("&#95;","_")}catch(G){h=E}e[g]=h}v.carto_id=e}catch(H){}B=v.carto_id.table.slice(0,63),isNull(B)?console.warn("Unable to get a table id from this carto data:",v.carto_id):(p={sql:"SELECT * FROM "+B,cartocss:"#"+B+" {marker-fill: #F0F0F0; polygon-fill: #FF6600; line-color: #000; line-width: 1; polygon-opacity: 0.7; line-opacity: 1;}"},q.push(p)),x[l]=v,++l}try{d=[[c.n,c.w],[c.n,c.e],[c.s,c.e],[c.s,c.w]],t=getMapCenter(d);try{p$("#global-data-map").latitude=t.lat,p$("#global-data-map").longitude=t.lng}catch(I){try{geo.lMap.panTo([t.lat,t.lng])}catch(H){}}F=getMapZoom(d,".map-container"),null!=geo.lMap&&geo.lMap.setZoom(F)}catch(j){i=j,console.warn("Failed to rezoom/recenter map - "+i.message,d),console.warn(i.stack)}if(b)return doDeepSearch(x),!1;A=D.length,console.info("Projects containing your search returned "+C+" ("+u+" positive) among "+A+" species",c),$("#post-map-subtitle").text("Viewing projects containing "+C+" samples ("+u+" positive) among "+A+" species");try{createRawCartoMap(q)}catch(k){i=k,console.error("Couldn't create map! "+i.message),console.warn(i.stack)}return stopLoad(),!1}).fail(function(a,b){return console.error(a,b),stopLoadError("Server error, couldn't perform search")}),!1},doDeepSearch=function(a){return toastStatusMessage("Deep search not yet implemented"),stopLoad(),!1},$(function(){var a,b,c;return geo.initLocation(),c={center:[window.locationData.lat,window.locationData.lng],zoom:5},a=new L.Map("global-map-container",c),b={attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community"},L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",b).addTo(a),geo.lMap=a,$(".coord-input").keyup(function(){return checkCoordinateSanity()}),$(".do-search").click(function(){var a,b;return(b=checkCoordinateSanity())?(a=$(this).attr("data-deep").toBool(),doSearch(getSearchObject(),a),!1):(toastStatusMessage("Please check your coordinates"),!1)})});
//# sourceMappingURL=maps/c.map