var getSampleSummaryDialog,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};importScripts("c.min.js","https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"),self.addEventListener("message",function(a){var b,c;switch(a.data.action){case"summary-dialog":return b=a.data.resultsList,c=a.data.tableToProjectMap,getSampleSummaryDialog(b,c)}}),getSampleSummaryDialog=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;if(isArray(a)||(a=Object.toArray(a)),0===a.length)return console.warn("There were no results in the result list"),!1;for(console.log("Generating dialog from",a),w=[],s=[],l=0,G=["cartodb_id","the_geom","the_geom_webmercator","id"],window.dataSummary={species:[],diseases:[],data:{}},m=0,o=a.length;m<o;m++){v=a[m],++l,g=.5*$(window).width(),h=.3*$(window).width();try{B=v.rows;try{c={},x=v.rows;for(r in x){for(A=x[r],n=0,p=G.length;n<p;n++)d=G[n],delete A[d];c[r]=A,A.carto_table=v.table,A.project_id=v.project_id,C=getPrettySpecies(A),indexOf.call(dataSummary.species,C)<0&&dataSummary.species.push(C),e=A.diseasetested,indexOf.call(dataSummary.diseases,e)<0&&dataSummary.diseases.push(e),isNull(dataSummary.data[C])&&(dataSummary.data[C]={}),isNull(dataSummary.data[C][e])&&(dataSummary.data[C][e]={samples:0,positive:0,negative:0,no_confidence:0,prevalence:0}),A.diseasedetected.toBool()?dataSummary.data[C][e].positive++:"no_confidence"===A.diseasedetected.toLowerCase()?dataSummary.data[C][e].no_confidence++:dataSummary.data[C][e].negative++,dataSummary.data[C][e].samples++,t=dataSummary.data[C][e].positive/dataSummary.data[C][e].samples,dataSummary.data[C][e].prevalence=t,s.push(A)}B=c}catch(a){y=v.rows;for(r in y)A=y[r],A.carto_table=v.table,A.project_id=v.project_id,s.push(A)}if(f=JSON.stringify(B),isNull(f)){console.warn("Got bad data for row #"+l+"!",v,v.rows,f);continue}f=""+f}catch(a){f="Invalid data from server"}E=u=b[v.table],A='<tr>\n  <td colspan="4" class="code-box-container"><pre readonly class="code-box language-json" style="max-width:'+g+"px;min-width:"+h+'px">'+f+'</pre></td>\n  <td class="text-center"><paper-icon-button data-toggle="tooltip" raised class="click" data-href="https://amphibiandisease.org/project.php?id='+u.id+'" icon="icons:arrow-forward" title="'+u.name+'"></paper-icon-button></td>\n</tr>',w.push(A)}window.summaryTableRows={},z=dataSummary.data;for(C in z){j=z[C];for(i in j)f=j[i],null==summaryTableRows[i]&&(summaryTableRows[i]=[]),t=100*f.prevalence,t=roundNumberSigfig(t,2),summaryTableRows[i].push("<tr>\n  <td>"+C+"</td>\n  <td>"+f.samples+"</td>\n  <td>"+f.positive+"</td>\n  <td>"+f.negative+"</td>\n  <td>"+t+"%</td>\n</tr>")}D="";for(i in summaryTableRows)F=summaryTableRows[i],D+='<div class="row">\n  <div class="col-xs-12">\n    <h3>'+i+'</h3>\n    <table class="table table-striped">\n      <tr>\n        <th>Species</th>\n        <th>Samples</th>\n        <th>Disease Positive</th>\n        <th>Disease Negative</th>\n        <th>Disease Prevalence</th>\n      </tr>\n      '+F.join("\n")+"\n    </table>\n  </div>\n</div>";return k='<paper-dialog id="modal-sql-details-list" modal always-on-top auto-fit-on-attach>\n  <h2>Project Result List</h2>\n  <paper-dialog-scrollable>\n    '+D+'\n    <div class="row">\n      <div class="col-xs-12">\n        <h3>Raw Data</h3>\n        <table class="table table-striped">\n          <tr>\n            <th colspan="4">Query Data</th>\n            <th>Visit Project</th>\n          </tr>\n          '+w.join("\n")+'\n        </table>\n      </div>\n    </div>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button id="generate-download">Create Download</paper-button>\n    <paper-button dialog-dismiss>Close</paper-button>\n  </div>\n</paper-dialog>',q={html:k,outputData:s},self.postMessage(q),self.close()};
//# sourceMappingURL=maps/c.map