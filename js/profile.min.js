var apiTarget,cascadePrivacyToggledState,cleanupAddressDisplay,conditionalLoadAccountSettingsOptions,constructProfileJson,copyLink,createOverflowMenu,forceUpdateMarked,formatSocial,getProfilePrivacy,imageHandler,initialCascadeSetup,isoCountries,loadUserBadges,profileAction,renderCaptchas,saveProfileChanges,searchProfiles,setupProfileImageUpload,setupUserChat,validateAddress,verifyLoginCredentials;profileAction="update_profile",apiTarget=uri.urlString+"/admin-api.php",window._adp={};try{(createOverflowMenu=function(){return checkLoggedIn(function(a){var b,c;return b=a.status?'    <paper-item data-href="https://amphibiandisease.org/admin" class="click">\n  <iron-icon icon="icons:settings-applications"></iron-icon>\n  Account Settings\n</paper-item>\n<paper-item data-href="https://amphibiandisease.org/admin-login.php?q=logout" class="click">\n  <span class="glyphicon glyphicon-log-out"></span>\n  Log Out\n</paper-item>':"",c='<paper-menu-button id="header-overflow-menu" vertical-align="bottom" horizontal-offset="-15" horizontal-align="right" vertical-offset="30">\n  <paper-icon-button icon="icons:more-vert" class="dropdown-trigger"></paper-icon-button>\n  <paper-menu class="dropdown-content">\n    '+b+'\n    <paper-item data-href="'+uri.urlString+'/dashboard.php" class="click">\n      Summary Dashboard\n    </paper-item>\n    <paper-item data-href="https://amphibian-disease-tracker.readthedocs.org" class="click">\n      <iron-icon icon="icons:chrome-reader-mode"></iron-icon>\n      Documentation\n    </paper-item>\n    <paper-item data-href="https://github.com/AmphibiaWeb/amphibian-disease-tracker" class="click">\n      <iron-icon icon="glyphicon-social:github"></iron-icon>\n      Github\n    </paper-item>\n    <paper-item data-href="https://amphibiandisease.org/about.php" class="click">\n      About / Legal\n    </paper-item>\n  </paper-menu>\n</paper-menu-button>',$("#header-overflow-menu").remove(),$("header#header-bar .logo-container + p").append(c),isNull(b)||$("header#header-bar paper-icon-button[icon='icons:settings-applications']").remove(),bindClicks()}),!1})()}catch(a){}isoCountries={ZW:{name:"Zimbabwe",code:"263"},ZM:{name:"Zambia",code:"260"},ZA:{name:"South Africa",code:"27"},YT:{name:"Mayotte",code:"262"},YE:{name:"Yemen",code:"967"},XK:{name:"Kosovo",code:"383"},WS:{name:"Samoa",code:"685"},WF:{name:"Wallis And Futuna",code:"681"},VU:{name:"Vanuatu",code:"678"},VN:{name:"Viet Nam",code:"84"},VI:{name:"Virgin Islands (US)",code:"1 340"},VG:{name:"Virgin Islands (British)",code:"1 284"},VE:{name:"Venezuela, Bolivarian Republic Of",code:"58"},VC:{name:"Saint Vincent And The Grenadines",code:"1 784"},VA:{name:"Vatican City State",code:"379"},UZ:{name:"Uzbekistan",code:"998"},UY:{name:"Uruguay",code:"598"},US:{name:"United States",code:"1"},UM:{name:"United States Minor Outlying Islands",code:"1"},UK:{name:"United Kingdom",code:""},UG:{name:"Uganda",code:"256"},UA:{name:"Ukraine",code:"380"},TZ:{name:"Tanzania, United Republic Of",code:"255"},TW:{name:"Taiwan",code:"886"},TV:{name:"Tuvalu",code:"688"},TT:{name:"Trinidad And Tobago",code:"1 868"},TR:{name:"Turkey",code:"90"},TO:{name:"Tonga",code:"676"},TN:{name:"Tunisia",code:"216"},TM:{name:"Turkmenistan",code:"993"},TL:{name:"Timor-Leste, Democratic Republic of",code:"670"},TK:{name:"Tokelau",code:"690"},TJ:{name:"Tajikistan",code:"992"},TH:{name:"Thailand",code:"66"},TG:{name:"Togo",code:"228"},TF:{name:"French Southern Territories",code:""},TD:{name:"Chad",code:"235"},TC:{name:"Turks And Caicos Islands",code:"1 649"},TA:{name:"Tristan de Cunha",code:"290"},SZ:{name:"Swaziland",code:"268"},SY:{name:"Syrian Arab Republic",code:"963"},SX:{name:"Sint Maarten",code:"1 721"},SV:{name:"El Salvador",code:"503"},SU:{name:"USSR",code:""},ST:{name:"Sï¿½o Tomï¿½ and Prï¿½ncipe",code:"239"},SS:{name:"South Sudan",code:"211"},SR:{name:"Suriname",code:"597"},SO:{name:"Somalia",code:"252"},SN:{name:"Senegal",code:"221"},SM:{name:"San Marino",code:"378"},SL:{name:"Sierra Leone",code:"232"},SK:{name:"Slovakia",code:"421"},SJ:{name:"Svalbard And Jan Mayen",code:"47"},SI:{name:"Slovenia",code:"386"},SH:{name:"Saint Helena, Ascension And Tristan Da Cunha",code:"290"},SG:{name:"Singapore",code:"65"},SE:{name:"Sweden",code:"46"},SD:{name:"Sudan",code:"249"},SC:{name:"Seychelles",code:"248"},SB:{name:"Solomon Islands",code:"677"},SA:{name:"Saudi Arabia",code:"966"},RW:{name:"Rwanda",code:"250"},RU:{name:"Russian Federation",code:"7"},RS:{name:"Serbia",code:"381"},RO:{name:"Romania",code:"40"},RE:{name:"Reunion",code:"262"},QA:{name:"Qatar",code:"974"},PY:{name:"Paraguay",code:"595"},PW:{name:"Palau",code:"680"},PT:{name:"Portugal",code:"351"},PS:{name:"Palestinian Territory, Occupied",code:"970"},PR:{name:"Puerto Rico",code:"1 787"},PN:{name:"Pitcairn",code:"872"},PM:{name:"Saint Pierre And Miquelon",code:"508"},PL:{name:"Poland",code:"48"},PK:{name:"Pakistan",code:"92"},PH:{name:"Philippines",code:"63"},PG:{name:"Papua New Guinea",code:"675"},PF:{name:"French Polynesia",code:"689"},PE:{name:"Peru",code:"51"},PA:{name:"Panama",code:"507"},OM:{name:"Oman",code:"968"},NZ:{name:"New Zealand",code:"64"},NU:{name:"Niue",code:"683"},NR:{name:"Nauru",code:"674"},NP:{name:"Nepal",code:"977"},NO:{name:"Norway",code:"47"},NL:{name:"Netherlands",code:"31"},NI:{name:"Nicaragua",code:"505"},NG:{name:"Nigeria",code:"234"},NF:{name:"Norfolk Island",code:"672"},NE:{name:"Niger",code:"227"},NC:{name:"New Caledonia",code:"687"},NA:{name:"Namibia",code:"264"},MZ:{name:"Mozambique",code:"258"},MY:{name:"Malaysia",code:"60"},MX:{name:"Mexico",code:"52"},MW:{name:"Malawi",code:"265"},MV:{name:"Maldives",code:"960"},MU:{name:"Mauritius",code:"230"},MT:{name:"Malta",code:"356"},MS:{name:"Montserrat",code:"1 664"},MR:{name:"Mauritania",code:"222"},MQ:{name:"Martinique",code:"596"},MP:{name:"Northern Mariana Islands",code:"1 670"},MO:{name:"Macao",code:"853"},MN:{name:"Mongolia",code:"976"},MM:{name:"Myanmar",code:"95"},ML:{name:"Mali",code:"223"},MK:{name:"Macedonia, The Former Yugoslav Republic Of",code:"389"},MH:{name:"Marshall Islands",code:"692"},MG:{name:"Madagascar",code:"261"},MF:{name:"Saint Martin",code:"590"},ME:{name:"Montenegro",code:"382"},MD:{name:"Moldova",code:"373"},MC:{name:"Monaco",code:"377"},MA:{name:"Morocco",code:"212"},LY:{name:"Libya",code:"218"},LV:{name:"Latvia",code:"371"},LU:{name:"Luxembourg",code:"352"},LT:{name:"Lithuania",code:"370"},LS:{name:"Lesotho",code:"266"},LR:{name:"Liberia",code:"231"},LK:{name:"Sri Lanka",code:"94"},LI:{name:"Liechtenstein",code:"423"},LC:{name:"Saint Lucia",code:"1 758"},LB:{name:"Lebanon",code:"961"},LA:{name:"Lao People's Democratic Republic",code:"856"},KZ:{name:"Kazakhstan",code:"7"},KY:{name:"Cayman Islands",code:"1 345"},KW:{name:"Kuwait",code:"965"},KR:{name:"Korea, Republic Of",code:"82"},KP:{name:"Korea, Democratic People's Republic Of",code:"850"},KN:{name:"Saint Kitts And Nevis",code:"1 869"},KM:{name:"Comoros",code:"269"},KI:{name:"Kiribati",code:"686"},KH:{name:"Cambodia",code:"855"},KG:{name:"Kyrgyzstan",code:"996"},KE:{name:"Kenya",code:"254"},JP:{name:"Japan",code:"81"},JO:{name:"Jordan",code:"962"},JM:{name:"Jamaica",code:"1 876"},JE:{name:"Jersey",code:"44"},IT:{name:"Italy",code:"39"},IS:{name:"Iceland",code:"354"},IR:{name:"Iran, Islamic Republic Of",code:"98"},IQ:{name:"Iraq",code:"964"},IO:{name:"British Indian Ocean Territory",code:"246"},IN:{name:"India",code:"91"},IM:{name:"Isle Of Man",code:"44"},IL:{name:"Israel",code:"972"},IE:{name:"Ireland",code:"353"},ID:{name:"Indonesia",code:"62"},IC:{name:"Canary Islands",code:""},HU:{name:"Hungary",code:"36"},HT:{name:"Haiti",code:"509"},HR:{name:"Croatia",code:"385"},HN:{name:"Honduras",code:"504"},HM:{name:"Heard Island And McDonald Islands",code:""},HK:{name:"Hong Kong",code:"852"},GY:{name:"Guyana",code:"592"},GW:{name:"Guinea-bissau",code:"245"},GU:{name:"Guam",code:"1 671"},GT:{name:"Guatemala",code:"502"},GS:{name:"South Georgia And The South Sandwich Islands",code:""},GR:{name:"Greece",code:"30"},GQ:{name:"Equatorial Guinea",code:"240"},GP:{name:"Guadeloupe",code:"590"},GN:{name:"Guinea",code:"224"},GM:{name:"Gambia",code:"220"},GL:{name:"Greenland",code:"299"},GI:{name:"Gibraltar",code:"350"},GH:{name:"Ghana",code:"233"},GG:{name:"Guernsey",code:"44"},GF:{name:"French Guiana",code:"594"},GE:{name:"Georgia",code:"995"},GD:{name:"Grenada",code:"473"},GB:{name:"United Kingdom",code:"44"},GA:{name:"Gabon",code:"241"},FX:{name:"France, Metropolitan",code:"241"},FR:{name:"France",code:"33"},FO:{name:"Faroe Islands",code:"298"},FM:{name:"Micronesia, Federated States Of",code:"691"},FK:{name:"Falkland Islands",code:"500"},FJ:{name:"Fiji",code:"679"},FI:{name:"Finland",code:"358"},EU:{name:"European Union",code:"388"},ET:{name:"Ethiopia",code:"251"},ES:{name:"Spain",code:"34"},ER:{name:"Eritrea",code:"291"},EH:{name:"Western Sahara",code:"212"},EG:{name:"Egypt",code:"20"},EE:{name:"Estonia",code:"372"},EC:{name:"Ecuador",code:"593"},EA:{name:"Ceuta, Mulilla",code:""},DZ:{name:"Algeria",code:"213"},DO:{name:"Dominican Republic",code:"1 809"},DM:{name:"Dominica",code:"1 767"},DK:{name:"Denmark",code:"45"},DJ:{name:"Djibouti",code:"253"},DG:{name:"Diego Garcia",code:""},DE:{name:"Germany",code:"49"},CZ:{name:"Czech Republic",code:"420"},CY:{name:"Cyprus",code:"357"},CX:{name:"Christmas Island",code:"61"},CW:{name:"Curacao",code:"599"},CV:{name:"Cabo Verde",code:"238"},CU:{name:"Cuba",code:"53"},CR:{name:"Costa Rica",code:"506"},CP:{name:"Clipperton Island",code:""},CO:{name:"Colombia",code:"57"},CN:{name:"China",code:"86"},CM:{name:"Cameroon",code:"237"},CL:{name:"Chile",code:"56"},CK:{name:"Cook Islands",code:"682"},CI:{name:"Cote d'Ivoire",code:"225"},CH:{name:"Switzerland",code:"41"},CG:{name:"Republic Of Congo",code:"242"},CF:{name:"Central African Republic",code:"236"},CD:{name:"Democratic Republic Of Congo",code:"243"},CC:{name:"Cocos (Keeling) Islands",code:"61"},CA:{name:"Canada",code:"1"},BZ:{name:"Belize",code:"501"},BY:{name:"Belarus",code:"375"},BW:{name:"Botswana",code:"267"},BV:{name:"Bouvet Island",code:""},BT:{name:"Bhutan",code:"975"},BS:{name:"Bahamas",code:"1 242"},BR:{name:"Brazil",code:"55"},BQ:{name:"Bonaire, Saint Eustatius And Saba",code:"599"},BO:{name:"Bolivia, Plurinational State Of",code:"591"},BN:{name:"Brunei Darussalam",code:"673"},BM:{name:"Bermuda",code:"1 441"},BL:{name:"Saint Barthï¿½lemy",code:"590"},BJ:{name:"Benin",code:"229"},BI:{name:"Burundi",code:"257"},BH:{name:"Bahrain",code:"973"},BG:{name:"Bulgaria",code:"359"},BF:{name:"Burkina Faso",code:"226"},BE:{name:"Belgium",code:"32"},BD:{name:"Bangladesh",code:"880"},BB:{name:"Barbados",code:"1 246"},BA:{name:"Bosnia & Herzegovina",code:"387"},AZ:{name:"Azerbaijan",code:"994"},AX:{name:"ï¿½land Islands",code:"358"},AW:{name:"Aruba",code:"297"},AU:{name:"Australia",code:"61"},AT:{name:"Austria",code:"43"},AS:{name:"American Samoa",code:"1 684"},AR:{name:"Argentina",code:"54"},AQ:{name:"Antarctica",code:"672"},AO:{name:"Angola",code:"244"},AM:{name:"Armenia",code:"374"},AL:{name:"Albania",code:"355"},AI:{name:"Anguilla",code:"1 264"},AG:{name:"Antigua And Barbuda",code:"1 268"},AF:{name:"Afghanistan",code:"93"},AE:{name:"United Arab Emirates",code:"971"},AD:{name:"Andorra",code:"376"},AC:{name:"Ascension Island",code:"247"}},loadUserBadges=function(){return!1},setupProfileImageUpload=function(a,b,c){var d,e,f,g,h,i;return null==a&&(a="profile-image-uploader"),null==b&&(b=""),h="#"+a,d=$.cookie(adminParams.domain+"_link"),i=window.profileUid,g=_adp.projectIdentifierString,$(h).exists()||(console.info("Creating uploader to append"),e='<form id="'+a+'-form" class="'+b+' clearfix">\n  <p class="visible-xs-block">Tap the button to upload a file</p>\n  <fieldset class="hidden-xs">\n    <legend class="sr-only">Profile Image</legend>\n    <div id="'+a+'" class="media-uploader outline media-upload-target">\n    </div>\n  </fieldset>\n</form>',f="main #upload-container-section",$(f).append(e),isNull(b)||$(f).addClass("row"),console.info("Appended upload form",$(f).exists()),$(h).submit(function(a){return a.preventDefault(),a.stopPropagation(),!1})),verifyLoginCredentials(function(){var a;return null==window.dropperParams&&(window.dropperParams={}),window.dropperParams.dropTargetSelector=h,window.dropperParams.uploadPath="../../users/profiles/",window.dropperParams.uploadText="Drop your image here to set a new profile picture",a=window.dropperParams.hasInitialized===!0,loadJS("helpers/js-dragdrop/client-upload.min.js",function(){if(window.dropperParams.mimeTypes="image/*",console.info("Loaded drag drop helper"),a){console.info("Reinitialized dropper");try{window.dropperParams.initialize()}catch(a){console.warn("Couldn't reinitialize dropper!")}}if(window.dropperParams.postUploadHandler=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;if(window.dropperParams.dropzone.removeAllFiles(),"object"!=typeof b)return console.error("Dropzone returned an error - "+b),toastStatusMessage("There was a problem with the server handling your image. Please try again."),!1;if(b.status!==!0)return null==b.human_error&&(b.human_error="There was a problem uploading your image."),toastStatusMessage(""+b.human_error),console.error("Error uploading!",b),!1;try{switch(console.info("Server returned the following result:",b),console.info("The script returned the following file information:",a),k=window.dropperParams.uploadPath,g=b.full_path.split("/").pop(),m=b.wrote_thumb,j=b.mime_provided.split("/")[0],i=b.mime_provided.split("/")[1],h=a.size<5242880||"image"!==j?""+k+b.wrote_file:""+k+m,l=function(){switch(j){case"image":return'<div class="uploaded-media center-block" data-system-file="'+g+'" data-link-path="'+h+'">\n  <img src="'+h+'" alt=\'Uploaded Image\' class="img-circle thumb-img img-responsive"/>\n    <p class="text-muted">\n      '+a.name+" -> "+g+'\n      (<a href="'+h+'" class="newwindow" download="'+a.name+'">\n        Original Image\n      </a>)\n    </p>\n</div>';case"audio":return'<div class="uploaded-media center-block" data-system-file="'+g+'">\n  <audio src="'+h+'" controls preload="auto">\n    <span class="glyphicon glyphicon-music"></span>\n    <p>\n      Your browser doesn\'t support the HTML5 <code>audio</code> element.\n      Please download the file below.\n    </p>\n  </audio>\n  <p class="text-muted">\n    '+a.name+" -> "+g+'\n    (<a href="'+h+'" class="newwindow" download="'+a.name+'">\n      Original Media\n    </a>)\n  </p>\n</div>';case"video":return'<div class="uploaded-media center-block" data-system-file="'+g+'">\n  <video src="'+h+'" controls preload="auto">\n    <img src="'+k+m+'" alt="Video Thumbnail" class="img-responsive" />\n    <p>\n      Your browser doesn\'t support the HTML5 <code>video</code> element.\n      Please download the file below.\n    </p>\n  </video>\n  <p class="text-muted">\n    '+a.name+" -> "+g+'\n    (<a href="'+h+'" class="newwindow" download="'+a.name+'">\n      Original Media\n    </a>)\n  </p>\n</div>';default:return'<div class="uploaded-media center-block" data-system-file="'+g+'" data-link-path="'+h+'">\n  <span class="glyphicon glyphicon-file"></span>\n  <p class="text-muted">'+a.name+" -> "+g+"</p>\n</div>"}}(),$(window.dropperParams.dropTargetSelector).before(l),$("#validator-progress-container").remove(),c=h.slice(0),d=h.slice(0),f=d.split(".").pop(),j){case"application":switch(console.info("Checking "+i+" in application"),i){case"vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"vnd.ms-excel":return excelHandler(h);case"vnd.ms-office":switch(f){case"xls":return excelHandler(h);default:return stopLoadError("Sorry, we didn't understand the upload type."),!1}break;case"zip":case"x-zip-compressed":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===a.type||"xlsx"===f?excelHandler(h):zipHandler(h);case"x-7z-compressed":return _7zHandler(h)}break;case"text":return csvHandler(h);case"image":return imageHandler(h,b)}}catch(a){return e=a,console.error("There was a post-processing error: "+e.message),console.warn(e.stack),toastStatusMessage("Your file uploaded successfully, but there was a problem in the post-processing.")}},"function"==typeof c)return c()}),!1}),!1},imageHandler=function(a,b){var c,d,e,f;return null==b&&(b=null),startLoad(),f=a.replace(/^(\.\.\/)*([\w\/]+\.(jpg|jpeg|png|bmp|gif|webp|pnga))$/gim,"$2"),isNull(f)?(console.error("Invalid path '"+a+"' parsed to invalid canonical path",f),stopLoadError("Processing error. Please try again."),!1):(d={profile_image_path:f},console.log("Going to save",d),e=jsonTo64(d),c="perform=write_profile_image&data="+e,$.post(apiTarget,c,"json").done(function(a){var b,c,d,e,f,g,h,i;if(console.log("Save got",a),a.status!==!0)return f=null!=(g=null!=(h=a.human_error)?h:a.error)?g:"Unknown error",stopLoadError("There was an error saving your profile image - "+f+". Please try again later."),!1;try{e=a.image_uri,i="?v="+Date.now(),d='<img class="profile-image img-responsive"\n  id="user-profile-image"\n  src="'+a.tiny_image_uri+i+'"\n  srcset="'+e+i+" 10x, "+a.small_image_uri+i+" 4x, "+a.tiny_image_uri+i+' 1x" alt="Profile image" />',$("#user-profile-image").replaceWith(d),c='<div class="alert alert-info col-xs-12">\n  <a href="#" class="alert-link hard-refresh-page">Click here to refresh</a> and see your new profile image. Be sure to save any changes first.\n</div>',$(".hard-refresh-page").click(function(){return document.location.reload(!0)}),console.info("Replaced #user-profile-image",c)}catch(a){b=a,console.warn("Couldn't replace old profile image - "+b.message),console.warn(b.stack)}return $(".uploaded-media").remove(),stopLoad(),toastStatusMessage("Successfully updated your profile image"),!1}).fail(function(a,b){return console.error("Error!",a,b),stopLoadError("There was a problem saving to the server."),$(".uploaded-media").remove(),!1}),!1)},window.imageHandler=imageHandler,getProfilePrivacy=function(){var a,b,c,d,e,f,g,h,i,j,k;for(f={},i=$(".privacy-group"),a=0,c=i.length;a<c;a++)for(e=i[a],h=$(e).attr("data-group"),k=$(e).find("paper-toggle-button"),b=0,d=k.length;b<d;b++)j=k[b],g=$(j).attr("data-scope"),null==f[h]&&(f[h]={}),f[h][g]=p$(j).checked;return f},conditionalLoadAccountSettingsOptions=function(){return!1},constructProfileJson=function(a,b){var c,d,e,f,g,h,i,j,k,l;for(null==a&&(a=!1),j=!1,k="object"==typeof window.publicProfile?window.publicProfile:{},e=$(".profile-data:not(.from-base-profile) .user-input"),d=0,g=e.length;d<g;d++)c=e[d],l=p$(c).value,f=$(c).attr("data-source"),f=f.replace("-","_"),f=function(){switch(f){case"institution":return"name";default:return f}}(),h=$(c).parents("[data-source]").attr("data-source"),"object"!=typeof k[h]&&(k[h]={}),k[h][f]=l;return k.profile=p$("#bio-profile .user-input").value,i=getProfilePrivacy(),k.privacy=i,validateAddress(k.institution,function(c){return k.place=c,j=a?post64(k):k,console.info("Sending back response",j),"function"==typeof b?b(j):console.warn("No callback function! Profile construction got",j),delete k.institution,window.publicProfile=k,!1}),j=a?post64(k):k,window.publicProfile=k,console.log("Non-validated response object:",j),j},formatSocial=function(){var a,b,c,d,e,f,g,h,i,j,k;for(e=!0,a=window.isViewingSelf?"paper-input":"paper-fab",k=$(".social "+a),c=0,f=k.length;c<f;c++){b=k[c];try{d=$(b).attr("icon"),h=d.split(":").pop(),g=$(b).attr("data-href")}catch(a){try{h=$(b).attr("data-source"),h=h.replace(/_/g,"-"),g=p$(b).value}catch(a){console.error("borkedy")}}switch(j=g,h){case"twitter":j=0===g.search("@")?"https://twitter.com/"+g.slice(1):g.match(/^https?:\/\/(www\.)?twitter.com\/\w+$/m)?g:g.match(/^\w+$/m)?"https://twitter.com/"+g:"";break;case"google-plus":j=0===g.search(/\+/)?"https://google.com/"+g:g.match(/^https?:\/\/((plus|www)\.)?google.com\/(\+\w+|\d+)$/m)?g:g.match(/^\w+$/m)?"https://google.com/+"+g:"";break;case"facebook":j=g.match(/^https?:\/\/((www)\.)?facebook.com\/\w+$/m)?g:g.match(/^\w+$/m)?"https://facebook.com/"+g:""}if(isNull(j)&&!isNull(g)){console.warn(h+" has a questionable link",g,j);try{i=h.replace(/-/g,"_"),p$("."+i+" paper-input").errorMessage="We couldn't understand this profile",p$("."+i+" paper-input").invalid=!0,e=!1}catch(a){}}$(b).unbind().attr("data-href",j)}return bindClicks("paper-fab"),e},validateAddress=function(a,b){var c,d,e,f,g;return a.country_code=a.country_code.toUpperCase(),e=isoCountries[a.country_code],null==e&&stopLoadError("Sorry, '"+a.country_code+"' is an invalid country code"),f=a,f.validated=!1,f.partially_validated=!1,d={country:null!=(g=a.country_code)?g:"US",postalCode:a.zip},c=a.street_number+" "+a.street,console.log("Attempting validation with",c,d),geo.geocode(c,d,function(d){var g,h,i,j,k;return console.log("Address validator got",d),f.validated=d.partial_match!==!0,f.partially_validated=d.partial_match===!0,f.parsed=d,f.state=null!=(h=d.google.administrative_area_level_1)?h:"",f.city=null!=(i=d.google.locality)?i:"",f.validated&&(f.street_number=null!=(j=d.google.street_number)?j:a.street_number,f.street=null!=(k=d.google.route)?k:a.street,null!=d.google.postal_code_suffix&&(f.zip+="-"+d.google.postal_code_suffix),c=f.street_number+" "+f.street),g=c+"<br/>\n"+f.city+", "+f.state+" "+f.zip+"<br/>\n"+e.name,f.human_html=g,console.info("New address object",f),"function"==typeof b?b(f):console.warn("No callback fucntion! Address validation got",f),!1}),!1},cleanupAddressDisplay=function(){var a,b,c,d;return null!=window.publicProfile?(a=window.publicProfile.place,null!=a.human_html?(c=encodeURIComponent(a.human_html.replace(/(<br\/>|\n|\\n)/g," ")),d='<div class="">\n  <paper-fab mini icon="maps:map" data-href="https://www.google.com/maps/search/'+c+'" class="click materialblue newwindow" data-newtab="true" data-toggle="tooltip" title="View in Google Maps">\n  </paper-fab>\n</div>',b='<label class="col-xs-4 capitalize">\n  Address\n</label>',$("address").html(a.human_html.replace(/\\n/g,"<br/> ")).addClass("col-xs-8 col-md-5 col-lg-4").before(b).after(d).parent().addClass("row clearfix")):console.warn("Human HTML not yet defined for this user")):console.warn("Public profile not set up"),!1},saveProfileChanges=function(){var a,b,c,d,e,f;for(startLoad(),c=!0,e=$("paper-input"),a=0,d=e.length;a<d;a++){b=e[a];try{f=p$(b).validate(),f===!1&&(c=!1)}catch(a){}}return(c=c&&formatSocial())?(constructProfileJson(!1,function(a){var b,c;return console.log("Going to save",a),c=jsonTo64(a),b="perform="+profileAction+"&data="+c,$("#save-profile").attr("disabled","disabled"),$.post(apiTarget,b,"json").done(function(a){var b,c,d;return console.log("Save got",a),a.status!==!0?($("#save-profile").removeAttr("disabled"),b=null!=(c=null!=(d=a.human_error)?d:a.error)?c:"Unknown error",stopLoadError("There was an error saving - "+b+". Please try again later."),!1):($("#save-profile").attr("disabled","disabled"),stopLoad(),!1)}).fail(function(a,b){return console.error("Error!",a,b),stopLoadError("There was a problem saving to the server."),!1})}),!1):(stopLoadError("Please check all required fields are completed"),!1)},setupUserChat=function(){var a;return $(".conversation-list li").click(function(){var a;return a=$(this).attr("data-uid"),foo(),!1}),$("#compose-message").keyup(function(b){var c;return c=b.keyCode?b.keyCode:b.which,13===c&&a(),!1}),$(".send-chat").click(function(){return a(),!1}),a=function(){return toastStatusMessage("Would send message"),!1},!1},forceUpdateMarked=function(){var a,b;return a=$("marked-element script").text(),b=a.replace(/\\n/g,"\n"),p$("marked-element").markdown=b},copyLink=function(a,b,c){var d,e,f,g,h;if(null==a&&(a=_adp.zcClient),null==c&&(c=!0),h=p$("#profile-link-field").value,g="Profile URL copied to clipboard",c)try{return e={dataType:"text/plain",data:h,"text/plain":h},d=new ClipboardEvent("copy",e),document.dispatchEvent(d),toastStatusMessage(g),!1}catch(a){f=a,console.error("Error creating copy: "+f.message),console.warn(f.stack)}return console.warn("Can't use HTML5"),null!=a?(a.setData(e),null!=b&&b.setData(e),a.on("aftercopy",function(a){return a.data["text/plain"]?toastStatusMessage(g):toastStatusMessage("Error copying to clipboard")}),a.on("error",function(a){if(console.error("Error copying to clipboard"),console.warn("Got",a),"flash-overdue"===a.name){if(_adp.resetClipboard===!0)return console.error("Resetting ZeroClipboard didn't work!"),!1;ZeroClipboard.on("ready",function(){return _adp.resetClipboard=!0,copyLink()}),_adp.zcClient=new ZeroClipboard($("#copy-profile-link").get(0))}if("flash-disabled"===a.name)return console.info("No flash on this system"),ZeroClipboard.destroy(),$("#copy-profile-link").tooltip("destroy"),toastStatusMessage("Clipboard copying isn't available on your system")})):console.error("Can't use HTML, and ZeroClipboard wasn't passed"),!1},searchProfiles=function(){var a,b,c,d;return d=$("#profile-search").val(),isNull(d)?($("#profile-result-container").empty(),!1):(c=p$("#search-filter").selectedItem,b=$(c).attr("data-cols"),console.info("Searching on "+d+" ... in "+b),a="action=search_users&q="+d+"&cols="+b,$.post(uri.urlString+"api.php",a,"json").done(function(a){var b,c,e,f,g,h,i,j,k;if(console.info(a),a.status!==!0)return console.error("Problem searching profiles!"),c='<div class="alert alert-warning">\n  <p>There was an error searching profiles.</p>\n</div>',$("#profile-result-container").html(c),!1;if(c="",k=[],h=Object.toArray(a.result),h.length>0)for(e=0,f=h.length;e<f;e++)g=h[e],k.push(g.name),b='<button class="btn btn-primary search-profile-link" data-href="'+uri.urlString+"profile.php?id="+g.uid+'" data-uid="'+g.uid+'">\n  '+g.full_name+" / "+g.handle+"\n</button>",c+="<li class='profile-search-result'>"+b+"</li>";else j=null!=(i=a.search)?i:d,c='<p><em>No results found for "<strong>'+j+'</strong>"';return $("#profile-result-container").html(c),bindClicks(".search-profile-link")}).fail(function(a,b){return console.error(a,b)}),!1)},verifyLoginCredentials=function(a,b){var c,d,e,f,g;return c={},c.domain="amphibiandisease",c.apiTarget="admin-api.php",c.adminPageUrl="https://"+c.domain+".org/admin-page.html",c.loginDir="admin/",c.loginApiTarget=c.loginDir+"async_login_handler.php",e=$.cookie(c.domain+"_auth"),g=$.cookie(c.domain+"_secret"),f=$.cookie(c.domain+"_link"),d="hash="+e+"&secret="+g+"&dblink="+f,$.post(c.loginApiTarget,d,"json").done(function(b){return b.status!==!0?window.isViewingSelf===!0?document.location.reload(!0):console.info("Bad credentials, but not self-viewing"):("undefined"!=typeof _adp&&null!==_adp||(window._adp={}),_adp.isUnrestricted=b.unrestricted,"function"==typeof a?a(b):void 0)}).fail(function(a,b){return console.error("There was a problem verifying your login state"),!1}),!1},cascadePrivacyToggledState=function(a,b){var c,d,e,f,g,h,i,j,k,l;null==b&&(b=!0);try{if(e=p$(a).checked,i=toInt($(a).attr("data-level")),c=$(a).parents(".privacy-group[data-group]"),l=$(c).find("[data-scope]"),e)for(d=0,g=l.length;d<g;d++)j=l[d],k=toInt($(j).attr("data-level")),k>i?(p$(j).checked=e,p$(j).disabled=!0):k<i&&b&&(p$(j).checked=!e,p$(j).disabled=!1);else if(b)for(f=0,h=l.length;f<h;f++)j=l[f],k=toInt($(j).attr("data-level")),k>i&&(p$(j).disabled=!1)}catch(a){console.error("An invalid element was passed cascading privacy toggles")}return!1},initialCascadeSetup=function(){var a,b,c,d,e,f,g,h,i;for(h=["collaborators","members","public"],b=0,d=h.length;b<d;b++)for(g=h[b],i=".privacy-toggle [data-scope='"+g+"']",f=$(i),c=0,e=f.length;c<e;c++)a=f[c],cascadePrivacyToggledState(a,!1);return!1},renderCaptchas=function(a){var b,c,d,e;return animateLoad(),c=uri.urlString+"api.php",d=null!=(e=window.profileUid)?e:uri.o.param("id"),b="action=is_human&recaptcha_response="+a+"&user="+d,$.post(c,b,"json").done(function(a){var b,c,d,e,f,g,h,i;for(console.info("Checked response"),console.log(a),i={email:a.response.username,phone:a.response.phone,department_phone:a.response.public_profile.place.department_phone},h=$(".g-recaptcha"),e=0,f=h.length;e<f;e++)c=h[e],$(c).removeClass("g-recaptcha"),g=$(c).attr("data-type"),b=i[g],d="email"!==g?'<p class="col-xs-8">\n  '+b+"\n</p>":'<p class="col-xs-5">\n  '+b+'\n</p>\n<paper-fab mini icon="communication:email" class="materialblue do-mailto col-xs-3" data-email="'+b+'"></paper-fab>',$(c).replaceWith(d);try{$(".do-mailto").unbind().click(function(){var a;return a=$(this).attr("data-email"),document.location.href="mailto:"+a,!1})}catch(a){}return stopLoad(),!1}).fail(function(a,b){return stopLoadError("Sorry, there was a problem getting the contact information"),!1}),!1},$(function(){var a,b;try{loadUserBadges()}catch(a){}try{conditionalLoadAccountSettingsOptions()}catch(a){}if($("#expose-uploader").click(function(){return $("#upload-container-section").removeAttr("hidden"),$(this).remove()}),$("#save-profile").click(function(){return saveProfileChanges(),!1}),$(".user-input").keyup(function(){return $("#save-profile").removeAttr("disabled"),!1}),$("paper-toggle-button").on("change",function(){return cascadePrivacyToggledState(this),$("#save-profile").removeAttr("disabled"),!1}),(a=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(!("undefined"!=typeof Polymer&&null!==Polymer&&null!=(l=Polymer.RenderStatus)?l._ready:void 0))return delay(500,function(){return a()}),!1;console.info("Setting up input values");try{formatSocial(),forceUpdateMarked()}catch(a){}try{initialCascadeSetup()}catch(a){}try{f=window.publicProfile.place.country_code,b=isoCountries[f].code}catch(a){}for(isNumber(b)||(b=1),m=$("gold-phone-input"),e=0,h=m.length;e<h;e++)c=m[e],p=$(c).parent().attr("data-value"),isNull(p)||(p$(c).value=toInt(p),p$(c).countryCode=b);for(n=$(".phone-number"),o=[],g=0,i=n.length;g<i;g++)j=n[g],k=$(j).text(),isNumber(k)?(p="+"+b+k,d='<a href="tel:'+p+'" class="phone-number-parsed">\n  <iron-icon icon="communication:phone" data-toggle="tooltip" title="Click to call"></iron-icon>\n  '+k+"\n</a>",o.push($(j).replaceWith(d))):o.push(void 0);return o})(),window.isViewingSelf!==!0)console.info("Foreign profile"),cleanupAddressDisplay();else{console.info("Doing self-profile checks"),setupUserChat(),verifyLoginCredentials();try{setupProfileImageUpload()}catch(a){}}return $("#profile-search").keyup(function(a){if(!isNull($(this).val()))return searchProfiles.debounce()}),b={swfPath:"bower_components/zeroclipboard/dist/ZeroClipboard.swf"},_adp.zcConfig=b,ZeroClipboard.config(b),_adp.zcClient=new ZeroClipboard($("#copy-profile-link").get(0)),$("#copy-profile-link").click(function(){return copyLink(_adp.zcClient)}),checkFileVersion(!1,"js/profile.js"),!1});
//# sourceMappingURL=profile.min.js.map