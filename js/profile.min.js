var apiTarget,cascadePrivacyToggledState,cleanupAddressDisplay,conditionalLoadAccountSettingsOptions,constructProfileJson,copyLink,createOverflowMenu,forceUpdateMarked,formatSocial,getProfilePrivacy,imageHandler,initialCascadeSetup,isoCountries,loadUserBadges,profileAction,renderCaptchas,saveProfileChanges,searchProfiles,setupProfileImageUpload,setupUserChat,validateAddress,verifyLoginCredentials;profileAction="update_profile",apiTarget=uri.urlString+"/admin-api.php",window._adp={};try{(createOverflowMenu=function(){return checkLoggedIn(function(e){var a,n;return n='<paper-menu-button id="header-overflow-menu" vertical-align="bottom" horizontal-offset="-15" horizontal-align="right" vertical-offset="30">\n  <paper-icon-button icon="icons:more-vert" class="dropdown-trigger"></paper-icon-button>\n  <paper-menu class="dropdown-content">\n    '+(a=e.status?'    <paper-item data-href="https://amphibiandisease.org/admin" class="click">\n  <iron-icon icon="icons:settings-applications"></iron-icon>\n  Account Settings\n</paper-item>\n<paper-item data-href="https://amphibiandisease.org/admin-login.php?q=logout" class="click">\n  <span class="glyphicon glyphicon-log-out"></span>\n  Log Out\n</paper-item>':"")+'\n    <paper-item data-href="'+uri.urlString+'dashboard.php" class="click">\n      <iron-icon icon="icons:donut-small"></iron-icon>\n      Data Dashboard\n    </paper-item>\n    <paper-item data-href="https://amphibian-disease-tracker.readthedocs.org" class="click">\n      <iron-icon icon="icons:chrome-reader-mode"></iron-icon>\n      Documentation\n    </paper-item>\n    <paper-item data-href="https://github.com/AmphibiaWeb/amphibian-disease-tracker" class="click">\n      <iron-icon icon="glyphicon-social:github"></iron-icon>\n      Github\n    </paper-item>\n    <paper-item data-href="https://amphibiandisease.org/about.php" class="click">\n      About / Legal\n    </paper-item>\n  </paper-menu>\n</paper-menu-button>',$("#header-overflow-menu").remove(),$("header#header-bar .logo-container + p").append(n),isNull(a)||$("header#header-bar paper-icon-button[icon='icons:settings-applications']").remove(),bindClicks()}),!1})()}catch(e){}isoCountries={ZW:{name:"Zimbabwe",code:"263"},ZM:{name:"Zambia",code:"260"},ZA:{name:"South Africa",code:"27"},YT:{name:"Mayotte",code:"262"},YE:{name:"Yemen",code:"967"},XK:{name:"Kosovo",code:"383"},WS:{name:"Samoa",code:"685"},WF:{name:"Wallis And Futuna",code:"681"},VU:{name:"Vanuatu",code:"678"},VN:{name:"Viet Nam",code:"84"},VI:{name:"Virgin Islands (US)",code:"1 340"},VG:{name:"Virgin Islands (British)",code:"1 284"},VE:{name:"Venezuela, Bolivarian Republic Of",code:"58"},VC:{name:"Saint Vincent And The Grenadines",code:"1 784"},VA:{name:"Vatican City State",code:"379"},UZ:{name:"Uzbekistan",code:"998"},UY:{name:"Uruguay",code:"598"},US:{name:"United States",code:"1"},UM:{name:"United States Minor Outlying Islands",code:"1"},UK:{name:"United Kingdom",code:""},UG:{name:"Uganda",code:"256"},UA:{name:"Ukraine",code:"380"},TZ:{name:"Tanzania, United Republic Of",code:"255"},TW:{name:"Taiwan",code:"886"},TV:{name:"Tuvalu",code:"688"},TT:{name:"Trinidad And Tobago",code:"1 868"},TR:{name:"Turkey",code:"90"},TO:{name:"Tonga",code:"676"},TN:{name:"Tunisia",code:"216"},TM:{name:"Turkmenistan",code:"993"},TL:{name:"Timor-Leste, Democratic Republic of",code:"670"},TK:{name:"Tokelau",code:"690"},TJ:{name:"Tajikistan",code:"992"},TH:{name:"Thailand",code:"66"},TG:{name:"Togo",code:"228"},TF:{name:"French Southern Territories",code:""},TD:{name:"Chad",code:"235"},TC:{name:"Turks And Caicos Islands",code:"1 649"},TA:{name:"Tristan de Cunha",code:"290"},SZ:{name:"Swaziland",code:"268"},SY:{name:"Syrian Arab Republic",code:"963"},SX:{name:"Sint Maarten",code:"1 721"},SV:{name:"El Salvador",code:"503"},SU:{name:"USSR",code:""},ST:{name:"Sï¿½o Tomï¿½ and Prï¿½ncipe",code:"239"},SS:{name:"South Sudan",code:"211"},SR:{name:"Suriname",code:"597"},SO:{name:"Somalia",code:"252"},SN:{name:"Senegal",code:"221"},SM:{name:"San Marino",code:"378"},SL:{name:"Sierra Leone",code:"232"},SK:{name:"Slovakia",code:"421"},SJ:{name:"Svalbard And Jan Mayen",code:"47"},SI:{name:"Slovenia",code:"386"},SH:{name:"Saint Helena, Ascension And Tristan Da Cunha",code:"290"},SG:{name:"Singapore",code:"65"},SE:{name:"Sweden",code:"46"},SD:{name:"Sudan",code:"249"},SC:{name:"Seychelles",code:"248"},SB:{name:"Solomon Islands",code:"677"},SA:{name:"Saudi Arabia",code:"966"},RW:{name:"Rwanda",code:"250"},RU:{name:"Russian Federation",code:"7"},RS:{name:"Serbia",code:"381"},RO:{name:"Romania",code:"40"},RE:{name:"Reunion",code:"262"},QA:{name:"Qatar",code:"974"},PY:{name:"Paraguay",code:"595"},PW:{name:"Palau",code:"680"},PT:{name:"Portugal",code:"351"},PS:{name:"Palestinian Territory, Occupied",code:"970"},PR:{name:"Puerto Rico",code:"1 787"},PN:{name:"Pitcairn",code:"872"},PM:{name:"Saint Pierre And Miquelon",code:"508"},PL:{name:"Poland",code:"48"},PK:{name:"Pakistan",code:"92"},PH:{name:"Philippines",code:"63"},PG:{name:"Papua New Guinea",code:"675"},PF:{name:"French Polynesia",code:"689"},PE:{name:"Peru",code:"51"},PA:{name:"Panama",code:"507"},OM:{name:"Oman",code:"968"},NZ:{name:"New Zealand",code:"64"},NU:{name:"Niue",code:"683"},NR:{name:"Nauru",code:"674"},NP:{name:"Nepal",code:"977"},NO:{name:"Norway",code:"47"},NL:{name:"Netherlands",code:"31"},NI:{name:"Nicaragua",code:"505"},NG:{name:"Nigeria",code:"234"},NF:{name:"Norfolk Island",code:"672"},NE:{name:"Niger",code:"227"},NC:{name:"New Caledonia",code:"687"},NA:{name:"Namibia",code:"264"},MZ:{name:"Mozambique",code:"258"},MY:{name:"Malaysia",code:"60"},MX:{name:"Mexico",code:"52"},MW:{name:"Malawi",code:"265"},MV:{name:"Maldives",code:"960"},MU:{name:"Mauritius",code:"230"},MT:{name:"Malta",code:"356"},MS:{name:"Montserrat",code:"1 664"},MR:{name:"Mauritania",code:"222"},MQ:{name:"Martinique",code:"596"},MP:{name:"Northern Mariana Islands",code:"1 670"},MO:{name:"Macao",code:"853"},MN:{name:"Mongolia",code:"976"},MM:{name:"Myanmar",code:"95"},ML:{name:"Mali",code:"223"},MK:{name:"Macedonia, The Former Yugoslav Republic Of",code:"389"},MH:{name:"Marshall Islands",code:"692"},MG:{name:"Madagascar",code:"261"},MF:{name:"Saint Martin",code:"590"},ME:{name:"Montenegro",code:"382"},MD:{name:"Moldova",code:"373"},MC:{name:"Monaco",code:"377"},MA:{name:"Morocco",code:"212"},LY:{name:"Libya",code:"218"},LV:{name:"Latvia",code:"371"},LU:{name:"Luxembourg",code:"352"},LT:{name:"Lithuania",code:"370"},LS:{name:"Lesotho",code:"266"},LR:{name:"Liberia",code:"231"},LK:{name:"Sri Lanka",code:"94"},LI:{name:"Liechtenstein",code:"423"},LC:{name:"Saint Lucia",code:"1 758"},LB:{name:"Lebanon",code:"961"},LA:{name:"Lao People's Democratic Republic",code:"856"},KZ:{name:"Kazakhstan",code:"7"},KY:{name:"Cayman Islands",code:"1 345"},KW:{name:"Kuwait",code:"965"},KR:{name:"Korea, Republic Of",code:"82"},KP:{name:"Korea, Democratic People's Republic Of",code:"850"},KN:{name:"Saint Kitts And Nevis",code:"1 869"},KM:{name:"Comoros",code:"269"},KI:{name:"Kiribati",code:"686"},KH:{name:"Cambodia",code:"855"},KG:{name:"Kyrgyzstan",code:"996"},KE:{name:"Kenya",code:"254"},JP:{name:"Japan",code:"81"},JO:{name:"Jordan",code:"962"},JM:{name:"Jamaica",code:"1 876"},JE:{name:"Jersey",code:"44"},IT:{name:"Italy",code:"39"},IS:{name:"Iceland",code:"354"},IR:{name:"Iran, Islamic Republic Of",code:"98"},IQ:{name:"Iraq",code:"964"},IO:{name:"British Indian Ocean Territory",code:"246"},IN:{name:"India",code:"91"},IM:{name:"Isle Of Man",code:"44"},IL:{name:"Israel",code:"972"},IE:{name:"Ireland",code:"353"},ID:{name:"Indonesia",code:"62"},IC:{name:"Canary Islands",code:""},HU:{name:"Hungary",code:"36"},HT:{name:"Haiti",code:"509"},HR:{name:"Croatia",code:"385"},HN:{name:"Honduras",code:"504"},HM:{name:"Heard Island And McDonald Islands",code:""},HK:{name:"Hong Kong",code:"852"},GY:{name:"Guyana",code:"592"},GW:{name:"Guinea-bissau",code:"245"},GU:{name:"Guam",code:"1 671"},GT:{name:"Guatemala",code:"502"},GS:{name:"South Georgia And The South Sandwich Islands",code:""},GR:{name:"Greece",code:"30"},GQ:{name:"Equatorial Guinea",code:"240"},GP:{name:"Guadeloupe",code:"590"},GN:{name:"Guinea",code:"224"},GM:{name:"Gambia",code:"220"},GL:{name:"Greenland",code:"299"},GI:{name:"Gibraltar",code:"350"},GH:{name:"Ghana",code:"233"},GG:{name:"Guernsey",code:"44"},GF:{name:"French Guiana",code:"594"},GE:{name:"Georgia",code:"995"},GD:{name:"Grenada",code:"473"},GB:{name:"United Kingdom",code:"44"},GA:{name:"Gabon",code:"241"},FX:{name:"France, Metropolitan",code:"241"},FR:{name:"France",code:"33"},FO:{name:"Faroe Islands",code:"298"},FM:{name:"Micronesia, Federated States Of",code:"691"},FK:{name:"Falkland Islands",code:"500"},FJ:{name:"Fiji",code:"679"},FI:{name:"Finland",code:"358"},EU:{name:"European Union",code:"388"},ET:{name:"Ethiopia",code:"251"},ES:{name:"Spain",code:"34"},ER:{name:"Eritrea",code:"291"},EH:{name:"Western Sahara",code:"212"},EG:{name:"Egypt",code:"20"},EE:{name:"Estonia",code:"372"},EC:{name:"Ecuador",code:"593"},EA:{name:"Ceuta, Mulilla",code:""},DZ:{name:"Algeria",code:"213"},DO:{name:"Dominican Republic",code:"1 809"},DM:{name:"Dominica",code:"1 767"},DK:{name:"Denmark",code:"45"},DJ:{name:"Djibouti",code:"253"},DG:{name:"Diego Garcia",code:""},DE:{name:"Germany",code:"49"},CZ:{name:"Czech Republic",code:"420"},CY:{name:"Cyprus",code:"357"},CX:{name:"Christmas Island",code:"61"},CW:{name:"Curacao",code:"599"},CV:{name:"Cabo Verde",code:"238"},CU:{name:"Cuba",code:"53"},CR:{name:"Costa Rica",code:"506"},CP:{name:"Clipperton Island",code:""},CO:{name:"Colombia",code:"57"},CN:{name:"China",code:"86"},CM:{name:"Cameroon",code:"237"},CL:{name:"Chile",code:"56"},CK:{name:"Cook Islands",code:"682"},CI:{name:"Cote d'Ivoire",code:"225"},CH:{name:"Switzerland",code:"41"},CG:{name:"Republic Of Congo",code:"242"},CF:{name:"Central African Republic",code:"236"},CD:{name:"Democratic Republic Of Congo",code:"243"},CC:{name:"Cocos (Keeling) Islands",code:"61"},CA:{name:"Canada",code:"1"},BZ:{name:"Belize",code:"501"},BY:{name:"Belarus",code:"375"},BW:{name:"Botswana",code:"267"},BV:{name:"Bouvet Island",code:""},BT:{name:"Bhutan",code:"975"},BS:{name:"Bahamas",code:"1 242"},BR:{name:"Brazil",code:"55"},BQ:{name:"Bonaire, Saint Eustatius And Saba",code:"599"},BO:{name:"Bolivia, Plurinational State Of",code:"591"},BN:{name:"Brunei Darussalam",code:"673"},BM:{name:"Bermuda",code:"1 441"},BL:{name:"Saint Barthï¿½lemy",code:"590"},BJ:{name:"Benin",code:"229"},BI:{name:"Burundi",code:"257"},BH:{name:"Bahrain",code:"973"},BG:{name:"Bulgaria",code:"359"},BF:{name:"Burkina Faso",code:"226"},BE:{name:"Belgium",code:"32"},BD:{name:"Bangladesh",code:"880"},BB:{name:"Barbados",code:"1 246"},BA:{name:"Bosnia & Herzegovina",code:"387"},AZ:{name:"Azerbaijan",code:"994"},AX:{name:"ï¿½land Islands",code:"358"},AW:{name:"Aruba",code:"297"},AU:{name:"Australia",code:"61"},AT:{name:"Austria",code:"43"},AS:{name:"American Samoa",code:"1 684"},AR:{name:"Argentina",code:"54"},AQ:{name:"Antarctica",code:"672"},AO:{name:"Angola",code:"244"},AM:{name:"Armenia",code:"374"},AL:{name:"Albania",code:"355"},AI:{name:"Anguilla",code:"1 264"},AG:{name:"Antigua And Barbuda",code:"1 268"},AF:{name:"Afghanistan",code:"93"},AE:{name:"United Arab Emirates",code:"971"},AD:{name:"Andorra",code:"376"},AC:{name:"Ascension Island",code:"247"}},loadUserBadges=function(){return!1},setupProfileImageUpload=function(e,a,n){var o,r,i;return null==e&&(e="profile-image-uploader"),null==a&&(a=""),i="#"+e,$.cookie(adminParams.domain+"_link"),window.profileUid,_adp.projectIdentifierString,$(i).exists()||(console.info("Creating uploader to append"),o='<form id="'+e+'-form" class="'+a+' clearfix">\n  <p class="visible-xs-block">Tap the button to upload a file</p>\n  <fieldset class="hidden-xs">\n    <legend class="sr-only">Profile Image</legend>\n    <div id="'+e+'" class="media-uploader outline media-upload-target">\n    </div>\n  </fieldset>\n</form>',r="main #upload-container-section",$(r).append(o),isNull(a)||$(r).addClass("row"),console.info("Appended upload form",$(r).exists()),$(i).submit(function(e){return e.preventDefault(),e.stopPropagation(),!1})),verifyLoginCredentials(function(){var e;return null==window.dropperParams&&(window.dropperParams={}),window.dropperParams.dropTargetSelector=i,window.dropperParams.uploadPath="../../users/profiles/",window.dropperParams.uploadText="Drop your image here to set a new profile picture",e=!0===window.dropperParams.hasInitialized,loadJS("helpers/js-dragdrop/client-upload.min.js",function(){if(window.dropperParams.mimeTypes="image/*",console.info("Loaded drag drop helper"),e){console.info("Reinitialized dropper");try{window.dropperParams.initialize()}catch(e){console.warn("Couldn't reinitialize dropper!")}}if(window.dropperParams.postUploadHandler=function(e,a){var n,o,r,i,t,c,d,l,s;if(window.dropperParams.dropzone.removeAllFiles(),"object"!=typeof a)return console.error("Dropzone returned an error - "+a),toastStatusMessage("There was a problem with the server handling your image. Please try again."),!1;if(!0!==a.status)return null==a.human_error&&(a.human_error="There was a problem uploading your image."),toastStatusMessage(""+a.human_error),console.error("Error uploading!",a),!1;try{switch(console.info("Server returned the following result:",a),console.info("The script returned the following file information:",e),d=window.dropperParams.uploadPath,r=a.full_path.split("/").pop(),s=a.wrote_thumb,c=a.mime_provided.split("/")[0],t=a.mime_provided.split("/")[1],i=e.size<5242880||"image"!==c?""+d+a.wrote_file:""+d+s,l=function(){switch(c){case"image":return'<div class="uploaded-media center-block" data-system-file="'+r+'" data-link-path="'+i+'">\n  <img src="'+i+'" alt=\'Uploaded Image\' class="img-circle thumb-img img-responsive"/>\n    <p class="text-muted">\n      '+e.name+" -> "+r+'\n      (<a href="'+i+'" class="newwindow" download="'+e.name+'">\n        Original Image\n      </a>)\n    </p>\n</div>';case"audio":return'<div class="uploaded-media center-block" data-system-file="'+r+'">\n  <audio src="'+i+'" controls preload="auto">\n    <span class="glyphicon glyphicon-music"></span>\n    <p>\n      Your browser doesn\'t support the HTML5 <code>audio</code> element.\n      Please download the file below.\n    </p>\n  </audio>\n  <p class="text-muted">\n    '+e.name+" -> "+r+'\n    (<a href="'+i+'" class="newwindow" download="'+e.name+'">\n      Original Media\n    </a>)\n  </p>\n</div>';case"video":return'<div class="uploaded-media center-block" data-system-file="'+r+'">\n  <video src="'+i+'" controls preload="auto">\n    <img src="'+d+s+'" alt="Video Thumbnail" class="img-responsive" />\n    <p>\n      Your browser doesn\'t support the HTML5 <code>video</code> element.\n      Please download the file below.\n    </p>\n  </video>\n  <p class="text-muted">\n    '+e.name+" -> "+r+'\n    (<a href="'+i+'" class="newwindow" download="'+e.name+'">\n      Original Media\n    </a>)\n  </p>\n</div>';default:return'<div class="uploaded-media center-block" data-system-file="'+r+'" data-link-path="'+i+'">\n  <span class="glyphicon glyphicon-file"></span>\n  <p class="text-muted">'+e.name+" -> "+r+"</p>\n</div>"}}(),$(window.dropperParams.dropTargetSelector).before(l),$("#validator-progress-container").remove(),i.slice(0),o=i.slice(0).split(".").pop(),c){case"application":switch(console.info("Checking "+t+" in application"),t){case"vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"vnd.ms-excel":return excelHandler(i);case"vnd.ms-office":switch(o){case"xls":return excelHandler(i);default:return stopLoadError("Sorry, we didn't understand the upload type."),!1}break;case"zip":case"x-zip-compressed":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type||"xlsx"===o?excelHandler(i):zipHandler(i);case"x-7z-compressed":return _7zHandler(i)}break;case"text":return csvHandler(i);case"image":return imageHandler(i,a)}}catch(e){return console.error("There was a post-processing error: "+(n=e).message),console.warn(n.stack),toastStatusMessage("Your file uploaded successfully, but there was a problem in the post-processing.")}},"function"==typeof n)return n()}),!1}),!1},imageHandler=function(e,a){var n,o,r;return null==a&&(a=null),startLoad(),r=e.replace(/^(\.\.\/)*([\w\/]+\.(jpg|jpeg|png|bmp|gif|webp|pnga))$/gim,"$2"),isNull(r)?(console.error("Invalid path '"+e+"' parsed to invalid canonical path",r),stopLoadError("Processing error. Please try again.")):(console.log("Going to save",o={profile_image_path:r}),n="perform=write_profile_image&data="+jsonTo64(o),$.post(apiTarget,n,"json").done(function(e){var a,n,o,r,i,t,c;if(console.log("Save got",e),!0!==e.status)return r=null!=(i=null!=(t=e.human_error)?t:e.error)?i:"Unknown error",stopLoadError("There was an error saving your profile image - "+r+". Please try again later."),!1;try{o=e.image_uri,c="?v="+Date.now(),n='<img class="profile-image img-responsive"\n  id="user-profile-image"\n  src="'+e.tiny_image_uri+c+'"\n  srcset="'+o+c+" 10x, "+e.small_image_uri+c+" 4x, "+e.tiny_image_uri+c+' 1x" alt="Profile image" />',$("#user-profile-image").replaceWith(n),'<div class="alert alert-info col-xs-12">\n  <a href="#" class="alert-link hard-refresh-page">Click here to refresh</a> and see your new profile image. Be sure to save any changes first.\n</div>',$(".hard-refresh-page").click(function(){return document.location.reload(!0)}),console.info("Replaced #user-profile-image",'<div class="alert alert-info col-xs-12">\n  <a href="#" class="alert-link hard-refresh-page">Click here to refresh</a> and see your new profile image. Be sure to save any changes first.\n</div>')}catch(e){console.warn("Couldn't replace old profile image - "+(a=e).message),console.warn(a.stack)}return $(".uploaded-media").remove(),stopLoad(),toastStatusMessage("Successfully updated your profile image"),!1}).fail(function(e,a){return console.error("Error!",e,a),stopLoadError("There was a problem saving to the server."),$(".uploaded-media").remove(),!1})),!1},window.imageHandler=imageHandler,getProfilePrivacy=function(){var e,a,n,o,r,i,t,c,d,l,s;for(i={},e=0,n=(d=$(".privacy-group")).length;e<n;e++)for(r=d[e],c=$(r).attr("data-group"),a=0,o=(s=$(r).find("paper-toggle-button")).length;a<o;a++)l=s[a],t=$(l).attr("data-scope"),null==i[c]&&(i[c]={}),i[c][t]=p$(l).checked;return i},conditionalLoadAccountSettingsOptions=function(){return!1},constructProfileJson=function(a,n){var e,o,r,i,t,c,d,l,s,p;for(null==a&&(a=!1),l=!1,s="object"==typeof window.publicProfile?window.publicProfile:{},o=0,t=(r=$(".profile-data:not(.from-base-profile) .user-input")).length;o<t;o++)e=r[o],p=p$(e).value,i=(i=$(e).attr("data-source")).replace("-","_"),i=function(){switch(i){case"institution":return"name";default:return i}}(),c=$(e).parents("[data-source]").attr("data-source"),"object"!=typeof s[c]&&(s[c]={}),s[c][i]=p;return s.profile=p$("#bio-profile .user-input").value,d=getProfilePrivacy(),s.privacy=d,validateAddress(s.institution,function(e){return s.place=e,l=a?post64(s):s,console.info("Sending back response",l),"function"==typeof n?n(l):console.warn("No callback function! Profile construction got",l),delete s.institution,window.publicProfile=s,!1}),l=a?post64(s):s,window.publicProfile=s,console.log("Non-validated response object:",l),l},formatSocial=function(){var e,a,n,o,r,i,t,c,d,l;for(o=!0,e=window.isViewingSelf?"paper-input":"paper-fab",n=0,r=(l=$(".social "+e)).length;n<r;n++){a=l[n];try{t=$(a).attr("icon").split(":").pop(),i=$(a).attr("data-href")}catch(e){try{t=(t=$(a).attr("data-source")).replace(/_/g,"-"),i=p$(a).value}catch(e){console.error("borkedy")}}switch(d=i,t){case"twitter":d=0===i.search("@")?"https://twitter.com/"+i.slice(1):i.match(/^https?:\/\/(www\.)?twitter.com\/\w+$/m)?i:i.match(/^\w+$/m)?"https://twitter.com/"+i:"";break;case"google-plus":d=0===i.search(/\+/)?"https://google.com/"+i:i.match(/^https?:\/\/((plus|www)\.)?google.com\/(\+\w+|\d+)$/m)?i:i.match(/^\w+$/m)?"https://google.com/+"+i:"";break;case"facebook":d=i.match(/^https?:\/\/((www)\.)?facebook.com\/\w+$/m)?i:i.match(/^\w+$/m)?"https://facebook.com/"+i:""}if(isNull(d)&&!isNull(i)){console.warn(t+" has a questionable link",i,d);try{c=t.replace(/-/g,"_"),p$("."+c+" paper-input").errorMessage="We couldn't understand this profile",o=!(p$("."+c+" paper-input").invalid=!0)}catch(e){}}$(a).unbind().attr("data-href",d)}return bindClicks("paper-fab"),o},validateAddress=function(t,c){var d,e,l,s,a;return t.country_code=t.country_code.toUpperCase(),null==(l=isoCountries[t.country_code])&&stopLoadError("Sorry, '"+t.country_code+"' is an invalid country code"),(s=t).validated=!1,s.partially_validated=!1,e={country:null!=(a=t.country_code)?a:"US",postalCode:t.zip},d=t.street_number+" "+t.street,console.log("Attempting validation with",d,e),geo.geocode(d,e,function(e){var a,n,o,r,i;return console.log("Address validator got",e),s.validated=!0!==e.partial_match,s.partially_validated=!0===e.partial_match,s.parsed=e,s.state=null!=(n=e.google.administrative_area_level_1)?n:"",s.city=null!=(o=e.google.locality)?o:"",s.validated&&(s.street_number=null!=(r=e.google.street_number)?r:t.street_number,s.street=null!=(i=e.google.route)?i:t.street,null!=e.google.postal_code_suffix&&(s.zip+="-"+e.google.postal_code_suffix),d=s.street_number+" "+s.street),a=d+"<br/>\n"+s.city+", "+s.state+" "+s.zip+"<br/>\n"+l.name,s.human_html=a,console.info("New address object",s),"function"==typeof c?c(s):console.warn("No callback fucntion! Address validation got",s),!1}),!1},cleanupAddressDisplay=function(){var e,a;return null!=window.publicProfile?null!=(e=window.publicProfile.place).human_html?(a='<div class="">\n  <paper-fab mini icon="maps:map" data-href="https://www.google.com/maps/search/'+encodeURIComponent(e.human_html.replace(/(<br\/>|\n|\\n)/g," "))+'" class="click materialblue newwindow" data-newtab="true" data-toggle="tooltip" title="View in Google Maps">\n  </paper-fab>\n</div>','<label class="col-xs-4 capitalize">\n  Address\n</label>',$("address").html(e.human_html.replace(/\\n/g,"<br/> ")).addClass("col-xs-8 col-md-5 col-lg-4").before('<label class="col-xs-4 capitalize">\n  Address\n</label>').after(a).parent().addClass("row clearfix")):console.warn("Human HTML not yet defined for this user"):console.warn("Public profile not set up"),!1},saveProfileChanges=function(){var e,a,n,o,r;for(startLoad(),n=!0,e=0,o=(r=$("paper-input")).length;e<o;e++){a=r[e];try{!1===p$(a).validate()&&(n=!1)}catch(e){}}return(n=n&&formatSocial())?constructProfileJson(!1,function(e){var a,n;return console.log("Going to save",e),n=jsonTo64(e),a="perform="+profileAction+"&data="+n,$("#save-profile").attr("disabled","disabled"),$.post(apiTarget,a,"json").done(function(e){var a,n,o;return console.log("Save got",e),!0!==e.status?($("#save-profile").removeAttr("disabled"),a=null!=(n=null!=(o=e.human_error)?o:e.error)?n:"Unknown error",stopLoadError("There was an error saving - "+a+". Please try again later.")):($("#save-profile").attr("disabled","disabled"),stopLoad()),!1}).fail(function(e,a){return console.error("Error!",e,a),stopLoadError("There was a problem saving to the server."),!1})}):stopLoadError("Please check all required fields are completed"),!1},setupUserChat=function(){var a;return $(".conversation-list li").click(function(){return $(this).attr("data-uid"),foo(),!1}),$("#compose-message").keyup(function(e){return 13===(e.keyCode?e.keyCode:e.which)&&a(),!1}),$(".send-chat").click(function(){return a(),!1}),!(a=function(){return toastStatusMessage("Would send message"),!1})},forceUpdateMarked=function(){var e;return e=$("marked-element script").text().replace(/\\n/g,"\n"),p$("marked-element").markdown=e},copyLink=function(e,a,n){var o,r,i,t,c;if(null==e&&(e=_adp.zcClient),null==n&&(n=!0),c=p$("#profile-link-field").value,t="Profile URL copied to clipboard",n)try{return r={dataType:"text/plain",data:c,"text/plain":c},o=new ClipboardEvent("copy",r),document.dispatchEvent(o),toastStatusMessage(t),!1}catch(e){console.error("Error creating copy: "+(i=e).message),console.warn(i.stack)}return console.warn("Can't use HTML5"),null!=e?(e.setData(r),null!=a&&a.setData(r),e.on("aftercopy",function(e){return e.data["text/plain"]?toastStatusMessage(t):toastStatusMessage("Error copying to clipboard")}),e.on("error",function(e){if(console.error("Error copying to clipboard"),console.warn("Got",e),"flash-overdue"===e.name){if(!0===_adp.resetClipboard)return console.error("Resetting ZeroClipboard didn't work!"),!1;ZeroClipboard.on("ready",function(){return _adp.resetClipboard=!0,copyLink()}),_adp.zcClient=new ZeroClipboard($("#copy-profile-link").get(0))}if("flash-disabled"===e.name)return console.info("No flash on this system"),ZeroClipboard.destroy(),$("#copy-profile-link").tooltip("destroy"),toastStatusMessage("Clipboard copying isn't available on your system")})):console.error("Can't use HTML, and ZeroClipboard wasn't passed"),!1},searchProfiles=function(){var e,a,n,d;return d=$("#profile-search").val(),isNull(d)?$("#profile-result-container").empty():(n=p$("#search-filter").selectedItem,a=$(n).attr("data-cols"),console.info("Searching on "+d+" ... in "+a),e="action=search_users&q="+d+"&cols="+a,$.post(uri.urlString+"api.php",e,"json").done(function(e){var a,n,o,r,i,t,c;if(console.info(e),!0!==e.status)return console.error("Problem searching profiles!"),a='<div class="alert alert-warning">\n  <p>There was an error searching profiles.</p>\n</div>',$("#profile-result-container").html(a),!1;if(a="",c=[],0<(i=Object.toArray(e.result)).length)for(n=0,o=i.length;n<o;n++)r=i[n],c.push(r.name),a+="<li class='profile-search-result'>"+('<button class="btn btn-primary search-profile-link" data-href="'+uri.urlString+"profile.php?id="+r.uid+'" data-uid="'+r.uid+'">\n  '+r.full_name+" / "+r.handle+"\n</button>")+"</li>";else a='<p><em>No results found for "<strong>'+(null!=(t=e.search)?t:d)+'</strong>"';return $("#profile-result-container").html(a),bindClicks(".search-profile-link")}).fail(function(e,a){return console.error(e,a)})),!1},verifyLoginCredentials=function(a,e){var n,o;return(n={}).domain="amphibiandisease",n.apiTarget="admin-api.php",n.adminPageUrl="https://"+n.domain+".org/admin-page.html",n.loginDir="admin/",n.loginApiTarget=n.loginDir+"async_login_handler.php",o="hash="+$.cookie(n.domain+"_auth")+"&secret="+$.cookie(n.domain+"_secret")+"&dblink="+$.cookie(n.domain+"_link"),$.post(n.loginApiTarget,o,"json").done(function(e){return!0!==e.status?!0===window.isViewingSelf?document.location.reload(!0):console.info("Bad credentials, but not self-viewing"):("undefined"!=typeof _adp&&null!==_adp||(window._adp={}),_adp.isUnrestricted=e.unrestricted,"function"==typeof a?a(e):void 0)}).fail(function(e,a){return console.error("There was a problem verifying your login state"),!1}),!1},cascadePrivacyToggledState=function(e,a){var n,o,r,i,t,c,d,l,s,p;null==a&&(a=!0);try{if(r=p$(e).checked,d=toInt($(e).attr("data-level")),n=$(e).parents(".privacy-group[data-group]"),p=$(n).find("[data-scope]"),r)for(o=0,t=p.length;o<t;o++)l=p[o],d<(s=toInt($(l).attr("data-level")))?(p$(l).checked=r,p$(l).disabled=!0):s<d&&a&&(p$(l).checked=!r,p$(l).disabled=!1);else if(a)for(i=0,c=p.length;i<c;i++)l=p[i],d<(s=toInt($(l).attr("data-level")))&&(p$(l).disabled=!1)}catch(e){console.error("An invalid element was passed cascading privacy toggles")}return!1},initialCascadeSetup=function(){var e,a,n,o,r,i,t;for(a=0,o=(t=["collaborators","members","public"]).length;a<o;a++)for(n=0,r=(i=$(".privacy-toggle [data-scope='"+t[a]+"']")).length;n<r;n++)e=i[n],cascadePrivacyToggledState(e,!1);return!1},renderCaptchas=function(e){var a,n,o;return animateLoad(),n=uri.urlString+"api.php",a="action=is_human&recaptcha_response="+e+"&user="+(null!=(o=window.profileUid)?o:uri.o.param("id")),$.post(n,a,"json").done(function(e){var a,n,o,r,i,t,c,d;for(console.info("Checked response"),console.log(e),d={email:e.response.username,phone:e.response.phone,department_phone:e.response.public_profile.place.department_phone},r=0,i=(c=$(".g-recaptcha")).length;r<i;r++)n=c[r],$(n).removeClass("g-recaptcha"),a=d[t=$(n).attr("data-type")],o="email"!==t?'<p class="col-xs-8">\n  '+a+"\n</p>":'<p class="col-xs-5">\n  '+a+'\n</p>\n<paper-fab mini icon="communication:email" class="materialblue do-mailto col-xs-3" data-email="'+a+'"></paper-fab>',$(n).replaceWith(o);try{$(".do-mailto").unbind().click(function(){var e;return e=$(this).attr("data-email"),document.location.href="mailto:"+e,!1})}catch(e){}return stopLoad(),!1}).fail(function(e,a){return stopLoadError("Sorry, there was a problem getting the contact information"),!1}),!1},$(function(){var g,e;try{loadUserBadges()}catch(e){}try{conditionalLoadAccountSettingsOptions()}catch(e){}if($("#expose-uploader").click(function(){return $("#upload-container-section").removeAttr("hidden"),$(this).remove()}),$("#save-profile").click(function(){return saveProfileChanges(),!1}),$(".user-input").keyup(function(){return $("#save-profile").removeAttr("disabled"),!1}),$("paper-toggle-button").on("change",function(){return cascadePrivacyToggledState(this),$("#save-profile").removeAttr("disabled"),!1}),(g=function(){var e,a,n,o,r,i,t,c,d,l,s,p,m,u,f;if(!("undefined"!=typeof Polymer&&null!==Polymer&&null!=(s=Polymer.RenderStatus)?s._ready:void 0))return delay(500,function(){return g()}),!1;console.info("Setting up input values");try{formatSocial(),forceUpdateMarked()}catch(e){}try{initialCascadeSetup()}catch(e){}try{r=window.publicProfile.place.country_code,e=isoCountries[r].code}catch(e){}for(isNumber(e)||(e=1),o=0,t=(p=$("gold-phone-input")).length;o<t;o++)a=p[o],f=$(a).parent().attr("data-value"),isNull(f)||(p$(a).value=toInt(f),p$(a).countryCode=e);for(u=[],i=0,c=(m=$(".phone-number")).length;i<c;i++)d=m[i],l=$(d).text(),isNumber(l)?(n='<a href="tel:'+(f="+"+e+l)+'" class="phone-number-parsed">\n  <iron-icon icon="communication:phone" data-toggle="tooltip" title="Click to call"></iron-icon>\n  '+l+"\n</a>",u.push($(d).replaceWith(n))):u.push(void 0);return u})(),!0!==window.isViewingSelf)console.info("Foreign profile"),cleanupAddressDisplay();else{console.info("Doing self-profile checks"),setupUserChat(),verifyLoginCredentials();try{setupProfileImageUpload()}catch(e){}}return $("#profile-search").keyup(function(e){if(!isNull($(this).val()))return searchProfiles.debounce()}),e={swfPath:"bower_components/zeroclipboard/dist/ZeroClipboard.swf"},_adp.zcConfig=e,ZeroClipboard.config(e),_adp.zcClient=new ZeroClipboard($("#copy-profile-link").get(0)),$("#copy-profile-link").click(function(){return copyLink(_adp.zcClient)}),checkFileVersion(!1,"js/profile.js"),!1});
//# sourceMappingURL=profile.min.js.map