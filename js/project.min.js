var checkProjectAuthorization,postAuthorizeRender,renderEmail,showEmailField,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};checkProjectAuthorization=function(a,b){return null==a&&(a=_adp.projectId),null==b&&(b=postAuthorizeRender),startLoad(),console.info("Checking authorization for "+a),checkLoggedIn(function(c){var d,e;return c.status?(e=uri.urlString+"/admin-api.php",d="perform=check_access&project="+a,$.post(e,d,"json").done(function(a){var c;return a.status?(console.info("User is authorized"),c=a.detail.project,"function"==typeof b?b(c):(console.warn("No callback specified!"),console.info("Got project data",c))):console.info("User is unauthorized")}).error(function(a,b){return console.log("Error checking server",a,b)}).always(function(){return stopLoad()})):(console.info("Non logged-in user"),!1)}),!1},renderEmail=function(a){var b,c;return stopLoad(),c=uri.urlString+"/api.php",b="action=is_human&recaptcha_response="+a+"&project="+_adp.projectId,$.post(c,b,"json").done(function(a){var b;return console.info("Checked response"),console.log(a),b=a.author_data,showEmailField(b.contact_email),stopLoad()}).error(function(a,b){return stopLoadError("Sorry, there was a problem getting the contact email"),!1}),!1},showEmailField=function(a){var b;return b='<div class="row">\n  <paper-input readonly class="col-xs-8 col-md-11" label="Contact Email" value="'+a+'"></paper-input>\n  <div class="col-xs-4 col-md-1">\n    <paper-fab icon="communication:email" class="click materialblue" id="contact-email-send" data-href="mailto:'+a+'"></paper-fab>\n  </div>\n</div>',$("#email-fill").replaceWith(b),bindClicks("#contact-email-send"),!1},postAuthorizeRender=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(a["public"]&&console.info("Project is already public, not rerendering"),startLoad(),console.info("Should render stuff",a),h='<paper-icon-button icon="icons:create" class="authorized-action" data-href="admin-page.html?id='+a.project_id+'"></paper-icon-button>',$("#title").append(h),d=JSON.parse(a.author_data),showEmailField(d.contact_email),$(".needs-auth").html("<p>User is authorized, should repopulate</p>"),bindClicks(".authorized-action"),e=JSON.parse(deEscape(a.carto_id)),g=e.table,m=e.bounding_polygon,k='<google-map-poly closed fill-color="'+m.fillColor+'" fill-opacity="'+m.fillOpacity+'" stroke-weight="1">',o=[],n=m.paths,i=0,j=n.length;j>i;i++)l=n[i],indexOf.call(o,l)<0&&(o.push(l),k+='<google-map-point latitude="'+l.lat+'" longitude="'+l.lng+'"> </google-map-point>');return k+="    </google-map-poly>",f="SELECT genus, specificEpithet, diseaseTested, diseaseDetected, originalTaxa, ST_asGeoJSON(the_geom) FROM "+g+";",console.info("Would ping cartodb with",f),b=encodeURIComponent(encode64(f)),c="action=fetch&sql_query="+b,$.post("api.php",c,"json").done(function(a){var b,c,d,e,f,g,h,i,j,l,m,n;if(console.info("Carto query got result:",a),!a.status)return b=null!=(j=a.human_error)?j:a.error,null==b&&(b="Unknown error"),stopLoadError("Sorry, we couldn't retrieve your information at the moment ("+b+")"),!1;m=a.parsed_responses[0].rows;for(e in m)l=m[e],c=JSON.parse(l.st_asgeojson),f=c.coordinates[0],g=c.coordinates[1],l.diseasedetected=function(){switch((""+l.diseasedetected).toLowerCase()){case"true":return"positive";case"false":return"negative";default:return""+l.diseasedetected}}(),n=l.genus+" "+l.specificepithet,i="",n!==l.originaltaxa&&(console.warn(n+" was changed from "+l.originaltaxa),i="(<em>"+l.originaltaxa+"</em>)"),h='<google-map-marker latitude="'+f+'" longitude="'+g+'">\n  <p>\n    <em>'+l.genus+" "+l.specificepithet+"</em> "+i+"\n    <br/>\n    Tested <strong>"+l.diseasedetected+"</strong> for "+l.diseasetested+"\n  </p>\n</google-map-marker>",k+=h;return d='<google-map id="transect-viewport" latitude="'+project.lat+'" longitude="'+project.lng+'" fit-to-markers map-type="hybrid" disable-default-ui>\n  '+k+"\n</google-map>",$("#auth-block").append(d),stopLoad()}).error(function(a,b){return console.error(a,b),stopLoadError("Couldn't render map")}),!1},$(function(){return _adp.projectId=uri.o.param("id"),checkProjectAuthorization()});
//# sourceMappingURL=maps/c.map