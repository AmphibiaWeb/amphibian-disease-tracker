var checkProjectAuthorization,copyLink,postAuthorizeRender,renderEmail,renderMapWithData,searchProjects,showEmailField,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};_adp.mapRendered=!1,checkProjectAuthorization=function(a,b){return null==a&&(a=_adp.projectId),null==b&&(b=postAuthorizeRender),startLoad(),console.info("Checking authorization for "+a),checkLoggedIn(function(c){var d,e;return c.status?(e=uri.urlString+"/admin-api.php",d="perform=check_access&project="+a,$.post(e,d,"json").done(function(a){var c;return a.status?(console.info("User is authorized"),c=a.detail.project,"function"==typeof b?b(c):(console.warn("No callback specified!"),console.info("Got project data",c))):console.info("User is unauthorized")}).error(function(a,b){return console.log("Error checking server",a,b)}).always(function(){return stopLoad()})):(console.info("Non logged-in user or unauthorized user"),stopLoad(),!1)}),!1},renderEmail=function(a){var b,c;return stopLoad(),c=uri.urlString+"/api.php",b="action=is_human&recaptcha_response="+a+"&project="+_adp.projectId,$.post(c,b,"json").done(function(a){var b;return console.info("Checked response"),console.log(a),b=a.author_data,showEmailField(b.contact_email),stopLoad()}).error(function(a,b){return stopLoadError("Sorry, there was a problem getting the contact email"),!1}),!1},showEmailField=function(a){var b;return b='<div class="row">\n  <paper-input readonly class="col-xs-8 col-md-11" label="Contact Email" value="'+a+'"></paper-input>\n  <div class="col-xs-4 col-md-1">\n    <paper-fab icon="communication:email" class="click materialblue" id="contact-email-send" data-href="mailto:'+a+'" data-toggle="tooltip" title="Send Email"></paper-fab>\n  </div>\n</div>',$("#email-fill").replaceWith(b),bindClicks("#contact-email-send"),!1},renderMapWithData=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;if(null==b&&(b=!1),_adp.mapRendered===!0&&b!==!0)return console.warn("The map was asked to be rendered again, but it has already been rendered!"),!1;e=JSON.parse(deEscape(a.carto_id)),g=e.table;try{o=getMapZoom(e.bounding_polygon.paths,"#transect-viewport"),console.info("Got zoom",o)}catch(p){o=""}for(l=e.bounding_polygon,j='<google-map-poly closed fill-color="'+l.fillColor+'" fill-opacity="'+l.fillOpacity+'" stroke-weight="1">',n=[],m=l.paths,h=0,i=m.length;i>h;h++)k=m[h],indexOf.call(n,k)<0&&(n.push(k),j+='<google-map-point latitude="'+k.lat+'" longitude="'+k.lng+'"> </google-map-point>');return j+="    </google-map-poly>",f="SELECT genus, specificEpithet, diseaseTested, diseaseDetected, originalTaxa, ST_asGeoJSON(the_geom) FROM "+g+";",console.info("Would ping cartodb with",f),c=encodeURIComponent(encode64(f)),d="action=fetch&sql_query="+c,$.post("api.php",d,"json").done(function(b){var c,d,e,f,g,h,i,k,l,m,n,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;if(console.info("Carto query got result:",b),!b.status)return f=null!=(y=b.human_error)?y:b.error,null==f&&(f="Unknown error"),stopLoadError("Sorry, we couldn't retrieve your information at the moment ("+f+")"),!1;A=b.parsed_responses[0].rows;for(k in A)z=A[k],g=JSON.parse(z.st_asgeojson),m=g.coordinates[0],q=g.coordinates[1],z.diseasedetected=function(){switch((""+z.diseasedetected).toLowerCase()){case"true":return"positive";case"false":return"negative";default:return""+z.diseasedetected}}(),B=z.genus+" "+z.specificepithet,x="",B!==z.originaltaxa&&(x="(<em>"+z.originaltaxa+"</em>)"),t='<google-map-marker latitude="'+m+'" longitude="'+q+'" data-disease-detected="'+z.diseasedetected+'">\n  <p>\n    <em>'+z.genus+" "+z.specificepithet+"</em> "+x+"\n    <br/>\n    Tested <strong>"+z.diseasedetected+"</strong> for "+z.diseasetested+"\n  </p>\n</google-map-marker>",j+=t;for(h='<google-map id="transect-viewport" latitude="'+a.lat+'" longitude="'+a.lng+'" fit-to-markers map-type="hybrid" disable-default-ui zoom="'+o+'" class="col-xs-12 col-md-9 col-lg-6">\n  '+j+"\n</google-map>",v="",w=a.sampling_months.split(","),i=0,l=0,n=w.length;n>l;l++)u=w[l],++i,i>1&&i===w.length?(w.length>2&&(v+=","),v+=" and "):i>1&&(v+=", "),isNumber(u)&&(u=dateMonthToString(u)),v+=u;for(i=0,D="",E=a.sampling_years.split(","),i=0,r=0,p=E.length;p>r;r++)C=E[r],++i,i>1&&i===E.length?(E.length>2&&(D+=","),D+=" and "):i>1&&(D+=", "),D+=C;return D=1===E.length?"the year "+D:"the years "+D,d=new Date(toInt(a.sampled_collection_start)),e=new Date(toInt(a.sampled_collection_end)),c=dateMonthToString(d.getMonth())+" "+d.getFullYear()+" &#8212; "+dateMonthToString(e.getMonth())+" "+e.getFullYear(),s='<div class="row">\n  '+h+'\n  <div class="col-xs-12 col-md-3 col-lg-6">\n    <p class="text-muted"><span class="glyphicon glyphicon-calendar"></span> Data were taken from '+c+'</p>\n    <p class="text-muted"><span class="glyphicon glyphicon-calendar"></span> Data were taken in '+v+'</p>\n    <p class="text-muted"><span class="glyphicon glyphicon-calendar"></span> Data were sampled in '+D+'</p>\n    <p class="text-muted"><iron-icon icon="icons:language"></iron-icon> The effective project center is at ('+roundNumberSigfig(a.lat,6)+", "+roundNumberSigfig(a.lng,6)+") with a sample radius of "+a.radius+"m and a resulting locality <strong class='locality'>"+a.locality+'</strong></p>\n    <p class="text-muted"><iron-icon icon="editor:insert-chart"></iron-icon> The dataset contains '+a.disease_positive+" positive samples ("+roundNumber(100*a.disease_positive/a.disease_samples)+"%), "+a.disease_negative+" negative samples ("+roundNumber(100*a.disease_negative/a.disease_samples)+"%), and "+a.disease_no_confidence+" inconclusive samples ("+roundNumber(100*a.disease_no_confidence/a.disease_samples)+"%)</p>\n  </div>\n</div>",$("#auth-block").append(s),setupMapMarkerToggles(),_adp.mapRendered=!0,stopLoad()}).error(function(a,b){return console.error(a,b),stopLoadError("Couldn't render map")}),!1},postAuthorizeRender=function(a){var b,c,d;return a["public"]&&console.info("Project is already public, not rerendering"),startLoad(),console.info("Should render stuff",a),d='<paper-icon-button icon="icons:create" class="authorized-action" data-href="admin-page.html?id='+a.project_id+'"></paper-icon-button>',$("#title").append(d),b=JSON.parse(a.author_data),showEmailField(b.contact_email),$(".needs-auth").html("<p>User is authorized, should repopulate</p>"),bindClicks(".authorized-action"),c=JSON.parse(deEscape(a.carto_id)),renderMapWithData(a),!1},copyLink=function(a){var b,c,d,e;if(null==a&&(a=!0),toastStatusMessage("Would copy full ark link to clipboard"),b=p$(".ark-identifier").value,a)try{return d={dataType:"text/plain",data:"https://n2t.net/"+b},c=new ClipboardEvent("copy",d),document.dispatchEvent(c),!1}catch(f){e=f,console.error("Error creating copy: "+e.message),console.warn(e.stack)}return console.warn("Can't use HTML5"),!1},searchProjects=function(){var a,b,c,d;return d=$("#project-search").val(),c=p$("#search-filter").selectedItem,b=$(c).attr("data-cols"),console.info("Searching on "+d+" ... in "+b),a="action=search_project&q="+d,$.post(uri.urlString+"api.php",a,"json").done(function(a){var b,c,d,e,f,g,h,i;if(console.info(a),h=Object.toArray(a.result),h.length>0){for(c="",e=0,f=h.length;f>e;e++)g=h[e],i=g["public"].toBool(),d=i?'<iron-icon icon="social:public"></iron-icon>':'<iron-icon icon="icons:lock"></iron-icon>',b='<button class="btn btn-primary search-proj-link" data-href="'+uri.urlString+"/project.php?id="+g.project_id+'" data-toggle="tooltip" title="Project #'+g.project_id.slice(0,8)+'...">\n  '+d+" "+g.project_title+"\n</button>",c+="<li class='project-search-result'>"+b+"</li>";return $("#project-result-container").html(c),bindClicks(".search-proj-link")}}).error(function(a,b){return console.error(a,b)}),!1},$(function(){return _adp.projectId=uri.o.param("id"),checkProjectAuthorization(),$("#project-list button").unbind().click(function(){var a;return a=$(this).attr("data-project"),goTo(uri.urlString+"project.php?id="+a)}),$("#project-search").unbind().keyup(function(){return searchProjects.debounce()}),$("#copy-ark").click(function(){return copyLink()})});
//# sourceMappingURL=maps/c.map