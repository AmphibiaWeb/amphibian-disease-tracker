var adminApiTarget,apiTarget,createChart,createOverflowMenu,dashboardDisclaimer,dropdownSortEvents,fetchMiniTaxonBlurb,fetchMiniTaxonBlurbs,getRandomDataColor,getServerChart,popShowRangeMap,renderNewChart,indexOf=[].indexOf||function(e){for(var a=0,t=this.length;a<t;a++)if(a in this&&this[a]===e)return a;return-1};apiTarget=uri.urlString+"api.php",adminApiTarget=uri.urlString+"admin-api.php",window._adp={taxonCharts:{}};try{(createOverflowMenu=function(){return checkLoggedIn(function(e){var a,t;return t='<paper-menu-button id="header-overflow-menu" vertical-align="bottom" horizontal-offset="-15" horizontal-align="right" vertical-offset="30">\n  <paper-icon-button icon="icons:more-vert" class="dropdown-trigger"></paper-icon-button>\n  <paper-menu class="dropdown-content">\n    '+(a=e.status?'    <paper-item data-href="'+uri.urlString+'admin" class="click">\n  <iron-icon icon="icons:settings-applications"></iron-icon>\n  Account Settings\n</paper-item>\n<paper-item data-href="'+uri.urlString+'admin-login.php?q=logout" class="click">\n  <span class="glyphicon glyphicon-log-out"></span>\n  Log Out\n</paper-item>':"")+'\n    <paper-item data-href="https://amphibian-disease-tracker.readthedocs.org" class="click">\n      <iron-icon icon="icons:chrome-reader-mode"></iron-icon>\n      Documentation\n    </paper-item>\n    <paper-item data-href="https://github.com/AmphibiaWeb/amphibian-disease-tracker" class="click">\n      <iron-icon icon="glyphicon-social:github"></iron-icon>\n      Github\n    </paper-item>\n    <paper-item data-href="'+uri.urlString+'about.php" class="click">\n      About / Legal\n    </paper-item>\n  </paper-menu>\n</paper-menu-button>',$("#header-overflow-menu").remove(),$("header#header-bar .logo-container + p").append(t),isNull(a)||$("header#header-bar paper-icon-button[icon='icons:settings-applications']").remove(),bindClicks()}),!1})()}catch(e){}createChart=function(e,a,t,n,o){var r,s,l,i,c,d,p;if(null==t&&(t=!1),null==n&&(n="#charts"),"object"!=typeof a)return console.error("Can't create a chart without a data object"),!1;if("function"==typeof t&&isNull(o)&&(o=t,t=!1),p={labels:["January","February","March","April","May","June","July"],datasets:[{label:"Sample Data",data:[65,59,80,81,56,55,40],borderWidth:1,borderColor:["rgba(255,99,132,1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"]}]},isNull(a.data)&&console.warn("No data for chart, will use sample data",a),null==a.data&&(a.data=p),null==a.type&&(a.type="bar"),"object"!=typeof a.options&&(a.options={responsive:!0,scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}),$(e).exists())console.log("Canvas already exists:",e);else{console.log("Creating new canvas"),i="#"===e.slice(0,1)?e.slice(1):"dataChart-"+$("canvas").length,(r=document.createElement("canvas")).setAttribute("class","chart dynamic-chart col-xs-12"),r.setAttribute("id",i);try{_adp.newCanvas=r}catch(e){}document.querySelector(n).appendChild(r)}if(null!=(null!=(c=_adp.chart)?c.chart:void 0)&&_adp.chart.chart.destroy(),l=$(e),isNull(l))try{console.log("trying again to make context"),l=$(r)}catch(e){}try{"object"!=typeof(null!=(d=a.options)?d.customCallbacks:void 0)&&(a.options.customCallbacks={})}catch(e){}return s=new Chart(l,a),_adp.chart={chart:s,ctx:l},console.info("Chart created with",a),"function"==typeof o&&o(),s},getRandomDataColor=function(){var e;return{border:(e="rgba("+randomInt(0,255)+","+randomInt(0,255)+","+randomInt(0,255))+",1)",background:e+",0.2)"}},getServerChart=function(f,v){var y,e,a,t,n;null==f&&(f="location"),startLoad();try{$("#post-species-summary").remove()}catch(e){}if(y="action=chart&bin="+f,"object"==typeof v){for(a in e=[],v)t=v[a],e.push(a+"="+t);y+="&"+e.join("&")}try{$("#diseasetested-select").exists()&&(n=p$("#diseasetested-select").selectedItem.name,isNull(n)||(y+="&disease="+n))}catch(e){}return console.debug("Fetching chart with",apiTarget+"?"+y),$.post(apiTarget,y,"json").done(function(m){var _,e,A,S,D,a,t,n,o,r,s;if(!1===m.status)return console.error("Server had a problem fetching chart data - "+m.human_error),console.warn(m),stopLoadError(m.human_error),!1;for(console.debug("Fetched chart",m),_=m.data,S=Object.toArray(_.datasets),a=D=0,t=S.length;a<t;a++){if((A=S[a]).data=Object.toArray(A.data),console.log("examine data",A),null==A.borderWidth&&(A.borderWidth=1),null==A.backgroundColor)for(A.borderColor=[],A.backgroundColor=[],o=0,n=(s=A.data).length;o<n;o++)s[o],"PosNeg"===A.stack?(-1!==A.label.toLowerCase().search("positive")&&(e={border:"rgba(220,30,25,1)",background:"rgba(220,30,25,0.2)"}),-1!==A.label.toLowerCase().search("negative")&&(e={border:"rgba(25,70,220,1)",background:"rgba(25,70,220,0.2)"})):"totals"===A.stack?-1!==A.label.toLowerCase().search("total")&&(e={border:"rgba(25,200,90,1)",background:"rgba(25,200,90,0.2)"}):e=getRandomDataColor(),A.borderColor.push(e.border),A.backgroundColor.push(e.background),0;S[D]=A,++D}switch(m.use_preprocessor){case"geocoder":console.log("Got results",m),r=function(c){var e,a,d,p,u,h,t,g,b,m,n,o,r,s,l,i,f,v,y,w,x,C,$,k;for(console.log("Starting geocoder preprocessor",S),m=[],p=[],k=!(u={}),x=[],s=D=a=0,n=S.length;s<n;s++){for(h=S[s],A=h.data,console.log("Data blob",A),k||(!1,d=D,b=g=0),l=t=0,o=A.length;l<o;l++){if(v=A[l],++t,!isNull(v.points)){for(console.debug("Using pointset",v),e={points:[],title:$=v.title,project:y=v.project_id},a=0,console.log("Looking at project #"+y+", '"+$+"'"),i=0,r=(w=Object.toArray(v.points)).length;i<r;i++){f=w[i];try{C=canonicalizePoint(f),e.points.push(C),a++}catch(e){}}if(0===a){console.log("Skipping project #"+y+" = '"+$+"' with no points");continue}g++,80,localityFromMapBuilder(e,function(e,a){var t,n,o,r,s,l,i;b++;try{for(i=null!=(s=a.views)?s:geo.geocoderViews,r=0,o=i.length;r<o;r++)l=i[r],indexOf.call(l.types,"country")<0||(n=l.formatted_address)}catch(e){n="Multiple Countries"}if(isNull(n)&&(n=e),console.log("Final locality '"+n+"' for "+a.title),indexOf.call(m,n)<0?(m.push(n),u[n]=p.length,p.push(1)):(t=u[n],p[t]++),b===g&&(h.data=p,S[d]=h,g=b=0,k=!1,D===S.length))return _.labels=m,c()})}t===A.length&&(k=!0)}x.push(++D)}return x};break;default:r=function(e){return e()}}return r(function(){var u,h,g,a,e,t,n,o,r,s,l,i,c,d,p,b;if(u={labels:Object.toArray(_.labels),datasets:S},h={data:u,type:null!=(e=_.type)?e:"bar"},isNull(_.stacking))try{null==h.options&&(h.options={scales:{xAxes:[{scaleLabel:{}}],yAxes:[{scaleLabel:{}}]}}),null!=m.title&&(h.options.title={display:!0,text:m.title}),null!=(t=h.options)&&null!=(n=t.scales)&&null!=(o=n.xAxes)&&null!=(r=o[0])&&(r.scaleLabel={labelString:m.axes.x,display:!0}),null!=(s=h.options)&&null!=(l=s.scales)&&null!=(i=l.yAxes)&&null!=(c=i[0])&&(c.scaleLabel={labelString:m.axes.y,display:!0})}catch(e){console.warn("Couldn't set up redundant options - "+(a=e).message),console.warn(a.stack)}else h.options={scales:{xAxes:[{scaleLabel:{labelString:m.axes.x,display:!0},stacked:_.stacking.x}],yAxes:[{scaleLabel:{labelString:m.axes.y,display:!0},stacked:_.stacking.y}]}},null!=m.title&&(h.options.title={display:!0,text:m.title});try{d=function(e,a){switch(f){case"species":return"Click to view the taxon data";default:return"Click to view the taxon breakdown"}},h.options.tooltips={callbacks:{afterLabel:d}}}catch(e){console.error("Couldn't custom label tooltips! "+(a=e).message),console.warn(a.stack)}try{p=u.labels.join(","+JSON.stringify(u.datasets))}catch(e){try{p=u.labels.join(",")}catch(e){p="BAD_STRINGIFY"}}return b=md5(p),g="#dataChart-"+S[0].label.replace(/ /g,"-")+"-"+b,console.log("Creating chart with",g,h),createChart(g,h,function(){var e,a,t,n,o,r,s,l,i,c,d,p;if(isNull(m.full_description)||$("#chart-"+S[0].label.replace(" ","-")).before("<h3 class='col-xs-12 text-center chart-title'>"+m.full_description+"</h3>"),"species"===f){for(n={},a="",i=0,r=(c=u.labels).length;i<r;i++)e=c[i],isNull(e)||(a+='<div class="col-xs-12 col-md-6 col-lg-4">\n  <button type="button" class="btn btn-default collapse-trigger" data-target="#'+(p=md5(e+"-"+Date.now()))+'" id="'+p+'-button-trigger" data-taxon="'+e+'">\n  '+e+'\n  </button>\n  <iron-collapse id="'+p+'" data-bin="'+v.sort+'" data-taxon="'+e+'" class="taxon-collapse">\n    <div class="collapse-content alert">\n      Binned data for '+e+". Should populate this asynchronously ....\n    </div>\n  </iron-collapse>\n</div>",n[p]=e);"species"===v.sort?d=(l=s="species")+" Summaries":(s="genera",l="genus",d="Species Summaries by Genus"),o='<section id="post-species-summary" class="col-xs-12" style="margin-top:2rem;">\n  <div class="row">\n    <a href="'+(t=_adp.chart.chart.toBase64Image())+'" class="btn btn-primary pull-right col-xs-8 col-sm-4 col-md-3 col-lg-2" id="download-main-chart" download disabled>\n      <iron-icon icon="icons:cloud-download"></iron-icon>\n      Download Chart\n    </a>\n  </div>\n  <p hidden>\n    These data are generated from over '+m.rows+" "+s+". AND MORE SUMMARY BLAHDEYBLAH. Per "+l+' summary links, etc.\n  </p>\n  <div class="row">\n    <h3 class="capitalize col-xs-12">'+d+' <small class="text-muted">Ordered as the above chart</small></h3>\n    <p class="col-xs-12 text-muted">Click on a taxon to toggle charts and more data for that taxon</p>\n    '+a+"\n  </div>\n</section>";try{$("#post-species-summary").remove()}catch(e){}$(g).after(o),delay(750,function(){return t=_adp.chart.chart.toBase64Image(),$("#download-main-chart").attr("href",t).removeAttr("disabled")});try{bindCollapsors(),_adp.fetchUpdatesFor=n,delay(250,function(){return fetchMiniTaxonBlurbs()})}catch(e){}return _adp.chart.ctx.click(function(e){var a,t,n,o,r;return t=_adp.chart.chart.getDatasetAtEvent(e),o=_adp.chart.chart.getElementAtEvent(e),console.debug("Dataset",t),console.debug("Element",o),n=o[0]._index,A=t[n],console.debug("Specific data:",A),r=A._model.label,console.debug("Taxon clicked:",r),getRandomDataColor(),console.debug("Selector test",a="button[data-taxon='"+r+"']",$(a).exists()),$(".success-glow").removeClass("success-glow"),$(a).addClass("success-glow").get(0).scrollIntoView(!1)})}if("location"===f)return _adp.chart.ctx.click(function(e){var i,a,t,n;return a=_adp.chart.chart.getDatasetAtEvent(e),n=_adp.chart.chart.getElementAtEvent(e),console.debug("Dataset",a),console.debug("Element",n),t=n[0]._index,A=a[t],console.debug("Specific data:",A),i=A._model.label,console.debug("country clicked:",i),y={async:!0,action:"country_taxon",country:i},$.get("dashboard.php",buildQuery(y,"json")).done(function(e){var a,t,n,o,r,s,l;if(console.debug("Got country result",e),e.status){for(s in console.log("Should build out new chart here"),h={type:"bar",options:{responsive:!0,title:{display:!0,text:"Taxa in "+i},scales:{xAxes:[{scaleLabel:{labelString:"Taxa",display:!0}}],yAxes:[{scaleLabel:{labelString:"Sample Count",display:!0},stacked:!0}]}}},o={label:"Positive Samples",data:[],borderColor:"rgba(220,30,25,1)",backgroundColor:"rgba(220,30,25,0.3)",borderWidth:1,stack:"pnSamples"},n={label:"Negative Samples",data:[],borderColor:"rgba(25,70,220,1)",backgroundColor:"rgba(25,70,220,0.3)",borderWidth:1,stack:"pnSamples"},t=[],r=e.data)l=r[s],n.data.push(toInt(l.false)),o.data.push(toInt(l.true)),t.push(s);_={labels:t,datasets:[o,n]},h.data=_,console.log("Using chart data",h),b=JSON.stringify(_),g="#locale-zoom-chart",a=$(g),$(g).attr("data-uid",b),null!=_adp.zoomChart&&_adp.zoomChart.destroy(),_adp.zoomChart=new Chart(a,h)}return!1}),!1})}),stopLoad()}),!1}).fail(function(e,a){return console.error("AJAX error",e,a),stopLoadError("There was a problem communicating with the server"),!1}),!1},dashboardDisclaimer=function(e){var t,n,o;return null==e&&(e="main > h2 .badge"),n=!1,o="dashboard-disclaimer-popover",(t=function(e,a){if(!n){if(!$(a).exists())return console.error("Invalid element to append disclaimer info to!"),!1;$("#"+o).exists()||('<paper-icon-button icon="icons:info" data-placement="right" title="Please wait..." id="'+o+'">\n</paper-icon-button>',$(a).after('<paper-icon-button icon="icons:info" data-placement="right" title="Please wait..." id="dashboard-disclaimer-popover">\n</paper-icon-button>'),$("#"+o).tooltip()),n=!0}return"function"==typeof e&&($("#"+o).removeAttr("data-toggle").tooltip("destroy"),delay(100,function(){return e("#"+o)})),!1})(void 0,e),checkLoggedIn(function(e){var a;return console.debug("CLI callback"),a=!0===e.status?'Data aggregated here are only for publicly available data sets, and those you have permissions to view. There may be samples in the disease repository for which the Principal Investigator(s) has marked as Private, and you lack permissions to view. These are never available in the Dashboard.\n<br/><br/>\nIf you wish to view the data as a member of the public, please either log out or view this page in a "Private Browsing" or "Incognito" mode.':"Data aggregated here are only for publicly available data sets. There may be samples in the disease repository for which the Principal Investigator(s) has marked as Private. These are never available in the Dashboard.",t(function(e){return null==e&&(e=o),console.debug("AIB callback for '"+e+"'",$(e)),$(e).tooltip("destroy").attr("data-toggle","popover").attr("title","Data Disclaimer").attr("data-trigger","focus").attr("role","button").attr("tabindex","0").popover({content:a,html:!0}),console.debug("popover bound"),!1}),_adp.appendInfoButton=t,console.log(a),!1}),!1},fetchMiniTaxonBlurbs=function(e){var a,t,o,r,s,l;for(a in null==e&&(e=_adp.fetchUpdatesFor),console.debug("Binding / setting up taxa updates for",e),_adp.collapseOpener=function(e){if(e.opened){if(Date.now()-_adp.lastOpened<1e3)return!1;e.hide()}else _adp.lastOpened=Date.now(),e.show();return!1},e){r=e[a],o="#"+a+" .collapse-content";try{s=r.split(" ")}catch(e){continue}l={genus:s[0],species:null!=(t=s[1])?t:""},$("button#"+a+"-button-trigger").attr("data-taxon",r).click(function(){var e,a,t,n;return r=$(this).attr("data-taxon"),s=r.split(" "),l={genus:s[0],species:null!=(a=s[1])?a:""},o=$(this).parent().find(".collapse-content"),(null!=(t=$(this).attr("data-has-data"))&&t).toBool()?console.debug("Already has data"):($(this).attr("data-has-data","true"),"<paper-spinner active></paper-spinner> Fetching Data...",$(o).html("<paper-spinner active></paper-spinner> Fetching Data..."),fetchMiniTaxonBlurb(l,o)),e=$(this).parent().find("iron-collapse").get(0),delay(250,(n=this,function(){return console.debug("is opened?",e.opened),e.opened?($("#post-species-summary").addClass("has-open-collapse"),$(n).parent().addClass("is-open")):($("#post-species-summary").removeClass("has-open-collapse"),$(".is-open").removeClass("is-open"))}))})}return!1},fetchMiniTaxonBlurb=function(e,Q,a){var t,n,o;for(n in null==a&&(a=!1),t=["action=taxon"],e)o=e[n],t.push(n+"="+encodeURIComponent(o));return $.get("api.php",t.join("&"),"json").done(function(e){var a,t,n,o,r,s,l,i,c,d,p,u,h,g,b,m,f,v,y,w,x,C,k,_,A,S,D,F,E,L,N,B,T,j,O,I,R,M,P,z,G,J,U,W,q,H,V,Y,K;if(console.log("Got result",e),!0!==e.status)return g='<div class="alert alert-danger">\n  <p>\n    <strong>Error:</strong> Couldn\'t fetch taxon data\n  </p>\n</div>',$(Q).html(g),!1;if($(Q).html(""),e.isGenusLookup)for(f=[],v=0,y=(O=Object.toArray(e.taxa)).length;v<y;v++)U=O[v],f.push(U.data);else f=[e];for(T=[],_=0,w=f.length;_<w;_++){q=f[_];try{console.log("Doing blurb for",JSON.stringify(q.taxon));try{if("object"!=typeof q.amphibiaweb.data.common_name)throw{message:"NOT_OBJECT"};for(E=Object.toArray(q.amphibiaweb.data.common_name),F="",A=b=0,x=E.length;A<x;A++)S=E[A],++b,S===q.iucn.data.main_common_name&&(S="<strong>"+S.trim()+"</strong>"),F+=S.trim(),E.length!==b&&(F+=", ")}catch(e){h=e,"string"==typeof q.amphibiaweb.data.common_name?F=q.amphibiaweb.data.common_name:(F=null!=(I=null!=(R=q.iucn)&&null!=(M=R.data)?M.main_common_name:void 0)?I:"",console.warn("Couldn't create common name string! "+h.message),console.warn(h.stack),console.debug(q.amphibiaweb.data))}for(j in D=isNull(F)?"":"<p>\n  <strong>Names:</strong> "+F+"\n</p>",c='<p>Sampled in the following countries:</p>\n<ul class="country-list">\n  <li>'+Object.toArray(q.adp.countries).join("</li><li>")+"</li>\n</ul>",k="<div class='clade-project-summary'>\n  <p>Represented in <strong>"+q.adp.project_count+"</strong> projects with <strong>"+q.adp.samples+"</strong> samples:</p>",P=q.adp.projects)K=Y=P[j],!0!==noDefaultRender&&30<Y.length&&(Y=Y.slice(0,27)+"..."),k+='<a class="btn btn-primary newwindow project-button-link" href="'+uri.urlString+"/project.php?id="+j+'" data-toggle="tooltip" title="'+K+'">\n  '+Y+"\n</a>";k+="</div>",0===q.adp.samples&&(k="<p>There are no samples of this taxon in our database.</p>",c=""),H=e.isGenusLookup||!0===noDefaultRender?"<p style='display:inline-block'>\n  <strong>Taxon:</strong> "+('<span class="sciname">\n  <span class="genus">'+q.taxon.genus+'</span>\n  <span class="species">'+q.taxon.species+"</span>\n</span>")+"\n</p>":"",m=(m=encode64(JSON.stringify(q.taxon))).replace(/[^\w0-9]/gim,""),console.log("Appended blurb for idTaxon",m),console.debug("Taxon data:",q,null!=(z=q.amphibiaweb)?z.map:void 0),a="<div class='blurb-info' id=\"taxon-blurb-"+m+'">\n  '+H+'\n  <div style=\'display:inline-block\'>\n    <paper-icon-button\n      icon="maps:satellite"\n      onclick="popShowRangeMap(this)"\n      data-genus="'+q.taxon.genus+'"\n      data-kml="'+(null!=(G=q.amphibiaweb)&&null!=(J=G.map)?J.shapefile:void 0)+'"\n      data-species="'+q.taxon.species+'"\n      data-toggle="tooltip"\n      title="View Range Map"\n      data-placement="right">\n    </paper-icon-button>\n  </div>\n  <p>\n    <strong>IUCN Status:</strong> '+q.iucn.category+"\n  </p>\n  "+D+"\n  "+c+'\n  <div class="charts-container row">\n  </div>\n  '+k+'\n  <div class="aweb-link-species click" data-href="http://amphibiaweb.org/cgi/amphib_query?rel-genus=equals&rel-species=equals&where-genus='+q.taxon.genus.toTitleCase()+"&where-species="+q.taxon.species+'" data-newtab="true">\n    <span class="sciname">\n      '+q.taxon.genus.toTitleCase()+" "+q.taxon.species+'\n    </span> on AmphibiaWeb\n    <iron-icon icon="icons:open-in-new"></iron-icon>\n  </div>\n</div>';try{if(-1!==q.taxon.species.search(/sp\./)){W={blurb:a,taxonData:q,idTaxon:m,targetSelector:Q},T.push(W);continue}}catch(e){}for(p in $(Q).append(a),bindClicks(),formatScientificNames(".aweb-link-species .sciname"),0===q.adp.samples&&(stopLoad(),delay(1e3,function(){return stopLoad()})),u=q.adp.disease_data)(d=u[p]).detected.no_confidence!==d.detected.total&&(r={type:"pie",data:{labels:[p+" detected",p+" not detected",p+" inconclusive data"],datasets:[{data:[d.detected.true,d.detected.false,d.detected.no_confidence],backgroundColor:["#FF6384","#36A2EB","#FFCE56"],hoverBackgroundColor:["#FF6384","#36A2EB","#FFCE56"]}]}},(t=document.createElement("canvas")).setAttribute("class","chart dynamic-pie-chart"),o=m+"-"+p+"-testdata",t.setAttribute("id",o),n=o+"-container",s=$(Q).find("#taxon-blurb-"+m).find(".charts-container").get(0),i='<div id="'+n+'" class="'+(!0===window.noDefaultRender?"col-xs-6 col-md-4 col-lg-3 ":"")+'taxon-chart">\n</div>',$(s).append(i),$("#"+n).get(0).appendChild(t),l=$("#"+o),B=new Chart(l,r),_adp.taxonCharts[o]=B,stopLoad()),d.fatal.unknown!==d.fatal.total&&(r={type:"pie",data:{labels:[p+" fatal",p+" not fatal",p+" unknown fatality"],datasets:[{data:[d.fatal.true,d.fatal.false,d.fatal.unknown],backgroundColor:["#FF6384","#36A2EB","#FFCE56"],hoverBackgroundColor:["#FF6384","#36A2EB","#FFCE56"]}]}},(t=document.createElement("canvas")).setAttribute("class","chart dynamic-pie-chart"),o=m+"-"+p+"-fataldata",t.setAttribute("id",o),n=o+"-container",s=$(Q).find(".charts-container").get(0),i='<div id="'+n+'" class="col-xs-6">\n</div>',$(s).append(i),$("#"+n).get(0).appendChild(t),l=$("#"+o),B=new Chart(l,r),_adp.taxonCharts[o]=B,stopLoad())}catch(e){h=e;try{V="",V='for\n  <span class="sciname">\n    <span class="genus">'+q.taxon.genus+'</span>\n    <span class="species">'+q.taxon.species+"</span>\n  </span>"}catch(e){}g='<div class="alert alert-danger">\n  <p>\n    <strong>Error:</strong> Couldn\'t fetch taxon data '+V+"\n  </p>\n</div>",$(Q).append(g),console.error("Couldn't get taxon data -- "+h.message,q),console.warn(h.stack),stopLoadError()}}if(0<T.length){for(console.log("Have "+T.length+" unidentified species"),N=0,C=T.length;N<C;N++){L=T[N];try{for(p in Q=L.targetSelector,m=L.idTaxon,q=L.taxonData,a=L.blurb,$(Q).append(a),u=q.adp.disease_data)(d=u[p]).detected.no_confidence!==d.detected.total&&(r={type:"pie",data:{labels:[p+" detected",p+" not detected",p+" inconclusive data"],datasets:[{data:[d.detected.true,d.detected.false,d.detected.no_confidence],backgroundColor:["#FF6384","#36A2EB","#FFCE56"],hoverBackgroundColor:["#FF6384","#36A2EB","#FFCE56"]}]}},(t=document.createElement("canvas")).setAttribute("class","chart dynamic-pie-chart"),o=m+"-"+p+"-testdata",t.setAttribute("id",o),n=o+"-container",s=$(Q).find("#taxon-blurb-"+m).find(".charts-container").get(0),i='<div id="'+n+'" class="col-xs-6">\n</div>',$(s).append(i),$("#"+n).get(0).appendChild(t),l=$("#"+o),B=new Chart(l,r),_adp.taxonCharts[o]=B,stopLoad()),d.fatal.unknown!==d.fatal.total&&(r={type:"pie",data:{labels:[p+" fatal",p+" not fatal",p+" unknown fatality"],datasets:[{data:[d.fatal.true,d.fatal.false,d.fatal.unknown],backgroundColor:["#FF6384","#36A2EB","#FFCE56"],hoverBackgroundColor:["#FF6384","#36A2EB","#FFCE56"]}]}},(t=document.createElement("canvas")).setAttribute("class","chart dynamic-pie-chart"),o=m+"-"+p+"-fataldata",t.setAttribute("id",o),n=o+"-container",s=$(Q).find(".charts-container").get(0),i='<div id="'+n+'" class="col-xs-6">\n</div>',$(s).append(i),$("#"+n).get(0).appendChild(t),l=$("#"+o),B=new Chart(l,r),_adp.taxonCharts[o]=B,stopLoad())}catch(e){}}stopLoad(),delay(1e3,function(){return console.debug("Doing 1s delayed stopLoad"),stopLoad()})}return!1}).error(function(e,a){return'<div class="alert alert-danger">\n  <p>\n    <strong>Error:</strong> Server error fetching taxon data ()\n  </p>\n</div>',$(Q).html('<div class="alert alert-danger">\n  <p>\n    <strong>Error:</strong> Server error fetching taxon data ()\n  </p>\n</div>'),console.error("Couldn't fetch taxon data from server"),console.warn(e,a),stopLoadError(),!1}),!1},renderNewChart=function(){var a,e,t,n,o,r,s,l,i;try{null!=_adp.zoomChart&&_adp.zoomChart.destroy()}catch(e){}for(a={},o=0,r=(l=$(".chart-param")).length;o<r;o++){s=l[o],n=$(s).attr("data-key").replace(" ","-");try{if(null==p$(s).checked)throw"Not Toggle";a[n]=p$(s).checked}catch(e){t=$(p$(s).selectedItem).attr("data-value"),isNull(t)&&(t=p$(s).selectedItemLabel.toLowerCase().replace(" ","-")),a[n]=t}}return $(".chart.dynamic-chart").remove(),$(".chart-title").remove(),e=null!=(i=a.bin)?i:"location",delete a.bin,console.info("Going to generate a new chart with the following options",a),getServerChart(e,a),a},dropdownSortEvents=function(){var e;return!0!==("undefined"!=typeof _adp&&null!==_adp?_adp.hasBoundSortDisables:void 0)&&($("paper-dropdown-menu#binned-by paper-listbox").on("iron-select",function(){return e.debounce(50,null,null,this)}),$("paper-dropdown-menu#binned-by paper-listbox > paper-item").click(function(){return e.debounce(50,null,null,$(this).parents("paper-listbox"))}),_adp.hasBoundSortDisabled=!0),e=function(e){var a,t,n,o,r,s,l,i,c,d,p;for(n=p$(e).selectedItem,console.log("Firing doSortDisables",n,e),l=$(n).attr("data-value"),isNull(l)&&(l=$(n).text().trim().toLowerCase()),t=l,o=!1,i=s=0,c=(d=$("paper-dropdown-menu#sort-by paper-listbox paper-item")).length;i<c;i++){if(r=d[i],a=(null!=(p=$(r).attr("data-bins"))?p:"").split(","),console.log("Searching allowed bins for '"+t+"'",a,r),0<=indexOf.call(a,t)){try{p$(r).disabled=!1}catch(e){}$(r).removeAttr("disabled"),o=!0}else{try{p$(r).disabled=!0}catch(e){}$(r).attr("disabled","disabled")}o||s++}return p$("paper-dropdown-menu#sort-by paper-listbox").selected=s,!1},console.log("Dropdown sort events bound"),!1},popShowRangeMap=function(e,a){var t,n,o,r,s;if("object"!=typeof e)return!1;if(isNull((n=e).genus)||isNull(e.species))try{o=$(e).attr("data-genus"),s=$(e).attr("data-species"),isNull(a)&&(a=$(e).attr("data-kml")),e={genus:o,species:s}}catch(e){}if(isNull(e.genus)||isNull(e.species))return toastStatusMessage("Unable to show range map"),!1;if(isNull(a)){try{a=$(n).attr("data-kml")}catch(e){}isNull(a)&&console.warn("Unable to read KML attr and none passed")}return"https://mol.org/species/map/",t={embed:"true"},r='<paper-dialog modal id="species-range-map" class="pop-map dashboard-map" data-taxon-genus="'+e.genus+'" data-taxon-species="'+e.species+'">\n  <h2>Range map for <span class="genus">'+e.genus+'</span> <span class="species">'+e.species+'</span></h2>\n  <paper-dialog-scrollable>\n    \x3c!-- <iframe class="mol-embed" src="https://mol.org/species/map/'+e.genus.toTitleCase()+"_"+e.species+"?"+buildQuery(t)+'"></iframe> --\x3e\n  <google-map\n    api-key="'+gMapsApiKey+'"\n    kml="'+a+'"\n    map-type="hybrid">\n    </google-map>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Close</paper-button>\n  </div>\n</paper-dialog>',$("#species-range-map").remove(),$("body").append(r),$("#species-range-map").on("iron-overlay-opened",function(){var e;return console.debug("Opened"),e=$(this).find("paper-dialog-scrollable").height(),$(this).find("paper-dialog-scrollable > div#scrollable").css("max-height",e+"px").css("height",e+"px"),console.debug($(this).width(),$(this).height(),e),!1}),p$("#species-range-map").open(),!0},$(function(){console.log("Loaded dashboard");try{isNull(window.noDefaultRender)&&(window.noDefaultRender=!1)}catch(e){window.noDefaultRender=!1}return console.debug("NDR state",window.noDefaultRender),!0!==window.noDefaultRender&&getServerChart(),$("#generate-chart").click(function(){return renderNewChart.debounce(50),!1}),$(".tab-area-container .nav-tabs a").click(function(e){return e.preventDefault(),console.debug("Clicked a tab",this),$(this).tab("show"),!1}),delayPolymerBind("paper-dropdown-menu#binned-by",function(){return $(".chart-param paper-listbox").on("iron-select",function(){return console.log("Firing iron-select event",this),renderNewChart.debounce(50)}),$(".chart-param paper-listbox paper-item").on("click",function(){return console.log("Firing click event on paper-item",this),renderNewChart.debounce(50)}),$("#diseasetested-select").on("selected-item-changed",function(){return console.log("Firing selection change"),renderNewChart.debounce(50)}),dropdownSortEvents(),dashboardDisclaimer()}),!1});
//# sourceMappingURL=dashboard.min.js.map