var adminApiTarget,apiTarget,createChart,createOverflowMenu,getRandomDataColor,getServerChart,renderNewChart,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};apiTarget=uri.urlString+"api.php",adminApiTarget=uri.urlString+"admin-api.php",window._adp={};try{(createOverflowMenu=function(){return checkLoggedIn(function(a){var b,c;return b=a.status?'    <paper-item data-href="https://amphibiandisease.org/admin" class="click">\n  <iron-icon icon="icons:settings-applications"></iron-icon>\n  Account Settings\n</paper-item>\n<paper-item data-href="https://amphibiandisease.org/admin-login.php?q=logout" class="click">\n  <span class="glyphicon glyphicon-log-out"></span>\n  Log Out\n</paper-item>':"",c='<paper-menu-button id="header-overflow-menu" vertical-align="bottom" horizontal-offset="-15" horizontal-align="right" vertical-offset="30">\n  <paper-icon-button icon="icons:more-vert" class="dropdown-trigger"></paper-icon-button>\n  <paper-menu class="dropdown-content">\n    '+b+'\n    <paper-item disabled data-href="https://github.com/AmphibiaWeb/amphibian-disease-tracker/issues/176" class="click">\n      Summary Dashboard\n    </paper-item>\n    <paper-item data-href="https://amphibian-disease-tracker.readthedocs.org" class="click">\n      <iron-icon icon="icons:chrome-reader-mode"></iron-icon>\n      Documentation\n    </paper-item>\n    <paper-item data-href="https://github.com/AmphibiaWeb/amphibian-disease-tracker" class="click">\n      <iron-icon icon="glyphicon-social:github"></iron-icon>\n      Github\n    </paper-item>\n    <paper-item data-href="https://amphibiandisease.org/about.php" class="click">\n      About / Legal\n    </paper-item>\n  </paper-menu>\n</paper-menu-button>',$("#header-overflow-menu").remove(),$("header#header-bar .logo-container + p").append(c),isNull(b)||$("header#header-bar paper-icon-button[icon='icons:settings-applications']").remove(),bindClicks()}),!1})()}catch(a){}createChart=function(a,b,c,d,e){var f,g,h,i,j,k,l,m;return null==c&&(c=!1),null==d&&(d="main"),"object"!=typeof b?(console.error("Can't create a chart without a data object"),!1):("function"==typeof c&&isNull(e)&&(e=c,c=!1),k={label:"Sample Data",data:[65,59,80,81,56,55,40],borderWidth:1,borderColor:["rgba(255,99,132,1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"]},m=[k],l={labels:["January","February","March","April","May","June","July"],datasets:m},isNull(b.data)&&(j=b,console.warn("No data for chart, will use sample data",j)),null==b.data&&(b.data=l),null==b.type&&(b.type="bar"),"object"!=typeof b.options&&(b.options={responsive:!0}),$(a).exists()||(i="#"===a.slice(0,1)?a.slice(1):"dataChart-"+$("canvas").length,h='<canvas id="'+i+'" class="chart dynamic-chart col-xs-12">\n</canvas>',$(d).append(h)),g=$(a),f=new Chart(g,b),console.info("Chart created with",b),"function"==typeof e&&e(),f)},getRandomDataColor=function(){var a,b;return a="rgba("+randomInt(0,255)+","+randomInt(0,255)+","+randomInt(0,255),b={border:a+",1)",background:a+",0.2)"}},getServerChart=function(a,b){var c,d,e,f;if(null==a&&(a="infection"),startLoad(),c="action=chart&sort="+a,"object"==typeof b){d=[];for(e in b)f=b[e],d.push(e+"="+f);c+="&"+d.join("&")}return console.debug("Fetching chart with",apiTarget+"?"+c),$.post(apiTarget,c,"json").done(function(a){var b,c,d,e,f,g,h,i,j,k,l,m;if(a.status===!1)return console.error("Server had a problem fetching chart data - "+a.human_error),console.warn(a),stopLoadError(a.human_error),!1;for(b=a.data,f=Object.toArray(b.datasets),g=0,h=0,j=f.length;h<j;h++){if(d=f[h],d.data=Object.toArray(d.data),null==d.borderWidth&&(d.borderWidth=1),null==d.backgroundColor)for(d.borderColor=[],d.backgroundColor=[],m=d.data,i=0,k=m.length;i<k;i++)e=m[i],c=getRandomDataColor(),d.borderColor.push(c.border),d.backgroundColor.push(c.background);f[g]=d,++g}switch(a.use_preprocessor){case"geocoder":console.log("Got results",a),l=function(a){var c,e,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;for(console.log("Starting geocoder preprocessor",f),e=0,n=[],i=[],j={},g=0,z=!1,x=[],r=0,o=f.length;r<o;r++){for(k=f[r],d=k.data,z||(l=!1,h=g),m=0,s=0,p=d.length;s<p;s++){if(v=d[s],++m,!isNull(v)){for(c={points:[]},w=Object.toArray(v),t=0,q=w.length;t<q;t++){u=w[t];try{y=canonicalizePoint(u),c.points.push(y),e++}catch(a){}}localityFromMapBuilder(c,function(d){var e,m,o,p,q,r;try{for(q=geo.geocoderViews,p=0,o=q.length;p<o;p++)r=q[p],indexOf.call(r.types,"country")<0||(m=r.formatted_address)}catch(a){return console.warn("Skipping bad builder",c),!1}if(isNull(m)&&(m=d),console.log("Final locality '"+m+"'"),indexOf.call(n,m)<0?(n.push(m),j[m]=i.length,i.push(1)):(e=j[m],i[e]++),l&&(k.data=i,f[h]=k,z=!1,g===f.length))return b.labels=n,a()})}m===d.length&&(l=!0,z=!0)}x.push(++g)}return x};break;default:l=function(a){return a()}}return l(function(){var c,d,e,g;return c={labels:Object.toArray(b.labels),datasets:f},d={data:c,type:null!=(g=b.type)?g:"bar"},e="#chart-"+f[0].label.replace(" ","-"),createChart(e,d,function(){if(!isNull(a.full_description))return $("#chart-"+f[0].label.replace(" ","-")).before("<h3 class='col-xs-12 text-center chart-title'>"+a.full_description+"</h3>")}),stopLoad()}),!1}).fail(function(a,b){return console.error("AJAX error",a,b),stopLoadError("There was a problem communicating with the server"),!1}),!1},renderNewChart=function(){var a,b,c,d,e,f,g,h;for(a={},g=$(".chart-param"),c=0,e=g.length;c<e;c++){f=g[c],d=$(f).attr("data-key").replace(" ","-");try{if(null==p$(f).checked)throw"Not Toggle";a[d]=p$(f).checked}catch(b){a[d]=p$(f).selectedItemLabel.toLowerCase().replace(" ","-")}}return $(".chart.dynamic-chart").remove(),$(".chart-title").remove(),b=null!=(h=a.sort)?h:"infection",delete a.sort,console.info("Going to generate a new chart with the following options",a),getServerChart(b,a),a},$(function(){return console.log("Loaded dashboard"),getServerChart(),$("#generate-chart").click(function(){return renderNewChart.debounce(50)}),!1});
//# sourceMappingURL=dashboard.min.js.map