var adminApiTarget,apiTarget,createChart,createOverflowMenu,dropdownSortEvents,getRandomDataColor,getServerChart,renderNewChart,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};apiTarget=uri.urlString+"api.php",adminApiTarget=uri.urlString+"admin-api.php",window._adp={};try{(createOverflowMenu=function(){return checkLoggedIn(function(a){var b,c;return b=a.status?'    <paper-item data-href="'+uri.urlString+'admin" class="click">\n  <iron-icon icon="icons:settings-applications"></iron-icon>\n  Account Settings\n</paper-item>\n<paper-item data-href="'+uri.urlString+'admin-login.php?q=logout" class="click">\n  <span class="glyphicon glyphicon-log-out"></span>\n  Log Out\n</paper-item>':"",c='<paper-menu-button id="header-overflow-menu" vertical-align="bottom" horizontal-offset="-15" horizontal-align="right" vertical-offset="30">\n  <paper-icon-button icon="icons:more-vert" class="dropdown-trigger"></paper-icon-button>\n  <paper-menu class="dropdown-content">\n    '+b+'\n    <paper-item data-href="'+uri.urlString+'/dashboard.php" class="click">\n      Summary Dashboard\n    </paper-item>\n    <paper-item data-href="https://amphibian-disease-tracker.readthedocs.org" class="click">\n      <iron-icon icon="icons:chrome-reader-mode"></iron-icon>\n      Documentation\n    </paper-item>\n    <paper-item data-href="https://github.com/AmphibiaWeb/amphibian-disease-tracker" class="click">\n      <iron-icon icon="glyphicon-social:github"></iron-icon>\n      Github\n    </paper-item>\n    <paper-item data-href="'+uri.urlString+'about.php" class="click">\n      About / Legal\n    </paper-item>\n  </paper-menu>\n</paper-menu-button>',$("#header-overflow-menu").remove(),$("header#header-bar .logo-container + p").append(c),isNull(b)||$("header#header-bar paper-icon-button[icon='icons:settings-applications']").remove(),bindClicks()}),!1})()}catch(a){}createChart=function(a,b,c,d,e){var f,g,h,i,j,k,l,m;if(null==c&&(c=!1),null==d&&(d="main"),"object"!=typeof b)return console.error("Can't create a chart without a data object"),!1;if("function"==typeof c&&isNull(e)&&(e=c,c=!1),k={label:"Sample Data",data:[65,59,80,81,56,55,40],borderWidth:1,borderColor:["rgba(255,99,132,1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"]},m=[k],l={labels:["January","February","March","April","May","June","July"],datasets:m},isNull(b.data)&&(j=b,console.warn("No data for chart, will use sample data",j)),null==b.data&&(b.data=l),null==b.type&&(b.type="bar"),"object"!=typeof b.options&&(b.options={responsive:!0,scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}),$(a).exists())console.log("Canvas already exists:",a);else{console.log("Creating new canvas"),i="#"===a.slice(0,1)?a.slice(1):"dataChart-"+$("canvas").length,f=document.createElement("canvas"),f.setAttribute("class","chart dynamic-chart col-xs-12"),f.setAttribute("id",i);try{_adp.newCanvas=f}catch(a){}document.querySelector(d).appendChild(f)}if(h=$(a),isNull(h))try{console.log("trying again to make context"),h=$(f)}catch(a){}return g=new Chart(h,b),console.info("Chart created with",b),"function"==typeof e&&e(),g},getRandomDataColor=function(){var a,b;return a="rgba("+randomInt(0,255)+","+randomInt(0,255)+","+randomInt(0,255),b={border:a+",1)",background:a+",0.2)"}},getServerChart=function(a,b){var c,d,e,f;if(null==a&&(a="location"),startLoad(),c="action=chart&bin="+a,"object"==typeof b){d=[];for(e in b)f=b[e],d.push(e+"="+f);c+="&"+d.join("&")}return console.debug("Fetching chart with",apiTarget+"?"+c),$.post(apiTarget,c,"json").done(function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p;if(c.status===!1)return console.error("Server had a problem fetching chart data - "+c.human_error),console.warn(c),stopLoadError(c.human_error),!1;for(console.debug("Fetched chart",c),d=c.data,h=Object.toArray(d.datasets),i=0,j=0,k=h.length;j<k;j++){if(f=h[j],f.data=Object.toArray(f.data),console.log("examine data",f),null==f.borderWidth&&(f.borderWidth=1),null==f.backgroundColor)for(f.borderColor=[],f.backgroundColor=[],p=0,o=f.data,m=0,l=o.length;m<l;m++)g=o[m],"PosNeg"===f.stack?(f.label.toLowerCase().search("positive")!==-1&&(e={border:"rgba(220,30,25,1)",background:"rgba(220,30,25,0.2)"}),f.label.toLowerCase().search("negative")!==-1&&(e={border:"rgba(25,70,220,1)",background:"rgba(25,70,220,0.2)"})):"totals"===f.stack?f.label.toLowerCase().search("total")!==-1&&(e={border:"rgba(25,200,90,1)",background:"rgba(25,200,90,0.2)"}):e=getRandomDataColor(),f.borderColor.push(e.border),f.backgroundColor.push(e.background),++p;h[i]=f,++i}switch(c.use_preprocessor){case"geocoder":console.log("Got results",c),n=function(a){var b,c,e,g,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;for(console.log("Starting geocoder preprocessor",h),c=0,p=[],g=[],j={},i=0,D=!1,A=[],t=0,q=h.length;t<q;t++){for(k=h[t],f=k.data,console.log("Data blob",f),D||(l=!1,e=i,n=0,o=0),m=0,u=0,r=f.length;u<r;u++){if(x=f[u],++m,!isNull(x.points)){for(console.debug("Using pointset",x),C=x.title,y=x.project_id,b={points:[],title:C,project:y},c=0,console.log("Looking at project #"+y+", '"+C+"'"),z=Object.toArray(x.points),v=0,s=z.length;v<s;v++){w=z[v];try{B=canonicalizePoint(w),b.points.push(B),c++}catch(a){}}if(0===c){console.log("Skipping project #"+y+" = '"+C+"' with no points");continue}n++,E=80,localityFromMapBuilder(b,function(b,c){var f,l,m,q,r,s,t;o++;try{for(t=null!=(r=c.views)?r:geo.geocoderViews,q=0,m=t.length;q<m;q++)s=t[q],indexOf.call(s.types,"country")<0||(l=s.formatted_address)}catch(a){l="Multiple Countries"}if(isNull(l)&&(l=b),console.log("Final locality '"+l+"' for "+c.title),indexOf.call(p,l)<0?(p.push(l),j[l]=g.length,g.push(1)):(f=j[l],g[f]++),o===n&&(k.data=g,h[e]=k,o=0,n=0,D=!1,i===h.length))return d.labels=p,a()})}m===f.length&&(l=!0,D=!0)}A.push(++i)}return A};break;default:n=function(a){return a()}}return n(function(){var e,f,g,i,j,k;e={labels:Object.toArray(d.labels),datasets:h},f={data:e,type:null!=(i=d.type)?i:"bar"},isNull(d.stacking)||(f.options={scales:{xAxes:[{stacked:d.stacking.x}],yAxes:[{stacked:d.stacking.y}]}});try{j=e.labels.join(","+JSON.stringify(e.datasets))}catch(a){try{j=e.labels.join(",")}catch(a){j="BAD_STRINGIFY"}}return k=md5(j),g="#dataChart-"+h[0].label.replace(/ /g,"-")+"-"+k,console.log("Creating chart with",g,f),createChart(g,f,function(){var d,e,f;if(isNull(c.full_description)||$("#chart-"+h[0].label.replace(" ","-")).before("<h3 class='col-xs-12 text-center chart-title'>"+c.full_description+"</h3>"),"species"===a){"species"===b.sort?(e="species",f=e):(e="genera",f="genus"),d='<section id="post-species-summary" class="col-xs-12">\n  <p>\n    These data are generated from over '+c.rows+" "+e+". AND MORE SUMMARY BLAHDEYBLAH. Per "+f+' summary links, etc.\n  </p>\n  <div class="row">\n    <h3>'+f+" Summaries</h3>\n    collapsors here? or async pulls?\n  </div>\n</section>";try{$("#post-species-summary").remove()}catch(a){}return $(g).after(d)}}),stopLoad()}),!1}).fail(function(a,b){return console.error("AJAX error",a,b),stopLoadError("There was a problem communicating with the server"),!1}),!1},renderNewChart=function(){var a,b,c,d,e,f,g,h;for(a={},g=$(".chart-param"),d=0,e=g.length;d<e;d++){f=g[d],c=$(f).attr("data-key").replace(" ","-");try{if(null==p$(f).checked)throw"Not Toggle";a[c]=p$(f).checked}catch(b){a[c]=p$(f).selectedItemLabel.toLowerCase().replace(" ","-")}}return $(".chart.dynamic-chart").remove(),$(".chart-title").remove(),b=null!=(h=a.bin)?h:"location",delete a.bin,console.info("Going to generate a new chart with the following options",a),getServerChart(b,a),a},dropdownSortEvents=function(){var a;return $("paper-dropdown-menu#binned-by paper-listbox").unbind("iron-select").on("iron-select",function(){return a.debounce(50,null,null,this)}),$("paper-dropdown-menu#binned-by paper-listbox > paper-item").unbind("click").click(function(){return a.debounce(50,null,null,$(this).parents("paper-listbox"))}),a=function(a){var b,c,d,e,f,g,h,i,j,k,l;for(e=p$(a).selectedItem,console.log("Firing doSortDisables",e,a),d=$(e).text().trim().toLowerCase(),h=0,f=!1,k=$("paper-dropdown-menu#sort-by paper-listbox paper-item"),i=0,j=k.length;i<j;i++){if(g=k[i],c=null!=(l=$(g).attr("data-bins"))?l:"",b=c.split(","),console.log("Searching allowed bins for '"+d+"'",b,g),indexOf.call(b,d)>=0){try{p$(g).disabled=!1}catch(a){}$(g).removeAttr("disabled"),f=!0}else{try{p$(g).disabled=!0}catch(a){}$(g).attr("disabled","disabled")}f||h++}return p$("paper-dropdown-menu#sort-by paper-listbox").selected=h,!1},console.log("Dropdown sort events bound"),!1},$(function(){return console.log("Loaded dashboard"),getServerChart(),$("#generate-chart").click(function(){return renderNewChart.debounce(50)}),delayPolymerBind("paper-dropdown-menu#binned-by",function(){return $(".chart-param paper-listbox").on("iron-select",function(){return renderNewChart.debounce(50)}),$(".chart-param paper-listbox paper-item").on("click",function(){return renderNewChart.debounce(50)}),dropdownSortEvents()}),!1});
//# sourceMappingURL=dashboard.min.js.map