function shuffle(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function pointSort(a,b){if(a==upper)return-1;if(b==upper)return 1;var c=upper.slope(a),d=upper.slope(b);return c==d?a.distance(upper)<b.distance(upper)?-1:1:c<=0&&d>0?-1:c>0&&d<=0?1:c>d?-1:1}function upperLeft(a){for(var b=a[0],c=1;c<a.length;c++){var d=a[c];(d.y>b.y||d.y==b.y&&d.x<b.x)&&(b=d)}return b}function cross(a,b,c){return(b.lat-a.lat)*(c.lng-a.lng)-(b.lng-a.lng)*(c.lat-a.lat)}function convexHull(a){a.sort(function(a,b){return a.lat==b.lat?a.lng-b.lng:a.lat-b.lat});for(var b=[],c=0;c<a.length;c++){for(;b.length>=2&&cross(b[b.length-2],b[b.length-1],a[c])<=0;)b.pop();b.push(a[c])}for(var d=[],c=a.length-1;c>=0;c--){for(;d.length>=2&&cross(d[d.length-2],d[d.length-1],a[c])<=0;)d.pop();d.push(a[c])}return d.pop(),b.pop(),b.concat(d)}function calculateConvexHull(){polyline&&polyline.setMap(null),document.getElementById("hull_points").innerHTML="",points=[];for(var a=0;a<gmarkers.length;a++)points.push(gmarkers[a].getPosition());points.sort(sortPointY),points.sort(sortPointX),DrawHull()}function DrawHull(){hullPoints=[],chainHull_2D(points,points.length,hullPoints),polyline=new google.maps.Polygon({map:map,paths:hullPoints,fillColor:"#FF0000",strokeWidth:2,fillOpacity:.5,strokeColor:"#0000FF",strokeOpacity:.5}),displayHullPts()}function displayHullPts(){document.getElementById("hull_points").innerHTML="";for(var a=0;a<hullPoints.length;a++)document.getElementById("hull_points").innerHTML+=hullPoints[a].toUrlValue()+"<br>"}function isLeft(a,b,c){return(b.lng()-a.lng())*(c.lat()-a.lat())-(c.lng()-a.lng())*(b.lat()-a.lat())}function chainHull_2D(a,b,c){var d,e,f=0,g=-1,h=a[0].lng();for(d=1;d<b&&a[d].lng()==h;d++);if((e=d-1)==b-1)return c[++g]=a[0],a[e].lat()!=a[0].lat()&&(c[++g]=a[e]),c[++g]=a[0],g+1;var i,j=b-1,k=a[b-1].lng();for(d=b-2;d>=0&&a[d].lng()==k;d--);for(i=d+1,c[++g]=a[0],d=e;++d<=i;)if(!(isLeft(a[0],a[i],a[d])>=0&&d<i)){for(;g>0&&!(isLeft(c[g-1],c[g],a[d])>0);)g--;c[++g]=a[d]}for(j!=i&&(c[++g]=a[j]),f=g,d=i;--d>=e;)if(!(isLeft(a[j],a[e],a[d])>=0&&d>e)){for(;g>f&&!(isLeft(c[g-1],c[g],a[d])>0);)g--;c[++g]=a[d]}return 0!=e&&(c[++g]=a[0]),g+1}var Point,activityIndicatorOff,activityIndicatorOn,adData,allError,animateHoverShadows,animateLoad,backupDebugLog,bindClicks,bindCollapsors,bindCopyEvents,bindDismissalRemoval,bsAlert,buildArgs,buildMap,buildQuery,byteCount,cancelAsyncOperation,canonicalizePoint,cartoAccount,cartoMap,cartoVis,checkFileVersion,checkLoggedIn,cleanupToasts,copyText,createConvexHull,createMap,createMap2,createRawCartoMap,d$,dateMonthToString,deEscape,decode64,deepJQuery,defaultFillColor,defaultFillOpacity,defaultMapMouseOverBehaviour,delay,delayPolymerBind,disableDebugLogging,doCORSget,doMapBuilder,doNothing,downloadCSVFile,downloadCSVFileOnThread,e,enableDebugLogging,encode64,error1,fPoint,featureClickEvent,fetchCitation,fixTruncatedJson,foo,formatScientificNames,gMapsApiKey,generateCSVFromResults,getColumnObj,getConvexHull,getConvexHullConfig,getConvexHullPoints,getCorners,getElementHtml,getLocation,getMapCenter,getMapZoom,getMaxZ,getPointsFromBoundingBox,getPointsFromCartoResult,getPosterFromSrc,goTo,interval,isArray,isBlank,isBool,isEmpty,isHovered,isJson,isNull,isNumber,jsonTo64,lightboxImages,linkUsers,loadJS,localityFromMapBuilder,makePageCitationOverflow,mapNewWindows,openLink,openTab,overlayOff,overlayOn,p$,post64,prepURI,randomInt,randomString,reInitMap,reportDebugLog,roundNumber,roundNumberSigfig,safariDialogHelper,setupMapMarkerToggles,sortPointX,sortPointY,sortPoints,sortPointsXY,speculativeApiLoader,startLoad,stopLoad,stopLoadError,toFloat,toInt,toObject,toastStatusMessage,toggleGoogleMapMarkers,uri,validateAWebTaxon,wait,slice=[].slice,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},modulo=function(a,b){return(+a%(b=+b)+b)%b};try{uri={},uri.o=$.url(),uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+uri.o.attr("directory"),uri.query=uri.o.attr("fragment")}catch(error1){e=error1,console.warn("PURL not installed!")}window.locationData={},locationData.params={enableHighAccuracy:!0},locationData.last=void 0,window.debounce_timer=null,null==window.adminParams&&(window.adminParams={}),null==window._adp&&(window._adp={}),isBool=function(a,b){if(null==b&&(b=!1),b)return"boolean"==typeof a;try{return"boolean"==typeof a?!0===a||!1===a:"string"==typeof a?"true"===a.toLowerCase()||"false"===a.toLowerCase():"number"==typeof a&&(1===a||0===a)}catch(a){return e=a,!1}},isEmpty=function(a){return!a||0===a.length},isBlank=function(a){return!a||/^\s*$/.test(a)},isNull=function(a,b){var c;if(null==b&&(b=!1),"object"==typeof a)try{if(null!=(c=a.length))try{return 0===c}catch(a){}return 0===Object.size}catch(a){}try{if(isEmpty(a)||isBlank(a)||null==a){if(!1!==a&&0!==a)return!0;if(b&&(!1===a||0===a))return!0}}catch(a){return e=a,!1}try{a=(""+a).toLowerCase()}catch(a){}return"undefined"===a||"null"===a||!(!b||"false"!==a&&"0"!==a)},isJson=function(a){if("object"==typeof a&&!isArray(a))return!0;try{return JSON.parse(a),!0}catch(a){return!1}return!1},isArray=function(a){var b;try{return b=a.slice(0),b.push("foo"),!0}catch(a){return!1}},isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},toFloat=function(a){return!isNumber(a)||isNull(a)?0:parseFloat(a)},toInt=function(a){var b;return"string"==typeof a&&(a=a.replace("px","").replace("em","").replace("rem","").replace("vw","").replace("vh","")),!isNumber(a)||isNull(a)?0:(b=parseFloat(a),parseInt(b))},String.prototype.toAscii=function(){return this.replace(/[\u2018\u2019\u201A\u201B\u2032\u2035]/g,"'").replace(/[\u201C\u201D\u201E\u201F\u2033\u2036]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"...").replace(/\u02C6/g,"^").replace(/\u2039/g,"").replace(/[\u02DC|\u00A0]/g," ")},String.prototype.toBool=function(){var a;return"true"===(a=(""+this).toLowerCase())||"1"===a},Boolean.prototype.toBool=function(){return""+this=="true"},Number.prototype.toBool=function(){return""+this=="1"},String.prototype.addSlashes=function(){return this.replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.containsObject=function(a){try{return"object"==typeof _.find(this,function(b){return _.isEqual(a,b)})}catch(a){return e=a,console.error("Please load underscore.js before using this."),console.info("https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js")}},Object.toArray=function(a){var b;try{return b=a.slice(0),b.push("foo"),a}catch(a){}return Object.keys(a).map(function(b){return function(b){return a[b]}}())},Object.size=function(a){var b,c;if("object"!=typeof a)try{return a.length}catch(a){e=a,console.error("Passed argument isn't an object and doesn't have a .length parameter"),console.warn(e.message)}c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},Object.doOnSortedKeys=function(a,b){var c,d,e,f,g,h;for(g=Object.keys(a).sort(),f=[],h=0,e=g.length;h<e;h++)d=g[h],c=a[d],f.push(b(c));return f},delay=function(a,b){return setTimeout(b,a)},interval=function(a,b){return setInterval(b,a)},roundNumber=function(a,b){var c;return null==b&&(b=0),c=Math.pow(10,b),Math.round(a*c)/c},roundNumberSigfig=function(a,b){var c,d,e,f,g;return null==b&&(b=0),e=""+roundNumber(a,b),c=e.split("."),1===c.length?e+"."+Array(b+1).join("0"):(g=c.pop(),f=c[0]+".",g.length===b?e:(d=b-g.length,g+=Array(d+1).join("0"),""+f+g))},String.prototype.stripHtml=function(a){var b;return null==a&&(a=!1),b=this,a&&(b=b.replace(/<(\w+)(?:[^"'>]|"[^"]*"|'[^']*')*>(?:((?:.)*?))<\/?\1(?:[^"'>]|"[^"]*"|'[^']*')*>/gm,"")),b=b.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),b=b.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"")},String.prototype.unescape=function(a){var b,c,d;return null==a&&(a=!1),c=document.createElement("div"),b=function(b){return null!=b&&"string"==typeof b&&(!0!==a?b=escape(b).replace(/%26/g,"&").replace(/%23/g,"#").replace(/%3B/g,";"):(b=b.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),b=b.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"")),c.innerHTML=b,c.innerText?(b=c.innerText,c.innerText=""):(b=c.textContent,c.textContent="")),unescape(b)},d=deEscape(this),b(d)},deEscape=function(a){return a=a.replace(/\&amp;#/gm,"&#"),a=a.replace(/\&quot;/gm,'"'),a=a.replace(/\&quote;/gm,'"'),a=a.replace(/\&#95;/gm,"_"),a=a.replace(/\&#39;/gm,"'"),a=a.replace(/\&#34;/gm,'"'),a=a.replace(/\&#62;/gm,">"),a=a.replace(/\&#60;/gm,"<")},String.prototype.escapeQuotes=function(){var a;return a=this.replace(/"/gm,"&#34;"),a=a.replace(/'/gm,"&#39;")},getElementHtml=function(a){return a.outerHTML},jQuery.fn.outerHTML=function(){return e=$(this).get(0),e.outerHTML},jQuery.fn.outerHtml=function(){return $(this).outerHTML()},buildQuery=function(a){var b,c,d,e,f;d=[];for(b in a)e=a[b],c=b.replace(/[^A-Za-z\-_\[\]]/gim,""),f=encodeURIComponent(e).replace(/\%20/g,"+"),d.push(c+"="+f);return d.join("&")},buildArgs=buildQuery,jQuery.fn.selectText=function(){var a,b,c=document,d=this[0];c.body.createTextRange?(a=document.body.createTextRange(),a.moveToElementText(d),a.select()):window.getSelection&&(b=window.getSelection(),a=document.createRange(),a.selectNodeContents(d),b.removeAllRanges(),b.addRange(a))},copyText=function(a,b,c){var d,e,f,g;if(null==window.copyDebouncer&&(window.copyDebouncer={}),Date.now()-window.copyDebouncer.last<300)return console.warn("Skipping copy on debounce"),!1;window.copyDebouncer.last=Date.now(),f=md5($(c).html());try{return e={dataType:"text/plain",data:a},d=new ClipboardEvent("copy",e),document.dispatchEvent(d),!1}catch(a){}return null!=(null!=(g=_adp.copyObject)?g[f]:void 0)?(e={"text/plain":a},console.info('Setting up clipboard events for "'+a+'"'),_adp.copyObject[f].setData(e),_adp.copyObject[f].on("copy",function(a){try{return a.clipboardData={setData:_adp.copyObject[f].setData(e)}}catch(a){}}),_adp.copyObject[f].on("aftercopy",function(b){return b.data["text/plain"]===a?(toastStatusMessage("Copied to clipboard"),console.info("Succesfully copied",b.data["text/plain"]),window.hasRetriedCopy=!1):b.data["text/plain"]?(console.warn("Incorrect copy: instead of '"+a+"', '"+b.data["text/plain"]+"'"),window.hasRetriedCopy?(console.error("Re-copy failed!"),toastStatusMessage("Error copying to clipboard. Please try again")):(window.hasRetriedCopy=!0,delete window.copyDebouncer.last,delay(100,function(){return console.warn("Re-trying copy"),$(c).click(),console.info("Sent click")}))):(console.error("Bad data passed",b.data["text/plain"]),toastStatusMessage("Error copying to clipboard. Please try again"),window.hasRetriedCopy=!1),window.resetClipboard=!1,_adp.copyObject[f].setData(e)}),_adp.copyObject[f].on("error",function(b){if(console.error("Error copying to clipboard"),console.warn("Got",b),"flash-overdue"===b.name){if(!0===window.resetClipboard)return console.error("Resetting ZeroClipboard didn't work!"),!1;ZeroClipboard.on("ready",function(){return window.resetClipboard=!0,copyLink(window.tempZC,a)}),window.tempZC=new ZeroClipboard(c)}if("flash-disabled"===b.name)return console.info("No flash on this system"),ZeroClipboard.destroy(),$(".click-copy").remove(),p$("paper-dialog").refit(),toastStatusMessage("Clipboard copying isn't available on your system")})):console.error("Can't copy: zcObject doesn't exist for identifier "+f),!1},bindCopyEvents=function(a){return null==a&&(a=".click-copy"),loadJS("bower_components/zeroclipboard/dist/ZeroClipboard.min.js",function(){var b,c,d,e,f,g,h,i,j;for(j={swfPath:"bower_components/zeroclipboard/dist/ZeroClipboard.swf"},ZeroClipboard.config(j),f=$(a),g=[],h=0,e=f.length;h<e;h++)if(c=f[h],d=md5($(c).html()),null==_adp.copyObject&&(_adp.copyObject={}),null==_adp.copyObject[d]){if(console.info("Setting up copy events for identifier",d),_adp.copyObject[d]=new ZeroClipboard(c),i=$(c).attr("data-clipboard-text"),isNull(i)&&(b=$(c).attr("data-copy-selector"),i=$(b).val(),isNull(i)))try{i=p$(b).value}catch(a){}console.info("Registering copy text",i);try{delete window.copyDebouncer.last}catch(a){}g.push(copyText(i,_adp.copyObject[d],c))}else g.push(console.info("Copy event already set up for identifier",d));return g}),!1},buildQuery=function(a){var b,c,d,e,f;d=[];for(b in a)e=a[b],c=b.replace(/[^A-Za-z\-_\[\]]/gim,""),f=encodeURIComponent(e).replace(/\%20/g,"+"),d.push(c+"="+f);return d.join("&")},jsonTo64=function(a,b){var c,d,e;null==b&&(b=!0);try{e=a.slice(0),e.push("foo"),a=toObject(a)}catch(a){}return d=JSON.stringify(a),c=!0===b?post64(d):encode64(c)},encode64=function(a){try{return Base64.encode(a)}catch(b){return e=b,console.warn("Bad encode string provided"),a}},decode64=function(a){try{return Base64.decode(a)}catch(b){return e=b,console.warn("Bad decode string provided"),a}},post64=function(a){var b;return b=encode64(a),encodeURIComponent(b)},jQuery.fn.polymerSelected=function(a,b){var c,d,f;if(null==a&&(a=void 0),null==b&&(b="attrForSelected"),c=$(this).attr(b),null==a){f=void 0;try{f=$(this).get(0).selected,isNumber(f)&&!isNull(c)&&(d=$(this).find("paper-item")[toInt(f)],f=$(d).attr(c))}catch(a){return e=a,!1}return"null"!==f&&null!=f||(f=void 0),f}if(isBool(a)){if($(this).parent().children().removeAttribute("aria-selected"),$(this).parent().children().removeAttribute("active"),$(this).parent().children().removeClass("iron-selected"),$(this).prop("selected",a),$(this).prop("active",a),$(this).prop("aria-selected",a),!0===a)return $(this).addClass("iron-selected")}else try{return $(this).get(0).select(a)}catch(a){return e=a,!1}},jQuery.fn.polymerChecked=function(a){var b;return null==a&&(a=void 0),null!=a?jQuery(this).prop("checked",a):(b=jQuery(this)[0].checked,"null"!==b&&null!=b||(b=void 0),b)},isHovered=function(a){return $(a+":hover").length>0},jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery.fn.isVisible=function(){return jQuery(this).is(":visible")&&"hidden"!==jQuery(this).css("visibility")},jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3},byteCount=function(a){return function(a){return encodeURI(a).split(/%..|./).length-1}}(),toObject=function(a){var b,c,d;d={};for(c in a)void 0!==(b=a[c])&&(d[c]=b);return d},loadJS=function(a,b,c){var d,f,g;if(null==b&&(b={}),null==c&&(c=!0),$("script[src='"+a+"']").exists()){if("function"==typeof b)try{b()}catch(a){e=a,console.error("Script is already loaded, but there was an error executing the callback function - "+e.message)}return!0}return g=document.createElement("script"),g.setAttribute("src",a),g.setAttribute("async","async"),g.setAttribute("type","text/javascript"),g.src=a,g.async=!0,f=function(){var c;c=g.readyState;try{if(!b.done&&(!c||/loaded|complete/.test(c))&&(b.done=!0,"function"==typeof b))try{return b()}catch(b){return e=b,console.error("Postload callback error for "+a+" - "+e.message),console.warn(e.stack)}}catch(a){return e=a,console.error("Onload error - "+e.message)}},d=function(){console.warn("There may have been a problem loading "+a);try{if(!b.done&&(b.done=!0,"function"==typeof b&&c))try{return b()}catch(a){return e=a,console.error("Post error callback error - "+e.message)}}catch(a){return e=a,console.error("There was an error in the error handler! "+e.message)}},g.setAttribute("onload",f),g.setAttribute("onreadystate",f),g.setAttribute("onerror",d),g.onload=g.onreadystate=f,g.onerror=d,document.getElementsByTagName("head")[0].appendChild(g),!0},String.prototype.toTitleCase=function(){var a,b,c,d,e,f,g,h,i,j,k;for(f=this.replace(/([^\W_]+[^\s-]*) */g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),e=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"],g=0,a=e.length;g<a;g++)c=e[g],d=RegExp("\\s"+c+"\\s","g"),f=f.replace(d,function(a){return a.toLowerCase()});for(k=["Id","Tv"],h=0,b=k.length;h<b;h++)i=k[h],j=RegExp("\\b"+i+"\\b","g"),f=f.replace(j,i.toUpperCase());return f},Function.prototype.getName=function(){var a;return a=this.name,null==a&&(a=(""+this).substr(0,(""+this).indexOf("(")).replace("function ","")),isNull(a)&&(a=md5(""+this)),a},Function.prototype.debounce=function(){var a,b,c,d,f,g,h,i;h=arguments[0],c=arguments[1],i=arguments[2],a=4<=arguments.length?slice.call(arguments,3):[],null==h&&(h=300),null==c&&(c=!1),null==i&&(i=window.debounce_timer),null==(null!=(g=window.core)?g.debouncers:void 0)&&(null==window.core&&(window.core={}),core.debouncers={});try{f=this.getName()}catch(a){}try{null!=core.debouncers[f]&&(i=core.debouncers[f])}catch(a){}if(d=this,b=function(){if(null!=f&&(clearTimeout(i),delete core.debouncers[f]),!c)return d.apply(d,a)},null!=i)try{clearTimeout(i)}catch(a){e=a}return c?(d.apply(obj,a),console.log("Executed "+f+" immediately"),!1):null!=f?core.debouncers[f]=delay(h,function(){return b()}):(console.log("Delaying '"+f+"' for "+h+" ms"),window.debounce_timer=delay(h,function(){return b()}))},randomInt=function(a,b){var c,d,e;return null==a&&(a=0),null==b&&(b=1),e=Math.random(),null==a&&(c=[0,a],a=c[0],b=c[1]),a>b&&(d=[b,a],a=d[0],b=d[1]),Math.floor(e*(b-a+1)+a)},randomString=function(a){var b,c,d,e,f;for(null==a&&(a=8),e=0,c=65,d=126,f=[];e<a;)++e,b=randomInt(c,d),f.push(String.fromCharCode(b));return f.join("")},animateLoad=function(a){var b;null==a&&(a="loader"),isNumber(a)&&(a="loader"),"#"===a.slice(0,1)?(b=a,a=a.slice(1)):b="#"+a;try{return $(b).exists()?$(b).attr("active",!0):$("body").append('<paper-spinner id="'+a+'" active></paper-spinner'),!1}catch(a){return e=a,console.log("Could not animate loader",e.message)}},startLoad=animateLoad,stopLoad=function(a,b){var c;null==a&&(a="loader"),null==b&&(b=1e3),"#"===a.slice(0,1)?(c=a,a=a.slice(1)):c="#"+a;try{if($(c).exists())return $(c).addClass("good"),delay(b,function(){return $(c).removeClass("good"),$(c).removeAttr("active")})}catch(a){return e=a,console.log("Could not stop load animation",e.message)}},stopLoadError=function(a,b,c){var d;null==b&&(b="loader"),null==c&&(c=1e4),"#"===b.slice(0,1)?(d=b,b=b.slice(1)):d="#"+b;try{if($(d).exists())return $(d).addClass("bad"),null!=a&&toastStatusMessage(a,"",c),delay(c,function(){return $(d).removeClass("bad"),$(d).removeAttr("active")})}catch(a){return e=a,console.log("Could not stop load error animation",e.message)}},toastStatusMessage=function(a,b,c,d){var e,f,g;if(null==b&&(b=""),null==c&&(c=3e3),null==d&&(d="#status-message"),null==(null!=(f=window.metaTracker)?f.isToasting:void 0)&&null==window.metaTracker&&(window.metaTracker={},window.metaTracker.toastTracker=[],window.metaTracker.isToasting=!1),window.metaTracker.isToasting)return g=delay(250,function(){return toastStatusMessage(a,b,c,d)}),window.metaTracker.toastTracker.push(g),!1;window.metaTracker.isToasting=!0,isNumber(c)||(c=3e3),!1===d.slice(0,1)&&(d="#"+d),$(d).exists()||(e='<paper-toast id="'+d.slice(1)+'" duration="'+c+'"></paper-toast>',$(e).appendTo("body")),$(d).attr("text",a).html(a).addClass(b);try{p$(d).show()}catch(a){}return delay(c+500,function(){var a;try{a=p$(d).opened}catch(b){a=!1}return a||($(d).empty(),$(d).removeClass(b),$(d).attr("text","")),window.metaTracker.isToasting=!1})},cleanupToasts=function(){var a,b,c,d,e;for(b=window.metaTracker.toastTracker,c=[],d=0,a=b.length;d<a;d++){e=b[d];try{c.push(clearTimeout(e))}catch(a){}}return c},openLink=function(a){return null!=a&&(window.open(a),!1)},openTab=function(a){return openLink(a)},goTo=function(a){return null!=a&&(window.location.href=a,!1)},mapNewWindows=function(a){var b,c,d,e;for(null==a&&(a=!0),e=[".newwindow",".newWindow",".new-window","[newwindow]","[new-window]"],d=0,b=e.length;d<b;d++)c=e[d],$(c).each(function(){var b;return b=$(this).attr("href"),null==b&&(b=$(this).attr("data-href")),$(this).click(function(c){return a&&(c.preventDefault(),c.stopPropagation()),openTab(b)}),$(this).keypress(function(){return openTab(b)})});return!1},deepJQuery=function(a){"undefined"!=typeof jQuery&&null!==jQuery||console.warn("Danger -- jQuery isn't defined. Selectors may fail.");try{if(!$("html /deep/ "+a).exists())throw"Bad /deep/ selector";return $("html /deep/ "+a)}catch(b){e=b;try{if(!$("html >>> "+a).exists())throw"Bad >>> selector";return $("html >>> "+a)}catch(b){return e=b,$(p$(a))}}},d$=function(a){return deepJQuery(a)},bindClicks=function(a){null==a&&(a=".click"),$(a).each(function(){var a,b,c,d,f,g,h,i;try{if(i=null!=(c=$(this).attr("data-href"))?c:$(this).attr("href"),!isNull(i)){try{h=$(this).prop("tagName").toLowerCase()}catch(a){h=null}try{i===uri.o.attr("path")&&"paper-tab"===h&&$(this).parent().prop("selected",$(this).index())}catch(a){e=a,console.warn("tagname lower case error")}return b=(null!=(d=$(this).attr("newTab"))?d.toBool():void 0)||(null!=(f=$(this).attr("newtab"))?f.toBool():void 0)||(null!=(g=$(this).attr("data-newtab"))?g.toBool():void 0),"a"!==h||b?("a"===h&&$(this).keypress(function(){return openTab(i)}),$(this).unbind().click(function(a){a.preventDefault(),a.stopPropagation();try{return b?openTab(i):goTo(i)}catch(a){return goTo(i)}}),i):!0}if(null!=(a=$(this).attr("data-function")))return $(this).unbind(),$(this).click(function(){var b;try{console.log("Executing bound function "+a+"()");try{b=null,isNull($(this).attr("data-args"))||(b=$(this).attr("data-args").split(","))}catch(a){}try{return null!=b?window[a].apply(window,b):window[a]()}catch(b){return window[a]()}}catch(b){return e=b,console.error("'"+a+"()' is a bad function - "+e.message)}})}catch(a){return e=a,console.error("There was a problem binding to #"+$(this).attr("id")+" - "+e.message)}});try{bindCollapsors()}catch(a){}return!1},bindCollapsors=function(a){var b,c,d,e,f;for(null==a&&(a=".collapse-trigger"),f=function(a){var b,c,d;return c=$(a).attr("data-target"),$(c).exists()?(d=["iron-collapse"],b=p$(c).tagName.toLowerCase(),indexOf.call(d,b)>=0?p$(c).toggle():console.error("Target type "+p$(c).tagName.toLowerCase()+" is an invalid target"),!1):(console.error("Couldn't find target "+c),!1)},c=$(a),d=0,b=c.length;d<b;d++)e=c[d],$(e).click(function(){return f.debounce(50,null,null,this)});return!1},dateMonthToString=function(a){var b,c;b={0:"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"};try{c=b[a]}catch(b){c=a}return c},getPosterFromSrc=function(a){var b;try{return b=a.split("."),b.pop(),b.push("png"),b.join(".")}catch(a){return e=a,""}},doCORSget=function(a,b,c,d){var f,g,h,i;null==c&&(c=void 0),null==d&&(d=void 0),f=function(){if("function"==typeof d)return d();throw Error("There was an error performing the CORS request")},h={url:a,data:b,type:"get",crossDomain:!0};try{$.ajax(h).done(function(a){return"function"==typeof c?(c(),!1):console.log(response)}).fail(function(a,b){return console.warn("Couldn't perform jQuery AJAX CORS. Attempting manually.")})}catch(a){e=a,console.warn("There was an error using jQuery to perform the CORS request. Attemping manually.")}if(a=a+"?"+b,g=function(a,b){var c;return null==a&&(a="get"),c=new XMLHttpRequest,"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c},!(i=g("get",a)))throw Error("CORS not supported");return i.onload=function(){var a;return a=i.responseText,"function"==typeof c&&c(a),console.log(a),!1},i.onerror=function(){return console.warn("Couldn't do manual XMLHttp CORS request"),f()},i.send(),!1},lightboxImages=function(a,b){var c,d;return null==a&&(a=".lightboximage"),null==b&&(b=!1),d={onStart:function(){return overlayOn()},onEnd:function(){return overlayOff(),activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif|bmp|webp",quitOnDocClick:!0,quitOnImgClick:!0},c=b?d$(a):$(a),loadJS("bower_components/imagelightbox/dist/imagelightbox.min.js",function(){return c.click(function(a){try{return a.preventDefault(),a.stopPropagation(),$(this).imageLightbox(d).startImageLightbox(),console.warn("Event propagation was stopped when clicking on this.")}catch(b){return a=b,console.error("Unable to lightbox this image!")}}).each(function(){var b,c;console.log("Using selectors '"+a+"' / '"+this+"' for lightboximages");try{if("img"===$(this).prop("tagName").toLowerCase()&&"a"!==$(this).parent().prop("tagName").toLowerCase())return c=$(this).removeClass("lightboximage").prop("outerHTML"),b=function(){switch(!1){case!!isNull($(this).attr("data-layzr-retina")):return $(this).attr("data-layzr-retina");case!!isNull($(this).attr("data-layzr")):return $(this).attr("data-layzr");case!!isNull($(this).attr("data-lightbox-image")):return $(this).attr("data-lightbox-image");default:return $(this).attr("src")}}.call(this),$(this).replaceWith("<a href='"+b+"' class='lightboximage'>"+c+"</a>"),$("a[href='"+b+"']").imageLightbox(d)}catch(a){return e=a,console.log("Couldn't parse through the elements")}}),console.info("Lightboxed the following:",c)})},activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")},activityIndicatorOff=function(){return $("#imagelightbox-loading").remove(),$("#imagelightbox-overlay").click(function(){return $("#imagelightbox").click()})},overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")},overlayOff=function(){return $("#imagelightbox-overlay").remove()},formatScientificNames=function(a){return null==a&&(a=".sciname"),$(".sciname").each(function(){var a;return a="italic"===$(this).css("font-style")?"normal":"italic",$(this).css("font-style",a)})},prepURI=function(a){return a=encodeURIComponent(a),a.replace(/%20/g,"+")},window.locationData={},locationData.params={enableHighAccuracy:!0},locationData.last=void 0,getLocation=function(a){var b,c,d;return null==a&&(a=void 0),d=1500,c=function(b){var c;return clearTimeout(window.geoTimeout),window.locationData.lat=b.coords.latitude,window.locationData.lng=b.coords.longitude,window.locationData.acc=b.coords.accuracy,c=window.locationData.last,window.locationData.last=Date.now(),!(window.locationData.last-c<d)&&(console.info("Successfully set location"),"function"==typeof a&&a(window.locationData),!1)},b=function(b){var c;return clearTimeout(window.geoTimeout),c=function(){switch(b.code){case 0:return"There was an error while retrieving your location: "+b.message;case 1:return"The user prevented this page from retrieving a location";case 2:return"The browser was unable to determine your location: "+b.message;case 3:return"The browser timed out retrieving your location."}}(),console.error(c),"function"==typeof a&&a(!1),!1},navigator.geolocation?(console.log("Querying location"),navigator.geolocation.getCurrentPosition(c,b,window.locationData.params),window.geoTimeout=delay(1500,function(){return getLocation(a)})):(console.warn("This browser doesn't support geolocation!"),null!=a?a(!1):void 0)},getMaxZ=function(){var a;return a=function(){return $.map($("body *"),function(a,b){if("static"!==$(a).css("position"))return parseInt($(a).css("z-index")||1)})},Math.max.apply(null,a())},foo=function(){return toastStatusMessage("Sorry, this feature is not yet finished"),stopLoad(),!1},safariDialogHelper=function(a,b,c){var d,f;if(null==a&&(a="#download-chooser"),null==b&&(b=0),"function"!=typeof c&&(c=function(){return bindDismissalRemoval()}),!(b<10))return stopLoadError("Unable to show dialog. Please try again.");try{return d$(a).get(0).open(),delay(125,function(){return d$(a).get(0).refit()}),"function"==typeof c&&c(),stopLoad()}catch(g){return e=g,f=b+1,d=250,delay(d,function(){return console.warn("Trying again to display dialog after "+f*d+"ms"),safariDialogHelper(a,f,c)})}},bindDismissalRemoval=function(){return $("[dialog-dismiss]").unbind().click(function(){return $(this).parents("paper-dialog").remove()})},p$=function(a){try{return $$(a)[0]}catch(b){return $(a).get(0)}},bsAlert=function(a,b,c,d){var e,f;return null==b&&(b="warning"),null==c&&(c="body"),null==d&&(d="#bs-alert"),$(d).exists()?($(d).removeClass("alert-warning alert-info alert-danger alert-success"),$(d).addClass("alert-"+b)):(e='<div class="alert alert-'+b+' alert-dismissable hanging-alert" role="alert" id="'+d.slice(1)+'">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <div class="alert-message"></div>\n</div>',f=$("main").exists()?"main":$("article").exists()?"article":c,$(f).prepend(e)),$(d+" .alert-message").html(a),bindClicks(),mapNewWindows(),!1},animateHoverShadows=function(a,b,c){var d,e;return null==a&&(a="paper-card.card-tile"),null==b&&(b=2),null==c&&(c=4),d=function(){return $(this).attr("elevation",c)},e=function(){return $(this).attr("elevation",b)},$(a).hover(d,e),!1},allError=function(a){return stopLoadError(a),bsAlert(a,"danger"),console.error(a),!1},checkFileVersion=function(a,b,c){var d,e,f;null==a&&(a=!1),null==b&&(b="js/c.min.js"),null==("undefined"!=typeof _adp&&null!==_adp?_adp.lastModChecked:void 0)&&(null==window._adp&&(window._adp={}),window._adp.lastModChecked={}),e=b.split("/").pop().split(".")[0],d=function(f,g){return null==f&&(f=b),null==g&&(g=e),$.get(uri.urlString+"meta.php","do=get_last_mod&file="+f,"json").done(function(b){var c;return window._adp.lastModChecked[g]=Date.now(),a&&doNothing(),!!isNumber(b.last_mod)&&(null==_adp.lastMod&&(window._adp.lastMod={}),null==_adp.lastMod[g]&&(window._adp.lastMod[g]=b.last_mod),b.last_mod>_adp.lastMod[g]?(c='<div id="outdated-warning" class="alert alert-warning alert-dismissible fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>We have page updates!</strong> This page has been updated since you last refreshed. <a class="alert-link" id="refresh-page" style="cursor:pointer">Click here to refresh now</a> and get bugfixes and updates.\n</div>',$("#outdated-warning").exists()||($("body").append(c),$("#refresh-page").click(function(){return document.location.reload(!0)})),console.warn("Your current version of this page is out of date! Please refresh the page.")):a?doNothing():void 0)}).fail(function(){return console.warn("Couldn't check file version!!")}).always(function(){if(delay(3e5,function(){return d(f,g)}),"function"==typeof c)return c()})};try{f=window._adp.lastMod[e]}catch(a){f=!1}if(a||null==window._adp.lastMod||!f){try{Date.now()-toInt(window._adp.lastModChecked[e])<15e3||d(b,e)}catch(a){d(b,e)}return!0}return!1},window.checkFileVersion=checkFileVersion,fixTruncatedJson=function(a){var b,c,d,e,f;for(c=a,b=c,e=!1,d=!1,f=[];d=b.match(/[^\{\[\]\}"]*([\{\[\]\}"])/);){switch(d[1]){case"{":f.push("}");break;case"[":f.push("]");break;case"}":case"]":f.pop();break;case'"':e?(e=!1,f.pop()):(e=!0,f.push('"'))}b=b.substring(d[0].length)}for(":"===b[b.length-1]&&(c+='""');f.length;)c+=f.pop();try{return JSON.parse(c)}catch(a){return!1}},checkLoggedIn=function(a){var b,c,d,e,f;return c=$.cookie(uri.domain+"_auth"),f=$.cookie(uri.domain+"_secret"),d=$.cookie(uri.domain+"_link"),b="hash="+c+"&secret="+f+"&dblink="+d,e=uri.urlString+"admin/async_login_handler.php",$.post(e,b,"json").done(function(b){return console.info("Got",b),a(b)}).fail(function(b,c){var d;return d={status:!1},a(d)}),!1},doNothing=function(){return null},downloadCSVFile=function(a,b,c){var d,f;try{d={action:"csv",data:a,options:b},f=new Worker("js/global-search-worker.min.js"),console.info("Generating an off-thread worker for CSV population"),f.addEventListener("message",function(a){var d,e,f;if(e=a.data.html,d=a.data.file,b=a.data.options,console.info("CSV Web worker returned",a.data),f=function(){var a;return a=b.selector,!0!==b.create||$(a).exists()?$(a).attr("download",b.downloadFile).attr("href",d).removeClass("disabled").removeAttr("disabled"):$(a).append(e),!1},"function"!=typeof c)return f();try{return c(function(){return f()})}catch(a){return f()}}),
f.postMessage(d)}catch(c){e=c,console.warn("Web workers aren't supported or otherwise failed"),console.warn(e.message),console.warn("Doing work on-thread"),downloadCSVFileOnThread(a,b)}return!1},downloadCSVFileOnThread=function(a,b){var c,d,f,g,h,i,j,k,l,m,n,o,p,q,r;if(r="",isJson(a))console.info("Parsing as JSON string"),l=JSON.parse(a);else if(isArray(a))console.info("Parsing as array"),l=toObject(a);else{if("object"!=typeof a)return console.error("Unexpected data type '"+typeof a+"' for downloadCSVFile()",a),!1;console.info("Parsing as object"),l=a}for(null==b&&(b={}),null==b.create&&(b.create=!1),null==b.downloadFile&&(b.downloadFile="datalist.csv"),null==b.classes&&(b.classes="btn btn-default"),null==b.buttonText&&(b.buttonText="Download File"),null==b.iconHtml&&(b.iconHtml='<iron-icon icon="icons:cloud-download"></iron-icon>'),null==b.selector&&(b.selector="#download-file"),null==b.splitValues&&(b.splitValues=!1),null==b.cascadeObjects&&(b.cascadeObjects=!1),null==b.objectAsValues&&(b.objectAsValues=!0),h=[],(o=function(c,d){var f,g,i,j,k,l,m,n,p,q,s,t;n=0,b.objectAsValues&&(b.splitValues="::@@::"),m=[];for(k in c)if("function"!=typeof(t=c[k])){++n;try{if(i=(""+k).replace(/"/g,'""'),1===n)if(b.objectAsValues){console.info("objectAsValues set");for(f in t)a=t[f],isArray(b.acceptableCols)?indexOf.call(b.acceptableCols,f)>=0&&h.push(f):h.push(f);console.log("Using as header",h)}else console.log("Boring options",b.objectAsValues,b),h.push(i);if("object"==typeof t&&d&&(t=o(t,!0)),j=function(a,c){var d,e,f,g;return null==a&&(a=t),null==c&&(c=b),isNull(t)?d="":("object"==typeof a&&(a=JSON.stringify(a)),a=""+a,e=a.replace(/"/g,'""'),e=e.replace(/,/g,","),e=e.replace(/<\/p><p>/g,'","'),"string"==typeof c.splitValues&&(f=e.split(c.splitValues),e=f.join('","'),i=!1),d=e),!1===i?g='"'+d+'"\n':isNumber(i)?g='"'+d+'",':isNull(i)||(g='"'+i+'","'+d+'"\n'),g},b.objectAsValues){for(q=[],p=0,l=h.length;p<l;p++){if(f=h[p],"object"==typeof(g=t[f]))try{g=JSON.stringify(g),g=g.replace(/"/g,'""')}catch(a){}q.push(g)}s=q.join(b.splitValues),m.push(r+=j(s,b))}else m.push(r+=j(t))}catch(a){e=a,console.warn("Unable to run key "+k+" on row "+n,t,c),m.push(console.warn(e.stack))}}return m})(l,b.cascadeObjects),r=r.trim(),m=0,q=0,n=h.length;q<n;q++)d=h[q],d=d.replace(/"/g,'""'),h[m]=d,++m;return b.objectAsValues&&(b.header=h),isArray(b.header)?(i=b.header.join('","'),r='"'+i+'"\n'+r,r=r.trim(),g="present"):g="absent",","===r.slice(-1)&&(r=r.slice(0,-1)),f="data:text/csv;charset=utf-8;header="+g+","+encodeURIComponent(r),p=b.selector,!0===b.create?(c=$(p).find("button").length,k=p.slice(1)+"-download-button-"+c,j='<a id="'+k+'" class="'+b.classes+'" href="'+f+'" download="'+b.downloadFile+'">\n  '+b.iconHtml+"\n  "+b.buttonText+"\n</a>",$(p).append(j)):$(p).attr("download",b.downloadFile).attr("href",f),f},linkUsers=function(a){var b,c;return null==a&&(a=".is-user"),c="https://amphibiandisease.org/profile.php",b="?id=",$(a).addClass("linked-user-profile").attr("title","Visit Profile").attr("data-toggle","tooltip").click(function(){var a,d,e,f,g,h,i;if(i=$(this).attr("data-uid"),h=$(this).attr("data-email"),!isNull(i))return e=""+c+b+i,document.location.href=e,!1;if(isNull(h)){if(g=$(this).text(),isNull(g)&&(g=$(this).attr("data-name"),isNull(g)))return console.error("Unable to find a search criterion!"),!1;d="name"}else g=h,d="username,alternate_email";return startLoad(),f=encodeURIComponent(g),a="action=search_users&q="+f+"&cols="+d,$.post(uri.urlString+"api.php",a,"json").done(function(a){var d,f,h;return console.info("Found",a),!0!==a.status?(console.error("Error searching for profile"),stopLoadError("There was an error looking up the user. Please try again later."),!1):(f=Object.toArray(a.result),f.length<1?(stopLoadError("Couldn't find user '"+g+"'"),!1):(stopLoad(),d=f[0],h=d.uid,e=""+c+b+h,document.location.href=e,!1))}).fail(function(a,b){return console.error(a,b),stopLoadError("Error communicating with server. Please try again later."),!1}),!1}),!1},fetchCitation=function(a,b){var c,d;return c="https://api.crossref.org/works/",encodeURIComponent(a),d=""+c+a,$.get(d,"","json").done(function(c){var d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;for(console.info("Citation base",c),s=c.message,h=[],o=0,f=", ",x=s.author,G=0,t=x.length;G<t;G++){for(d=x[G],q=d.given.split(" "),p="",H=0,u=q.length;H<u;H++)n=q[H],v=n.slice(0,1),p+=v;if(g=d.family+" "+p,h.push(g),++o>2){++o,h.push("et al");break}}2===o&&(f=" and "),w=null!=(y=null!=(z=null!=(A=s["published-print"])&&null!=(B=A["date-parts"])&&null!=(C=B[0])?C[0]:void 0)?z:null!=(D=s["published-online"])&&null!=(E=D["date-parts"])&&null!=(F=E[0])?F[0]:void 0)?y:"In press",r=isNull(s.issue)?"":"("+s.issue+")",isNull(s.volume)&&(s.volume=""),J=isNull(s.volume)&&isNull(r)?"":""+s.volume+r+":";try{try{k=s.DOI,m=k.replace(/[^0-9]/gm,""),l=m.slice(-8),j=" "+l+"; doi: "+k}catch(a){j=s.page+"."}i=h.join(f)+". "+w+" "+s.title[0]+". "+s["container-title"][0]+" "+J+j}catch(a){e=a,console.warn("Couldn't generate full citation"),console.warn(s),i=h.join(", ")+". "+s.title[0]+". "+s["container-title"][0]+". In press."}if(console.log(i),"function"==typeof b){try{I=isNull(s.URL)?s.link[0].URL:s.URL,-1!==I.search("http:")&&(I=I.replace(/^(http):\/\/(([a-z0-9]+\.?)+)(.*)$/g,"https://$2$4"))}catch(b){I="https://dx.doi.og/"+a}try{b(i,I)}catch(a){e=a,console.error("Callback failed, couldn't display citation - "+e.message),console.warn(e.stack),stopLoadError("Failed to display citation")}}return!1}).fail(function(a,b){return console.error("Failed to fetch citation"),stopLoadError("Failed to fetch citation")}),!1},cancelAsyncOperation=function(a,b){null==b&&(b=_adp.currentAsyncJqxhr);try{null!=a&&$(a).remove()}catch(a){}try{if(b.readyState===XMLHttpRequest.DONE)return console.warn("Couldn't cancel operation -- it's already completed"),!1;b.abort();try{stopLoadBarsError(null,"Operation Cancelled")}catch(a){stopLoadError("Operation Cancelled")}}catch(a){console.error("Couldn't abort current async operation")}return!1},generateCSVFromResults=function(a,b,c){var d,f;null==c&&(c="#modal-sql-details-list"),f=Date.now(),console.info("Source CSV data:",a),d={objectAsValues:!0,downloadFile:"adp-global-search-result-data_"+Date.now()+".csv"};try{downloadCSVFile(a,d,function(a){var d,g;if($("#download-file").remove(),g='<a tabindex="-1" id="download-file" class="paper-button-link">\n  <paper-button disabled>\n    <iron-icon icon="icons:cloud-download"></iron-icon>\n    Download File\n  </paper-button>\n</a>',$(b).replaceWith(g),$(c+" #download-file paper-button").removeAttr("disabled"),"function"==typeof a)try{a()}catch(a){e=a,console.warn("Couldn't run postCallbacak after downloadCSV file -- "+e.message)}return d=Date.now()-f,console.debug("GenerateCSVFromResults completed in "+d+"ms"),stopLoad()})}catch(a){animateLoad(),stopLoadError("Sorry, there was a problem with this dataset and we can't generate a downloadable file.")}return!1},validateAWebTaxon=function(a,b){var c,d,e;return null==b&&(b=null),null==(null!=(e=window.validationMeta)?e.validatedTaxons:void 0)&&("object"!=typeof window.validationMeta&&(window.validationMeta={}),window.validationMeta.validatedTaxons=[]),d=function(a){return"function"==typeof b&&b(a),!1},window.validationMeta.validatedTaxons.containsObject(a)?(console.info("Already validated taxon, skipping revalidation",a),d(a),!1):(c="action=validate&genus="+a.genus+"&species="+a.species,null!=a.subspecies&&(c+="&subspecies="+a.subspecies),_adp.currentAsyncJqxhr=$.post("api.php",c,"json").done(function(b){return b.status?(a.genus=b.validated_taxon.genus,a.species=b.validated_taxon.species,a.subspecies=b.validated_taxon.subspecies,null==a.clade&&(a.clade=b.validated_taxon.family),window.validationMeta.validatedTaxons.push(a)):a.invalid=!0,a.response=b,d(a),!1}).fail(function(b,c){var d;return d=a.genus+" "+a.species,d=null!=a.subspecies?d+" "+a.subspecies:d,bsAlert("<strong>Problem validating taxon:</strong> "+d+" couldn't be validated."),console.warn("Warning: Couldn't validated "+d+" with AmphibiaWeb")}),!1)},makePageCitationOverflow=function(){var a,b,c,d,e,f,g,h,i,j,k;for(j=["project_id","id","projectid"],k=0,f=j.length;k<f;k++)if(i=j[k],!isNull(uri.o.param(i)))return console.info("Not creating overflow citation - page is project-specific"),!1;if("admin-login.php"===uri.o.data.seg.path[0])return!1;c=new Date,h=dateMonthToString(c.getMonth()),b="AmphibiaWeb. "+c.getUTCFullYear()+". "+$("title").text()+" &lt;"+uri.o.data.attr.source+"&gt;. University of California, Berkeley, CA, USA. Accessed "+c.getUTCDate()+" "+h+" "+c.getUTCFullYear()+".",a='<paper-dialog id="page-citation" modal>\n  <h2>Citation</h2>\n  <paper-dialog-scrollable>\n    <div>\n      <p style="opacity:0">\n        '+b+'\n      </p>\n      <paper-input value="'+b.escapeQuotes()+'" label="Citation" readonly></paper-input>\n    </div>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Close</paper-button>\n  </div>\n</paper-dialog>',e="dialog-trigger-item";try{d=document.createElement("paper-item"),d.setAttribute("id",e),d.textContent="Show Citation",g=p$("header paper-menu"),Polymer.dom(g).appendChild(d)}catch(a){d='<paper-item id="'+e+'">\n  Show Citation\n</paper-item>',$("header paper-menu-button .paper-menu").append(d)}return $("#page-citation").remove(),$("body").append(a),delay(250,function(){return $("#"+e).click(function(){return console.debug("Clicked trigger item"),p$("#page-citation").open()})}),b},delayPolymerBind=function(a,b,c){var d,f,g,h;if(null==c&&(c=0),"object"!=typeof window._dpb&&(window._dpb={}),h=md5(a)+md5(b),isNull(window._dpb[h])&&(window._dpb[h]=!1),g=1e3,null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(f=Polymer.Base)?f.$$:void 0)){!1===window._dpb[h]&&(c=0,window._dpb[h]=!0);try{d=Polymer.Base.$$(a),b(d),delay(g,function(){return console.info("Doing "+g+"ms delay callback for "+a),b(d)})}catch(f){e=f,console.warn("Error trying to do the delayed polymer bind - "+e.message),c<10?(++c,delay(75,function(){return delayPolymerBind(a,b,c)})):(console.error("Persistent error in polymer binding ("+e.message+")"),console.error(e.stack),d=$(a).get(0),b(d),delay(g,function(){return d=document.querySelector(a),console.info("Doing "+g+"ms delay callback for "+a),console.info("Using element",d),b(d)}))}}else c<50?delay(100,function(){return++c,delayPolymerBind(a,b,c)}):(console.error("Failed to verify Polymer was set up, attempting manual"),d=document.querySelector(a),b(d));return!1},$(function(){bindClicks(),formatScientificNames(),lightboxImages(),animateHoverShadows(),checkFileVersion(),linkUsers();try{$(".do-mailto").click(function(){var a;return a=$(this).attr("data-email"),document.location.href="mailto:"+a,!1})}catch(a){}try{$("body").tooltip({selector:"[data-toggle='tooltip']"})}catch(a){e=a,console.warn("Tooltips were attempted to be set up, but do not exist")}try{checkAdmin(),!0===("undefined"!=typeof adminParams&&null!==adminParams?adminParams.loadAdminUi:void 0)?loadJS("js/admin.js",function(){return console.info("Loaded admin file"),loadAdminUi()}):console.info("No admin setup requested"),$("header .header-bar-user-name").click(function(){return goTo(uri.urlString+"profile.php")})}catch(a){}loadJS(uri.urlString+"js/prism.js");try{makePageCitationOverflow()}catch(a){}try{return delay(500,function(){return setupDebugContext()})}catch(a){}}),uri.domain=uri.o.attr("host").split(".").reverse().pop(),cartoAccount="mvz",gMapsApiKey="AIzaSyAZvQMkfFkbqNStlgzNjw1VOWBASd74gq4",cartoMap=null,cartoVis=null,defaultFillColor="#ff7800",defaultFillOpacity=.35,adData={},window.geo={},geo.GLOBE_WIDTH_GOOGLE=256,geo.initLocation=function(){try{return window.locationData.lat=37.871527,window.locationData.lng=-122.262113,getLocation(function(){return _adp.currentLocation=new Point(window.locationData.lat,window.locationData.lng)})}catch(a){}},geo.init=function(a){var b;try{window.locationData.lat=37.871527,window.locationData.lng=-122.262113,getLocation(function(){return _adp.currentLocation=new Point(window.locationData.lat,window.locationData.lng)})}catch(a){}return b='<link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />',$("head").append(b),null==a&&(a=function(){return getCanonicalDataCoords(geo.dataTable),!1}),window.gMapsCallback=function(){return a()},speculativeApiLoader()},speculativeApiLoader=function(){var a,b,c;if(!isNull("undefined"!=typeof google&&null!==google&&null!=(c=google.maps)?c.Geocoder:void 0))return a=function(){var a;if(!isNull("undefined"!=typeof google&&null!==google&&null!=(a=google.maps)?a.Geocoder:void 0)){try{console.debug("API element was insufficient. Loading direct API")}catch(a){}return loadJS("https://maps.googleapis.com/maps/api/js?key="+gMapsApiKey+"&callback=gMapsCallback")}},$("google-maps-api").exists()?a():(b='<google-maps-api\n  api-key="'+gMapsApiKey+'" >\n</google-maps-api>',$("head").append(b),$("google-maps-api").on("api-load",function(){try{return window.gMapsCallback()}catch(a){}}),delay(300,function(){return a()}));try{return window.gMapsCallback()}catch(a){}},getMapCenter=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(null==a&&(a=geo.canonicalBoundingBox),null!=a){for(g=0,k=0,l=0,b=Object.toArray(a),j=0,h=b.length;j<h;j++)f=b[j],++g,i=canonicalizePoint(f),k+=i.lat,l+=i.lng;d=toFloat(k)/toFloat(g),e=toFloat(l)/toFloat(g),c={lat:d,lng:e}}else c={lat:window.locationData.lat,lng:window.locationData.lng};return c=canonicalizePoint(c)},getCorners=function(a){var b,c,d,e,f,g,h,i,j,k;for(h=[],f=-90,i=90,k=180,b=-180,d=0,j=0,e=a.length;j<e;j++)g=a[j],0===d&&console.debug("Sample point:",g),++d,g.lat>f&&(f=g.lat),g.lng>b&&(b=g.lng),g.lng<k&&(k=g.lng),g.lat<i&&(i=g.lat);return c={lat:f,lng:k},h.push(c),c={lat:f,lng:b},h.push(c),c={lat:i,lng:b},h.push(c),c={lat:i,lng:k},h.push(c),c={lat:f,lng:k},h.push(c),h},getPointsFromBoundingBox=function(a,b){var c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;for(null==b&&(b=!1),z=["n","e","w","s"],m=!1,x=0,o=z.length;x<o;x++)if(l=z[x],n="bounding_box_"+l,isNull(a[n])||0===toInt(a[n])){m=!0;break}if(m){if("object"!=typeof(i=a.carto_id))try{g=JSON.parse(deEscape(i))}catch(a){e=a,e.message;try{g=JSON.parse(i)}catch(a){if(e=a,i.length>511&&"object"==typeof(h=fixTruncatedJson(i))&&(console.debug("The carto data object was truncated, but rebuilt."),g=h),isNull(g))return console.error("Couldn't get bounding points: cartoObj must be JSON string or obj"),!1}}else g=i;if(f=null!=(u=g.bounding_polygon)?u:g["bounding&#95;polygon"],isNull(f))return console.error("Bad bounding box set, and not a projectData object"),!1;if(isNull(f.multibounds))return console.error("Project objects with no intrinsic bounding box and no multibounds are not supported yet"),!1;for(console.debug("Using multibound coordinate assignment"),d=[],v=f.multibounds,A=0,p=v.length;A<p;A++)s=v[A],y=getCorners(s),console.debug("Poly got corners "+JSON.stringify(y),y),d.push(y);for(w=[],B=0,q=d.length;B<q;B++)c=d[B],w=w.concat(c);k=getCorners(w)}else k=[[a.bounding_box_n,a.bounding_box_w],[a.bounding_box_n,a.bounding_box_e],[a.bounding_box_s,a.bounding_box_e],[a.bounding_box_s,a.bounding_box_w]];for(t=[],C=0,r=k.length;C<r;C++)j=k[C],console.log("Pushing corner",j),t.push(canonicalizePoint(j));return t},null==geo.mapSelector&&(geo.mapSelector="#transect-viewport"),getMapZoom=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;if(null==b&&(b=geo.mapSelector),null==c&&(c=!0),D=$(window).width()<1024?1:2,null!=a){g=-180,y=180,o=-90,x=90,isArray(a)&&(a=toObject(a)),console.info("Working with dataset",a),Object.size(a)<3&&console.warn("Danger: Very small dataset");for(h in a)f=a[h],j=null!=f.lng?f.lng:f[1],i=null!=f.lat?f.lat:f[0],j<y&&(y=j),j>g&&(g=j),i<x&&(x=i),i>o&&(o=i);for(e=g-y,q=o-x;e<0;)e+=360;for(;q<0;)q+=360;$(b).exists()||console.warn("Can't find '"+b+"' - will use 650x480"),n=null!=(t=$(b).width())?t:650,l=null!=(u=$(b).height())?u:480,d=360/e,m=d/geo.GLOBE_WIDTH_GOOGLE,p=360/q,r=p/geo.GLOBE_WIDTH_GOOGLE,E=Math.log(n*m)/Math.LN2,s=Math.log(l*r)/Math.LN2,console.info("Calculated raw zoom",E,s),console.info("Sources",n,m,Math.LN2),s<D&&(s=100),E<D&&(E=100),z=s<E?s:E,(D>z||z>20)&&(z=7.5),A=toInt(z),console.log("Diff between zoomBasis vs zoomCalc",z-A),v=.6,w=16,B=v/w,C=B*z,z-A<C&&--A}else A=7;if(c&&$(b).exists()&&"google-map"===$(b).get(0).tagName.toLowerCase()){console.log("Trying to assign zoom");try{k=p$(b),k.isAttached?(console.info("Setting zoom on "+b+" to "+A),k.zoom=A,k.ready=function(){return k.zoom=A}):(console.info("Deferring till ready"),$(b).on("google-map-ready",function(){return k.zoom=A}))}catch(a){console.warn("Zoom setting failed!")}}return A},geo.getMapZoom=getMapZoom,defaultMapMouseOverBehaviour=function(a,b,c,d,e){return console.log(a,b,c,d,e)},createMap2=function(a,b,c){var d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;console.log("createMap2 was provided options:",b),null==b&&(b={},b={polyParams:{fillColor:defaultFillColor,fillOpacity:defaultFillOpacity},classes:"",onClickCallback:null,skipHull:!1,skipPoints:!1,boundingBox:null,selector:"#carto-map-container",bsGrid:"col-md-9 col-lg-6",resetMapBuilder:!0,onlyOne:!0}),M=null!=b.selector?b.selector:"#carto-map-container",isNull(b.onlyOne)&&(b.onlyOne=!0);try{if(G=null!=(null!=b&&null!=(I=b.polyParams)?I.fillColor:void 0)&&null!=(null!=b&&null!=(J=b.polyParams)?J.fillOpacity:void 0)?b.polyParams:{fillColor:defaultFillColor,fillOpacity:defaultFillOpacity},console.info("createMap2 working with data",a),Object.size(a)<3){try{E=Object.toArray(a)}catch(a){E=[]}if(F=[],b.skipHull=!0,0===E.length)b.skipPoints=!0;else for(P=0,r=E.length;P<r;P++)C=E[P],console.log("Checking",C,"in",E),F.push(canonicalizePoint(C));if(null!=b.boundingBox){if(null!=b.boundingBox.nw)F.push(canonicalizePoint(b.boundingBox.nw)),F.push(canonicalizePoint(b.boundingBox.ne)),F.push(canonicalizePoint(b.boundingBox.sw)),F.push(canonicalizePoint(b.boundingBox.se));else for(K=b.boundingBox,S=0,s=K.length;S<s;S++)C=K[S],F.push(canonicalizePoint(C));m=createConvexHull(F),b.skipHull=!1}}else i=createConvexHull(a,!0),m=i.hull,F=i.points;console.info("createMap2 working with",F);try{V=getMapZoom(F,M),console.info("Got zoom",V)}catch(a){V=""}if(!0!==b.skipHull){for(v='<google-map-poly closed fill-color="'+G.fillColor+'" fill-opacity="'+G.fillOpacity+'" stroke-weight="1">',T=0,t=m.length;T<t;T++)C=m[T],v+='<google-map-point latitude="'+C.lat+'" longitude="'+C.lng+'"> </google-map-point>';v+="    </google-map-poly>"}else v="";if(!0!==b.skipPoints){for(n=0,U=0,u=F.length;U<u;U++){C=F[U],z="",A="";try{null!=a[n].infoWindow?(q=a[n].infoWindow,A=escape(null!=(L=q.title)?L:""),z=q.html,null!=a[n].data?(D=a[n].data,j=null!=D.diseasedetected?D.diseasedetected:D.diseaseDetected,null!=D.catalognumber?D.catalognumber:D.catalogNumber,N=null!=D.specificepithet?D.specificepithet:D.specificEpithet,O=null!=D.infraspecificepithet?D.infraspecificepithet:D.infraspecificeEpithet,null==O&&(O=""),isNull(A)&&D.genus):j=""):null!=a[n].data&&(D=a[n].data,k=D.genus,N=null!=D.specificepithet?D.specificepithet:D.specificEpithet,B=null!=D.originaltaxa?D.originaltaxa:D.originalTaxa,j=null!=D.diseasedetected?D.diseasedetected:D.diseaseDetected,R=null!=D.diseasetested?D.diseasetested:D.diseaseTested,null==k&&(k="No Data"),null==N&&(N=""),B=isNull(B)?"":"("+B+")",Q=null!=j&&null!=R?"<br/> Tested <strong>"+j+"</strong> for "+R:"",z="<p>\n  <em>"+k+" "+N+"</em> "+B+"\n  "+Q+"\n</p>",null==D.catalogNumber&&null==D.catalognumber||(f=null!=D.catalognumber?D.catalognumber:D.catalogNumber,O=null!=D.infraspecificepithet?D.infraspecificepithet:D.infraspecificEpithet,A=f+": "+k+" "+N))}catch(a){}C=canonicalizePoint(C),y='<google-map-marker latitude="'+C.lat+'" longitude="'+C.lng+'" data-disease-detected="'+j+'" title="'+A+'" animation="DROP">\n  '+z+"\n</google-map-marker>",v+=y}g=getMapCenter(F)}else{if(null==window.locationData)try{window.locationData.lat=37.871527,window.locationData.lng=-122.262113,getLocation(function(){return _adp.currentLocation=new Point(window.locationData.lat,window.locationData.lng)})}catch(a){}g=new Point(window.locationData.lat,window.locationData.lng),V=14}if(w=null!=geo.googleMap?'map="geo.googleMap"':"",p=$("google-map").length,o="transect-viewport-"+p,x="#"+o,null!=(null!=b?b.classes:void 0)?("object"==typeof b.classes?(d=Object.toArray(b.classes),h=d.join(" ")):h=b.classes,h=escape(h)):h="",l='<google-map id="'+o+'" latitude="'+g.lat+'" longitude="'+g.lng+'" map-type="hybrid" click-events  zoom="'+V+'" class="col-xs-12 '+b.bsGrid+" center-block clearfix google-map transect-viewport map-viewport "+h+'" api-key="'+gMapsApiKey+'" '+w+">\n      "+v+"\n</google-map>",!0===b.onlyOne&&(M=$("google-map").get(0)),!$(M).exists()){try{console.debug("Selector does not exist:",M)}catch(a){}M="#carto-map-container",$(M).exists()||(M="body")}"google-map"!==$(M).get(0).tagName.toLowerCase()?(console.log("Appending map to selector "+M,$(M)),$(M).addClass("map-container has-map").append(l)):(console.log("Replacing map at selector "+M),$(M).replaceWith(l)),console.log("Attaching events to "+x),null==window.mapBuilder&&(window.mapBuilder={},window.mapBuilder.points=[],window.mapBuilder.selector="#"+$(x).attr("id")),!1!==(null!=b?b.resetMapBuilder:void 0)?window.mapBuilder.points=[]:window.mapBuilder.selector="#"+$(x).attr("id"),null==(null!=b?b.onClickCallback:void 0)&&(null==b&&(b={}),b.onClickCallback=function(a,b){null==window.mapBuilder&&(window.mapBuilder={},window.mapBuilder.selector="#"+$(b).attr("id"),window.mapBuilder.points=[]),window.mapBuilder.points.push(a);try{$("#using-computed-locality").remove()}catch(a){}return $("#init-map-build").removeAttr("disabled"),$("#init-map-build .points-count").text(window.mapBuilder.points.length),y=document.createElement("google-map-marker"),y.setAttribute("latitude",a.lat),y.setAttribute("longitude",a.lng),y.setAttribute("animation","DROP"),Polymer.dom(b).appendChild(y),!1}),$(""+x).on("google-map-click",function(a){var c;return c=a.originalEvent.detail.latLng,C=canonicalizePoint(c),console.info("Clicked point "+C,C,c),"function"==typeof b.onClickCallback?b.onClickCallback(C,this):console.warn("google-map-click wasn't provided a callback"),!1}),H={selector:x,html:l,points:F,hull:m,center:g},console.info("Map",H),geo.googleMapWebComponent=l,"function"==typeof c&&(console.log("createMap2 calling back"),c(H))}catch(a){e=a,console.error("Couldn't create map! "+e.message),console.warn(e.stack)}return!1},reInitMap=function(a){var b,c,d,e,f,g,h,i;for(c=p$(a),c.map=null,e=c.objects,c._initGMap(),d=[],i=0,b=e.length;i<b;i++)f=e[i],"google-map-poly"===f.tagName.toLowerCase()&&(f._points=[],$(f).find("google-map-point").each(function(){var a,b,c,d;return a=$(this).attr("latitude"),b=$(this).attr("longitude"),d={lat:toFloat(a),lng:toFloat(b)},c=new google.maps.LatLng(d),f._points.push(c)}),f.path=null,f.map=c.map,h={clickable:f.clickable||f.draggable,draggable:f.draggable,editable:f.editable,geodesic:f.geodesic,map:f.map,strokeColor:f.strokeColor,strokeOpacity:f.strokeOpacity,strokePosition:f._convertStrokePosition(),strokeWeight:f.strokeWeight,visible:!f.hidden,zIndex:f.zIndex},g=new google.maps.Polygon(h),g.setPaths(f._points),f._setPoly(g),d.push(f));return c.objects=d},buildMap=function(a,b,c){return null==a&&(a=window.mapBuilder),null==b&&(b={selector:a.selector,resetMapBuilder:!1}),createMap2(a.points,b,c),!1},getPointsFromCartoResult=function(a,b){var c,d,f,g,h,i,j,k,l,m,n;null==b&&(b=!1);try{for(m=Object.toArray(a),k=[],n=0,f=m.length;n<f;n++)l=m[n],j=l.st_asgeojson,i=JSON.parse(j),c=i.coordinates,d={lat:c[1],lng:c[0]},h=canonicalizePoint(d),k.push(h);return b&&(g=k.slice(0),k=sortPoints(g)),k}catch(a){e=a,console.error("Couldn't get points: "+e.message),console.warn(e.stack)}return!1},featureClickEvent=function(a,b,c,d,e,f){var g,h;console.log("Clicked feature event",d,c,b),h=[];for(g in d)d[g],h.push(g);return["genus","specificepithet","diseasedetected","dateidentified"],null!=f?{infowindowTemplate:f,templateType:"mustache"}:null,!1},createRawCartoMap=function(a,b,c,d,f){var g,h,i,j,k,l,m,n,o,p;null==d&&(d="#global-data-map"),null==f&&(f=featureClickEvent),isNull(c)&&(c={}),l=null==a.user_name?{user_name:null!=(m=c.user_name)?m:cartoAccount,type:null!=(n=c.type)?n:"cartodb",sublayers:a,extra_params:{map_key:window.apiKey,api_key:window.apiKey}}:a,console.info("Creating map",l),k={cartodb_logo:!1,https:!0,mobile_layout:!0};try{({center:new google.maps.LatLng(null!=(o=k.center_lat)?o:0,null!=(p=k.center_lon)?p:0),zoom:k.zoom,mapTypeId:google.maps.MapTypeId.TERRAIN}),geo.googleMap=p$(d).map}catch(a){}return j={center:[window.locationData.lat,window.locationData.lng],zoom:5},null==geo.lMap&&(h=new L.Map("global-map-container",j),geo.lMap=h,i={attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community"},L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",i).addTo(h)),g=localStorage.useTestMap?geo.googleMap:geo.lMap,cartodb.createLayer(g,l,k).addTo(g,1).on("done",function(d){var h,i,j,k,m,n,o,p;try{d.setParams("table_name",l.named_map.params.table_name)}catch(a){console.warn("Couldn't explicitly set table")}if(isArray(a)){for(p=0,j=a.length;p<j;p++)h=a[p],console.info("Re-adding sublayer",h),d.createSubLayer(h);console.info("Added layers to map")}null==geo.mapSublayers&&(geo.mapSublayers=[]),k=d.getSubLayerCount();try{d.setInteraction(!0)}catch(a){}try{d.unbind("featureClick")}catch(a){}for(d.on("featureClick",function(a,b,c,e,g){var h;return h=l.named_map.params.table_name.slice(0,63),f.debounce(150,!1,null,a,b,c,e,d,$("#infowindow_template_"+h).outerHtml()),!1}).on("error",function(a){return console.warn("Error on layer feature click",a)}),i=0,m=function(a,b,d,f,g){var h,i,j,k,l,n,o;if(null==d&&(d=0),n="#infowindow_template_"+b,o=null!=(k=null!=(l=window._adp.templates)?l[b]:void 0)?k:$(n).html(),isNull(o)&&(o=$(n).html(),isNull(o)&&0===modulo(d,100)&&d>0&&console.warn("Warning: null template for table '"+b+"' @ sublayer "+f,o)),isNull(o))d<100?delay(200,function(){return d+=1,m(a,b,d,f,g)}):(console.warn("Timed out (count: "+d+") trying to assign a template for '"+b+"'",n,"https://github.com/AmphibiaWeb/amphibian-disease-tracker/issues/154"),g.show());else{j={template:o,width:218,maxHeight:250},a.infowindow.set(j),console.info("Successfully set template "+n+" on sublayer "+f);try{h=["genus","specificepithet","diseasedetected","dateidentified"],i=function(a){var b;return console.debug("Running infowindow parser on ",a),$("body .temp-parser").remove(),$("body").append("<div class='temp-parser'>\n  "+a+"\n</div>"),$(".temp-parser").find(".unix-date").each(function(){var a,b,c;return b=$(this).text(),isNull(b)&&$(this).parent().remove(),isNumber(b)&&(b=toInt(b)),a=new Date(b),c=a.getUTCFullYear(),$(this).replaceWith(c)}),$(".temp-parser").find(".disposition").each(function(){var a;if(a=$(this).find(".disposition-label"),isNull(a))return console.debug("Removed empty disposition from label"),$(this).remove()}),b=$(".temp-parser").html(),$(".temp-parser").remove(),console.debug("Parser output",b),b},c={infowindowTemplate:$(n).html(),templateType:"mustache",sanitizeTemplate:i};try{g.getSubLayer(f).infowindow.sanitizeTemplate=i,console.debug("Assigned template parser to sublayer")}catch(a){e=a,console.warn("Couldn't assign template parser - "+e.message),console.warn(e.stack)}cartodb.vis.Vis.addInfowindow(geo.lMap,g.getSubLayer(f),h,c),console.info("Successfully assigned template "+n+" to sublayer "+f+" in vis"),console.debug("template",o),console.debug("selector",$(n).html())}catch(a){}if(0===f)try{g.infowindow.set("template",o),console.info("Successfully assigned template to primary layer",o)}catch(a){}f===g.getSubLayerCount()-1&&(console.info("Showing layer for '"+b+"' after successful template assignment for all sublayers"),g.show())}return!1};i<k;){o=d.getSubLayer(i),o.setInteraction(!0);try{n=l.named_map.params.table_name.slice(0,63),m(o,n,0,i,d)}catch(a){}geo.mapSublayers.push(o),++i}try{console.log("Layer counts:",g.overlayMapTypes.length)}catch(a){}return"function"==typeof b&&b(),!1}).on("error",function(a){return toastStatusMessage("Couldn't load maps!"),console.error("Couldn't get map - "+a)}),!1},createMap=function(a,b,c,d){var f,g,h,i;return null==a&&(a="38544c04-5e56-11e5-8515-0e4fddd5de28"),null==b&&(b="carto-map-container"),null==a&&console.info("Can't create map without a data visualization identifier"),geo.mapId=b,geo.mapSelector="#"+b,h=function(){var f,h,i,j;null==c&&(c={cartodb_logo:!1,https:!0,mobile_layout:!0,gmaps_base_type:"hybrid",center_lat:window.locationData.lat,center_lon:window.locationData.lng,zoom:getMapZoom(geo.boundingBox)}),geo.mapParams=c,$("#"+b).exists()||(f='<div id="'+b+'" class="carto-map wide-map map-container">\n  \x3c!-- Dynamically inserted from unavailable target --\x3e\n</div>',$("main #main-body").append(f)),"function"!=typeof d&&(d=function(a,b){return cartodb.createLayer(b,g).addTo(b).done(function(a){geo.mapLayer=a;try{return a.setInteraction(!0),a.on("featureOver",defaultMapMouseOverBehaviour)}catch(a){return console.warn("Can't set carto map interaction")}})}),j={center:new google.maps.LatLng(c.center_lat,c.center_lon),zoom:c.zoom,mapTypeId:google.maps.MapTypeId.HYBRID},geo.googleMap=new google.maps.Map(document.getElementById(b),j),geo.cartoMap=geo.googleMap,i=function(b){return console.info("Fetched data into Google Map from CartoDB account "+cartoAccount+", from data set "+a),geo.mapLayer=b,geo.cartoMap=geo.googleMap,clearTimeout(h),"function"==typeof d&&d(b,geo.cartoMap),!1};try{console.info("About to render map with options",geo.cartoUrl,c),cartodb.createLayer(geo.googleMap,geo.cartoUrl,c).addTo(geo.googleMap).on("done",function(a){return i(a)}).on("error",function(a){return toastStatusMessage("Couldn't load maps!"),console.error("Couldn't get map - "+a)}),h=delay(1e3,function(){if("function"==typeof d)return console.warn("Callback wasn't called, forcing"),d(null,geo.cartoMap)})}catch(a){console.warn("The map threw an error! "+e.message),console.warn(e.stack),clearTimeout(h),"function"==typeof d&&d(null,geo.cartoMap)}return!1},"object"!=typeof a?(g=/^https?:\/\/.*$/m.test(a)?a:"https://"+cartoAccount+".cartodb.com/api/v2/viz/"+a+"/viz.json",geo.cartoUrl=g,h()):(f={},i="http://tigerhawkvok.cartodb.com/api/v2/viz/38544c04-5e56-11e5-8515-0e4fddd5de28/viz.json",$.get(i,"","json").done(function(b){var c,d,e;f=b,d=[];for(c in a)e=a[c],d.push(f[c]=e);return d}).fail(function(b,c){return f=a}).always(function(){return g=f,geo.cartoUrl=g,h()}))},getColumnObj=function(a){var b;return null==a&&(a=!1),b={id:"int",collectionID:"varchar",catalogNumber:"varchar",sampleId:"varchar",diseaseTested:"varchar",diseaseStrain:"varchar",sampleMethod:"varchar",sampleDisposition:"varchar",diseaseDetected:"varchar",fatal:"boolean",cladeSampled:"varchar",genus:"varchar",specificEpithet:"varchar",infraspecificEpithet:"varchar",lifeStage:"varchar",dateIdentified:"date",decimalLatitude:"decimal",decimalLongitude:"decimal",alt:"decimal",coordinateUncertaintyInMeters:"decimal",Collector:"varchar",originalTaxa:"varchar",sex:"varchar",datum:"text",fimsExtra:"json",the_geom:"varchar"},null==_adp.activeCols||a?b:_adp.activeCols},geo.requestCartoUpload=function(a,b,c,d){var f,g,h,i,j,k;startLoad();try{h=a.data}catch(a){}return"object"!=typeof h?(console.info("This function requires the base data to be a JSON object."),toastStatusMessage("Your data is malformed. Please double check your data and try again."),!1):(f=["edit","insert","delete","create"],indexOf.call(f,c)<0?(console.error(c+" is not an allowed operation on a data set!"),console.info("Allowed operations are ",f),
toastStatusMessage("Sorry, '"+c+"' isn't an allowed operation."),!1):isNull(b)?(console.error("Must use a defined table name!"),toastStatusMessage("You must name your data table"),!1):(j=$.cookie(uri.domain+"_link"),i=$.cookie(uri.domain+"_auth"),k=$.cookie(uri.domain+"_secret"),null==j||null==i||null==k?(console.error("You're not logged in. Got one or more invalid tokens for secrets.",j,i,k),toastStatusMessage("Sorry, you're not logged in. Please log in and try again."),!1):(b=b+"_"+j,g="hash="+i+"&secret="+k+"&dblink="+j,null==("undefined"!=typeof adminParams&&null!==adminParams?adminParams.apiTarget:void 0)?(console.warn("Administration file not loaded. Upload cannot continue"),stopLoadError("Administration file not loaded. Upload cannot continue"),!1):($.post(adminParams.apiTarget,g,"json").done(function(f){var g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_;if(!f.status)return console.error("Unable to authenticate session. Please log in."),stopLoadError("Sorry, your session has expired. Please log in and try again.");Q=[],B=[],F=[];for(J in h){P=h[J],E=[];for(m in P)switch(Z=P[m],m){case"decimalLongitude":E[1]=Z,F.push(Z);break;case"decimalLatitude":E[0]=Z,B.push(Z)}Q.push(E)}i=null!=(K=B.max())?K:0,j=null!=(L=B.min())?L:0,g=null!=(M=F.max())?M:0,k=null!=(N=F.min())?N:0,t=[[i,k],[i,g],[j,g],[j,k]];try{for(Y=JSON.parse(a.transectRing),Y=Object.toArray(Y),x=0,U=0,C=Y.length;U<C;U++){if(r=Y[U],r instanceof Point&&(r=r.toGeoJson(),Y[x]=r),2!==r.length)throw{message:"Bad coordinate length for '"+r+"'"};for(X=0,D=r.length;X<D;X++)if(q=r[X],!isNumber(q))throw{message:"Bad coordinate number '"+q+"'"};++x}}catch(a){e=a,console.warn("Error parsing the user transect ring - "+e.message),Y=void 0}switch(W=null!=Y?Y:t,u={type:"GeometryCollection",geometries:[{type:"MultiPoint",coordinates:Q},{type:"Polygon",coordinates:W}]},s="ST_AsBinary("+JSON.stringify(u)+", 4326)",n=getColumnObj(!0),c){case"edit":return S="UPDATE "+b+" ",foo(),!1;case"insert":case"create":S="","create"===c&&(S="CREATE TABLE "+b+" "),{the_geom:s},_=[],p=[],p.push("id int"),_adp.rowsCount=Object.size(h);for(x in h){P=h[x],x=toInt(x),$=[],0,0,0,0,v={type:"Point",coordinates:[]},y=x+1,$.push(y);for(m in P){Z=P[m],0===x&&(H=m.toLowerCase(),o=null!=(O=n[m])?O:n[H],"object"==typeof o&&(o=o.type),isNull(o)&&(o="text"),p.push(m+" "+o));try{Z=Z.replace("'","&#95;")}catch(a){}switch(m){case"decimalLongitude":v.coordinates[1]=Z;break;case"decimalLatitude":v.coordinates[0]=Z}"string"==typeof Z?$.push("'"+Z+"'"):isNull(Z)?$.push("null"):$.push(Z)}0===x&&(console.log("We're appending to col names list"),p.push("the_geom geometry"),"create"===c&&(S=S+" ("+p.join(",")+"); ")),w="ST_SetSRID(ST_Point("+v.coordinates[1]+","+v.coordinates[0]+"),4326)",$.push(w),_.push("("+$.join(",")+")")}for(I=4096,z=15,A=0,console.info("Inserting statements of max length "+I),G=0,R=I,V=[];_.slice(A,A+z).length>0;){for(T=0;V.join(", ").length<I-1&&(++T,V=_.slice(A,A+T),!(T>z)););T--,T>G&&(G=T),T<R&&(R=T),V=_.slice(A,A+T),A+=T,S+="INSERT INTO "+b+" VALUES "+V.join(", ")+";"}l="SELECT cdb_cartodbfytable('"+b+"');",S+=l,console.info("Constructed statements: maximum "+G+" rows, minimum "+R+" rows");break;case"delete":return S="DELETE FROM "+b+" WHERE ",foo(),!1}try{return geo.postToCarto(S,b,d)}catch(a){return stopLoadBarsErrors()}}).fail(function(a,b){return console.error("Couldn't communicate with server!",a,b),console.warn(""+uri.urlString+adminParams.apiTarget+"?"+g),stopLoadError("There was a problem communicating with the server. Please try again in a bit. (E-001)"),$("#upload-data").removeAttr("disabled")}),!1))))},geo.postToCarto=function(a,b,c){var d,f,g,h,i,j,k,l,m,n,o;d=encodeURIComponent(encode64(a)),f="action=upload&sql_query="+d,console.info("Querying:"),console.info(a);try{_adp.postedSqlQuery=a,_adp.postedSqlQueryStatements=a.split(");")}catch(a){}console.info("POSTing to server"),$("#data-sync").removeAttr("indeterminate"),l=Date.now(),o=0,m=["A silly story for you, while you wait!","Everything had gone according to plan, up 'til this moment.","His design team had done their job flawlessly,","and the machine, still thrumming behind him,","a thing of another age,","was settled on a bed of prehistoric moss.","They'd done it.","But now,","beyond the protection of the pod","and facing an enormous Tyrannosaurus rex with dripping jaws,","Professor Cho reflected that,","had he known of the dinosaur's presence,","he wouldnt have left the Chronoculator","- and he certainly wouldn't have chosen 'Staying&#39; Alive',","by The Beegees,","as his dying soundtrack.","Curse his MP3 player!","The End.","Yep, your data is still being processed","And we're out of fun things to say","We hope you think it's all worth it"],g=function(){var a;return a=null!=m[o]?"("+m[o]+")":"",toastStatusMessage("Still working ... "+a),++o,window._adp.secondaryTimeout=delay(15e3,function(){return g()})};try{i=toInt(.7*_adp.rowsCount),console.log("Estimate "+i+" seconds"),window._adp.uploader=!0,$("#data-sync").removeAttr("indeterminate"),k=30*i;try{p$("#data-sync").max=k}catch(a){}(n=function(a){try{p$("#data-sync").value=a}catch(a){}return++a,window._adp.uploader&&a<=k?delay(33,function(){return n(a)}):a>k?(toastStatusMessage("This may take a few minutes. We'll give you an error if things go wrong."),window._adp.secondaryTimeout=delay(15e3,function(){return g()})):console.log("Not running upload progress indicator",a,window._adp.uploader,k)})(0)}catch(a){e=a,console.warn("Can't show upload status - "+e.message),console.warn(e.stack);try{window._adp.initialTimeout=delay(5e3,function(){var a,b;return a=toInt(i/60)+1,b=a>1?"minutes":"minute",toastStatusMessage("Please be patient, it may take a few minutes (we guess "+a+" "+b+")"),window._adp.secondaryTimeout=delay(15e3,function(){return g()})})}catch(a){h=a,console.error("Can't show backup upload notices! "+h.message),console.warn(h.stack)}}return j=Date.now(),$.post("api.php",f,"json").done(function(a){var d,e,f,g,h,l,m,n,o,p;console.log("Got back response from carto",a);try{n=roundNumber((Date.now()-j)/1e3,1),console.info("Really took "+n+"s (estimated "+i+"s)",n/i)}catch(a){}if(!0!==a.status)return console.error("Got an error from the server!"),console.warn(a),stopLoadError("There was a problem uploading your data. Please try again."),bsAlert("<strong>There was a problem uploading your data</strong>: the server said <code>"+a.error+"</code>","danger"),!1;e=a.post_response,d=!1;for(h in e){o=e[h],isNull(null!=o?o.error:void 0)||(g=null!=(null!=o?o.error:void 0)?o.error[0]:"Unspecified Error",d=g);try{o=JSON.parse(o);for(l in o)p=o[l],"error"===l&&(d=p)}catch(a){}}if(!1!==d)return console.error("There was an error communicating with cartoDB!"),bsAlert("Error uploading your data to CartoDB: <code>"+d+"</code>","danger"),stopLoadError("CartoDB returned an error: "+d),!1;console.info("Carto was successful! Got results",e);try{JsonHuman.format(e)}catch(a){}return bsAlert("Upload to CartoDB of table <code>"+b+"</code> was successful","success"),$("#cancel-new-upload").remove(),toastStatusMessage("Data parse and upload successful"),geo.dataTable=b,f="",isNull(f)?"object"==typeof f?f:"":"https://"+cartoAccount+".cartodb.com/api/v2/viz/"+f+"/viz.json",m=function(a){var b,d;console.info("Initiating parent callback"),stopLoad();try{k=p$("#data-sync").max,p$("#data-sync").value=k}catch(a){}return $("#data-sync").removeAttr("indeterminate"),b={boundingBox:geo.boundingBox,bsGrid:""},null!=(null!=(d=window.mapBuilder)?d.selector:void 0)?b.selector=window.mapBuilder.selector:$("google-map").exists()?b.selector=$($("google-map").get(0)).attr("id"):b.selector="#carto-map-container",_adp.defaultMapOptions=b,"function"==typeof c?c(geo.dataTable,a,b):console.info("requestCartoUpload recieved no callback")},geo.init(function(){return console.info("Post init"),getCanonicalDataCoords(geo.dataTable,null,function(a,b){return console.info("gcdc callback successful",a),m(a)}),!1})}).fail(function(a,b){return console.error("Couldn't communicate with server!",a,b),console.warn(""+uri.urlString+adminParams.apiTarget+"?"+f),stopLoadError("There was a problem communicating with the server. Please try again in a bit. (E-002)"),bsAlert("Couldn't upload dataset. Please try again later.","danger")}).always(function(){var a;try{return a=Date.now()-l,console.info("POST and process took "+a+"ms"),clearTimeout(window._adp.initialTimeout),clearTimeout(window._adp.secondaryTimeout),window._adp.uploader=!1,$("#upload-data").removeAttr("disabled")}catch(a){}}),!1},sortPoints=function(a,b){var c,d,e,f,g;for(null==b&&(b=!0),window.upper=upperLeft(a),a.sort(pointSort),f=[],g=0,d=a.length;g<d;g++)c=a[g],b?f.push(c.getObj()):(e=c.toSimplePoint(),f.push(e));return delete window.upper,f},canonicalizePoint=function(a,b){var c,d,e;null==b&&(b=!1),d={lat:null,lng:null};try{e=toFloat(a.lat),""+e===a.lat?b?(a.lat=toFloat(a.lng),a.lng=toFloat(a.lat)):(a.lat=toFloat(a.lat),a.lng=toFloat(a.lng)):""+(e=toFloat(a[0]))===a[0]&&(b?(a[0]=toFloat(a[1]),a[1]=toFloat(a[0])):(a[0]=toFloat(a[0]),a[1]=toFloat(a[1])))}catch(a){}if("number"==typeof(null!=a?a.lat:void 0))d=a;else if("number"==typeof(null!=a?a[0]:void 0))d={lat:a[0],lng:a[1]};else try{if("number"!=typeof a.lat())throw"Not fPoint";d.lat=a.lat(),d.lng=a.lng()}catch(b){try{if("number"!=typeof a.getLat())throw"Not Point";d=a.getObj()}catch(b){if(null!=("undefined"!=typeof google&&null!==google?google.map:void 0))try{c=a.getPosition(),d.lat=c.lat(),d.lng=c.lng()}catch(a){throw"Unable to determine point type"}}}return new Point(d.lat,d.lng)},createConvexHull=function(a,b){var c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(null==b&&(b=!1),n=[],m=[],o=Date.now(),console.log("createConvexHull called with "+Object.size(a)+" points"),a=Object.toArray(a),p=!1,q=0,h=a.length;q<h&&(l=a[q],!(Math.abs(l.lng)>90));q++)if(Math.abs(l.lat)>90){p=!0;break}for(r=0,i=a.length;r<i;r++)l=a[r],c=canonicalizePoint(l,p),m.push(c);try{console.info("Getting convex hull (original: "+a.length+"; canonical: "+m.length+")",m);try{d=getConvexHull(m)}catch(a){console.warn("Couldn't run real way!"),n=sortPoints(m,!1),f=getConvexHullPoints(n)}f=d.paths}catch(a){e=a,console.error("Unable to get convex hull - "+e.message),console.warn(e.stack)}for(geo.canonicalBoundingBox=[],s=0,j=f.length;s<j;s++)l=f[s],geo.canonicalBoundingBox.push(l.getObj());k={hull:f,points:m},geo.canonicalHullObject=k;try{g=Date.now()-o,console.debug("createConvexHull completed in "+g+"ms")}catch(a){}return!0===b?k:f},fPoint=function(a,b){return this.latval=a,this.lngval=b,this.lat=function(){return this.latval},this.lng=function(){return this.lngval},this.toString=function(){return"("+this.x+", "+this.y+")"},""+this},Point=function(a,b){return this.lat=toFloat(a),this.lng=toFloat(b),this.x=360*(this.lng+180),this.y=180*(this.lat+90),this.distance=function(a){var b,c;return b=a.x-this.x,c=a.y-this.y,Math.sqrt(Math.pow(b,2)+Math.pow(c,2))},this.slope=function(a){var b;return b=a.x-this.x,(a.y-this.y)/b},this.toString=function(){return"("+this.lat+", "+this.lng+")"},this.getObj=function(){return{lat:this.lat,lng:this.lng}},this.getLatLng=function(){var a;return null!=("undefined"!=typeof google&&null!==google?google.maps:void 0)?(a=this.getObj(),new google.maps.LatLng(a)):this.getObj()},this.getLat=function(){return this.lat},this.getLng=function(){return this.lng},this.toSimplePoint=function(){return new fPoint(this.lat,this.lng)},this.toGeoJson=function(){return[this.lat,this.lng]},""+this},geo.Point=Point,Number.prototype.toRad=function(){return this*Math.PI/180},geo.distance=function(a,b,c,d){var e,f,g,h,i,j,k;return e=6371,h=(c-a).toRad(),i=(d-b).toRad(),j=h/2,k=i/2,f=Math.pow(Math.sin(j),2)+Math.cos(a.toRad())*Math.cos(c.toRad())*Math.pow(Math.sin(k),2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),e*g},geo.getBoundingRectangle=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(null==a&&(a=geo.boundingBox),a=Object.toArray(a),isNull(a))return console.warn("Need a set of coordinates for the bounding rectangle!"),!1;for(i=-90,j=90,l=180,e=-180,k=0,g=a.length;k<g;k++)c=a[k],d=canonicalizePoint(c),f=d.lat,h=d.lng,f>i&&(i=f),f<j&&(j=f),h<l&&(l=h),h>e&&(e=h);return b={nw:[i,l],ne:[i,e],se:[j,e],sw:[j,l],north:i,east:e,west:l,south:j},geo.computedBoundingRectangle=b,b},window.lastRanGeocoder=0,wait=function(a){var b,c;for(c=(new Date).getTime(),console.log("Will wait "+a+"ms after "+c),b=c;b<c+a;)b=(new Date).getTime(),!0===window.endWait&&(b=c+a+1);return console.log("Waited "+a+"ms"),b},localityFromMapBuilder=function(a,b){var c,d,e,f,g;return null==a&&(a=window.mapBuilder),c=50,f=c/20,e=1e3/f,(g=Date.now()-window.lastRanGeocoder-randomInt(1,25))<e?(console.debug("It's been "+g+"ms since last attempt to geocode (min: "+e+"ms), delaying"),delay(e,function(){return localityFromMapBuilder(a,b)}),!1):(window.lastRanGeocoder=Date.now(),d=getMapCenter(a.points),geo.reverseGeocode(d.lat,d.lng,a.points,function(c,d){if(console.info("Got locality '"+c+"'",d),a.views=d,"function"==typeof b)try{return b(c,a)}catch(a){return b(c)}}),!1)},doMapBuilder=function(a,b,c){return null==a&&(a=window.mapBuilder),null==b&&(b={selector:a.selector,resetMapBuilder:!1}),null==b.resetMapBuilder&&(b.resetMapBuilder=!1),"object"!=typeof(null!=a?a.points:void 0)?(console.error("Invalid builder",a),!1):buildMap(a,b,function(a){return geo.boundingBox=a.hull,localityFromMapBuilder(a,function(b){return a.locality=b,console.info("Map results:",a),"function"==typeof c&&c(a),!1})})},geo.geocode=function(a,b,c){var d,f,g,h,i,j,k,l,m,n;try{null!=geo.geocoder?i=geo.geocoder:(i=new google.maps.Geocoder,geo.geocoder=i)}catch(a){return e=a,console.error("Couldn't instance a google map geocoder - "+e.message),console.warn(e.stack),!1}if(h=function(){var d;return d={address:a,componentRestrictions:b},i.geocode(d,function(a,b){var e,f,g,h,i,j,k;if(console.log("Geocoder fetched",a,b),console.log("Provided",d),b!==google.maps.GeocoderStatus.OK)return console.warn("Geocoder failed -- Google said",b),!1;f=a[0],j={},j.google={},j.human=f.formatted_address;try{for(h=f.address_components,i=0,e=h.length;i<e;i++){g=h[i];try{k=g.types[0],j.google[k]=g.long_name}catch(a){continue}}}catch(a){}return j.partial_match=f.partial_match,"function"==typeof c?c(j):console.warn("No callback provided! Got address object",j)})},k=null,null!=a&&null!=k){m="https://maps.googleapis.com/maps/api/geocode/json",f=[];for(j in b)n=b[j],l=j+":"+encodeURIComponent(n),f.push(l);g=f.join("|"),d="address="+encodeURIComponent(a)+"&components="+g+"&key="+k,console.log("Trying",m+"?"+d),$.get(m,d,"json").done(function(a){var b,d,e,f,g,i,j,k;if(console.log("API hit fetched",a),d=a.results[0],(g=a.status)!==google.maps.GeocoderStatus.OK)return console.warn("Geocoder failed -- Google said",g),h(),!1;j={},j.google={},j.human=d.formatted_address;try{for(f=d.address_components,i=0,b=f.length;i<b;i++){e=f[i];try{k=e.types[0],j.google[k]=e.long_name}catch(a){continue}}}catch(a){}return j.partial_match=d.partial_match,"function"==typeof c?c(j):console.warn("No callback provided! Got address object",j)}).fail(function(a,b){return console.error("Error ("+b+"): Couldn't post to Google, trying geocoder"),h()})}else h();return!1},geo.reverseGeocode=function(a,b,c,d){var f,g,h;null==c&&(c=geo.boundingBox);try{null!=geo.geocoder?f=geo.geocoder:(f=new google.maps.Geocoder,geo.geocoder=f)}catch(a){return e=a,console.error("Couldn't instance a google map geocoder - "+e.message),console.warn(e.stack),!1}return g={lat:toFloat(a),lng:toFloat(b)},h={location:g},console.debug("Starting reverse geocoder"),f.geocode(h,function(a,b){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(b===google.maps.GeocoderStatus.OK){for(console.info("Google said:",a),geo.geocoderViews=a,i=geo.getBoundingRectangle(c),s=null,n=0,g=a.length;n<g&&(t=a[n],s=t,null==(f=t.geometry.bounds)||(j=f.getNorthEast(),m=f.getSouthWest(),k=j.lat(),l=m.lat(),e=j.lng(),u=m.lng(),k<i.north||l>i.south||u>i.west||e<i.east));n++);if(h=s.formatted_address,p=k<i.north,q=l>i.south,r=u>i.west,o=e<i.east,(p||q||r||o)&&(console.warn("The last locality, '"+h+"', doesn't contain all coordinates!"),console.warn("North: "+!p+", South: "+!q+", East: "+!o+", West: "+!r),console.info("Using",s,i),h="near "+h+" (nearest region)"),console.info("Computed locality: '"+h+"'"),geo.computedLocality=h,window.lastRanGeocoder=Date.now(),"function"!=typeof d)return console.warn("No callback provided to geo.reverseGeocode()!");try{return d(h,a)}catch(a){return d(h)}}else if(console.error("There was a problem getting the locality",a,b),"function"==typeof d)return console.warn("Proceeding anyway with fake locality 'Bad Locality'"),geo.computedLocality="Bad Locality",d("Bad Locality")})},toggleGoogleMapMarkers=function(a,b,c){var d,e,f,g,h;for(null==a&&(a="positive"),null==b&&(b="#transect-viewport"),b=b+" google-map-marker[data-disease-detected='"+a+"']",f=$(b),console.info("Got "+f.length+" markers"),g=void 0,h=0,d=f.length;h<d;h++)e=f[h],null==g&&(g=!p$(e).open,console.info("Setting "+a+" markers open state to "+g)),p$(e).open=g;return"function"==typeof c&&c(g),!1},setupMapMarkerToggles=function(){var a;return a='<div class="row">\n  <h3 class="col-xs-12">\n    Toggle map markers\n  </h3>\n  <button class="btn btn-danger col-xs-3 toggle-marker" data-disease-status="positive">Positive</button>\n  <button class="btn btn-primary col-xs-3 toggle-marker" data-disease-status="negative">Negative</button>\n  <button class="btn btn-warning col-xs-3 toggle-marker" data-disease-status="no_confidence"><span class="hidden-xs">Inconclusive</span><span class="visible-xs-inline">?</span></button>\n</div>',$(".toggle-marker").exists()||$("google-map + div").append(a),console.log("Setting up events for map marker toggles"),$(".toggle-marker").unbind().click(function(){var a;return a=$(this).attr("data-disease-status"),$(".aweb-link-species").removeAttr("hidden"),console.log("Clicked '"+a+"' toggle"),toggleGoogleMapMarkers(a,null,function(b){return"no_confidence"===a&&(a="inconclusive"),b?(console.info("Hiding selector",".aweb-link-species:not([data-"+a+"='true'])"),$(".aweb-link-species:not([data-"+a+"='true'])").attr("hidden","hidden")):console.info("Removing hidden attribute")})}),!1},getConvexHull=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;try{l=a[0],f=l.getPosition()}catch(e){for(c=[],k=0,d=a.length;k<d;k++){i=a[k],b=new google.maps.Marker;try{f=i.getLatLng()}catch(a){g={lat:i.lat,lng:i.lng},f=new google.maps.LatLng(g)}b.setPosition(f),c.push(b)}a=c.slice(0)}for(j=[],m=0,e=a.length;m<e;m++)h=a[m],j.push(h.getPosition());j.sort(sortPointY),j.sort(sortPointX);try{console.debug("Convex hull being formed from",j.slice(0))}catch(a){}return getConvexHullConfig(j)},sortPointX=function(a,b){return a.lng()-b.lng()},sortPointY=function(a,b){return a.lat()-b.lat()},sortPointsXY=function(a){return a.sort(sortPointY),a.sort(sortPointX),a},getConvexHullPoints=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(b=[],!isArray(a))return console.error("Function requires an array"),!1;j=[];try{if(!(a[0]instanceof Point)){for(g=a.slice(0),a=[],k=0,c=g.length;k<c;k++)i=g[k],a.push(canonicalizePoint(i));b=convexHull(a)}for(l=0,d=b.length;l<d;l++)i=b[l],h=new Point(i.lat,i.lng),j.push(h)}catch(c){if(a[0]instanceof Point){for(g=a.slice(0),a=[],m=0,e=g.length;m<e;m++)i=g[m],a.push(i.toSimplePoint());console.debug("Converted Point array to fPoint array",a.slice(0))}for(chainHull_2D(a,a.length,b),n=0,f=b.length;n<f;n++)i=b[n],h=new Point(i.lat(),i.lng()),j.push(h)}return console.info("Got hull from "+a.length+" points:",j),j},getConvexHullConfig=function(a,b){var c;return null==b&&(b=geo.googleMap),c=getConvexHullPoints(a),{map:b,paths:c,fillColor:defaultFillColor,fillOpacity:defaultFillOpacity,strokeWidth:2,strokeColor:"#0000FF",strokeOpacity:.5}};var gmarkers=[],points=[],hullPoints=[],map=null,polyline;$(function(){return $("google-maps-api").exists()&&$("google-maps-api").on("api-load",function(){try{return window.gMapsCallback()}catch(a){}}),speculativeApiLoader()}),enableDebugLogging=function(){var a,b,c;if(window.debugLoggingEnabled)return!1;if(null!=("undefined"!=typeof localStorage&&null!==localStorage?localStorage.debugLog:void 0))try{c=JSON.parse(localStorage.debugLog),window._debug=c,console.info("Restored log history to local object")}catch(a){console.warn("Unable to restore log history"),window._debug=[]}else window._debug=[];window.sysConsole=console,window.sysLog=console.log,window.sysInfo=console.info,window.sysWarn=console.warn,window.sysError=console.error,window.sysDebug=console.debug,console.debug=function(){var a,b;return a=1<=arguments.length?slice.call(arguments,0):[],b={callType:"debug",arguments:a},_debug.push(b),sysDebug.apply(console,arguments),backupDebugLog(!0)},console.log=function(){var a,b;return a=1<=arguments.length?slice.call(arguments,0):[],b={callType:"log",arguments:a},_debug.push(b),sysLog.apply(console,arguments),backupDebugLog(!0)},console.info=function(){var a,b;return a=1<=arguments.length?slice.call(arguments,0):[],b={callType:"info",arguments:a},_debug.push(b),sysInfo.apply(console,arguments),backupDebugLog(!0)},console.warn=function(){var a,b;return a=1<=arguments.length?slice.call(arguments,0):[],b={callType:"warn",arguments:a},_debug.push(b),sysWarn.apply(console,arguments),backupDebugLog(!0)},console.error=function(){var a,b;return a=1<=arguments.length?slice.call(arguments,0):[],b={callType:"error",arguments:a},_debug.push(b),sysError.apply(console,arguments),backupDebugLog(!0)},$(window).on("popstate",function(a){return console.log("Navigation event"),!1}),$(window).unload(function(a){return console.log("unload event"),!1}),$("#debug-reporter").remove(),b='<paper-fab id="debug-reporter" icon="icons:send" data-toggle="tooltip" title="Send Debug Report" elevation="5">\n</paper-fab>',$("body").append(b),a='<style type="text/css">\n  #debug-reporter {\n    background: #F44336;\n    color: #fff!important;\n    position: fixed;\n    right: 1rem;\n    bottom: 1rem;\n    cursor: pointer;\n  }\n</style>',$("#debug-reporter").before(a),$("#debug-reporter").click(function(){return reportDebugLog()}),window.debugLoggingEnabled=!0;try{p$(".debug-enable-context").disabled=!0}catch(a){}return backupDebugLog(),!1},backupDebugLog=function(a){var b;if(null==a&&(a=!1),"undefined"!=typeof localStorage&&null!==localStorage&&null!=window._debug){a||console.info("Saving backup of debug log");try{b=JSON.stringify(window._debug),localStorage.debugLog=b}catch(a){e=a,sysError.apply(console,["Unable to backup debug log! "+e.message,window._debug])}}return!1},window.enableDebugLogging=enableDebugLogging,disableDebugLogging=function(){null!=("undefined"!=typeof localStorage&&null!==localStorage?localStorage.debugLog:void 0)&&(delete localStorage.debugLog,delete _debug),"function"==typeof window.sysLog&&(console.log=sysLog,console.info=sysInfo,console.warn=sysWarn,console.error=sysError,console.debug=sysDebug),$("#debug-reporter").remove(),window.debugLoggingEnabled=!1;try{p$(".debug-disable-context").disabled=!0}catch(a){}return!1},window.disableDebugLogging=disableDebugLogging,reportDebugLog=function(){var a,b,c,d,f,g,h;if(null!=window._debug){backupDebugLog(),console.info("Opening debug reporter"),f=function(){return'<div>\n  <p>Copy the text below</p>\n  <textarea readonly rows="10" class="form-control">\n    '+localStorage.debugLog+'\n  </textarea>\n  <br/><br/>\n  <p>And email it to <a href="mailto:support@velociraptorsystems.com?subject=Debug%20Log">support@velociraptorsystems.com</a></p>\n</div>'},g='<paper-dialog modal id="report-bug-modal">\n  <h2>Bug Report</h2>\n  <paper-dialog-scrollable>\n    '+f()+'\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Close</paper-button>\n  </div>\n</paper-dialog-modal>',$("#report-bug-modal").remove(),$("body").append(g);try{safariDialogHelper("#report-bug-modal")}catch(g){e=g,console.warn("Warning -- couldn't use safariDialogHelper to open. Some browsers may have an issue seeing this alert. ("+e.message+")"),console.debug(e.stack);try{try{p$("#report-bug-modal").open()}catch(b){a=b,console.warn("Couldn't use p$ to show modal, trying direct ... ("+a.message+")"),document.querySelector("#report-bug-modal").open()}h=3e3,delay(h,function(){if(!$("#report-bug-modal").isVisible())throw function(){return this.message="Modal failed visibility test at "+h+"ms",this.name="InvisibleModalError"}})}catch(a){b=a,console.error("Unable to show bug report modal! "+b.message),console.warn(b.stack);try{bsAlert(f())}catch(a){c=a,console.error("Couldn't show fallback bsAlert! "+c.message),console.warn(c.stack);try{startLoad(),stopLoadError("Unable to show bug report modal!")}catch(a){d=a,console.error("Couldn't alert user to the problem! "+d.message),console.warn(c.stack)}}}}}return!1},window.reportDebugLog=reportDebugLog,"function"!=typeof delay&&(delay=function(a,b){return setTimeout(b,a)}),delay(100,function(){var a,b;if("function"!=typeof("undefined"!=typeof jQuery&&null!==jQuery&&null!=(a=jQuery.fn)?a.isVisible:void 0)&&(jQuery.fn.isVisible=function(){return jQuery(this).is(":visible")&&"hidden"!==jQuery(this).css("visibility")}),"function"!=typeof("undefined"!=typeof jQuery&&null!==jQuery&&null!=(b=jQuery.fn)?b.exists:void 0)&&(jQuery.fn.exists=function(){return jQuery(this).length>0}),"function"!=typeof p$&&(p$=function(a){try{return $$(a)[0]}catch(b){return $(a).get(0)}}),"function"!=typeof isNull&&(isEmpty=function(a){return!a||0===a.length},isBlank=function(a){return!a||/^\s*$/.test(a)},isNull=function(a,b){var c;if(null==b&&(b=!1),"object"==typeof a)try{if(null!=(c=a.length))try{return 0===c}catch(a){}return 0===Object.size}catch(a){}try{if(isEmpty(a)||isBlank(a)||null==a){if(!1!==a&&0!==a)return!0;if(b&&(!1===a||0===a))return!0}}catch(a){return e=a,!1}try{a=(""+a).toLowerCase()}catch(a){}return"undefined"===a||"null"===a||!(!b||"false"!==a&&"0"!==a)}),"function"!=typeof bsAlert&&(bsAlert=function(a,b,c,d){var e,f,g;return null==b&&(b="warning"),null==c&&(c="body"),null==d&&(d="#bs-alert"),$(d).exists()?($(d).removeClass("alert-warning alert-info alert-danger alert-success"),$(d).addClass("alert-"+b)):(f='<div class="alert alert-'+b+' alert-dismissable hanging-alert" role="alert" id="'+d.slice(1)+'">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <div class="alert-message"></div>\n</div>',g=$("main").exists()?"main":$("article").exists()?"article":c,$(g).prepend(f)),$(d+" .alert-message").html(a),e='<style type="text/css">\n  .hanging-alert {\n    position: fixed;\n    top: 0;\n    width: 50%;\n    margin: 0;\n    left: 25%;\n    z-index: 5999;\n  }\n</style>',$(d).before(e),bindClicks(),mapNewWindows(),!1},"function"!=typeof openTab&&(openLink=function(a){return null!=a&&(window.open(a),!1)},openTab=function(a){return openLink(a)},goTo=function(a){return null!=a&&(window.location.href=a,!1)}),"function"!=typeof mapNewWindows&&(mapNewWindows=function(a){return null==a&&(a=!0),$(".newwindow").each(function(){var b;return b=$(this).attr("href"),null==b&&(b=$(this).attr("data-href")),$(this).click(function(c){return a&&(c.preventDefault(),c.stopPropagation()),openTab(b)}),$(this).keypress(function(){return openTab(b)})})}),"function"!=typeof bindClicks&&(bindClicks=function(a){return null==a&&(a=".click"),$(a).each(function(){var a,b,c,d,f,g,h,i;try{if(i=null!=(c=$(this).attr("data-href"))?c:$(this).attr("href"),!isNull(i)){try{h=$(this).prop("tagName").toLowerCase()}catch(a){h=null}try{i===uri.o.attr("path")&&"paper-tab"===h&&$(this).parent().prop("selected",$(this).index())}catch(a){e=a,console.warn("tagname lower case error")}return b=(null!=(d=$(this).attr("newTab"))?d.toBool():void 0)||(null!=(f=$(this).attr("newtab"))?f.toBool():void 0)||(null!=(g=$(this).attr("data-newtab"))?g.toBool():void 0),"a"!==h||b?("a"===h&&$(this).keypress(function(){return openTab(i)}),$(this).unbind().click(function(a){a.preventDefault(),a.stopPropagation();try{return b?openTab(i):goTo(i)}catch(a){return goTo(i)}}),i):!0}if(null!=(a=$(this).attr("data-function")))return $(this).unbind(),$(this).click(function(){var b;try{console.log("Executing bound function "+a+"()");try{b=null,isNull($(this).attr("data-args"))||(b=$(this).attr("data-args").split(","))}catch(a){}try{return null!=b?window[a].apply(window,b):window[a]()}catch(b){return window[a]()}}catch(b){return e=b,console.error("'"+a+"()' is a bad function - "+e.message)}})}catch(a){return e=a,console.error("There was a problem binding to #"+$(this).attr("id")+" - "+e.message)}}),!1})),"function"!=typeof Function.debounce)return Function.prototype.getName=function(){var a;return a=this.name,null==a&&(a=(""+this).substr(0,(""+this).indexOf("(")).replace("function ","")),isNull(a)&&(a=md5(""+this)),a},Function.prototype.debounce=function(){var a,b,c,d,f,g,h,i;h=arguments[0],c=arguments[1],i=arguments[2],a=4<=arguments.length?slice.call(arguments,3):[],null==h&&(h=300),null==c&&(c=!1),null==i&&(i=window.debounce_timer),null==(null!=(g=window.core)?g.debouncers:void 0)&&(null==window.core&&(window.core={}),core.debouncers={});try{f=this.getName()}catch(a){}d=this,b=function(){if(!c)return d.apply(d,a)};try{null!=core.debouncers[f]&&(i=core.debouncers[f])}catch(a){}if(null!=i)try{clearTimeout(i)}catch(a){e=a}return c?(d.apply(obj,a),console.log("Executed "+f+" immediately"),!1):null!=f?core.debouncers[f]=delay(h,function(){return b()}):window.debounce_timer=delay(h,function(){return b()})}}),window.debugScriptSetup=!1,$(function(){var a,b;(a=function(){return window.debugScriptSetup=!0,null!=("undefined"!=typeof localStorage&&null!==localStorage?localStorage.debugLog:void 0)?(window.debugLoggingEnabled=!0,enableDebugLogging()):window.debugLoggingEnabled=!1})(),(b=function(a){var c,d,f,g,h,i,j,k,l;if(!("undefined"!=typeof Polymer&&null!==Polymer&&null!=(i=Polymer.RenderStatus)?i._ready:void 0)){if("undefined"!=typeof Polymer&&null!==Polymer){if(a>20){l=500*a,console.warn("Fake it till you make it -- after waiting "+l+"ms, we're going to pretend Polymer is ready");try{Polymer.RenderStatus._ready=!0}catch(a){}}}else if(a>20)try{console.warn("Inserting Polymer components into DOM"),h="https://cdn.rawgit.com/download/polymer-cdn/1.5.0/lib",f='<script src="'+h+'/webcomponentsjs/webcomponents-lite.min.js"><\/script>\n<link rel="import" href="'+h+'/polymer/polymer.html"/>\n<link rel="import" href="'+h+'/paper-spinner/paper-spinner.html"/>\n<link rel="import" href="'+h+'/paper-menu/paper-menu.html"/>\n<link rel="import" href="'+h+'/paper-material/paper-material.html"/>\n<link rel="import" href="'+h+'/paper-dialog/paper-dialog.html"/>\n<link rel="import" href="'+h+'/paper-dialog-scrollable/paper-dialog-scrollable.html"/>\n<link rel="import" href="'+h+'/paper-button/paper-button.html"/>\n<link rel="import" href="'+h+'/paper-icon-button/paper-icon-button.html"/>\n<link rel="import" href="'+h+'/paper-fab/paper-fab.html"/>\n<link rel="import" href="'+h+'/paper-item/paper-item.html"/>\n<link rel="import" href="'+h+'/iron-icons/iron-icons.html"/>\n<link rel="import" href="'+h+'/iron-icons/image-icons.html"/>\n<link rel="import" href="'+h+'/iron-icons/social-icons.html"/>\n<link rel="import" href="'+h+'/iron-icons/editor-icons.html"/>\n<link rel="import" href="'+h+'/neon-animation/neon-animation.html"/>\n</',$("head").append(f),a=-2}catch(a){e=a,console.error("Unable to insert Polymer into DOM ("+e.message+")")}return console.warn("Delaying context until Polymer.RenderStatus is ready"),delay(500,function(){return a++,b(a)}),!1}for(console.info("Setting up context events"),$("paper-icon-button[icon='icons:bug-report']").contextmenu(function(a){return d.debounce(null,null,null,this,a),!1}),c=["paper-button","button"],j=0,g=c.length;j<g;j++)k=c[j],$(k).find("[icon='icons:bug-report']").parents(k).contextmenu(function(a){return d.debounce(null,null,null,this,a),!1});return d=function(a,b){var c,d;if(b.preventDefault(),
console.info("Showing bug report context menu"),f='<paper-material class="bug-report-context-wrapper" style="top:'+b.pageY+"px;left:"+b.pageX+'px;position:absolute">\n  <paper-menu class=context-menu">\n    <paper-item class="debug-enable-context" data-fn="enableDebugLogging">\n      Enable debug reporting\n    </paper-item>\n    <paper-item class="debug-disable-context" data-fn="disableDebugLogging">\n      Disable debug reporting\n    </paper-item>\n  </paper-menu>\n</paper-material>',$(".bug-report-context-wrapper").remove(),$("body").append(f),c=function(b){return $(a).addClass("iron-selected"),!1},d=function(b){return $(a).removeClass("iron-selected"),!1},$(".bug-report-context-wrapper paper-item").hover(c,d).click(function(){return $(a).attr("data-fn"),!1}),$(".debug-enable-context").click(function(){return enableDebugLogging()}),$(".debug-disable-context").click(function(){return disableDebugLogging()}),window.debugLoggingEnabled)try{p$(".debug-enable-context").disabled=!0}catch(a){}else try{p$(".debug-disable-context").disabled=!0}catch(a){}return delay(5e3,function(){return $(".bug-report-context-wrapper").remove()})}})(0),window.setupDebugContext=function(){return console.log("**** Debug Context Events Enabled ***"),a(),b(),!0};try{return setupDebugContext()}catch(a){}});
//# sourceMappingURL=c.min.js.map