function shuffle(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function pointSort(a,b){if(a==upper)return-1;if(b==upper)return 1;var c=upper.slope(a),d=upper.slope(b);return c==d?a.distance(upper)<b.distance(upper)?-1:1:0>=c&&d>0?-1:c>0&&0>=d?1:c>d?-1:1}function upperLeft(a){for(var b=a[0],c=1;c<a.length;c++){var d=a[c];(d.y>b.y||d.y==b.y&&d.x<b.x)&&(b=d)}return b}function calculateConvexHull(){polyline&&polyline.setMap(null),document.getElementById("hull_points").innerHTML="",points=[];for(var a=0;a<gmarkers.length;a++)points.push(gmarkers[a].getPosition());points.sort(sortPointY),points.sort(sortPointX),DrawHull()}function DrawHull(){hullPoints=[],chainHull_2D(points,points.length,hullPoints),polyline=new google.maps.Polygon({map:map,paths:hullPoints,fillColor:"#FF0000",strokeWidth:2,fillOpacity:.5,strokeColor:"#0000FF",strokeOpacity:.5}),displayHullPts()}function displayHullPts(){document.getElementById("hull_points").innerHTML="";for(var a=0;a<hullPoints.length;a++)document.getElementById("hull_points").innerHTML+=hullPoints[a].toUrlValue()+"<br>"}function sortPointX(a,b){return a.lng()-b.lng()}function sortPointY(a,b){return a.lat()-b.lat()}function isLeft(a,b,c){return(b.lng()-a.lng())*(c.lat()-a.lat())-(c.lng()-a.lng())*(b.lat()-a.lat())}function chainHull_2D(a,b,c){var d,e,f=0,g=-1,h=0,i=a[0].lng();for(d=1;b>d&&a[d].lng()==i;d++);if(e=d-1,e==b-1)return c[++g]=a[h],a[e].lat()!=a[h].lat()&&(c[++g]=a[e]),c[++g]=a[h],g+1;var j,k=b-1,l=a[b-1].lng();for(d=b-2;d>=0&&a[d].lng()==l;d--);for(j=d+1,c[++g]=a[h],d=e;++d<=j;)if(!(isLeft(a[h],a[j],a[d])>=0&&j>d)){for(;g>0&&!(isLeft(c[g-1],c[g],a[d])>0);)g--;c[++g]=a[d]}for(k!=j&&(c[++g]=a[k]),f=g,d=j;--d>=e;)if(!(isLeft(a[k],a[e],a[d])>=0&&d>e)){for(;g>f&&!(isLeft(c[g-1],c[g],a[d])>0);)g--;c[++g]=a[d]}return e!=h&&(c[++g]=a[h]),g+1}var Point,activityIndicatorOff,activityIndicatorOn,adData,animateHoverShadows,animateLoad,backupDebugLog,bindClicks,bindCopyEvents,bindDismissalRemoval,bsAlert,buildMap,byteCount,cancelAsyncOperation,canonicalizePoint,cartoAccount,cartoMap,cartoVis,checkFileVersion,checkLoggedIn,cleanupToasts,copyText,createConvexHull,createMap,createMap2,createRawCartoMap,d$,dateMonthToString,deEscape,decode64,deepJQuery,defaultFillColor,defaultFillOpacity,defaultMapMouseOverBehaviour,delay,disableDebugLogging,doCORSget,doMapBuilder,downloadCSVFile,e,enableDebugLogging,encode64,error1,fPoint,featureClickEvent,fetchCitation,foo,formatScientificNames,gMapsApiKey,generateCSVFromResults,getColumnObj,getConvexHull,getConvexHullConfig,getConvexHullPoints,getElementHtml,getLocation,getMapCenter,getMapZoom,getMaxZ,getPointsFromBoundingBox,getPosterFromSrc,goTo,isArray,isBlank,isBool,isEmpty,isHovered,isJson,isNull,isNumber,jsonTo64,lightboxImages,linkUsers,loadJS,localityFromMapBuilder,mapNewWindows,openLink,openTab,overlayOff,overlayOn,p$,post64,prepURI,randomInt,randomString,reInitMap,reportDebugLog,roundNumber,roundNumberSigfig,safariDialogHelper,setupMapMarkerToggles,sortPointX,sortPointY,sortPoints,startLoad,stopLoad,stopLoadError,toFloat,toInt,toObject,toastStatusMessage,toggleGoogleMapMarkers,uri,slice=[].slice,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};try{uri={},uri.o=$.url(),uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+uri.o.attr("directory"),uri.query=uri.o.attr("fragment")}catch(error1){e=error1,console.warn("PURL not installed!")}window.locationData={},locationData.params={enableHighAccuracy:!0},locationData.last=void 0,window.debounce_timer=null,null==window.adminParams&&(window.adminParams={}),null==window._adp&&(window._adp={}),isBool=function(a,b){var c;if(null==b&&(b=!1),b)return"boolean"==typeof a;try{return"boolean"==typeof a?a===!0||a===!1:"string"==typeof a?"true"===a.toLowerCase()||"false"===a.toLowerCase():"number"==typeof a?1===a||0===a:!1}catch(c){return e=c,!1}},isEmpty=function(a){return!a||0===a.length},isBlank=function(a){return!a||/^\s*$/.test(a)},isNull=function(a){var b;try{if((isEmpty(a)||isBlank(a)||null==a)&&a!==!1&&0!==a)return!0}catch(b){return e=b,!1}return!1},isJson=function(a){if("object"==typeof a&&!isArray(a))return!0;try{return JSON.parse(a),!0}catch(b){return!1}return!1},isArray=function(a){var b;try{return b=a.slice(0),b.push("foo"),!0}catch(c){return!1}},isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},toFloat=function(a){return!isNumber(a)||isNull(a)?0:parseFloat(a)},toInt=function(a){var b;return!isNumber(a)||isNull(a)?0:(b=parseFloat(a),parseInt(b))},String.prototype.toAscii=function(){return this.replace(/[\u2018\u2019\u201A\u201B\u2032\u2035]/g,"'").replace(/[\u201C\u201D\u201E\u201F\u2033\u2036]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"...").replace(/\u02C6/g,"^").replace(/\u2039/g,"").replace(/[\u02DC|\u00A0]/g," ")},String.prototype.toBool=function(){var a;return a=(""+this).toLowerCase(),"true"===a||"1"===a},Boolean.prototype.toBool=function(){return""+this=="true"},Number.prototype.toBool=function(){return""+this=="1"},String.prototype.addSlashes=function(){return this.replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.containsObject=function(a){var b,c;try{return c=_.find(this,function(b){return _.isEqual(a,b)}),"object"==typeof c}catch(b){return e=b,console.error("Please load underscore.js before using this."),console.info("https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js")}},Object.toArray=function(a){var b;try{return b=a.slice(0),b.push("foo"),a}catch(c){}return Object.keys(a).map(function(b){return function(b){return a[b]}}(this))},Object.size=function(a){var b,c,d;if("object"!=typeof a)try{return a.length}catch(b){e=b,console.error("Passed argument isn't an object and doesn't have a .length parameter"),console.warn(e.message)}d=0;for(c in a)a.hasOwnProperty(c)&&d++;return d},delay=function(a,b){return setTimeout(b,a)},roundNumber=function(a,b){var c;return null==b&&(b=0),c=Math.pow(10,b),Math.round(a*c)/c},roundNumberSigfig=function(a,b){var c,d,e,f,g;return null==b&&(b=0),e=""+roundNumber(a,b),c=e.split("."),1===c.length?e+"."+Array(b+1).join("0"):(g=c.pop(),f=c[0]+".",g.length===b?e:(d=b-g.length,g+=Array(d+1).join("0"),""+f+g))},String.prototype.stripHtml=function(a){var b;return null==a&&(a=!1),b=this,a&&(b=b.replace(/<(\w+)(?:[^"'>]|"[^"]*"|'[^']*')*>(?:((?:.)*?))<\/?\1(?:[^"'>]|"[^"]*"|'[^']*')*>/gm,"")),b=b.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),b=b.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"")},String.prototype.unescape=function(a){var b,c,d,e;return null==a&&(a=!1),c=document.createElement("div"),b=function(b){return null!=b&&"string"==typeof b&&(a!==!0?b=escape(b).replace(/%26/g,"&").replace(/%23/g,"#").replace(/%3B/g,";"):(b=b.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),b=b.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"")),c.innerHTML=b,c.innerText?(b=c.innerText,c.innerText=""):(b=c.textContent,c.textContent="")),unescape(b)},d=function(a){return a=a.replace(/\&amp;#/gm,"&#"),a=a.replace(/\&quot;/gm,'"'),a=a.replace(/\&quote;/gm,'"'),a=a.replace(/\&#95;/gm,"_"),a=a.replace(/\&#39;/gm,"'"),a=a.replace(/\&#34;/gm,'"'),a=a.replace(/\&#62;/gm,">"),a=a.replace(/\&#60;/gm,"<")},e=d(this),b(e)},deEscape=function(a){return a=a.replace(/\&amp;#/gm,"&#"),a=a.replace(/\&quot;/gm,'"'),a=a.replace(/\&quote;/gm,'"'),a=a.replace(/\&#95;/gm,"_"),a=a.replace(/\&#39;/gm,"'"),a=a.replace(/\&#34;/gm,'"'),a=a.replace(/\&#62;/gm,">"),a=a.replace(/\&#60;/gm,"<")},getElementHtml=function(a){return a.outerHTML},jQuery.fn.outerHTML=function(){return e=$(this).get(0),e.outerHTML},jQuery.fn.outerHtml=function(){return $(this).outerHTML()},copyText=function(a,b,c){var d,e,f,g;if(null==window.copyDebouncer&&(window.copyDebouncer={}),Date.now()-window.copyDebouncer.last<300)return console.warn("Skipping copy on debounce"),!1;window.copyDebouncer.last=Date.now(),f=md5($(c).html());try{return e={dataType:"text/plain",data:a},d=new ClipboardEvent("copy",e),document.dispatchEvent(d),!1}catch(h){}return null!=(null!=(g=_adp.copyObject)?g[f]:void 0)?(e={"text/plain":a},console.info('Setting up clipboard events for "'+a+'"'),_adp.copyObject[f].setData(e),_adp.copyObject[f].on("copy",function(a){try{return a.clipboardData={setData:_adp.copyObject[f].setData(e)}}catch(b){}}),_adp.copyObject[f].on("aftercopy",function(b){return b.data["text/plain"]===a?(toastStatusMessage("Copied to clipboard"),console.info("Succesfully copied",b.data["text/plain"]),window.hasRetriedCopy=!1):b.data["text/plain"]?(console.warn("Incorrect copy: instead of '"+a+"', '"+b.data["text/plain"]+"'"),window.hasRetriedCopy?(console.error("Re-copy failed!"),toastStatusMessage("Error copying to clipboard. Please try again")):(window.hasRetriedCopy=!0,delete window.copyDebouncer.last,delay(100,function(){return console.warn("Re-trying copy"),$(c).click(),console.info("Sent click")}))):(console.error("Bad data passed",b.data["text/plain"]),toastStatusMessage("Error copying to clipboard. Please try again"),window.hasRetriedCopy=!1),window.resetClipboard=!1,_adp.copyObject[f].setData(e)}),_adp.copyObject[f].on("error",function(b){if(console.error("Error copying to clipboard"),console.warn("Got",b),"flash-overdue"===b.name){if(window.resetClipboard===!0)return console.error("Resetting ZeroClipboard didn't work!"),!1;ZeroClipboard.on("ready",function(){return window.resetClipboard=!0,copyLink(window.tempZC,a)}),window.tempZC=new ZeroClipboard(c)}return"flash-disabled"===b.name?(console.info("No flash on this system"),ZeroClipboard.destroy(),$(".click-copy").remove(),p$("paper-dialog").refit(),toastStatusMessage("Clipboard copying isn't available on your system")):h})):console.error("Can't copy: zcObject doesn't exist for identifier "+f),!1},bindCopyEvents=function(a){return null==a&&(a=".click-copy"),loadJS("bower_components/zeroclipboard/dist/ZeroClipboard.min.js",function(){var b,c,d,e,f,g,h,i,j;for(j={swfPath:"bower_components/zeroclipboard/dist/ZeroClipboard.swf"},ZeroClipboard.config(j),g=$(a),h=[],e=0,f=g.length;f>e;e++)if(c=g[e],d=md5($(c).html()),null==_adp.copyObject&&(_adp.copyObject={}),null==_adp.copyObject[d]){if(console.info("Setting up copy events for identifier",d),_adp.copyObject[d]=new ZeroClipboard(c),i=$(c).attr("data-clipboard-text"),isNull(i)&&(b=$(c).attr("data-copy-selector"),i=$(b).val(),isNull(i)))try{i=p$(b).value}catch(k){}console.info("Registering copy text",i);try{delete window.copyDebouncer.last}catch(k){}h.push(copyText(i,_adp.copyObject[d],c))}else h.push(console.info("Copy event already set up for identifier",d));return h}),!1},jsonTo64=function(a,b){var c,d,e;null==b&&(b=!0);try{e=a.slice(0),e.push("foo"),a=toObject(a)}catch(f){}return d=JSON.stringify(a),c=b===!0?post64(d):encode64(c)},encode64=function(a){var b;try{return Base64.encode(a)}catch(b){return e=b,console.warn("Bad encode string provided"),a}},decode64=function(a){var b;try{return Base64.decode(a)}catch(b){return e=b,console.warn("Bad decode string provided"),a}},post64=function(a){var b,c;return c=encode64(a),b=encodeURIComponent(c)},jQuery.fn.polymerSelected=function(a,b){var c,d,f,g,h;if(null==a&&(a=void 0),null==b&&(b="attrForSelected"),c=$(this).attr(b),null==a){h=void 0;try{h=$(this).get(0).selected,isNumber(h)&&!isNull(c)&&(g=$(this).find("paper-item")[toInt(h)],h=$(g).attr(c))}catch(f){return e=f,!1}return"null"!==h&&null!=h||(h=void 0),h}if(isBool(a)){if($(this).parent().children().removeAttribute("aria-selected"),$(this).parent().children().removeAttribute("active"),$(this).parent().children().removeClass("iron-selected"),$(this).prop("selected",a),$(this).prop("active",a),$(this).prop("aria-selected",a),a===!0)return $(this).addClass("iron-selected")}else try{return $(this).get(0).select(a)}catch(d){return e=d,!1}},jQuery.fn.polymerChecked=function(a){var b;return null==a&&(a=void 0),null!=a?jQuery(this).prop("checked",a):(b=jQuery(this)[0].checked,"null"!==b&&null!=b||(b=void 0),b)},isHovered=function(a){return $(a+":hover").length>0},jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery.fn.isVisible=function(){return jQuery(this).is(":visible")&&"hidden"!==jQuery(this).css("visibility")},jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3},byteCount=function(a){return function(a){return encodeURI(a).split(/%..|./).length-1}}(this),toObject=function(a){var b,c,d;d={};for(c in a)b=a[c],void 0!==b&&(d[c]=b);return d},loadJS=function(a,b,c){var d,f,g,h;if(null==b&&(b={}),null==c&&(c=!0),$("script[src='"+a+"']").exists()){if("function"==typeof b)try{b()}catch(d){e=d,console.error("Script is already loaded, but there was an error executing the callback function - "+e.message)}return!0}return h=document.createElement("script"),h.setAttribute("src",a),h.setAttribute("async","async"),h.setAttribute("type","text/javascript"),h.src=a,h.async=!0,g=function(){var c,d,f;f=h.readyState;try{if(!b.done&&(!f||/loaded|complete/.test(f))&&(b.done=!0,"function"==typeof b))try{return b()}catch(c){return e=c,console.error("Postload callback error for "+a+" - "+e.message),console.warn(e.stack)}}catch(d){return e=d,console.error("Onload error - "+e.message)}},f=function(){var d,f;console.warn("There may have been a problem loading "+a);try{if(!b.done&&(b.done=!0,"function"==typeof b&&c))try{return b()}catch(d){return e=d,console.error("Post error callback error - "+e.message)}}catch(f){return e=f,console.error("There was an error in the error handler! "+e.message)}},h.setAttribute("onload",g),h.setAttribute("onreadystate",g),h.setAttribute("onerror",f),h.onload=h.onreadystate=g,h.onerror=f,document.getElementsByTagName("head")[0].appendChild(h),!0},String.prototype.toTitleCase=function(){var a,b,c,d,e,f,g,h,i,j,k;for(h=this.replace(/([^\W_]+[^\s-]*) */g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),f=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"],a=0,b=f.length;b>a;a++)d=f[a],e=RegExp("\\s"+d+"\\s","g"),h=h.replace(e,function(a){return a.toLowerCase()});for(k=["Id","Tv"],g=0,c=k.length;c>g;g++)i=k[g],j=RegExp("\\b"+i+"\\b","g"),h=h.replace(j,i.toUpperCase());return h},Function.prototype.getName=function(){var a;return a=this.name,null==a&&(a=(""+this).substr(0,(""+this).indexOf("(")).replace("function ","")),isNull(a)&&(a=md5(""+this)),a},Function.prototype.debounce=function(){var a,b,c,d,f,g,h,i,j;i=arguments[0],d=arguments[1],j=arguments[2],a=4<=arguments.length?slice.call(arguments,3):[],null==i&&(i=300),null==d&&(d=!1),null==j&&(j=window.debounce_timer),null==(null!=(h=window.core)?h.debouncers:void 0)&&(null==window.core&&(window.core={}),core.debouncers={});try{g=this.getName()}catch(k){}try{null!=core.debouncers[g]&&(j=core.debouncers[g])}catch(k){}if(f=this,b=function(){return null!=g&&(clearTimeout(j),delete core.debouncers[g]),d||f.apply(f,a),console.info("Debounce applied")},null!=j)try{clearTimeout(j)}catch(c){e=c}return d?(f.apply(obj,a),console.log("Executed "+g+" immediately"),!1):null!=g?(console.log("Debouncing '"+g+"' for "+i+" ms"),core.debouncers[g]=delay(i,function(){return b()})):(console.log("Delaying '"+g+"' for "+i+" ms"),window.debounce_timer=delay(i,function(){return b()}))},randomInt=function(a,b){var c,d,e;return null==a&&(a=0),null==b&&(b=1),e=Math.random(),null==a&&(c=[0,a],a=c[0],b=c[1]),a>b&&(d=[b,a],a=d[0],b=d[1]),Math.floor(e*(b-a+1)+a)},randomString=function(a){var b,c,d,e,f;for(null==a&&(a=8),e=0,c=65,d=126,f=[];a>e;)++e,b=randomInt(c,d),f.push(String.fromCharCode(b));return f.join("")},animateLoad=function(a){var b,c;null==a&&(a="loader"),isNumber(a)&&(a="loader"),"#"===a.slice(0,1)?(c=a,a=a.slice(1)):c="#"+a;try{return $(c).exists()?$(c).attr("active",!0):$("body").append('<paper-spinner id="'+a+'" active></paper-spinner'),!1}catch(b){return e=b,console.log("Could not animate loader",e.message)}},startLoad=animateLoad,stopLoad=function(a,b){var c,d;null==a&&(a="loader"),null==b&&(b=1e3),"#"===a.slice(0,1)?(d=a,a=a.slice(1)):d="#"+a;try{if($(d).exists())return $(d).addClass("good"),delay(b,function(){return $(d).removeClass("good"),$(d).removeAttr("active")})}catch(c){return e=c,console.log("Could not stop load animation",e.message)}},stopLoadError=function(a,b,c){var d,f;null==b&&(b="loader"),null==c&&(c=1e4),"#"===b.slice(0,1)?(f=b,b=b.slice(1)):f="#"+b;try{if($(f).exists())return $(f).addClass("bad"),null!=a&&toastStatusMessage(a,"",c),delay(c,function(){return $(f).removeClass("bad"),$(f).removeAttr("active")})}catch(d){return e=d,console.log("Could not stop load error animation",e.message)}},toastStatusMessage=function(a,b,c,d){var e,f,g;if(null==b&&(b=""),null==c&&(c=3e3),null==d&&(d="#status-message"),null==(null!=(f=window.metaTracker)?f.isToasting:void 0)&&null==window.metaTracker&&(window.metaTracker={},window.metaTracker.toastTracker=[],window.metaTracker.isToasting=!1),window.metaTracker.isToasting)return g=delay(250,function(){return toastStatusMessage(a,b,c,d)}),window.metaTracker.toastTracker.push(g),!1;window.metaTracker.isToasting=!0,isNumber(c)||(c=3e3),d.slice(0,1)===!1&&(d="#"+d),$(d).exists()||(e='<paper-toast id="'+d.slice(1)+'" duration="'+c+'"></paper-toast>',$(e).appendTo("body")),$(d).attr("text",a).text(a).addClass(b);try{p$(d).show()}catch(h){}return delay(c+500,function(){var a;try{a=p$(d).opened}catch(c){a=!1}return a||($(d).empty(),$(d).removeClass(b),$(d).attr("text","")),window.metaTracker.isToasting=!1})},cleanupToasts=function(){var a,b,c,d,e;for(c=window.metaTracker.toastTracker,d=[],a=0,b=c.length;b>a;a++){e=c[a];try{d.push(clearTimeout(e))}catch(f){}}return d},openLink=function(a){return null==a?!1:(window.open(a),!1)},openTab=function(a){return openLink(a)},goTo=function(a){return null==a?!1:(window.location.href=a,!1)},mapNewWindows=function(a){return null==a&&(a=!0),$(".newwindow").each(function(){var b;return b=$(this).attr("href"),null==b&&(b=$(this).attr("data-href")),$(this).click(function(c){return a&&(c.preventDefault(),c.stopPropagation()),openTab(b)}),$(this).keypress(function(){return openTab(b)})})},deepJQuery=function(a){var b,c;try{if(!$("html /deep/ "+a).exists())throw"Bad /deep/ selector";return $("html /deep/ "+a)}catch(b){e=b;try{if(!$("html >>> "+a).exists())throw"Bad >>> selector";return $("html >>> "+a)}catch(c){return e=c,$(a)}}},d$=function(a){return deepJQuery(a)},bindClicks=function(a){return null==a&&(a=".click"),$(a).each(function(){var a,b,c,d;try{if(d=$(this).attr("data-href"),!isNull(d)){$(this).unbind();try{d===uri.o.attr("path")&&"paper-tab"===$(this).prop("tagName").toLowerCase()&&$(this).parent().prop("selected",$(this).index())}catch(b){e=b,console.warn("tagname lower case error")}return $(this).click(function(){var a,b,c;try{return(null!=(a=$(this).attr("newTab"))?a.toBool():void 0)||(null!=(b=$(this).attr("newtab"))?b.toBool():void 0)||(null!=(c=$(this).attr("data-newtab"))?c.toBool():void 0)?openTab(d):goTo(d)}catch(e){return goTo(d)}}),d}if(a=$(this).attr("data-function"),null!=a)return $(this).unbind(),$(this).click(function(){var b;try{return console.log("Executing bound function "+a+"()"),window[a]()}catch(b){return e=b,console.error("'"+a+"()' is a bad function - "+e.message)}})}catch(c){return e=c,console.error("There was a problem binding to #"+$(this).attr("id")+" - "+e.message)}}),!1},dateMonthToString=function(a){var b,c;b={0:"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"};try{c=b[a]}catch(d){c=a}return c},getPosterFromSrc=function(a){var b,c,d;try{return d=a.split("."),b=d.pop(),d.push("png"),d.join(".")}catch(c){return e=c,""}},doCORSget=function(a,b,c,d){var f,g,h,i,j;null==c&&(c=void 0),null==d&&(d=void 0),f=function(){if("function"==typeof d)return d();throw Error("There was an error performing the CORS request")},i={url:a,data:b,type:"get",crossDomain:!0};try{$.ajax(i).done(function(a){return"function"==typeof c?(c(),!1):console.log(response)}).fail(function(a,b){return console.warn("Couldn't perform jQuery AJAX CORS. Attempting manually.")})}catch(h){e=h,console.warn("There was an error using jQuery to perform the CORS request. Attemping manually.")}if(a=a+"?"+b,g=function(a,b){var c;return null==a&&(a="get"),c=new XMLHttpRequest,"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c},j=g("get",a),!j)throw Error("CORS not supported");return j.onload=function(){var a;return a=j.responseText,"function"==typeof c&&c(a),console.log(a),!1},j.onerror=function(){return console.warn("Couldn't do manual XMLHttp CORS request"),f()},j.send(),!1},lightboxImages=function(a,b){var c,d;return null==a&&(a=".lightboximage"),null==b&&(b=!1),d={onStart:function(){return overlayOn()},onEnd:function(){return overlayOff(),activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif|bmp|webp",quitOnDocClick:!0,quitOnImgClick:!0},c=b?d$(a):$(a),loadJS("bower_components/imagelightbox/dist/imagelightbox.min.js",function(){return c.click(function(a){var b;try{return a.preventDefault(),a.stopPropagation(),$(this).imageLightbox(d).startImageLightbox(),console.warn("Event propagation was stopped when clicking on this.")}catch(b){return a=b,console.error("Unable to lightbox this image!")}}).each(function(){var b,c,f;console.log("Using selectors '"+a+"' / '"+this+"' for lightboximages");try{if("img"===$(this).prop("tagName").toLowerCase()&&"a"!==$(this).parent().prop("tagName").toLowerCase())return f=$(this).removeClass("lightboximage").prop("outerHTML"),c=function(){switch(!1){case!!isNull($(this).attr("data-layzr-retina")):return $(this).attr("data-layzr-retina");case!!isNull($(this).attr("data-layzr")):return $(this).attr("data-layzr");case!!isNull($(this).attr("data-lightbox-image")):return $(this).attr("data-lightbox-image");default:return $(this).attr("src")}}.call(this),$(this).replaceWith("<a href='"+c+"' class='lightboximage'>"+f+"</a>"),$("a[href='"+c+"']").imageLightbox(d)}catch(b){return e=b,console.log("Couldn't parse through the elements")}}),console.info("Lightboxed the following:",c)})},activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")},activityIndicatorOff=function(){return $("#imagelightbox-loading").remove(),$("#imagelightbox-overlay").click(function(){return $("#imagelightbox").click()})},overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")},overlayOff=function(){return $("#imagelightbox-overlay").remove()},formatScientificNames=function(a){return null==a&&(a=".sciname"),$(".sciname").each(function(){var a;return a="italic"===$(this).css("font-style")?"normal":"italic",$(this).css("font-style",a)})},prepURI=function(a){return a=encodeURIComponent(a),a.replace(/%20/g,"+")},window.locationData={},locationData.params={enableHighAccuracy:!0},locationData.last=void 0,getLocation=function(a){var b,c,d;return null==a&&(a=void 0),d=1500,c=function(b){var c,e;return clearTimeout(window.geoTimeout),window.locationData.lat=b.coords.latitude,window.locationData.lng=b.coords.longitude,window.locationData.acc=b.coords.accuracy,e=window.locationData.last,window.locationData.last=Date.now(),c=window.locationData.last-e,d>c?!1:(console.info("Successfully set location"),"function"==typeof a&&a(window.locationData),!1)},b=function(b){var c;return clearTimeout(window.geoTimeout),c=function(){switch(b.code){case 0:return"There was an error while retrieving your location: "+b.message;case 1:return"The user prevented this page from retrieving a location";case 2:return"The browser was unable to determine your location: "+b.message;case 3:return"The browser timed out retrieving your location."}}(),console.error(c),"function"==typeof a&&a(!1),!1},navigator.geolocation?(console.log("Querying location"),navigator.geolocation.getCurrentPosition(c,b,window.locationData.params),window.geoTimeout=delay(1500,function(){return getLocation(a)})):(console.warn("This browser doesn't support geolocation!"),null!=a?a(!1):void 0)},getMaxZ=function(){var a;return a=function(){return $.map($("body *"),function(a,b){return"static"!==$(a).css("position")?parseInt($(a).css("z-index")||1):void 0})},Math.max.apply(null,a())},foo=function(){return toastStatusMessage("Sorry, this feature is not yet finished"),stopLoad(),!1},safariDialogHelper=function(a,b,c){var d,f,g;if(null==a&&(a="#download-chooser"),null==b&&(b=0),"function"!=typeof c&&(c=function(){return bindDismissalRemoval()}),!(10>b))return stopLoadError("Unable to show dialog. Please try again.");try{return d$(a).get(0).open(),delay(125,function(){return d$(a).get(0).refit()}),"function"==typeof c&&c(),stopLoad()}catch(f){return e=f,g=b+1,d=250,delay(d,function(){return console.warn("Trying again to display dialog after "+g*d+"ms"),safariDialogHelper(a,g,c)})}},bindDismissalRemoval=function(){return $("[dialog-dismiss]").unbind().click(function(){return $(this).parents("paper-dialog").remove()})},p$=function(a){try{return $$(a)[0]}catch(b){return $(a).get(0)}},bsAlert=function(a,b,c,d){var e,f;return null==b&&(b="warning"),null==c&&(c="body"),null==d&&(d="#bs-alert"),$(d).exists()?($(d).removeClass("alert-warning alert-info alert-danger alert-success"),$(d).addClass("alert-"+b)):(e='<div class="alert alert-'+b+' alert-dismissable hanging-alert" role="alert" id="'+d.slice(1)+'">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <div class="alert-message"></div>\n</div>',f=$("main").exists()?"main":$("article").exists()?"article":c,$(f).prepend(e)),$(d+" .alert-message").html(a),bindClicks(),mapNewWindows(),!1},animateHoverShadows=function(a,b,c){var d,e;return null==a&&(a="paper-card.card-tile"),null==b&&(b=2),null==c&&(c=4),d=function(){return $(this).attr("elevation",c)},e=function(){return $(this).attr("elevation",b)},$(a).hover(d,e),!1},checkFileVersion=function(a,b){var c,d,e;null==a&&(a=!1),null==b&&(b="js/c.min.js"),d=b.split("/").pop().split(".")[0],c=function(e,f){return null==e&&(e=b),null==f&&(f=d),$.get(uri.urlString+"meta.php","do=get_last_mod&file="+e,"json").done(function(b){var c;return a&&console.log("Forced version check:",b),isNumber(b.last_mod)?(null==_adp.lastMod&&(window._adp.lastMod={}),null==_adp.lastMod[f]&&(window._adp.lastMod[f]=b.last_mod),b.last_mod>_adp.lastMod[f]?(c='<div id="outdated-warning" class="alert alert-warning alert-dismissible fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>We have page updates!</strong> This page has been updated since you last refreshed. <a class="alert-link" id="refresh-page" style="cursor:pointer">Click here to refresh now</a> and get bugfixes and updates.\n</div>',$("#outdated-warning").exists()||($("body").append(c),$("#refresh-page").click(function(){return document.location.reload(!0)})),console.warn("Your current version of this page is out of date! Please refresh the page.")):a?console.info("Your version of this page is up to date: have "+window._adp.lastMod[f]+", got "+b.last_mod):void 0):!1}).fail(function(){return console.warn("Couldn't check file version!!")}).always(function(){return delay(3e5,function(){return c(e,f)})})};try{e=window._adp.lastMod[d]}catch(f){e=!1}return a||null==window._adp.lastMod||!e?(c(b,d),!0):!1},window.checkFileVersion=checkFileVersion,checkLoggedIn=function(a){var b,c,d,e,f;return c=$.cookie(uri.domain+"_auth"),f=$.cookie(uri.domain+"_secret"),d=$.cookie(uri.domain+"_link"),b="hash="+c+"&secret="+f+"&dblink="+d,e=uri.urlString+"admin/async_login_handler.php",$.post(e,b,"json").done(function(b){return console.info("Got",b),a(b)}).fail(function(b,c){var d;return d={status:!1},a(d)}),!1},downloadCSVFile=function(a,b){var c,d,f,g,h,i,j,k,l,m,n,o,p,q,r;if(r="",isJson(a))console.info("Parsing as JSON string"),l=JSON.parse(a);else if(isArray(a))console.info("Parsing as array"),l=toObject(a);else{if("object"!=typeof a)return console.error("Unexpected data type '"+typeof a+"' for downloadCSVFile()",a),!1;console.info("Parsing as object"),l=a}for(null==b&&(b={}),null==b.create&&(b.create=!1),null==b.downloadFile&&(b.downloadFile="datalist.csv"),null==b.classes&&(b.classes="btn btn-default"),null==b.buttonText&&(b.buttonText="Download File"),null==b.iconHtml&&(b.iconHtml='<iron-icon icon="icons:cloud-download"></iron-icon>'),null==b.selector&&(b.selector="#download-file"),null==b.splitValues&&(b.splitValues=!1),null==b.cascadeObjects&&(b.cascadeObjects=!1),null==b.objectAsValues&&(b.objectAsValues=!1),h=[],(p=function(c,d){var f,g,i,j,k,l,m,n,o,q,s,t,u;q=0,b.objectAsValues&&(b.splitValues="::@@::"),o=[];for(l in c)if(u=c[l],"function"!=typeof u){++q;try{if(j=(""+l).replace(/"/g,'""'),1===q)if(b.objectAsValues){console.info("objectAsValues set");for(f in u)a=u[f],isArray(b.acceptableCols)?indexOf.call(b.acceptableCols,f)>=0&&h.push(f):h.push(f);console.log("Using as header",h)}else console.log("Boring options",b.objectAsValues,b),h.push(j);if("object"==typeof u&&d&&(u=p(u,!0)),k=function(a,c){var d,e,f,g;return null==a&&(a=u),null==c&&(c=b),isNull(u)?d="":("object"==typeof a&&(a=JSON.stringify(a)),a=""+a,e=a.replace(/"/g,'""'),e=a.replace(/<\/p><p>/g,'","'),"string"==typeof c.splitValues&&(f=e.split(c.splitValues),e=f.join('","'),j=!1),d=e),j===!1?g='"'+d+'"\n':isNumber(j)?g='"'+d+'",':isNull(j)||(g='"'+j+'","'+d+'"\n'),g},b.objectAsValues){for(s=[],m=0,n=h.length;n>m;m++){if(f=h[m],g=u[f],"object"==typeof g)try{g=JSON.stringify(g)}catch(v){}s.push(g)}t=s.join(b.splitValues),o.push(r+=k(t,b))}else o.push(r+=k(u))}catch(i){e=i,console.warn("Unable to run key "+l+" on row "+q,u,c),o.push(console.warn(e.stack))}}return o})(l,b.cascadeObjects),r=r.trim(),m=0,n=0,o=h.length;o>n;n++)d=h[n],d=d.replace(/"/g,'""'),h[m]=d,++m;return b.objectAsValues&&(b.header=h),isArray(b.header)?(i=b.header.join('","'),r='"'+i+'"\n'+r,r=r.trim(),g="present"):g="absent",","===r.slice(-1)&&(r=r.slice(0,-1)),f="data:text/csv;charset=utf-8;header="+g+","+encodeURIComponent(r),q=b.selector,b.create===!0?(c=$(q).find("button").length,k=q.slice(1)+"-download-button-"+c,j='<a id="'+k+'" class="'+b.classes+'" href="'+f+'" download="'+b.downloadFile+'">\n  '+b.iconHtml+"\n  "+b.buttonText+"\n</a>",$(q).append(j)):$(q).attr("download",b.downloadFile).attr("href",f),f},linkUsers=function(a){var b,c;return null==a&&(a=".is-user"),c="https://amphibiandisease.org/profile.php",b="?id=",$(a).addClass("linked-user-profile").attr("title","Visit Profile").attr("data-toggle","tooltip").click(function(){var a,d,e,f,g,h,i;if(i=$(this).attr("data-uid"),h=$(this).attr("data-email"),!isNull(i))return e=""+c+b+i,document.location.href=e,!1;if(isNull(h)){if(g=$(this).text(),isNull(g)&&(g=$(this).attr("data-name"),isNull(g)))return console.error("Unable to find a search criterion!"),!1;d="name"}else g=h,d="username,alternate_email";return startLoad(),f=encodeURIComponent(g),a="action=search_users&q="+f+"&cols="+d,$.post(uri.urlString+"api.php",a,"json").done(function(a){var d,f,h;return console.info("Found",a),a.status!==!0?(console.error("Error searching for profile"),stopLoadError("There was an error looking up the user. Please try again later."),!1):(f=Object.toArray(a.result),f.length<1?(stopLoadError("Couldn't find user '"+g+"'"),!1):(stopLoad(),d=f[0],h=d.uid,e=""+c+b+h,document.location.href=e,!1))}).fail(function(a,b){return console.error(a,b),stopLoadError("Error communicating with server. Please try again later."),!1}),!1}),!1},fetchCitation=function(a,b){var c,d,f;return d="https://api.crossref.org/works/",c=encodeURIComponent(a),f=""+d+a,$.get(f,"","json").done(function(a){
var c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;for(n=a.message,f=[],j=0,u=n.author,o=0,p=u.length;p>o;o++){for(c=u[o],l=c.given.split(" "),k="",r=0,q=l.length;q>r;r++)i=l[r],s=i.slice(0,1),k+=s;if(d=c.family+" "+k,f.push(d),++j,j>2){f.push("et al");break}}t=null!=(v=null!=(w=null!=(x=n["published-print"])&&null!=(y=x["date-parts"])&&null!=(z=y[0])?z[0]:void 0)?w:null!=(A=n["published-online"])&&null!=(B=A["date-parts"])&&null!=(C=B[0])?C[0]:void 0)?v:"In press",m=null!=n.issue?"("+n.issue+")":"";try{g=f.join(", ")+". "+n.title[0]+". "+n["container-title"][0]+" "+t+";"+n.volume+m+":"+n.page+"."}catch(h){e=h,console.warn("Couldn't generate full citation"),console.warn(n),g=f.join(", ")+". "+n.title[0]+". "+n["container-title"][0]+". In press."}return console.log(g),"function"==typeof b&&b(g,n.link[0].URL),!1}).fail(function(a,b){return console.error("Failed to fetch citation")}),!1},cancelAsyncOperation=function(a,b){null==b&&(b=_adp.currentAsyncJqxhr);try{null!=a&&$(a).remove()}catch(c){}try{if(b.readyState===XMLHttpRequest.DONE)return console.warn("Couldn't cancel operation -- it's already completed"),!1;b.abort();try{stopLoadBarsError(null,"Operation Cancelled")}catch(d){stopLoadError("Operation Cancelled")}}catch(e){console.error("Couldn't abort current async operation")}return!1},generateCSVFromResults=function(a,b,c){var d,e,f;null==c&&(c="#modal-sql-details-list"),animateLoad(),toastStatusMessage("This may take a few seconds, please wait"),console.info("Given",a),$("#download-file").remove(),e='<a tabindex="-1" id="download-file" class="paper-button-link">\n  <paper-button disabled>\n    <iron-icon icon="icons:cloud-download"></iron-icon>\n    Download File\n  </paper-button>\n</a>',$(b).replaceWith(e),f={objectAsValues:!0,acceptableCols:["collectionid","catalognumber","fieldnumber","diseasetested","diseasestrain","samplemethod","sampledisposition","diseasedetected","fatal","cladesampled","genus","specificepithet","infraspecificepithet","lifestage","dateidentified","decimallatitude","decimallongitude","alt","coordinateuncertaintyinmeters","collector","fimsextra","originaltaxa"]};try{d=downloadCSVFile(a,f),$(c+" #download-file paper-button").removeAttr("disabled"),stopLoad()}catch(g){stopLoadError("Sorry, there was a problem with this dataset and we can't do that right now.")}return!1},$(function(){var a;bindClicks(),formatScientificNames(),lightboxImages(),animateHoverShadows(),checkFileVersion(),linkUsers();try{$(".do-mailto").click(function(){var a;return a=$(this).attr("data-email"),document.location.href="mailto:"+a,!1})}catch(b){}try{$("body").tooltip({selector:"[data-toggle='tooltip']"})}catch(a){e=a,console.warn("Tooltips were attempted to be set up, but do not exist")}try{checkAdmin(),("undefined"!=typeof adminParams&&null!==adminParams?adminParams.loadAdminUi:void 0)===!0?loadJS("js/admin.js",function(){return console.info("Loaded admin file"),loadAdminUi()}):console.info("No admin setup requested"),$("header .header-bar-user-name").click(function(){return goTo(uri.urlString+"profile.php")})}catch(b){}return loadJS(uri.urlString+"js/prism.js")}),uri.domain=uri.o.attr("host").split(".").reverse().pop(),cartoAccount="mvz",gMapsApiKey="AIzaSyAZvQMkfFkbqNStlgzNjw1VOWBASd74gq4",cartoMap=null,cartoVis=null,defaultFillColor="#ff7800",defaultFillOpacity=.35,adData={},window.geo={},geo.GLOBE_WIDTH_GOOGLE=256,geo.initLocation=function(){try{return window.locationData.lat=37.871527,window.locationData.lng=-122.262113,getLocation(function(){return _adp.currentLocation=new Point(window.locationData.lat,window.locationData.lng)})}catch(a){}},geo.init=function(a){var b;try{window.locationData.lat=37.871527,window.locationData.lng=-122.262113,getLocation(function(){return _adp.currentLocation=new Point(window.locationData.lat,window.locationData.lng)})}catch(c){}return b='<link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />',$("head").append(b),null==a&&(a=function(){return getCanonicalDataCoords(geo.dataTable),!1}),window.gMapsCallback=function(){return a()},null==("undefined"!=typeof google&&null!==google?google.maps:void 0)?loadJS("https://maps.googleapis.com/maps/api/js?key="+gMapsApiKey+"&callback=gMapsCallback"):window.gMapsCallback()},getMapCenter=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(null==a&&(a=geo.canonicalBoundingBox),null!=a){for(g=0,k=0,l=0,b=Object.toArray(a),h=0,i=b.length;i>h;h++)f=b[h],++g,j=canonicalizePoint(f),k+=j.lat,l+=j.lng;d=toFloat(k)/toFloat(g),e=toFloat(l)/toFloat(g),c={lat:d,lng:e}}else c={lat:window.locationData.lat,lng:window.locationData.lng};return c=canonicalizePoint(c)},getPointsFromBoundingBox=function(a){var b,c,d,e,f;for(c=[[a.bounding_box_n,a.bounding_box_w],[a.bounding_box_n,a.bounding_box_e],[a.bounding_box_s,a.bounding_box_e],[a.bounding_box_s,a.bounding_box_w]],f=[],d=0,e=c.length;e>d;d++)b=c[d],console.log("Pushing corner",b),f.push(canonicalizePoint(b));return f},null==geo.mapSelector&&(geo.mapSelector="#transect-viewport"),getMapZoom=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;if(null==b&&(b=geo.mapSelector),null==c&&(c=!0),D=$(window).width()<1024?1:2,null!=a){g=-180,y=180,o=-90,x=90,isArray(a)&&(a=toObject(a)),console.info("Working with dataset",a),Object.size(a)<3&&console.warn("Danger: Very small dataset");for(h in a)f=a[h],j=null!=f.lng?f.lng:f[1],i=null!=f.lat?f.lat:f[0],y>j&&(y=j),j>g&&(g=j),x>i&&(x=i),i>o&&(o=i);for(e=g-y,q=o-x;0>e;)e+=360;for(;0>q;)q+=360;$(b).exists()||console.warn("Can't find '"+b+"' - will use 650x480"),n=null!=(t=$(b).width())?t:650,l=null!=(u=$(b).height())?u:480,d=360/e,m=d/geo.GLOBE_WIDTH_GOOGLE,p=360/q,r=p/geo.GLOBE_WIDTH_GOOGLE,E=Math.log(n*m)/Math.LN2,s=Math.log(l*r)/Math.LN2,console.info("Calculated raw zoom",E,s),console.info("Sources",n,m,Math.LN2),D>s&&(s=100),D>E&&(E=100),z=E>s?s:E,(D>z||z>20)&&(z=7.5),A=toInt(z),console.log("Diff between zoomBasis vs zoomCalc",z-A),v=.6,w=16,B=v/w,C=B*z,C>z-A&&--A}else A=7;if(c&&$(b).exists()&&"google-map"===$(b).get(0).tagName.toLowerCase()){console.log("Trying to assign zoom");try{k=p$(b),k.isAttached?(console.info("Setting zoom on "+b+" to "+A),k.zoom=A,k.ready=function(){return k.zoom=A}):(console.info("Deferring till ready"),$(b).on("google-map-ready",function(){return k.zoom=A}))}catch(F){console.warn("Zoom setting failed!")}}return A},geo.getMapZoom=getMapZoom,defaultMapMouseOverBehaviour=function(a,b,c,d,e){return console.log(a,b,c,d,e)},createMap2=function(a,b,c){var d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X;console.log("createMap2 was provided options:",b),null==b&&(b={},b={polyParams:{fillColor:defaultFillColor,fillOpacity:defaultFillOpacity},classes:"",onClickCallback:null,skipHull:!1,skipPoints:!1,boundingBox:null,selector:"#carto-map-container",bsGrid:"col-md-9 col-lg-6",resetMapBuilder:!0,onlyOne:!0}),R=null!=b.selector?b.selector:"#carto-map-container";try{if(K=null!=(null!=b&&null!=(N=b.polyParams)?N.fillColor:void 0)&&null!=(null!=b&&null!=(O=b.polyParams)?O.fillOpacity:void 0)?b.polyParams:{fillColor:defaultFillColor,fillOpacity:defaultFillOpacity},console.info("createMap2 working with data",a),Object.size(a)<3){try{I=Object.toArray(a)}catch(Y){I=[]}if(J=[],b.skipHull=!0,0===I.length)b.skipPoints=!0;else for(t=0,u=I.length;u>t;t++)G=I[t],console.log("Checking",G,"in",I),J.push(canonicalizePoint(G));if(null!=b.boundingBox){if(null!=b.boundingBox.nw)J.push(canonicalizePoint(b.boundingBox.nw)),J.push(canonicalizePoint(b.boundingBox.ne)),J.push(canonicalizePoint(b.boundingBox.sw)),J.push(canonicalizePoint(b.boundingBox.se));else for(P=b.boundingBox,y=0,v=P.length;v>y;y++)G=P[y],J.push(canonicalizePoint(G));o=createConvexHull(J),b.skipHull=!1}}else j=createConvexHull(a,!0),o=j.hull,J=j.points;console.info("createMap2 working with",J);try{X=getMapZoom(J,R),console.info("Got zoom",X)}catch(Z){X=""}if(b.skipHull!==!0){for(z='<google-map-poly closed fill-color="'+K.fillColor+'" fill-opacity="'+K.fillOpacity+'" stroke-weight="1">',L=0,w=o.length;w>L;L++)G=o[L],z+='<google-map-point latitude="'+G.lat+'" longitude="'+G.lng+'"> </google-map-point>';z+="    </google-map-poly>"}else z="";if(b.skipPoints!==!0){for(p=0,U=0,x=J.length;x>U;U++){G=J[U],D="",E="";try{null!=a[p].infoWindow?(s=a[p].infoWindow,E=escape(null!=(Q=s.title)?Q:""),D=s.html,null!=a[p].data?(H=a[p].data,k=null!=H.diseasedetected?H.diseasedetected:H.diseaseDetected,g=null!=H.catalognumber?H.catalognumber:H.catalogNumber,S=null!=H.specificepithet?H.specificepithet:H.specificEpithet,T=null!=H.infraspecificepithet?H.infraspecificepithet:H.infraspecificeEpithet,null==T&&(T=""),isNull(E)&&g+": "+H.genus+" "+S+" "+T):k=""):null!=a[p].data&&(H=a[p].data,m=H.genus,S=null!=H.specificepithet?H.specificepithet:H.specificEpithet,F=null!=H.originaltaxa?H.originaltaxa:H.originalTaxa,k=null!=H.diseasedetected?H.diseasedetected:H.diseaseDetected,W=null!=H.diseasetested?H.diseasetested:H.diseaseTested,null==m&&(m="No Data"),null==S&&(S=""),F=isNull(F)?"":"("+F+")",V=null!=k&&null!=W?"<br/> Tested <strong>"+k+"</strong> for "+W:"",D="<p>\n  <em>"+m+" "+S+"</em> "+F+"\n  "+V+"\n</p>",null==H.catalogNumber&&null==H.catalognumber||(f=null!=H.catalognumber?H.catalognumber:H.catalogNumber,T=null!=H.infraspecificepithet?H.infraspecificepithet:H.infraspecificEpithet,E=f+": "+m+" "+S))}catch(_){}G=canonicalizePoint(G),C='<google-map-marker latitude="'+G.lat+'" longitude="'+G.lng+'" data-disease-detected="'+k+'" title="'+E+'" animation="DROP">\n  '+D+"\n</google-map-marker>",z+=C}h=getMapCenter(J)}else{if(null==window.locationData)try{window.locationData.lat=37.871527,window.locationData.lng=-122.262113,getLocation(function(){return _adp.currentLocation=new Point(window.locationData.lat,window.locationData.lng)})}catch(_){}h=new Point(window.locationData.lat,window.locationData.lng),X=14}A=null!=geo.googleMap?'map="geo.googleMap"':"",r=$("google-map").length,q="transect-viewport-"+r,B="#"+q,null!=(null!=b?b.classes:void 0)?("object"==typeof b.classes?(d=Object.toArray(b.classes),i=d.join(" ")):i=b.classes,i=escape(i)):i="",n='<google-map id="'+q+'" latitude="'+h.lat+'" longitude="'+h.lng+'" map-type="hybrid" click-events  zoom="'+X+'" class="col-xs-12 '+b.bsGrid+" center-block clearfix google-map transect-viewport map-viewport "+i+'" api-key="'+gMapsApiKey+'" '+A+">\n      "+z+"\n</google-map>",b.onlyOne===!0&&(R=$("google-map").get(0)),$(R).exists()||(R="#carto-map-container",$(R).exists()||(R="body")),"google-map"!==$(R).get(0).tagName.toLowerCase()?(console.log("Appending map to selector "+R,$(R)),$(R).addClass("map-container has-map").append(n)):(console.log("Replacing map at selector "+R),$(R).replaceWith(n)),console.log("Attaching events to "+B),null==window.mapBuilder&&(window.mapBuilder={},window.mapBuilder.points=[],window.mapBuilder.selector="#"+$(B).attr("id")),(null!=b?b.resetMapBuilder:void 0)!==!1?window.mapBuilder.points=[]:window.mapBuilder.selector="#"+$(B).attr("id"),null==(null!=b?b.onClickCallback:void 0)&&(null==b&&(b={}),b.onClickCallback=function(a,b){return null==window.mapBuilder&&(window.mapBuilder={},window.mapBuilder.selector="#"+$(b).attr("id"),window.mapBuilder.points=[]),window.mapBuilder.points.push(a),$("#init-map-build").removeAttr("disabled"),$("#init-map-build .points-count").text(window.mapBuilder.points.length),C=document.createElement("google-map-marker"),C.setAttribute("latitude",a.lat),C.setAttribute("longitude",a.lng),C.setAttribute("animation","DROP"),Polymer.dom(b).appendChild(C),!1}),$(""+B).on("google-map-click",function(a){var c;return c=a.originalEvent.detail.latLng,G=canonicalizePoint(c),console.info("Clicked point "+G,G,c),"function"==typeof b.onClickCallback?b.onClickCallback(G,this):console.warn("google-map-click wasn't provided a callback"),!1}),M={selector:B,html:n,points:J,hull:o,center:h},console.info("Map",M),geo.googleMapWebComponent=n,"function"==typeof c&&(console.log("createMap2 calling back"),c(M))}catch(l){e=l,console.error("Couldn't create map! "+e.message),console.warn(e.stack)}return!1},reInitMap=function(a){var b,c,d,e,f,g,h,i;for(d=p$(a),d.map=null,f=d.objects,d._initGMap(),e=[],b=0,c=f.length;c>b;b++)g=f[b],"google-map-poly"===g.tagName.toLowerCase()&&(g._points=[],$(g).find("google-map-point").each(function(){var a,b,c,d;return a=$(this).attr("latitude"),b=$(this).attr("longitude"),d={lat:toFloat(a),lng:toFloat(b)},c=new google.maps.LatLng(d),g._points.push(c)}),g.path=null,g.map=d.map,i={clickable:g.clickable||g.draggable,draggable:g.draggable,editable:g.editable,geodesic:g.geodesic,map:g.map,strokeColor:g.strokeColor,strokeOpacity:g.strokeOpacity,strokePosition:g._convertStrokePosition(),strokeWeight:g.strokeWeight,visible:!g.hidden,zIndex:g.zIndex},h=new google.maps.Polygon(i),h.setPaths(g._points),g._setPoly(h),e.push(g));return d.objects=e},buildMap=function(a,b,c){return null==a&&(a=window.mapBuilder),null==b&&(b={selector:a.selector,resetMapBuilder:!1}),createMap2(a.points,b,c),!1},featureClickEvent=function(a,b,c,d,e){var f,g,h,i;console.log("Clicked feature event",d,c,b),g=[];for(f in d)i=d[f],g.push(f);h=["genus","specificepithet","diseasedetected"],geo.infoWindow=cartodb.vis.Vis.addInfowindow(geo.lMap,e,h);try{geo.infoWindow.on("close",function(){return this.remove()})}catch(j){}return!1},createRawCartoMap=function(a,b,c,d,e){var f,g,h,i,j,k,l,m;return null==d&&(d="#global-data-map"),null==e&&(e=featureClickEvent),isNull(c)&&(c={}),k=null==a.user_name?{user_name:null!=(l=c.user_name)?l:cartoAccount,type:null!=(m=c.type)?m:"cartodb",sublayers:a,extra_params:{map_key:window.apiKey,api_key:window.apiKey}}:a,console.info("Creating map",k),j={cartodb_logo:!1,https:!0,mobile_layout:!0},i={center:[window.locationData.lat,window.locationData.lng],zoom:5},null==geo.lMap&&(g=new L.Map("global-map-container",i),geo.lMap=g,h={attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community"},L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",h).addTo(g)),f=geo.lMap,cartodb.createLayer(f,k,j).addTo(f,1).on("done",function(c){var d,g,h,i,j,l,m,n;try{c.setParams("table_name",k.named_map.params.table_name)}catch(o){console.warn("Couldn't explicitly set table")}if(isArray(a)){for(h=0,i=a.length;i>h;h++)d=a[h],console.info("Re-adding sublayer",d),c.createSubLayer(d);console.info("Added layers to map")}null==geo.mapSublayers&&(geo.mapSublayers=[]),j=c.getSubLayerCount();try{c.setInteraction(!0)}catch(p){}try{c.unbind("featureClick")}catch(p){}for(c.on("featureClick",function(a,b,d,f,g){return e.debounce(150,!1,null,a,b,d,f,c),!1}).on("error",function(a){return console.warn("Error on layer feature click",a)}),g=0;j>g;){n=c.getSubLayer(g),n.setInteraction(!0);try{m=k.named_map.params.table_name.slice(0,63),l=function(a,b,c){var d;return null==c&&(c=0),d="#infowindow_template_"+b,$(d).exists()?(a.infowindow.set("template",$(d).html()),console.info("Successfully assigned template "+d+" to sublayer")):100>c?delay(200,function(){return c+=1,l(a,b,c)}):console.warn("Timed out (count: "+c+") trying to assign a template for '"+b+"'",d)},l(n,m)}catch(p){}geo.mapSublayers.push(n),++g}c.show();try{console.log("Layer counts:",f.overlayMapTypes.length)}catch(p){}return"function"==typeof b&&b(),!1}).on("error",function(a){return toastStatusMessage("Couldn't load maps!"),console.error("Couldn't get map - "+a)}),!1},createMap=function(a,b,c,d){var f,g,h,i;return null==a&&(a="38544c04-5e56-11e5-8515-0e4fddd5de28"),null==b&&(b="carto-map-container"),null==a&&console.info("Can't create map without a data visualization identifier"),geo.mapId=b,geo.mapSelector="#"+b,h=function(){var f,h,i,j;null==c&&(c={cartodb_logo:!1,https:!0,mobile_layout:!0,gmaps_base_type:"hybrid",center_lat:window.locationData.lat,center_lon:window.locationData.lng,zoom:getMapZoom(geo.boundingBox)}),geo.mapParams=c,$("#"+b).exists()||(f='<div id="'+b+'" class="carto-map wide-map map-container">\n  <!-- Dynamically inserted from unavailable target -->\n</div>',$("main #main-body").append(f)),"function"!=typeof d&&(d=function(a,b){return cartodb.createLayer(b,g).addTo(b).done(function(a){geo.mapLayer=a;try{return a.setInteraction(!0),a.on("featureOver",defaultMapMouseOverBehaviour)}catch(b){return console.warn("Can't set carto map interaction")}})}),j={center:new google.maps.LatLng(c.center_lat,c.center_lon),zoom:c.zoom,mapTypeId:google.maps.MapTypeId.HYBRID},geo.googleMap=new google.maps.Map(document.getElementById(b),j),geo.cartoMap=geo.googleMap,i=function(b){return console.info("Fetched data into Google Map from CartoDB account "+cartoAccount+", from data set "+a),geo.mapLayer=b,geo.cartoMap=geo.googleMap,clearTimeout(h),"function"==typeof d&&d(b,geo.cartoMap),!1};try{console.info("About to render map with options",geo.cartoUrl,c),cartodb.createLayer(geo.googleMap,geo.cartoUrl,c).addTo(geo.googleMap).on("done",function(a){return i(a)}).on("error",function(a){return toastStatusMessage("Couldn't load maps!"),console.error("Couldn't get map - "+a)}),h=delay(1e3,function(){return"function"==typeof d?(console.warn("Callback wasn't called, forcing"),d(null,geo.cartoMap)):void 0})}catch(k){console.warn("The map threw an error! "+e.message),console.warn(e.stack),clearTimeout(h),"function"==typeof d&&d(null,geo.cartoMap)}return!1},"object"!=typeof a?(g=/^https?:\/\/.*$/m.test(a)?a:"https://"+cartoAccount+".cartodb.com/api/v2/viz/"+a+"/viz.json",geo.cartoUrl=g,h()):(f={},i="http://tigerhawkvok.cartodb.com/api/v2/viz/38544c04-5e56-11e5-8515-0e4fddd5de28/viz.json",$.get(i,"","json").done(function(b){var c,d,e;f=b,d=[];for(c in a)e=a[c],d.push(f[c]=e);return d}).fail(function(b,c){return f=a}).always(function(){return g=f,geo.cartoUrl=g,h()}))},getColumnObj=function(a){var b;return null==a&&(a=!1),b={id:"int",collectionID:"varchar",catalogNumber:"varchar",fieldNumber:"varchar",diseaseTested:"varchar",diseaseStrain:"varchar",sampleMethod:"varchar",sampleDisposition:"varchar",diseaseDetected:"varchar",fatal:"boolean",cladeSampled:"varchar",genus:"varchar",specificEpithet:"varchar",infraspecificEpithet:"varchar",lifeStage:"varchar",dateIdentified:"date",decimalLatitude:"decimal",decimalLongitude:"decimal",alt:"decimal",coordinateUncertaintyInMeters:"decimal",Collector:"varchar",originalTaxa:"varchar",fimsExtra:"json",the_geom:"varchar"},null==_adp.activeCols||a?b:_adp.activeCols},geo.requestCartoUpload=function(a,b,c,d){var f,g,h,i,j,k;startLoad();try{h=a.data}catch(l){}return"object"!=typeof h?(console.info("This function requires the base data to be a JSON object."),toastStatusMessage("Your data is malformed. Please double check your data and try again."),!1):(f=["edit","insert","delete","create"],indexOf.call(f,c)<0?(console.error(c+" is not an allowed operation on a data set!"),console.info("Allowed operations are ",f),toastStatusMessage("Sorry, '"+c+"' isn't an allowed operation."),!1):isNull(b)?(console.error("Must use a defined table name!"),toastStatusMessage("You must name your data table"),!1):(j=$.cookie(uri.domain+"_link"),i=$.cookie(uri.domain+"_auth"),k=$.cookie(uri.domain+"_secret"),null==j||null==i||null==k?(console.error("You're not logged in. Got one or more invalid tokens for secrets.",j,i,k),toastStatusMessage("Sorry, you're not logged in. Please log in and try again."),!1):(b=b+"_"+j,g="hash="+i+"&secret="+k+"&dblink="+j,null==("undefined"!=typeof adminParams&&null!==adminParams?adminParams.apiTarget:void 0)?(console.warn("Administration file not loaded. Upload cannot continue"),stopLoadError("Administration file not loaded. Upload cannot continue"),!1):($.post(adminParams.apiTarget,g,"json").done(function(f){var g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa;if(!f.status)return console.error("Unable to authenticate session. Please log in."),stopLoadError("Sorry, your session has expired. Please log in and try again.");Y=[],H=[],M=[];for(R in h){X=h[R],K=[];for(n in X)switch(da=X[n],n){case"decimalLongitude":K[1]=da,M.push(da);break;case"decimalLatitude":K[0]=da,H.push(da)}Y.push(K)}j=null!=(S=H.max())?S:0,k=null!=(T=H.min())?T:0,i=null!=(U=M.max())?U:0,l=null!=(V=M.min())?V:0,v=[[j,l],[j,i],[k,i],[k,l]];try{for(ca=JSON.parse(a.transectRing),ca=Object.toArray(ca),B=0,F=0,I=ca.length;I>F;F++){if(s=ca[F],s instanceof Point&&(s=s.toGeoJson(),ca[B]=s),2!==s.length)throw{message:"Bad coordinate length for '"+s+"'"};for(P=0,J=s.length;J>P;P++)if(r=s[P],!isNumber(r))throw{message:"Bad coordinate number '"+r+"'"};++B}}catch(x){e=x,console.warn("Error parsing the user transect ring - "+e.message),ca=void 0}switch(ba=null!=ca?ca:v,y={type:"GeometryCollection",geometries:[{type:"MultiPoint",coordinates:Y},{type:"Polygon",coordinates:ba}]},t="ST_AsBinary("+JSON.stringify(y)+", 4326)",o=getColumnObj(!0),c){case"edit":return $="UPDATE "+b+" ",foo(),!1;case"insert":case"create":$="","create"===c&&($="CREATE TABLE "+b+" "),u={the_geom:t},fa=[],q=[],q.push("id int"),_adp.rowsCount=Object.size(h);for(B in h){X=h[B],B=toInt(B),ea=[],G=0,L=0,g=0,w=0,z={type:"Point",coordinates:[]},C=B+1,ea.push(C);for(n in X){da=X[n],0===B&&(O=n.toLowerCase(),p=null!=(W=o[n])?W:o[O],"object"==typeof p&&(p=p.type),q.push(n+" "+p));try{da=da.replace("'","&#95;")}catch(ga){}switch(n){case"decimalLongitude":z.coordinates[1]=da;break;case"decimalLatitude":z.coordinates[0]=da}"string"==typeof da?ea.push("'"+da+"'"):isNull(da)?ea.push("null"):ea.push(da)}0===B&&(console.log("We're appending to col names list"),q.push("the_geom geometry"),"create"===c&&($=$+" ("+q.join(",")+"); ")),A="ST_SetSRID(ST_Point("+z.coordinates[1]+","+z.coordinates[0]+"),4326)",ea.push(A),fa.push("("+ea.join(",")+")")}for(Q=4096,D=15,E=0,console.info("Inserting statements of max length "+Q),N=0,Z=Q,aa=[];fa.slice(E,E+D).length>0;){for(_=0;aa.join(", ").length<Q-1&&(++_,aa=fa.slice(E,E+_),!(_>D)););_--,_>N&&(N=_),Z>_&&(Z=_),aa=fa.slice(E,E+_),E+=_,$+="INSERT INTO "+b+" VALUES "+aa.join(", ")+";"}m="SELECT cdb_cartodbfytable('"+b+"');",$+=m,console.info("Constructed statements: maximum "+N+" rows, minimum "+Z+" rows");break;case"delete":return $="DELETE FROM "+b+" WHERE ",foo(),!1}try{return geo.postToCarto($,b,d)}catch(ha){return stopLoadBarsErrors()}}).fail(function(a,b){return console.error("Couldn't communicate with server!",a,b),console.warn(""+uri.urlString+adminParams.apiTarget+"?"+g),stopLoadError("There was a problem communicating with the server. Please try again in a bit. (E-001)"),$("#upload-data").removeAttr("disabled")}),!1))))},geo.postToCarto=function(a,b,c){var d,f,g,h,i,j,k,l,m,n,o,p;d=encodeURIComponent(encode64(a)),f="action=upload&sql_query="+d,console.info("Querying:"),console.info(a),console.info("POSTing to server"),$("#data-sync").removeAttr("indeterminate"),m=Date.now(),p=0,n=["A silly story for you, while you wait!","Everything had gone according to plan, up 'til this moment.","His design team had done their job flawlessly,","and the machine, still thrumming behind him,","a thing of another age,","was settled on a bed of prehistoric moss.","They'd done it.","But now,","beyond the protection of the pod","and facing an enormous Tyrannosaurus rex with dripping jaws,","Professor Cho reflected that,","had he known of the dinosaur's presence,","he wouldnt have left the Chronoculator","- and he certainly wouldn't have chosen 'Staying&#39; Alive',","by The Beegees,","as his dying soundtrack.","Curse his MP3 player!","The End.","Yep, your data is still being processed","And we're out of fun things to say","We hope you think it's all worth it"],g=function(){var a;return a=null!=n[p]?"("+n[p]+")":"",toastStatusMessage("Still working ... "+a),++p,window._adp.secondaryTimeout=delay(15e3,function(){return g()})};try{k=toInt(.7*_adp.rowsCount),console.log("Estimate "+k+" seconds"),window._adp.uploader=!0,$("#data-sync").removeAttr("indeterminate"),l=30*k;try{p$("#data-sync").max=l}catch(q){}(o=function(a){try{p$("#data-sync").value=a}catch(b){}return++a,window._adp.uploader&&l>=a?delay(33,function(){return o(a)}):a>l?(toastStatusMessage("This may take a few minutes. We'll give you an error if things go wrong."),window._adp.secondaryTimeout=delay(15e3,function(){return g()})):console.log("Not running upload progress indicator",a,window._adp.uploader,l)})(0)}catch(i){e=i,console.warn("Can't show upload status - "+e.message),console.warn(e.stack);try{window._adp.initialTimeout=delay(5e3,function(){var a,b;return a=toInt(k/60)+1,b=a>1?"minutes":"minute",toastStatusMessage("Please be patient, it may take a few minutes (we guess "+a+" "+b+")"),window._adp.secondaryTimeout=delay(15e3,function(){return g()})})}catch(j){h=j,console.error("Can't show backup upload notices! "+h.message),console.warn(h.stack)}}return $.post("api.php",f,"json").done(function(a){var d,e,f,g,h,i,j,k,m,n,o;if(console.log("Got back",a),a.status!==!0)return console.error("Got an error from the server!"),console.warn(a),stopLoadError("There was a problem uploading your data. Please try again."),!1;e=a.post_response,d=!1;for(i in e){n=e[i],isNull(null!=n?n.error:void 0)||(h=null!=(null!=n?n.error:void 0)?n.error[0]:"Unspecified Error",d=h);try{n=JSON.parse(n);for(j in n)o=n[j],"error"===j&&(d=o)}catch(p){}}if(d!==!1)return bsAlert("Error uploading your data: "+d,"danger"),stopLoadError("CartoDB returned an error: "+d),!1;console.info("Carto was successful! Got results",e);try{m=JsonHuman.format(e)}catch(p){}return bsAlert("Upload to CartoDB of table <code>"+b+"</code> was successful","success"),toastStatusMessage("Data parse and upload successful"),geo.dataTable=b,f="",g=isNull(f)?"object"==typeof f?f:"":"https://"+cartoAccount+".cartodb.com/api/v2/viz/"+f+"/viz.json",k=function(a){var b,d;console.info("Initiating parent callback"),stopLoad();try{l=p$("#data-sync").max,p$("#data-sync").value=l}catch(e){}return $("#data-sync").removeAttr("indeterminate"),b={boundingBox:geo.boundingBox,bsGrid:""},null!=(null!=(d=window.mapBuilder)?d.selector:void 0)?b.selector=window.mapBuilder.selector:$("google-map").exists()?b.selector=$($("google-map").get(0)).attr("id"):b.selector="#carto-map-container",_adp.defaultMapOptions=b,"function"==typeof c?c(geo.dataTable,a,b):console.info("requestCartoUpload recieved no callback")},geo.init(function(){return console.info("Post init"),getCanonicalDataCoords(geo.dataTable,null,function(a,b){return console.info("gcdc callback successful"),k(a)}),!1})}).fail(function(a,b){return console.error("Couldn't communicate with server!",a,b),console.warn(""+uri.urlString+adminParams.apiTarget+"?"+f),stopLoadError("There was a problem communicating with the server. Please try again in a bit. (E-002)"),bsAlert("Couldn't upload dataset. Please try again later.","danger")}).always(function(){var a;try{return a=Date.now()-m,console.info("POST and process took "+a+"ms"),clearTimeout(window._adp.initialTimeout),clearTimeout(window._adp.secondaryTimeout),window._adp.uploader=!1,$("#upload-data").removeAttr("disabled")}catch(b){}}),!1},sortPoints=function(a,b){var c,d,e,f,g;for(null==b&&(b=!0),window.upper=upperLeft(a),a.sort(pointSort),g=[],d=0,e=a.length;e>d;d++)c=a[d],b?g.push(c.getObj()):(f=c.toSimplePoint(),g.push(f));return delete window.upper,g},canonicalizePoint=function(a){var b,c,d,e;d={lat:null,lng:null};try{e=toFloat(a.lat),""+e===a.lat?(a.lat=toFloat(a.lat),a.lng=toFloat(a.lng)):(e=toFloat(a[0]),""+e===a[0]&&(a[0]=toFloat(a[0]),a[1]=toFloat(a[1])))}catch(f){}if("number"==typeof(null!=a?a.lat:void 0))d=a;else if("number"==typeof(null!=a?a[0]:void 0))d={lat:a[0],lng:a[1]};else try{if("number"!=typeof a.lat())throw"Not fPoint";d.lat=a.lat(),d.lng=a.lng()}catch(g){try{if("number"!=typeof a.getLat())throw"Not Point";d=a.getObj()}catch(h){if(null!=("undefined"!=typeof google&&null!==google?google.map:void 0))try{b=a.getPosition(),d.lat=b.lat(),d.lng=b.lng()}catch(i){throw"Unable to determine point type"}}}return c=new Point(d.lat,d.lng)},createConvexHull=function(a,b){var c,d,f,g,h,i,j,k,l,m,n,o;for(null==b&&(b=!1),o=[],n=[],console.log("createConvexHull called with "+Object.size(a)+" points"),a=Object.toArray(a),h=0,i=a.length;i>h;h++)m=a[h],c=canonicalizePoint(m),n.push(c);try{console.info("Getting convex hull (original: "+a.length+"; canonical: "+n.length+")",n);try{d=getConvexHull(n)}catch(p){console.warn("Couldn't run real way!"),o=sortPoints(n,!1),f=getConvexHullPoints(o)}f=d.paths}catch(g){e=g,console.error("Unable to get convex hull - "+e.message),console.warn(e.stack)}for(geo.canonicalBoundingBox=[],k=0,j=f.length;j>k;k++)m=f[k],geo.canonicalBoundingBox.push(m.getObj());return l={hull:f,points:n},geo.canonicalHullObject=l,b===!0?l:f},fPoint=function(a,b){return this.latval=a,this.lngval=b,this.lat=function(){return this.latval},this.lng=function(){return this.lngval},this.toString=function(){return"("+this.x+", "+this.y+")"},""+this},Point=function(a,b){return this.lat=toFloat(a),this.lng=toFloat(b),this.x=360*(this.lng+180),this.y=180*(this.lat+90),this.distance=function(a){var b,c;return b=a.x-this.x,c=a.y-this.y,Math.sqrt(Math.pow(b,2)+Math.pow(c,2))},this.slope=function(a){var b,c;return b=a.x-this.x,c=a.y-this.y,c/b},this.toString=function(){return"("+this.lat+", "+this.lng+")"},this.getObj=function(){var a;return a={lat:this.lat,lng:this.lng}},this.getLatLng=function(){var a;return null!=("undefined"!=typeof google&&null!==google?google.maps:void 0)?(a=this.getObj(),new google.maps.LatLng(a)):this.getObj()},this.getLat=function(){return this.lat},this.getLng=function(){return this.lng},this.toSimplePoint=function(){var a;return a=new fPoint(this.lat,this.lng)},this.toGeoJson=function(){var a;return a=[this.lat,this.lng]},""+this},geo.Point=Point,Number.prototype.toRad=function(){return this*Math.PI/180},geo.distance=function(a,b,c,d){var e,f,g,h,i,j,k;return e=6371,h=(c-a).toRad(),i=(d-b).toRad(),j=h/2,k=i/2,f=Math.pow(Math.sin(j),2)+Math.cos(a.toRad())*Math.cos(c.toRad())*Math.pow(Math.sin(k),2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),e*g},geo.getBoundingRectangle=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(null==a&&(a=geo.boundingBox),a=Object.toArray(a),isNull(a))return console.warn("Need a set of coordinates for the bounding rectangle!"),!1;for(j=-90,k=90,l=180,e=-180,f=0,h=a.length;h>f;f++)c=a[f],d=canonicalizePoint(c),g=d.lat,i=d.lng,g>j&&(j=g),k>g&&(k=g),l>i&&(l=i),i>e&&(e=i);return b={nw:[j,l],ne:[j,e],se:[k,e],sw:[k,l],north:j,east:e,west:l,south:k},geo.computedBoundingRectangle=b,b},localityFromMapBuilder=function(a,b){var c;return null==a&&(a=window.mapBuilder),c=getMapCenter(a.points),geo.reverseGeocode(c.lat,c.lng,a.points,function(a){return console.info("Got locality '"+a+"'"),"function"==typeof b?b(a):void 0}),!1},doMapBuilder=function(a,b,c){return null==a&&(a=window.mapBuilder),null==b&&(b={selector:a.selector,resetMapBuilder:!1}),null==b.resetMapBuilder&&(b.resetMapBuilder=!1),"object"!=typeof(null!=a?a.points:void 0)?(console.error("Invalid builder",a),!1):buildMap(a,b,function(a){return geo.boundingBox=a.hull,localityFromMapBuilder(a,function(b){return a.locality=b,console.info("Map results:",a),"function"==typeof c&&c(a),!1})})},geo.geocode=function(a,b,c){var d,f,g,h,i,j,k,l,m,n,o;try{null!=geo.geocoder?j=geo.geocoder:(j=new google.maps.Geocoder,geo.geocoder=j)}catch(i){return e=i,console.error("Couldn't instance a google map geocoder - "+e.message),console.warn(e.stack),!1}if(h=function(){var d;return d={address:a,componentRestrictions:b},j.geocode(d,function(a,b){var e,f,g,h,i,j,k;if(console.log("Geocoder fetched",a,b),console.log("Provided",d),b!==google.maps.GeocoderStatus.OK)return console.warn("Geocoder failed -- Google said",b),!1;g=a[0],j={},j.google={},j.human=g.formatted_address;try{for(i=g.address_components,e=0,f=i.length;f>e;e++){h=i[e];try{k=h.types[0],j.google[k]=h.long_name}catch(l){continue}}}catch(m){}
return j.partial_match=g.partial_match,"function"==typeof c?c(j):console.warn("No callback provided! Got address object",j)})},l=null,null!=a&&null!=l){n="https://maps.googleapis.com/maps/api/geocode/json",f=[];for(k in b)o=b[k],m=k+":"+encodeURIComponent(o),f.push(m);g=f.join("|"),d="address="+encodeURIComponent(a)+"&components="+g+"&key="+l,console.log("Trying",n+"?"+d),$.get(n,d,"json").done(function(a){var b,d,e,f,g,i,j,k;if(console.log("API hit fetched",a),e=a.results[0],i=a.status,i!==google.maps.GeocoderStatus.OK)return console.warn("Geocoder failed -- Google said",i),h(),!1;j={},j.google={},j.human=e.formatted_address;try{for(g=e.address_components,b=0,d=g.length;d>b;b++){f=g[b];try{k=f.types[0],j.google[k]=f.long_name}catch(l){continue}}}catch(m){}return j.partial_match=e.partial_match,"function"==typeof c?c(j):console.warn("No callback provided! Got address object",j)}).fail(function(a,b){return console.error("Error ("+b+"): Couldn't post to Google, trying geocoder"),h()})}else h();return!1},geo.reverseGeocode=function(a,b,c,d){var f,g,h,i;null==c&&(c=geo.boundingBox);try{null!=geo.geocoder?g=geo.geocoder:(g=new google.maps.Geocoder,geo.geocoder=g)}catch(f){return e=f,console.error("Couldn't instance a google map geocoder - "+e.message),console.warn(e.stack),!1}return h={lat:toFloat(a),lng:toFloat(b)},i={location:h},g.geocode(i,function(a,b){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(b===google.maps.GeocoderStatus.OK){for(console.info("Google said:",a),j=geo.getBoundingRectangle(c),s=null,g=0,h=a.length;h>g&&(t=a[g],s=t,f=t.geometry.bounds,null==f||(k=f.getNorthEast(),n=f.getSouthWest(),l=k.lat(),m=n.lat(),e=k.lng(),u=n.lng(),l<j.north||m>j.south||u>j.west||e<j.east));g++);return i=s.formatted_address,p=l<j.north,q=m>j.south,r=u>j.west,o=e<j.east,(p||q||r||o)&&(console.warn("The last locality, '"+i+"', doesn't contain all coordinates!"),console.warn("North: "+!p+", South: "+!q+", East: "+!o+", West: "+!r),console.info("Using",s,j),i="near "+i+" (nearest region)"),console.info("Computed locality: '"+i+"'"),geo.computedLocality=i,"function"==typeof d?d(i):console.warn("No callback provided to geo.reverseGeocode()!")}})},toggleGoogleMapMarkers=function(a,b,c){var d,e,f,g,h;for(null==a&&(a="positive"),null==b&&(b="#transect-viewport"),b=b+" google-map-marker[data-disease-detected='"+a+"']",g=$(b),console.info("Got "+g.length+" markers"),h=void 0,d=0,e=g.length;e>d;d++)f=g[d],null==h&&(h=!p$(f).open,console.info("Setting "+a+" markers open state to "+h)),p$(f).open=h;return"function"==typeof c&&c(h),!1},setupMapMarkerToggles=function(){var a;return a='<div class="row">\n  <h3 class="col-xs-12">\n    Toggle map markers\n  </h3>\n  <button class="btn btn-danger col-xs-3 toggle-marker" data-disease-status="positive">Positive</button>\n  <button class="btn btn-primary col-xs-3 toggle-marker" data-disease-status="negative">Negative</button>\n  <button class="btn btn-warning col-xs-3 toggle-marker" data-disease-status="no_confidence"><span class="hidden-xs">Inconclusive</span><span class="visible-xs-inline">?</span></button>\n</div>',$(".toggle-marker").exists()||$("google-map + div").append(a),console.log("Setting up events for map marker toggles"),$(".toggle-marker").unbind().click(function(){var a;return a=$(this).attr("data-disease-status"),$(".aweb-link-species").removeAttr("hidden"),console.log("Clicked '"+a+"' toggle"),toggleGoogleMapMarkers(a,null,function(b){return"no_confidence"===a&&(a="inconclusive"),b?(console.info("Hiding selector",".aweb-link-species:not([data-"+a+"='true'])"),$(".aweb-link-species:not([data-"+a+"='true'])").attr("hidden","hidden")):console.info("Removing hidden attribute")})}),!1},getConvexHull=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;try{m=a[0],g=m.getPosition()}catch(n){for(c=[],d=0,e=a.length;e>d;d++){k=a[d],b=new google.maps.Marker;try{g=k.getLatLng()}catch(o){h={lat:k.lat,lng:k.lng},g=new google.maps.LatLng(h)}b.setPosition(g),c.push(b)}a=c}for(l=[],i=0,f=a.length;f>i;i++)j=a[i],l.push(j.getPosition());return l.sort(sortPointY),l.sort(sortPointX),getConvexHullConfig(l)},sortPointX=function(a,b){return a.lng()-b.lng()},sortPointY=function(a,b){return a.lat()-b.lat()},getConvexHullPoints=function(a){var b,c,d,e,f,g;for(b=[],chainHull_2D(a,a.length,b),g=[],c=0,d=b.length;d>c;c++)f=b[c],e=new Point(f.lat(),f.lng()),g.push(e);return console.info("Got hull from "+a.length+" points:",g),g},getConvexHullConfig=function(a,b){var c,d;return null==b&&(b=geo.googleMap),c=getConvexHullPoints(a),d={map:b,paths:c,fillColor:defaultFillColor,fillOpacity:defaultFillOpacity,strokeWidth:2,strokeColor:"#0000FF",strokeOpacity:.5}};var gmarkers=[],points=[],hullPoints=[],map=null,polyline;$(function(){return null==("undefined"!=typeof google&&null!==google?google.maps:void 0)?loadJS("https://maps.googleapis.com/maps/api/js?key="+gMapsApiKey):void 0}),enableDebugLogging=function(){var a,b;if(window.debugLoggingEnabled)return!1;if(null!=("undefined"!=typeof localStorage&&null!==localStorage?localStorage.debugLog:void 0))try{b=JSON.parse(localStorage.debugLog),window._debug=b,console.info("Restored log history to local object")}catch(c){console.warn("Unable to restore log history"),window._debug=[]}else window._debug=[];window.sysConsole=console,window.sysLog=console.log,window.sysInfo=console.info,window.sysWarn=console.warn,window.sysError=console.error,console.log=function(){var a,b;return a=1<=arguments.length?slice.call(arguments,0):[],b={callType:"log",arguments:a},_debug.push(b),sysLog.apply(console,arguments),backupDebugLog(!0)},console.info=function(){var a,b;return a=1<=arguments.length?slice.call(arguments,0):[],b={callType:"info",arguments:a},_debug.push(b),sysInfo.apply(console,arguments),backupDebugLog(!0)},console.warn=function(){var a,b;return a=1<=arguments.length?slice.call(arguments,0):[],b={callType:"warn",arguments:a},_debug.push(b),sysWarn.apply(console,arguments),backupDebugLog(!0)},console.error=function(){var a,b;return a=1<=arguments.length?slice.call(arguments,0):[],b={callType:"error",arguments:a},_debug.push(b),sysError.apply(console,arguments),backupDebugLog(!0)},$(window).on("popstate",function(a){return console.log("Navigation event"),!1}),$(window).unload(function(a){return console.log("unload event"),!1}),$("#debug-reporter").remove(),a='<paper-fab id="debug-reporter" icon="icons:send" data-toggle="tooltip" title="Send Debug Report" elevation="5">\n</paper-fab>',$("body").append(a),$("#debug-reporter").click(function(){return reportDebugLog()}),window.debugLoggingEnabled=!0;try{p$(".debug-enable-context").disabled=!0}catch(d){}return!1},backupDebugLog=function(a){var b,c;if(null==a&&(a=!1),"undefined"!=typeof localStorage&&null!==localStorage&&null!=window._debug){a||console.info("Saving backup of debug log");try{c=JSON.stringify(window._debug),localStorage.debugLog=c}catch(b){e=b,sysError.apply(console,["Unable to backup debug log! "+e.message,window._debug])}}return!1},window.enableDebugLogging=enableDebugLogging,disableDebugLogging=function(){null!=("undefined"!=typeof localStorage&&null!==localStorage?localStorage.debugLog:void 0)&&(delete localStorage.debugLog,delete _debug),"function"==typeof window.sysLog&&(console.log=sysLog,console.info=sysInfo,console.warn=sysWarn,console.error=sysError),$("#debug-reporter").remove(),window.debugLoggingEnabled=!1;try{p$(".debug-disable-context").disabled=!0}catch(a){}return!1},window.disableDebugLogging=disableDebugLogging,reportDebugLog=function(){var a;return null!=window._debug&&(backupDebugLog(),console.info("Opening debug reporter"),a='<paper-dialog modal id="report-bug-modal">\n  <h2>Bug Report</h2>\n  <paper-dialog-scrollable>\n    <div>\n      <p>Copy the text below</p>\n      <textarea readonly rows="10" class="form-control">\n        '+localStorage.debugLog+'\n      </textarea>\n      <br/><br/>\n      <p>And email it to <a href="mailto:support@velociraptorsystems.com?subject=Debug%20Log">support@velociraptorsystems.com</a></p>\n    </div>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Close</paper-button>\n  </div>\n</paper-dialog-modal>',$("#report-bug-modal").remove(),$("body").append(a),safariDialogHelper("#report-bug-modal")),!1},window.reportDebugLog=reportDebugLog,$(function(){var a;return window.debugLoggingEnabled=!1,(a=function(b){var c,d;if(!("undefined"!=typeof Polymer&&null!==Polymer&&null!=(c=Polymer.RenderStatus)?c._ready:void 0)){if("undefined"!=typeof Polymer&&null!==Polymer&&b>20){d=500*b,console.warn("Fake it till you make it -- after waiting "+d+"ms, we're going to pretend Polymer is ready");try{Polymer.RenderStatus._ready=!0}catch(e){}}return console.warn("Delaying context until Polymer.RenderStatus is ready"),delay(500,function(){return b++,a(b)}),!1}return console.info("Setting up context events"),$("footer paper-icon-button[icon='icons:bug-report']").contextmenu(function(a){var b,c,d;if(a.preventDefault(),console.info("Showing bug report context menu"),b='<paper-material class="bug-report-context-wrapper" style="top:'+a.pageY+"px;left:"+a.pageX+'px;position:absolute">\n  <paper-menu class=context-menu">\n    <paper-item class="debug-enable-context" data-fn="enableDebugLogging">\n      Enable debug reporting\n    </paper-item>\n    <paper-item class="debug-disable-context" data-fn="disableDebugLogging">\n      Disable debug reporting\n    </paper-item>\n  </paper-menu>\n</paper-material>',$(".bug-report-context-wrapper").remove(),$("body").append(b),c=function(a){return $(this).addClass("iron-selected"),!1},d=function(a){return $(this).removeClass("iron-selected"),!1},$(".bug-report-context-wrapper paper-item").hover(c,d).click(function(){var a;return a=$(this).attr("data-fn"),!1}),$(".debug-enable-context").click(function(){return enableDebugLogging()}),$(".debug-disable-context").click(function(){return disableDebugLogging()}),window.debugLoggingEnabled)try{p$(".debug-enable-context").disabled=!0}catch(e){}else try{p$(".debug-disable-context").disabled=!0}catch(e){}return delay(5e3,function(){return $(".bug-report-context-wrapper").remove()})})})(0),null!=("undefined"!=typeof localStorage&&null!==localStorage?localStorage.debugLog:void 0)?enableDebugLogging():void 0});
//# sourceMappingURL=maps/c.map