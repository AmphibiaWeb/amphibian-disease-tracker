function shuffle(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function pointSort(a,b){if(a==upper)return-1;if(b==upper)return 1;var c=upper.slope(a),d=upper.slope(b);return c==d?a.distance(upper)<b.distance(upper)?-1:1:0>=c&&d>0?-1:c>0&&0>=d?1:c>d?-1:1}function upperLeft(a){for(var b=a[0],c=1;c<a.length;c++){var d=a[c];(d.y>b.y||d.y==b.y&&d.x<b.x)&&(b=d)}return b}function calculateConvexHull(){polyline&&polyline.setMap(null),document.getElementById("hull_points").innerHTML="",points=[];for(var a=0;a<gmarkers.length;a++)points.push(gmarkers[a].getPosition());points.sort(sortPointY),points.sort(sortPointX),DrawHull()}function sortPointX(a,b){return a.lng()-b.lng()}function sortPointY(a,b){return a.lat()-b.lat()}function DrawHull(){hullPoints=[],chainHull_2D(points,points.length,hullPoints),polyline=new google.maps.Polygon({map:map,paths:hullPoints,fillColor:"#FF0000",strokeWidth:2,fillOpacity:.5,strokeColor:"#0000FF",strokeOpacity:.5}),displayHullPts()}function displayHullPts(){document.getElementById("hull_points").innerHTML="";for(var a=0;a<hullPoints.length;a++)document.getElementById("hull_points").innerHTML+=hullPoints[a].toUrlValue()+"<br>"}function sortPointX(a,b){return a.lng()-b.lng()}function sortPointY(a,b){return a.lat()-b.lat()}function isLeft(a,b,c){return(b.lng()-a.lng())*(c.lat()-a.lat())-(c.lng()-a.lng())*(b.lat()-a.lat())}function chainHull_2D(a,b,c){var d,e,f=0,g=-1,h=0,i=a[0].lng();for(d=1;b>d&&a[d].lng()==i;d++);if(e=d-1,e==b-1)return c[++g]=a[h],a[e].lat()!=a[h].lat()&&(c[++g]=a[e]),c[++g]=a[h],g+1;var j,k=b-1,l=a[b-1].lng();for(d=b-2;d>=0&&a[d].lng()==l;d--);for(j=d+1,c[++g]=a[h],d=e;++d<=j;)if(!(isLeft(a[h],a[j],a[d])>=0&&j>d)){for(;g>0&&!(isLeft(c[g-1],c[g],a[d])>0);)g--;c[++g]=a[d]}for(k!=j&&(c[++g]=a[k]),f=g,d=j;--d>=e;)if(!(isLeft(a[k],a[e],a[d])>=0&&d>e)){for(;g>f&&!(isLeft(c[g-1],c[g],a[d])>0);)g--;c[++g]=a[d]}return e!=h&&(c[++g]=a[h]),g+1}var Point,activityIndicatorOff,activityIndicatorOn,adData,animateHoverShadows,animateLoad,bindClicks,bindDismissalRemoval,bsAlert,byteCount,cartoAccount,cartoMap,cartoVis,checkFileVersion,cleanupToasts,createMap,d$,deEscape,decode64,deepJQuery,defaultMapMouseOverBehaviour,delay,doCORSget,e,encode64,fPoint,foo,formatScientificNames,gMapsApiKey,getConvexHull,getConvexHullConfig,getConvexHullPoints,getLocation,getMapCenter,getMapZoom,getMaxZ,getPosterFromSrc,goTo,isBlank,isBool,isEmpty,isHovered,isJson,isNull,isNumber,jsonTo64,lightboxImages,loadJS,mapNewWindows,openLink,openTab,overlayOff,overlayOn,p$,prepURI,randomInt,roundNumber,roundNumberSigfig,safariDialogHelper,sortPointX,sortPointY,sortPoints,startLoad,stopLoad,stopLoadError,toFloat,toInt,toObject,toastStatusMessage,uri,slice=[].slice,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};try{uri={},uri.o=$.url(),uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+uri.o.attr("directory"),uri.query=uri.o.attr("fragment")}catch(_error){e=_error,console.warn("PURL not installed!")}window.locationData={},locationData.params={enableHighAccuracy:!0},locationData.last=void 0,window.debounce_timer=null,null==window.adminParams&&(window.adminParams={}),null==window._adp&&(window._adp={}),isBool=function(a,b){if(null==b&&(b=!1),b)return"boolean"==typeof a;try{return"boolean"==typeof a?a===!0||a===!1:"string"==typeof a?"true"===a.toLowerCase()||"false"===a.toLowerCase():"number"==typeof a?1===a||0===a:!1}catch(c){return e=c,!1}},isEmpty=function(a){return!a||0===a.length},isBlank=function(a){return!a||/^\s*$/.test(a)},isNull=function(a){try{if((isEmpty(a)||isBlank(a)||null==a)&&a!==!1&&0!==a)return!0}catch(b){return e=b,!1}return!1},isJson=function(a){if("object"==typeof a)return!0;try{return JSON.parse(a),!0}catch(b){return e=b,!1}return!1},isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},toFloat=function(a){return!isNumber(a)||isNull(a)?0:parseFloat(a)},toInt=function(a){return!isNumber(a)||isNull(a)?0:parseInt(a)},String.prototype.toBool=function(){return"true"===(""+this).toLowerCase()||""+this=="1"},Boolean.prototype.toBool=function(){return""+this=="true"},Number.prototype.toBool=function(){return""+this=="1"},String.prototype.addSlashes=function(){return this.replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.containsObject=function(a){var b;try{return b=_.find(this,function(b){return _.isEqual(a,b)}),"object"==typeof b}catch(c){return e=c,console.error("Please load underscore.js before using this."),console.info("https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js")}},Object.toArray=function(a){return Object.keys(a).map(function(b){return function(b){return a[b]}}(this))},Object.size=function(a){var b,c;if("object"!=typeof a)try{return a.length}catch(d){e=d,console.error("Passed argument isn't an object and doesn't have a .length parameter"),console.warn(e.message)}c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},delay=function(a,b){return setTimeout(b,a)},roundNumber=function(a,b){var c;return null==b&&(b=0),c=Math.pow(10,b),Math.round(a*c)/c},roundNumberSigfig=function(a,b){var c,d,e,f,g;return null==b&&(b=0),e=""+roundNumber(a,b),c=e.split("."),1===c.length?e+"."+Array(b+1).join("0"):(g=c.pop(),f=c[0]+".",g.length===b?e:(d=b-g.length,g+=Array(d+1).join("0"),""+f+g))},deEscape=function(a){return a=a.replace(/\&quot;/gm,'"'),a=a.replace(/\&quote;/gm,'"'),a=a.replace(/\&#95;/gm,"_"),a=a.replace(/\&#39;/gm,"'"),a=a.replace(/\&#34;/gm,'"')},jsonTo64=function(a){var b;return"array"==typeof a&&(a=toObject(arr)),b=JSON.stringify(a),encodeURIComponent(encode64(b))},encode64=function(a){try{return Base64.encode(a)}catch(b){return e=b,console.warn("Bad encode string provided"),a}},decode64=function(a){try{return Base64.decode(a)}catch(b){return e=b,console.warn("Bad decode string provided"),a}},jQuery.fn.polymerSelected=function(a,b){var c,d,f;if(null==a&&(a=void 0),null==b&&(b="attrForSelected"),c=$(this).attr(b),null==a){f=void 0;try{f=$(this).get(0).selected,isNumber(f)&&!isNull(c)&&(d=$(this).find("paper-item")[toInt(f)],f=$(d).attr(c))}catch(g){return e=g,!1}return("null"===f||null==f)&&(f=void 0),f}if(isBool(a)){if($(this).parent().children().removeAttribute("aria-selected"),$(this).parent().children().removeAttribute("active"),$(this).parent().children().removeClass("iron-selected"),$(this).prop("selected",a),$(this).prop("active",a),$(this).prop("aria-selected",a),a===!0)return $(this).addClass("iron-selected")}else try{return $(this).get(0).select(a)}catch(g){return e=g,!1}},jQuery.fn.polymerChecked=function(a){var b;return null==a&&(a=void 0),null!=a?jQuery(this).prop("checked",a):(b=jQuery(this)[0].checked,("null"===b||null==b)&&(b=void 0),b)},isHovered=function(a){return $(a+":hover").length>0},jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery.fn.isVisible=function(){return jQuery(this).is(":visible")&&"hidden"!==jQuery(this).css("visibility")},jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3},byteCount=function(a){return function(a){return encodeURI(a).split(/%..|./).length-1}}(this),toObject=function(a){var b,c,d;d={};for(c in a)b=a[c],void 0!==b&&(d[c]=b);return d},loadJS=function(a,b,c){var d,f,g;if(null==b&&(b={}),null==c&&(c=!0),$("script[src='"+a+"']").exists()){if("function"==typeof b)try{b()}catch(h){e=h,console.error("Script is already loaded, but there was an error executing the callback function - "+e.message)}return!0}return g=document.createElement("script"),g.setAttribute("src",a),g.setAttribute("async","async"),g.setAttribute("type","text/javascript"),g.src=a,g.async=!0,f=function(){var c;c=g.readyState;try{if(!b.done&&(!c||/loaded|complete/.test(c))&&(b.done=!0,"function"==typeof b))try{return b()}catch(d){return e=d,console.error("Postload callback error for "+a+" - "+e.message),console.warn(e.stack)}}catch(d){return e=d,console.error("Onload error - "+e.message)}},d=function(){console.warn("There may have been a problem loading "+a);try{if(!b.done&&(b.done=!0,"function"==typeof b&&c))try{return b()}catch(d){return e=d,console.error("Post error callback error - "+e.message)}}catch(d){return e=d,console.error("There was an error in the error handler! "+e.message)}},g.setAttribute("onload",f),g.setAttribute("onreadystate",f),g.setAttribute("onerror",d),g.onload=g.onreadystate=f,g.onerror=d,document.getElementsByTagName("head")[0].appendChild(g),!0},String.prototype.toTitleCase=function(){var a,b,c,d,e,f,g,h,i,j,k;for(h=this.replace(/([^\W_]+[^\s-]*) */g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),f=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"],a=0,b=f.length;b>a;a++)d=f[a],e=RegExp("\\s"+d+"\\s","g"),h=h.replace(e,function(a){return a.toLowerCase()});for(k=["Id","Tv"],g=0,c=k.length;c>g;g++)i=k[g],j=RegExp("\\b"+i+"\\b","g"),h=h.replace(j,i.toUpperCase());return h},Function.prototype.debounce=function(){var a,b,c,d,f,g;if(f=arguments[0],c=arguments[1],g=arguments[2],a=4<=arguments.length?slice.call(arguments,3):[],null==f&&(f=300),null==c&&(c=!1),null==g&&(g=debounce_timer),d=this,b=function(){return c||d.apply(d,a),console.log("Debounce applied")},null!=g)try{clearTimeout(g)}catch(h){e=h}else c&&(d.apply(obj,a),console.log("Executed immediately"));return setTimeout(b,f)},randomInt=function(a,b){var c,d,e;return null==a&&(a=0),null==b&&(b=1),e=Math.random(),null==a&&(c=[0,a],a=c[0],b=c[1]),a>b&&(d=[b,a],a=d[0],b=d[1]),Math.floor(e*(b-a+1)+a)},animateLoad=function(a){var b;null==a&&(a="loader"),isNumber(a)&&(a="loader"),"#"===a.slice(0,1)?(b=a,a=a.slice(1)):b="#"+a;try{return $(b).exists()?$(b).attr("active",!0):$("body").append('<paper-spinner id="'+a+'" active></paper-spinner'),!1}catch(c){return e=c,console.log("Could not animate loader",e.message)}},startLoad=animateLoad,stopLoad=function(a,b){var c;null==a&&(a="loader"),null==b&&(b=1e3),"#"===a.slice(0,1)?(c=a,a=a.slice(1)):c="#"+a;try{if($(c).exists())return $(c).addClass("good"),delay(b,function(){return $(c).removeClass("good"),$(c).removeAttr("active")})}catch(d){return e=d,console.log("Could not stop load animation",e.message)}},stopLoadError=function(a,b,c){var d;null==b&&(b="loader"),null==c&&(c=5e3),"#"===b.slice(0,1)?(d=b,b=b.slice(1)):d="#"+b;try{if($(d).exists())return $(d).addClass("bad"),null!=a&&toastStatusMessage(a,"",c),delay(c,function(){return $(d).removeClass("bad"),$(d).removeAttr("active")})}catch(f){return e=f,console.log("Could not stop load error animation",e.message)}},toastStatusMessage=function(a,b,c,d){var e,f,g;return null==b&&(b=""),null==c&&(c=3e3),null==d&&(d="#status-message"),null==(null!=(f=window.metaTracker)?f.isToasting:void 0)&&null==window.metaTracker&&(window.metaTracker={},window.metaTracker.toastTracker=[],window.metaTracker.isToasting=!1),window.metaTracker.isToasting?(g=delay(250,function(){return toastStatusMessage(a,b,c,d)}),window.metaTracker.toastTracker.push(g),!1):(window.metaTracker.isToasting=!0,isNumber(c)||(c=3e3),d.slice(0,1)===!1&&(d="#"+d),$(d).exists()||(e='<paper-toast id="'+d.slice(1)+'" duration="'+c+'"></paper-toast>',$(e).appendTo("body")),$(d).attr("text",a).text(a).addClass(b),$(d).get(0).show(),delay(c+500,function(){return $(d).empty(),$(d).removeClass(b),$(d).attr("text",""),window.metaTracker.isToasting=!1}))},cleanupToasts=function(){var a,b,c,d,e;for(c=window.metaTracker.toastTracker,d=[],a=0,b=c.length;b>a;a++){e=c[a];try{d.push(clearTimeout(e))}catch(f){}}return d},openLink=function(a){return null==a?!1:(window.open(a),!1)},openTab=function(a){return openLink(a)},goTo=function(a){return null==a?!1:(window.location.href=a,!1)},mapNewWindows=function(a){return null==a&&(a=!0),$(".newwindow").each(function(){var b;return b=$(this).attr("href"),null==b&&(b=$(this).attr("data-href")),$(this).click(function(c){return a&&(c.preventDefault(),c.stopPropagation()),openTab(b)}),$(this).keypress(function(){return openTab(b)})})},deepJQuery=function(a){try{if(!$("html /deep/ "+a).exists())throw"Bad /deep/ selector";return $("html /deep/ "+a)}catch(b){e=b;try{if(!$("html >>> "+a).exists())throw"Bad >>> selector";return $("html >>> "+a)}catch(b){return e=b,$(a)}}},d$=function(a){return deepJQuery(a)},bindClicks=function(a){return null==a&&(a=".click"),$(a).each(function(){var a,b;try{if(b=$(this).attr("data-href"),!isNull(b)){$(this).unbind();try{b===uri.o.attr("path")&&"paper-tab"===$(this).prop("tagName").toLowerCase()&&$(this).parent().prop("selected",$(this).index())}catch(c){e=c,console.warn("tagname lower case error")}return $(this).click(function(){var a,c,d;try{return(null!=(a=$(this).attr("newTab"))?a.toBool():void 0)||(null!=(c=$(this).attr("newtab"))?c.toBool():void 0)||(null!=(d=$(this).attr("data-newtab"))?d.toBool():void 0)?openTab(b):goTo(b)}catch(e){return goTo(b)}}),b}if(a=$(this).attr("data-function"),null!=a)return $(this).unbind(),$(this).click(function(){try{return console.log("Executing bound function "+a+"()"),window[a]()}catch(b){return e=b,console.error("'"+a+"()' is a bad function - "+e.message)}})}catch(c){return e=c,console.error("There was a problem binding to #"+$(this).attr("id")+" - "+e.message)}}),!1},getPosterFromSrc=function(a){var b,c;try{return c=a.split("."),b=c.pop(),c.push("png"),c.join(".")}catch(d){return e=d,""}},doCORSget=function(a,b,c,d){var f,g,h,i;null==c&&(c=void 0),null==d&&(d=void 0),f=function(){if("function"==typeof d)return d();throw Error("There was an error performing the CORS request")},h={url:a,data:b,type:"get",crossDomain:!0};try{$.ajax(h).done(function(a){return"function"==typeof c?(c(),!1):console.log(response)}).fail(function(a,b){return console.warn("Couldn't perform jQuery AJAX CORS. Attempting manually.")})}catch(j){e=j,console.warn("There was an error using jQuery to perform the CORS request. Attemping manually.")}if(a=a+"?"+b,g=function(a,b){var c;return null==a&&(a="get"),c=new XMLHttpRequest,"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c},i=g("get",a),!i)throw Error("CORS not supported");return i.onload=function(){var a;return a=i.responseText,"function"==typeof c&&c(a),console.log(a),!1},i.onerror=function(){return console.warn("Couldn't do manual XMLHttp CORS request"),f()},i.send(),!1},lightboxImages=function(a,b){var c,d;return null==a&&(a=".lightboximage"),null==b&&(b=!1),d={onStart:function(){return overlayOn()},onEnd:function(){return overlayOff(),activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif|bmp|webp",quitOnDocClick:!0,quitOnImgClick:!0},c=b?d$(a):$(a),loadJS("bower_components/imagelightbox/dist/imagelightbox.min.js",function(){return c.click(function(a){try{return a.preventDefault(),a.stopPropagation(),$(this).imageLightbox(d).startImageLightbox(),console.warn("Event propagation was stopped when clicking on this.")}catch(b){return a=b,console.error("Unable to lightbox this image!")}}).each(function(){var b,c;console.log("Using selectors '"+a+"' / '"+this+"' for lightboximages");try{if("img"===$(this).prop("tagName").toLowerCase()&&"a"!==$(this).parent().prop("tagName").toLowerCase())return c=$(this).removeClass("lightboximage").prop("outerHTML"),b=function(){switch(!1){case!!isNull($(this).attr("data-layzr-retina")):return $(this).attr("data-layzr-retina");case!!isNull($(this).attr("data-layzr")):return $(this).attr("data-layzr");case!!isNull($(this).attr("data-lightbox-image")):return $(this).attr("data-lightbox-image");default:return $(this).attr("src")}}.call(this),$(this).replaceWith("<a href='"+b+"' class='lightboximage'>"+c+"</a>"),$("a[href='"+b+"']").imageLightbox(d)}catch(f){return e=f,console.log("Couldn't parse through the elements")}}),console.info("Lightboxed the following:",c)})},activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")},activityIndicatorOff=function(){return $("#imagelightbox-loading").remove(),$("#imagelightbox-overlay").click(function(){return $("#imagelightbox").click()})},overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")},overlayOff=function(){return $("#imagelightbox-overlay").remove()},formatScientificNames=function(a){return null==a&&(a=".sciname"),$(".sciname").each(function(){var a;return a="italic"===$(this).css("font-style")?"normal":"italic",$(this).css("font-style",a)})},prepURI=function(a){return a=encodeURIComponent(a),a.replace(/%20/g,"+")},window.locationData={},locationData.params={enableHighAccuracy:!0},locationData.last=void 0,getLocation=function(a){var b,c;return null==a&&(a=void 0),c=function(a,b){return window.locationData.lat=a.coords.latitude,window.locationData.lng=a.coords.longitude,window.locationData.acc=a.coords.accuracy,window.locationData.last=Date.now(),null!=b&&b(window.locationData),!1},b=function(a,b){var c;return c=function(){switch(a.code){case 0:return"There was an error while retrieving your location: "+a.message;case 1:return"The user prevented this page from retrieving a location";case 2:return"The browser was unable to determine your location: "+a.message;case 3:return"The browser timed out retrieving your location."}}(),console.error(c),null!=b&&b(!1),!1},navigator.geolocation?navigator.geolocation.getCurrentPosition(c,b,window.locationData.params):(console.warn("This browser doesn't support geolocation!"),null!=a?a(!1):void 0)},getMaxZ=function(){var a;return a=function(){return $.map($("body *"),function(a,b){return"static"!==$(a).css("position")?parseInt($(a).css("z-index")||1):void 0})},Math.max.apply(null,a())},foo=function(){return toastStatusMessage("Sorry, this feature is not yet finished"),stopLoad(),!1},safariDialogHelper=function(a,b,c){var d,f;if(null==a&&(a="#download-chooser"),null==b&&(b=0),"function"!=typeof c&&(c=function(){return bindDismissalRemoval()}),!(10>b))return stopLoadError("Unable to show dialog. Please try again.");try{return d$(a).get(0).open(),delay(125,function(){return d$(a).get(0).refit()}),"function"==typeof c&&c(),stopLoad()}catch(g){return e=g,f=b+1,d=250,delay(d,function(){return console.warn("Trying again to display dialog after "+f*d+"ms"),safariDialogHelper(a,f,c)})}},bindDismissalRemoval=function(){return $("[dialog-dismiss]").unbind().click(function(){return $(this).parents("paper-dialog").remove()})},p$=function(a){try{return $$(a)[0]}catch(b){return $(a).get(0)}},bsAlert=function(a,b,c,d){var e,f;return null==b&&(b="warning"),null==c&&(c="body"),null==d&&(d="#bs-alert"),$(d).exists()?($(d).removeClass("alert-warning alert-info alert-danger alert-success"),$(d).addClass("alert-"+b)):(e='<div class="alert alert-'+b+' alert-dismissable hanging-alert" role="alert" id="'+d.slice(1)+'">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <div class="alert-message"></div>\n</div>',f=$("main").exists()?"main":$("article").exists()?"article":c,$(f).prepend(e)),$(d+" .alert-message").html(a)},animateHoverShadows=function(a,b,c){var d,e;return null==a&&(a="paper-card.card-tile"),null==b&&(b=2),null==c&&(c=4),d=function(){return $(this).attr("elevation",c)},e=function(){return $(this).attr("elevation",b)},$(a).hover(d,e),!1},checkFileVersion=function(a,b){var c,d,e;null==a&&(a=!1),null==b&&(b="js/c.min.js"),d=b.split("/").pop().split(".")[0],c=function(e,f){return null==e&&(e=b),null==f&&(f=d),$.get(uri.urlString+"meta.php","do=get_last_mod&file="+e,"json").done(function(b){var c;return a&&console.log("Forced version check:",b),isNumber(b.last_mod)?(null==_adp.lastMod&&(window._adp.lastMod={}),null==_adp.lastMod[f]&&(window._adp.lastMod[f]=b.last_mod),b.last_mod>_adp.lastMod[f]?(c='<div id="outdated-warning" class="alert alert-warning alert-dismissible fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>We have page updates!</strong> This page has been updated since you last refreshed. <a class="alert-link" id="refresh-page" style="cursor:pointer">Click here to refresh now</a> and get bugfixes and updates.\n</div>',$("#outdated-warning").exists()||($("body").append(c),$("#refresh-page").click(function(){return document.location.reload(!0)})),console.warn("Your current version of this page is out of date! Please refresh the page.")):a?console.info("Your version of this page is up to date: have "+window._adp.lastMod[f]+", got "+b.last_mod):void 0):!1}).fail(function(){return console.warn("Couldn't check file version!!")}).always(function(){return delay(3e5,function(){return c(e,f)})})};try{e=window._adp.lastMod[d]}catch(f){e=!1}return a||null==window._adp.lastMod||!e?(c(b,d),!0):!1},window.checkFileVersion=checkFileVersion,$(function(){bindClicks(),formatScientificNames(),lightboxImages(),animateHoverShadows(),checkFileVersion();try{$("body").tooltip({selector:"[data-toggle='tooltip']"})}catch(a){e=a,console.warn("Tooltips were attempted to be set up, but do not exist")}try{return checkAdmin(),("undefined"!=typeof adminParams&&null!==adminParams?adminParams.loadAdminUi:void 0)===!0?loadJS("js/admin.js",function(){return console.info("Loaded admin file"),loadAdminUi()}):console.info("No admin setup requested")}catch(a){}}),uri.domain=uri.o.attr("host").split(".").reverse().pop(),cartoAccount="tigerhawkvok",gMapsApiKey="AIzaSyAZvQMkfFkbqNStlgzNjw1VOWBASd74gq4",cartoMap=null,cartoVis=null,adData={},window.geo={},geo.GLOBE_WIDTH_GOOGLE=256,geo.init=function(a){var b;try{window.locationData.lat=37.871527,window.locationData.lng=-122.262113,getLocation()}catch(c){}return b='<link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />',$("head").append(b),null==a&&(a=function(){return createMap(adData.cartoRef),!1}),window.gMapsCallback=function(){return loadJS("https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js",a,!1)},loadJS("https://maps.googleapis.com/maps/api/js?key="+gMapsApiKey+"&callback=gMapsCallback")},getMapCenter=function(a){var b,c,d,e,f,g,h,i;if(null!=a){f=0,h=0;for(g in a)e=a[g],++f,h+=e[0],console.info(e,f,h);c=toFloat(h)/toFloat(f),f=0,i=0;for(g in a)e=a[g],++f,i+=e[1];d=toFloat(i)/toFloat(f),c=toFloat(c),d=toFloat(d),b={lat:c,lng:d}}else b={lat:window.locationData.lat,lng:window.locationData.lng};return b},getMapZoom=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;if(null==b&&(b=geo.mapSelector),null!=a){f=-180,m=180;for(g in a)e=a[g],h=null!=e.lng?e.lng:e[1],m>h&&(m=h),h>f&&(f=h);d=f-m,0>d&&(d+=360),j=null!=(l=$(b).width())?l:650,c=360/d,i=c/geo.GLOBE_WIDTH_GOOGLE,o=toInt(Math.log(j*i)/Math.LN2),k=o,--o,n=o,1>o&&(o=7)}else o=7;return o},geo.getMapZoom=getMapZoom,defaultMapMouseOverBehaviour=function(a,b,c,d,e){return console.log(a,b,c,d,e)},createMap=function(a,b,c,d){var f,g,h,i;return null==a&&(a="38544c04-5e56-11e5-8515-0e4fddd5de28"),null==b&&(b="carto-map-container"),null==a&&console.info("Can't create map without a data visualization identifier"),geo.mapId=b,geo.mapSelector="#"+b,h=function(){var f,h,i,j;null==c&&(c={cartodb_logo:!1,https:!0,mobile_layout:!0,gmaps_base_type:"hybrid",center_lat:window.locationData.lat,center_lon:window.locationData.lng,zoom:getMapZoom(geo.boundingBox)}),geo.mapParams=c,$("#"+b).exists()||(f='<div id="'+b+'" class="carto-map wide-map">\n  <!-- Dynamically inserted from unavailable target -->\n</div>',$("main #main-body").append(f)),"function"!=typeof d&&(d=function(a,b){return cartodb.createLayer(b,g).addTo(b).done(function(a){geo.mapLayer=a;try{return a.setInteraction(!0),a.on("featureOver",defaultMapMouseOverBehaviour)}catch(b){return console.warn("Can't set carto map interaction")}})}),j={center:new google.maps.LatLng(c.center_lat,c.center_lon),zoom:c.zoom,mapTypeId:google.maps.MapTypeId.HYBRID},geo.googleMap=new google.maps.Map(document.getElementById(b),j),geo.cartoMap=geo.googleMap,i=function(b){return console.info("Fetched data into Google Map from CartoDB account "+cartoAccount+", from data set "+a),geo.mapLayer=b,geo.cartoMap=geo.googleMap,clearTimeout(h),"function"==typeof d&&d(b,geo.cartoMap),!1};try{console.info("About to render map with options",geo.cartoUrl,c),cartodb.createLayer(geo.googleMap,geo.cartoUrl,c).addTo(geo.googleMap).on("done",function(a){return i(a)}).on("error",function(a){return toastStatusMessage("Couldn't load maps!"),console.error("Couldn't get map - "+a)}),h=delay(1e3,function(){return"function"==typeof d?(console.warn("Callback wasn't called, forcing"),d(null,geo.cartoMap)):void 0})}catch(k){console.warn("The map threw an error! "+e.message),console.wan(e.stack),clearTimeout(h),"function"==typeof d&&d(null,geo.cartoMap)}return!1},"object"!=typeof a?(g=/^https?:\/\/.*$/m.test(a)?a:"https://"+cartoAccount+".cartodb.com/api/v2/viz/"+a+"/viz.json",geo.cartoUrl=g,h()):(f={},i="http://tigerhawkvok.cartodb.com/api/v2/viz/38544c04-5e56-11e5-8515-0e4fddd5de28/viz.json",$.get(i,"","json").done(function(b){var c,d,e;f=b,d=[];for(c in a)e=a[c],d.push(f[c]=e);return d}).fail(function(b,c){return f=a}).always(function(){return g=f,geo.cartoUrl=g,h()}))},geo.requestCartoUpload=function(a,b,c,d){var f,g,h,i,j,k;startLoad();try{h=a.data}catch(l){}return"object"!=typeof h?(console.info("This function requires the base data to be a JSON object."),toastStatusMessage("Your data is malformed. Please double check your data and try again."),!1):(f=["edit","insert","delete","create"],indexOf.call(f,c)<0?(console.error(c+" is not an allowed operation on a data set!"),console.info("Allowed operations are ",f),toastStatusMessage("Sorry, '"+c+"' isn't an allowed operation."),!1):isNull(b)?(console.error("Must use a defined table name!"),toastStatusMessage("You must name your data table"),!1):(j=$.cookie(uri.domain+"_link"),i=$.cookie(uri.domain+"_auth"),k=$.cookie(uri.domain+"_secret"),null==j||null==i||null==k?(console.error("You're not logged in. Got one or more invalid tokens for secrets.",j,i,k),toastStatusMessage("Sorry, you're not logged in. Please log in and try again."),!1):(b=b+"_"+j,g="hash="+i+"&secret="+k+"&dblink="+j,null==("undefined"!=typeof adminParams&&null!==adminParams?adminParams.apiTarget:void 0)?(console.warn("Administration file not loaded. Upload cannot continue"),stopLoadError("Administration file not loaded. Upload cannot continue"),!1):($.post(adminParams.apiTarget,g,"json").done(function(f){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba;if(f.status){V=[],H=[],M=[];for(O in h){U=h[O],K=[];for(o in U)switch(_=U[o],o){case"decimalLongitude":K[1]=_,M.push(_);break;case"decimalLatitude":K[0]=_,H.push(_)}V.push(K)}l=null!=(Q=H.max())?Q:0,m=null!=(R=H.min())?R:0,k=null!=(S=M.max())?S:0,n=null!=(T=M.min())?T:0,v=[[l,n],[l,k],[m,k],[m,n]];try{for(Z=JSON.parse(a.transectRing),F=0,I=Z.length;I>F;F++){if(s=Z[F],2!==s.length)throw{message:"Bad coordinate length for '"+s+"'"};for(N=0,J=s.length;J>N;N++)if(r=s[N],!isNumber(r))throw{message:"Bad coordinate number '"+r+"'"}}}catch(ca){e=ca,console.warn("Error parsing the user transect ring - "+e.message),Z=void 0}switch(Y=null!=Z?Z:v,y={type:"GeometryCollection",geometries:[{type:"MultiPoint",coordinates:V},{type:"Polygon",coordinates:Y}]},t="ST_AsBinary("+JSON.stringify(y)+", 4326)",p={id:"int",collectionID:"varchar",catalogNumber:"varchar",fieldNumber:"varchar",diseaseTested:"varchar",diseaseStrain:"varchar",sampleMethod:"varchar",sampleDisposition:"varchar",diseaseDetected:"varchar",fatal:"boolean",cladeSampled:"varchar",genus:"varchar",specificEpithet:"varchar",infraspecificEpithet:"varchar",lifeStage:"varchar",dateIdentified:"date",decimalLatitude:"decimal",decimalLongitude:"decimal",alt:"decimal",coordinateUncertaintyInMeters:"decimal",Collector:"varchar",originalTaxa:"varchar",fimsExtra:"json",the_geom:"varchar"},c){case"edit":return W="UPDATE "+b+" ",foo(),!1;case"insert":case"create":W="","create"===c&&(W="CREATE TABLE "+b+" "),ba="",u={the_geom:t},ba=[],q=[],q.push("id int");for(B in h){U=h[B],B=toInt(B),aa=[],G=0,L=0,i=0,x=0,z={type:"Point",coordinates:[]},C=B+1,aa.push(C);for(o in U){_=U[o],0===B&&q.push(o+" "+p[o]);try{_=_.replace("'","&#95;")}catch(ca){}switch(o){case"decimalLongitude":z.coordinates[1]=_;break;case"decimalLatitude":z.coordinates[0]=_}"string"==typeof _?aa.push("'"+_+"'"):isNull(_)?aa.push("null"):aa.push(_)}0===B&&(console.log("We're appending to col names list"),q.push("the_geom geometry"),"create"===c&&(W=W+" ("+q.join(",")+"); ")),A="ST_SetSRID(ST_Point("+z.coordinates[0]+","+z.coordinates[1]+"),4326)",aa.push(A),ba.push("("+aa.join(",")+")")}for(D=200,E=0;ba.slice(E,E+D).length>0;)X=ba.slice(E,E+D),E+=D,W+="INSERT INTO "+b+" VALUES "+X.join(", ")+";";break;case"delete":return W="DELETE FROM "+b+" WHERE ",foo(),!1}return j=encodeURIComponent(encode64(W)),g="action=upload&sql_query="+j,console.info("Querying:"),console.info(W),console.info("GeoJSON:",y),console.info("GeoJSON String:",t),console.info("POSTing to server"),P=Date.now(),w=function(){return toastStatusMessage("Still working ..."),window._adp.secondaryTimeout=delay(15e3,function(){return w()})},window._adp.initialTimeout=delay(5e3,function(){return toastStatusMessage("This may take a few moments"),window._adp.secondaryTimeout=delay(15e3,function(){return w()})}),$.post("api.php",g,"json").done(function(a){var c,e,f,g,h,i,j,k;if(console.log("Got back",a),a.status!==!0)return console.error("Got an error from the server!"),console.warn(a),stopLoadError("There was a problem uploading your data. Please try again."),!1;e=a.post_response,c=!1;for(h in e)k=e[h],isNull(null!=k?k.error:void 0)||(c=k.error[0]);if(c!==!1)return stopLoadError("CartoDB returned an error: "+c),!1;console.info("Carto was successful! Got results",e);try{j=JsonHuman.format(e)}catch(l){}return bsAlert("Upload to CartoDB of table <code>"+b+"</code> was successful","success"),toastStatusMessage("Data parse and upload successful"),geo.dataTable=b,f="",g=isNull(f)?"object"==typeof f?f:"":"https://"+cartoAccount+".cartodb.com/api/v2/viz/"+f+"/viz.json",i=function(){return stopLoad(),"function"==typeof d?d(geo.dataTable):console.info("requestCartoUpload recieved no callback")},isNull(cartoMap)?geo.init(function(){var a,b;return a=getMapCenter(geo.boundingBox),b={cartodb_logo:!1,https:!0,mobile_layout:!0,gmaps_base_type:"hybrid",center_lat:a.lat,center_lon:a.lng,zoom:getMapZoom(geo.boundingBox)},createMap(g,void 0,b,function(){return i()}),!1}):cartodb.createLayer(cartoMap,g).addTo(cartoMap).done(function(a){return a.setInteraction(!0),a.on("featureOver",defaultMapMouseOverBehaviour),i()})}).error(function(a,b){return console.error("Couldn't communicate with server!",a,b),stopLoadError("There was a problem communicating with the server. Please try again in a bit. (E-002)"),bsAlert("Couldn't upload dataset. Please try again later.","danger")}).always(function(){var a;try{return a=Date.now()-P,console.info("POST and process took "+a+"ms"),clearTimeout(window._adp.initialTimeout),clearTimeout(window._adp.secondaryTimeout)}catch(b){}})}return console.error("Unable to authenticate session. Please log in."),stopLoadError("Sorry, your session has expired. Please log in and try again.")}).error(function(a,b){return console.error("Couldn't communicate with server!",a,b),stopLoadError("There was a problem communicating with the server. Please try again in a bit. (E-001)")}),!1))))},sortPoints=function(a,b){var c,d,e,f,g;for(null==b&&(b=!0),window.upper=upperLeft(a),a.sort(pointSort),g=[],d=0,e=a.length;e>d;d++)c=a[d],b?g.push(c.getObj()):(f={},f.lat=function(){return c.lat},f.lng=function(){return c.lng},g.push(f));return delete window.upper,g},fPoint=function(a,b){return this.latval=a,
this.lngval=b,this.lat=function(){return this.latval},this.lng=function(){return this.lngval},this.toString=function(){return"("+this.x+", "+this.y+")"},""+this},Point=function(a,b){return this.x=360*(b+180),this.y=180*(a+90),this.lat=a,this.lng=b,this.distance=function(a){var b,c;return b=a.x-this.x,c=a.y-this.y,Math.sqrt(Math.pow(b,2)+Math.pow(c,2))},this.slope=function(a){var b,c;return b=a.x-this.x,c=a.y-this.y,c/b},this.toString=function(){return"("+this.x+", "+this.y+")"},this.getObj=function(){var a;return a={lat:this.lat,lng:this.lng}},this.getLatLng=function(){return null!=("undefined"!=typeof google&&null!==google?google.maps:void 0)?new google.maps.LatLng(this.lat,this.lng):this.getObj()},this.getLat=function(){return this.lat},this.getLng=function(){return this.lng},""+this},geo.Point=Point,geo.distance=function(a,b,c,d){var e,f,g,h,i,j,k;return e=6371,h=(c-c).toRad(),i=(d-b).toRad(),j=h/2,k=i/2,f=Math.pow(Math.sin(j),2)+Math.cos(a.toRad())*Math.cos(c.toRad())*Math.pow(Math.sin(smiLng),2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),e*g},getConvexHull=function(a){var b,c,d,e;for(e=[],b=0,c=a.length;c>b;b++)d=a[b],e.push(d.getPosition());return e.sort(sortPointY),e.sort(sortPointX),getConvexHullConfig(e)},sortPointX=function(a,b){return a.lng()-b.lng()},sortPointY=function(a,b){return a.lat()-b.lat()},getConvexHullPoints=function(a){var b,c,d,e,f,g;for(b=[],chainHull_2D(a,a.length,b),f=[],c=0,d=b.length;d>c;c++)e=b[c],g={lat:e.lat(),lng:e.lng()},f.push(g);return console.info("Got hull from "+a.length+" points:",f),f},getConvexHullConfig=function(a,b){var c,d;return null==b&&(b=geo.googleMap),c=getConvexHullPoints(a),d={map:b,paths:c,fillColor:"#ff7800",fillOpacity:.35,strokeWidth:2,strokeColor:"#0000FF",strokeOpacity:.5}};var gmarkers=[],points=[],hullPoints=[],map=null,polyline;$(function(){});
//# sourceMappingURL=maps/c.map