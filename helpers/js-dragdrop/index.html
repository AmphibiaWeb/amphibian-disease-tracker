<!DOCTYPE html>
<html>
  <head>
    <title>JS Droppbable Test</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="UTF-8"/>
    <meta name="theme-color" content="#445e14"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" type="text/css" media="screen" href="css/main.min.css"/>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/drop-upload.min.js"></script>
    <script type="text/javascript">
      // Generated by CoffeeScript 1.10.0

      /*
      * Test initialization and callback
      */

      (function() {
      var dropTargetSelector, postUploadCallback;

      dropTargetSelector = "#new-message";

      postUploadCallback = function(file, result) {

      /*
      * A sample callback function for handleDragDropImage
      *
      * The "file" object contains information about the uploaded file,
      * such as name, height, width, size, type, and more. Check the
      * console logs in the demo for a full output.
      *
      * The result object contains the results of the upload. The "status"
      * key is true or false depending on the status of the upload, and
      * the other most useful keys will be "full_path" and "thumb_path".
      */
      var e, error, html, mediaType;
      window.dropperParams.dropzone.removeAllFiles();
      if (typeof result !== "object") {
      console.error("Dropzone returned an error - " + result);
      toastStatusMessage("<strong>Error</strong> There was a problem with the server handling your image. Please try again.", "danger");
      return false;
      }
      if (result.status !== true) {
      if (result.human_error == null) {
      result.human_error = "There was a problem uploading your image.";
      }
      toastStatusMessage("<strong>Error</strong> " + result.human_error, "danger");
      console.error("Error uploading!", result);
      return false;
      }
      try {
      console.info("Server returned the following result:", result);
      console.info("The script returned the following file information:", file);
      mediaType = result.mime_provided.split("/")[0];
      html = (function() {
      switch (mediaType) {
      case "image":
      return "<div class='message-media'>\n  <a href=\"" + result.full_path + "\" class=\"newwindow\">\n    <img src=\"" + result.thumb_path + "\" />\n  </a>\n  <p class=\"text-muted\">Click the thumbnail for a full-sized image (" + file.name + ")</p>\n</div>";
      case "audio":
      return "<div class=\"message-media\">\n  <audio src=" + result.full_path + " controls preload=\"auto\">\n    <img src=\"" + result.thumb_path + "\" alt=\"Audio Thumbnail\" class=\"img-responsive\" />\n    <p>\n      Your browser doesn't support the HTML5 <code>audio</code> element.\n      Please download the file below.\n    </p>\n  </audio>\n  <p class=\"text-muted\">\n    (<a href=\"" + result.full_path + "\" class=\"newwindow\" download=\"" + file.name + "\">\n      Original Media\n    </a>)\n  </p>\n</div>";
      case "video":
      return "<div class=\"message-media\">\n  <video src=" + result.full_path + " controls preload=\"auto\">\n    <img src=\"" + result.thumb_path + "\" alt=\"Audio Thumbnail\" class=\"img-responsive\" />\n    <p>\n      Your browser doesn't support the HTML5 <code>video</code> element.\n      Please download the file below.\n    </p>\n  </video>\n  <p class=\"text-muted\">\n    (<a href=\"" + result.full_path + "\" class=\"newwindow\" download=\"" + file.name + "\">\n      Original Media\n    </a>)\n  </p>\n</div>";
      }
      })();
      $("#chat-region").append(html);
      mapNewWindows();
      } catch (error) {
      e = error;
      console.error("There was a problem with upload post-processing - " + e.message);
      console.warn("Using", fileName, result);
      toastStatusMessage("<strong>Error</strong> Your upload completed, but we couldn't post-process it.", "danger");
      }
      return false;
      };

      $(function() {
      window.dropperParams.metaPath = "http://velociraptorsystems.com/samples/js-dragdrop-upload/";
      window.dropperParams.showProgress = true;
      window.dropperParams.clickTargets = ["#do-upload-image"];
      return window.dropperParams.handleDragDropImage(dropTargetSelector, postUploadCallback);
      });

      }).call(this);

    </script>
  </head>
  <body class="container">
    <h1>Uploader Test</h1>
    <p>Drag and drop a media file into the message box to test it out!</p>
    <main>
      <section class="chat-box form-horizontal">
        <h2>Chat</h2>
        <div id="chat-region" style="min-height: 25vh; border: 1px solid black; max-height: 50vh; overflow-y:scroll; ">

        </div>
        <div id="entry-region" class="form-group">
          <label for="new-message">Message:</label>
          <textarea id="new-message" class="message-input form-control" placeholder="Message ..."></textarea>
          <button type="button" class="btn btn-primary" id="do-upload-image">Upload Image</button>
          <button type="submit" class="btn btn-default">Send</button>
        </div>
      </section>
    </main>
  </body>
</html>
